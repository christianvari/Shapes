(function(){'use strict';function M(){}function S(fm,hm){this.x=fm||0,this.y=hm||0}function E(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error('THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.')}function L(fm,hm,ym,xm){this._x=fm||0,this._y=hm||0,this._z=ym||0,this._w=xm===void 0?1:xm}function A(fm,hm,ym){this.x=fm||0,this.y=hm||0,this.z=ym||0}function C(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error('THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.')}function R(fm,hm,ym,xm,vm,_m,bm,Mm,Sm,Tm){Object.defineProperty(this,'id',{value:mp++}),this.uuid=dp.generateUUID(),this.name='',this.image=fm===void 0?R.DEFAULT_IMAGE:fm,this.mipmaps=[],this.mapping=hm===void 0?R.DEFAULT_MAPPING:hm,this.wrapS=ym===void 0?Rs:ym,this.wrapT=xm===void 0?Rs:xm,this.magFilter=vm===void 0?Bs:vm,this.minFilter=_m===void 0?Gs:_m,this.anisotropy=Sm===void 0?1:Sm,this.format=bm===void 0?$s:bm,this.type=Mm===void 0?Os:Mm,this.offset=new S(0,0),this.repeat=new S(1,1),this.center=new S(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new C,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=Tm===void 0?Kl:Tm,this.version=0,this.onUpdate=null}function I(fm,hm,ym,xm){this.x=fm||0,this.y=hm||0,this.z=ym||0,this.w=xm===void 0?1:xm}function D(fm,hm,ym){this.width=fm,this.height=hm,this.scissor=new I(0,0,fm,hm),this.scissorTest=!1,this.viewport=new I(0,0,fm,hm),ym=ym||{},ym.minFilter===void 0&&(ym.minFilter=Bs),this.texture=new R(void 0,void 0,ym.wrapS,ym.wrapT,ym.magFilter,ym.minFilter,ym.format,ym.type,ym.anisotropy,ym.encoding),this.texture.generateMipmaps=!(ym.generateMipmaps!==void 0)||ym.generateMipmaps,this.depthBuffer=!(ym.depthBuffer!==void 0)||ym.depthBuffer,this.stencilBuffer=!(ym.stencilBuffer!==void 0)||ym.stencilBuffer,this.depthTexture=ym.depthTexture===void 0?null:ym.depthTexture}function U(fm,hm,ym){D.call(this,fm,hm,ym),this.activeCubeFace=0,this.activeMipMapLevel=0}function G(fm,hm,ym,xm,vm,_m,bm,Mm,Sm,Tm,Em,wm){R.call(this,null,_m,bm,Mm,Sm,Tm,xm,vm,Em,wm),this.image={data:fm,width:hm,height:ym},this.magFilter=Sm===void 0?Ds:Sm,this.minFilter=Tm===void 0?Ds:Tm,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function O(fm,hm){this.min=fm===void 0?new A(+Infinity,+Infinity,+Infinity):fm,this.max=hm===void 0?new A(-Infinity,-Infinity,-Infinity):hm}function F(fm,hm){this.center=fm===void 0?new A:fm,this.radius=hm===void 0?0:hm}function H(fm,hm){this.normal=fm===void 0?new A(1,0,0):fm,this.constant=hm===void 0?0:hm}function V(fm,hm,ym,xm,vm,_m){this.planes=[fm===void 0?new H:fm,hm===void 0?new H:hm,ym===void 0?new H:ym,xm===void 0?new H:xm,vm===void 0?new H:vm,_m===void 0?new H:_m]}function W(fm,hm,ym){return void 0===hm&&void 0===ym?this.set(fm):this.setRGB(fm,hm,ym)}function X(){function fm(vm,_m){!1===ym||(xm(vm,_m),hm.requestAnimationFrame(fm))}var hm=null,ym=!1,xm=null;return{start:function(){!0==ym||null==xm||(hm.requestAnimationFrame(fm),ym=!0)},stop:function(){ym=!1},setAnimationLoop:function(vm){xm=vm},setContext:function(vm){hm=vm}}}function Y(fm){function hm(Mm,Sm){var Tm=Mm.array,Em=Mm.dynamic?35048:35044,wm=fm.createBuffer();fm.bindBuffer(Sm,wm),fm.bufferData(Sm,Tm,Em),Mm.onUploadCallback();var Lm=5126;return Tm instanceof Float32Array?Lm=5126:Tm instanceof Float64Array?console.warn('THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.'):Tm instanceof Uint16Array?Lm=5123:Tm instanceof Int16Array?Lm=5122:Tm instanceof Uint32Array?Lm=5125:Tm instanceof Int32Array?Lm=5124:Tm instanceof Int8Array?Lm=5120:Tm instanceof Uint8Array&&(Lm=5121),{buffer:wm,type:Lm,bytesPerElement:Tm.BYTES_PER_ELEMENT,version:Mm.version}}function ym(Mm,Sm,Tm){var Em=Sm.array,wm=Sm.updateRange;fm.bindBuffer(Tm,Mm),!1===Sm.dynamic?fm.bufferData(Tm,Em,35044):-1===wm.count?fm.bufferSubData(Tm,0,Em):0===wm.count?console.error('THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.'):(fm.bufferSubData(Tm,wm.offset*Em.BYTES_PER_ELEMENT,Em.subarray(wm.offset,wm.offset+wm.count)),wm.count=-1)}var bm=new WeakMap;return{get:function(Mm){return Mm.isInterleavedBufferAttribute&&(Mm=Mm.data),bm.get(Mm)},remove:function(Mm){Mm.isInterleavedBufferAttribute&&(Mm=Mm.data);var Sm=bm.get(Mm);Sm&&(fm.deleteBuffer(Sm.buffer),bm.delete(Mm))},update:function(Mm,Sm){Mm.isInterleavedBufferAttribute&&(Mm=Mm.data);var Tm=bm.get(Mm);Tm===void 0?bm.set(Mm,hm(Mm,Sm)):Tm.version<Mm.version&&(ym(Tm.buffer,Mm,Sm),Tm.version=Mm.version)}}}function Z(fm,hm,ym,xm,vm,_m){this.a=fm,this.b=hm,this.c=ym,this.normal=xm&&xm.isVector3?xm:new A,this.vertexNormals=Array.isArray(xm)?xm:[],this.color=vm&&vm.isColor?vm:new W,this.vertexColors=Array.isArray(vm)?vm:[],this.materialIndex=_m===void 0?0:_m}function J(fm,hm,ym,xm){this._x=fm||0,this._y=hm||0,this._z=ym||0,this._order=xm||J.DefaultOrder}function Q(){this.mask=1}function K(){Object.defineProperty(this,'id',{value:Uc++}),this.uuid=dp.generateUUID(),this.name='',this.type='Object3D',this.parent=null,this.children=[],this.up=K.DefaultUp.clone();var ym=new A,xm=new J,vm=new L,_m=new A(1,1,1);xm.onChange(function(){vm.setFromEuler(xm,!1)}),vm.onChange(function(){xm.setFromQuaternion(vm,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:ym},rotation:{configurable:!0,enumerable:!0,value:xm},quaternion:{configurable:!0,enumerable:!0,value:vm},scale:{configurable:!0,enumerable:!0,value:_m},modelViewMatrix:{value:new E},normalMatrix:{value:new C}}),this.matrix=new E,this.matrixWorld=new E,this.matrixAutoUpdate=K.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Q,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function ee(){Object.defineProperty(this,'id',{value:Gc+=2}),this.uuid=dp.generateUUID(),this.name='',this.type='Geometry',this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function re(fm,hm,ym){if(Array.isArray(fm))throw new TypeError('THREE.BufferAttribute: array should be a Typed Array.');this.name='',this.array=fm,this.itemSize=hm,this.count=fm===void 0?0:fm.length/hm,this.normalized=!0===ym,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function oe(fm,hm,ym){re.call(this,new Int8Array(fm),hm,ym)}function ie(fm,hm,ym){re.call(this,new Uint8Array(fm),hm,ym)}function ne(fm,hm,ym){re.call(this,new Uint8ClampedArray(fm),hm,ym)}function se(fm,hm,ym){re.call(this,new Int16Array(fm),hm,ym)}function le(fm,hm,ym){re.call(this,new Uint16Array(fm),hm,ym)}function pe(fm,hm,ym){re.call(this,new Int32Array(fm),hm,ym)}function ue(fm,hm,ym){re.call(this,new Uint32Array(fm),hm,ym)}function ge(fm,hm,ym){re.call(this,new Float32Array(fm),hm,ym)}function fe(fm,hm,ym){re.call(this,new Float64Array(fm),hm,ym)}function he(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function ye(fm){if(0===fm.length)return-Infinity;for(var hm=fm[0],ym=1,xm=fm.length;ym<xm;++ym)fm[ym]>hm&&(hm=fm[ym]);return hm}function xe(){Object.defineProperty(this,'id',{value:Oc+=2}),this.uuid=dp.generateUUID(),this.name='',this.type='BufferGeometry',this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:Infinity},this.userData={}}function ve(fm,hm,ym,xm,vm,_m){ee.call(this),this.type='BoxGeometry',this.parameters={width:fm,height:hm,depth:ym,widthSegments:xm,heightSegments:vm,depthSegments:_m},this.fromBufferGeometry(new _e(fm,hm,ym,xm,vm,_m)),this.mergeVertices()}function _e(fm,hm,ym,xm,vm,_m){function bm(Pm,Cm,Rm,Im,Dm,zm,Nm,Bm,Um,Gm,Om){var jm=Um+1,Ym=0,Zm=0,Jm,Qm,Km=new A;for(Qm=0;Qm<Gm+1;Qm++){var $m=Qm*(Nm/Gm)-Nm/2;for(Jm=0;Jm<jm;Jm++){var eg=Jm*(zm/Um)-zm/2;Km[Pm]=eg*Im,Km[Cm]=$m*Dm,Km[Rm]=Bm/2,Tm.push(Km.x,Km.y,Km.z),Km[Pm]=0,Km[Cm]=0,Km[Rm]=0<Bm?1:-1,Em.push(Km.x,Km.y,Km.z),wm.push(Jm/Um),wm.push(1-Qm/Gm),Ym+=1}}for(Qm=0;Qm<Gm;Qm++)for(Jm=0;Jm<Um;Jm++){var tg=Lm+Jm+jm*Qm,rg=Lm+Jm+jm*(Qm+1),ag=Lm+(Jm+1)+jm*(Qm+1),og=Lm+(Jm+1)+jm*Qm;Sm.push(tg,rg,og),Sm.push(rg,ag,og),Zm+=6}Mm.addGroup(Am,Zm,Om),Am+=Zm,Lm+=Ym}xe.call(this),this.type='BoxBufferGeometry',this.parameters={width:fm,height:hm,depth:ym,widthSegments:xm,heightSegments:vm,depthSegments:_m};var Mm=this;fm=fm||1,hm=hm||1,ym=ym||1,xm=Math.floor(xm)||1,vm=Math.floor(vm)||1,_m=Math.floor(_m)||1;var Sm=[],Tm=[],Em=[],wm=[],Lm=0,Am=0;bm('z','y','x',-1,-1,ym,hm,fm,_m,vm,0),bm('z','y','x',1,-1,ym,hm,-fm,_m,vm,1),bm('x','z','y',1,1,fm,ym,hm,xm,_m,2),bm('x','z','y',1,-1,fm,ym,-hm,xm,_m,3),bm('x','y','z',1,-1,fm,hm,ym,xm,vm,4),bm('x','y','z',-1,-1,fm,hm,-ym,xm,vm,5),this.setIndex(Sm),this.addAttribute('position',new ge(Tm,3)),this.addAttribute('normal',new ge(Em,3)),this.addAttribute('uv',new ge(wm,2))}function Me(fm,hm,ym,xm){ee.call(this),this.type='PlaneGeometry',this.parameters={width:fm,height:hm,widthSegments:ym,heightSegments:xm},this.fromBufferGeometry(new Se(fm,hm,ym,xm)),this.mergeVertices()}function Se(fm,hm,ym,xm){xe.call(this),this.type='PlaneBufferGeometry',this.parameters={width:fm,height:hm,widthSegments:ym,heightSegments:xm},fm=fm||1,hm=hm||1;var vm=fm/2,_m=hm/2,bm=Math.floor(ym)||1,Mm=Math.floor(xm)||1,Sm=bm+1,Em=fm/bm,wm=hm/Mm,Lm,Am,Pm=[],Cm=[],Rm=[],Im=[];for(Am=0;Am<Mm+1;Am++){var Dm=Am*wm-_m;for(Lm=0;Lm<Sm;Lm++){var zm=Lm*Em-vm;Cm.push(zm,-Dm,0),Rm.push(0,0,1),Im.push(Lm/bm),Im.push(1-Am/Mm)}}for(Am=0;Am<Mm;Am++)for(Lm=0;Lm<bm;Lm++){var Nm=Lm+Sm*Am,Bm=Lm+Sm*(Am+1),Um=Lm+1+Sm*(Am+1),Gm=Lm+1+Sm*Am;Pm.push(Nm,Bm,Gm),Pm.push(Bm,Um,Gm)}this.setIndex(Pm),this.addAttribute('position',new ge(Cm,3)),this.addAttribute('normal',new ge(Rm,3)),this.addAttribute('uv',new ge(Im,2))}function Te(){Object.defineProperty(this,'id',{value:Fc++}),this.uuid=dp.generateUUID(),this.name='',this.type='Material',this.fog=!0,this.lights=!0,this.blending=Un,this.side=Pn,this.flatShading=!1,this.vertexColors=Dn,this.opacity=1,this.transparent=!1,this.blendSrc=Qn,this.blendDst=Kn,this.blendEquation=Vn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ss,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function Ee(fm){Te.call(this),this.type='ShaderMaterial',this.defines={},this.uniforms={},this.vertexShader='void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}',this.fragmentShader='void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}',this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,fm!==void 0&&(fm.attributes!==void 0&&console.error('THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.'),this.setValues(fm))}function we(fm,hm){this.origin=fm===void 0?new A:fm,this.direction=hm===void 0?new A:hm}function Le(fm,hm,ym){this.a=fm===void 0?new A:fm,this.b=hm===void 0?new A:hm,this.c=ym===void 0?new A:ym}function Ae(fm){Te.call(this),this.type='MeshBasicMaterial',this.color=new W(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ms,this.reflectivity=1,this.refractionRatio=0.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap='round',this.wireframeLinejoin='round',this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(fm)}function Pe(fm,hm){K.call(this),this.type='Mesh',this.geometry=fm===void 0?new xe:fm,this.material=hm===void 0?new Ae({color:16777215*Math.random()}):hm,this.drawMode=Zl,this.updateMorphTargets()}function Ce(fm,hm,ym,xm){function _m(Em,wm){hm.buffers.color.setClear(Em.r,Em.g,Em.b,wm,xm)}var bm=new W(0),Mm=0,Sm,Tm;return{getClearColor:function(){return bm},setClearColor:function(Em,wm){bm.set(Em),Mm=wm===void 0?1:wm,_m(bm,Mm)},getClearAlpha:function(){return Mm},setClearAlpha:function(Em){Mm=Em,_m(bm,Mm)},render:function(Em,wm,Lm,Am){var Pm=wm.background;null===Pm?_m(bm,Mm):Pm&&Pm.isColor&&(_m(Pm,1),Am=!0),(fm.autoClear||Am)&&fm.clear(fm.autoClearColor,fm.autoClearDepth,fm.autoClearStencil),Pm&&(Pm.isCubeTexture||Pm.isWebGLRenderTargetCube)?(Tm===void 0&&(Tm=new Pe(new _e(1,1,1),new Ee({type:'BackgroundCubeMaterial',uniforms:Dc.clone(Bc.cube.uniforms),vertexShader:Bc.cube.vertexShader,fragmentShader:Bc.cube.fragmentShader,side:Cn,depthTest:!0,depthWrite:!1,fog:!1})),Tm.geometry.removeAttribute('normal'),Tm.geometry.removeAttribute('uv'),Tm.onBeforeRender=function(Cm,Rm,Im){this.matrixWorld.copyPosition(Im.matrixWorld)},Object.defineProperty(Tm.material,'envMap',{get:function(){return this.uniforms.tCube.value}}),ym.update(Tm)),Tm.material.uniforms.tCube.value=Pm.isWebGLRenderTargetCube?Pm.texture:Pm,Tm.material.uniforms.tFlip.value=Pm.isWebGLRenderTargetCube?1:-1,Em.push(Tm,Tm.geometry,Tm.material,0,null)):Pm&&Pm.isTexture&&(Sm===void 0&&(Sm=new Pe(new Se(2,2),new Ee({type:'BackgroundMaterial',uniforms:Dc.clone(Bc.background.uniforms),vertexShader:Bc.background.vertexShader,fragmentShader:Bc.background.fragmentShader,side:Pn,depthTest:!0,depthWrite:!1,fog:!1})),Sm.geometry.removeAttribute('normal'),Object.defineProperty(Sm.material,'map',{get:function(){return this.uniforms.t2D.value}}),ym.update(Sm)),Sm.material.uniforms.t2D.value=Pm,!0===Pm.matrixAutoUpdate&&Pm.updateMatrix(),Sm.material.uniforms.uvTransform.value.copy(Pm.matrix),Em.push(Sm,Sm.geometry,Sm.material,0,null))}}}function Re(fm,hm,ym,xm){var Mm;this.setMode=function(Sm){Mm=Sm},this.render=function(Sm,Tm){fm.drawArrays(Mm,Sm,Tm),ym.update(Tm,Mm)},this.renderInstances=function(Sm,Tm,Em){var wm;if(xm.isWebGL2)wm=fm;else if(wm=hm.get('ANGLE_instanced_arrays'),null===wm)return void console.error('THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.');wm[xm.isWebGL2?'drawArraysInstanced':'drawArraysInstancedANGLE'](Mm,Tm,Em,Sm.maxInstancedCount),ym.update(Em,Mm,Sm.maxInstancedCount)}}function Ie(fm,hm,ym){function vm(Bm){if('highp'===Bm){if(0<fm.getShaderPrecisionFormat(35633,36338).precision&&0<fm.getShaderPrecisionFormat(35632,36338).precision)return'highp';Bm='mediump'}return'mediump'===Bm&&0<fm.getShaderPrecisionFormat(35633,36337).precision&&0<fm.getShaderPrecisionFormat(35632,36337).precision?'mediump':'lowp'}var _m,bm='undefined'!=typeof WebGL2RenderingContext&&fm instanceof WebGL2RenderingContext,Mm=ym.precision===void 0?'highp':ym.precision,Sm=vm(Mm);Sm!==Mm&&(console.warn('THREE.WebGLRenderer:',Mm,'not supported, using',Sm,'instead.'),Mm=Sm);var Tm=!0===ym.logarithmicDepthBuffer,Em=fm.getParameter(34930),wm=fm.getParameter(35660),Lm=fm.getParameter(3379),Am=fm.getParameter(34076),Pm=fm.getParameter(34921),Cm=fm.getParameter(36347),Rm=fm.getParameter(36348),Im=fm.getParameter(36349),Dm=0<wm,zm=bm||!!hm.get('OES_texture_float');return{isWebGL2:bm,getMaxAnisotropy:function(){if(void 0!==_m)return _m;var Bm=hm.get('EXT_texture_filter_anisotropic');return _m=null===Bm?0:fm.getParameter(Bm.MAX_TEXTURE_MAX_ANISOTROPY_EXT),_m},getMaxPrecision:vm,precision:Mm,logarithmicDepthBuffer:Tm,maxTextures:Em,maxVertexTextures:wm,maxTextureSize:Lm,maxCubemapSize:Am,maxAttributes:Pm,maxVertexUniforms:Cm,maxVaryings:Rm,maxFragmentUniforms:Im,vertexTextures:Dm,floatFragmentTextures:zm,floatVertexTextures:Dm&&zm}}function De(){function fm(){Tm.value!==xm&&(Tm.value=xm,Tm.needsUpdate=0<vm),ym.numPlanes=vm,ym.numIntersection=0}function hm(Em,wm,Lm,Am){var Pm=null===Em?0:Em.length,Cm=null;if(0!==Pm){if(Cm=Tm.value,!0!==Am||null==Cm){var Rm=Lm+4*Pm,Im=wm.matrixWorldInverse;Sm.getNormalMatrix(Im),(null==Cm||Cm.length<Rm)&&(Cm=new Float32Array(Rm));for(var Dm=0,zm=Lm;Dm!==Pm;++Dm,zm+=4)Mm.copy(Em[Dm]).applyMatrix4(Im,Sm),Mm.normal.toArray(Cm,zm),Cm[zm+3]=Mm.constant}Tm.value=Cm,Tm.needsUpdate=!0}return ym.numPlanes=Pm,Cm}var ym=this,xm=null,vm=0,_m=!1,bm=!1,Mm=new H,Sm=new C,Tm={value:null,needsUpdate:!1};this.uniform=Tm,this.numPlanes=0,this.numIntersection=0,this.init=function(Em,wm,Lm){var Am=0!==Em.length||wm||0!=vm||_m;return _m=wm,xm=hm(Em,Lm,0),vm=Em.length,Am},this.beginShadows=function(){bm=!0,hm(null)},this.endShadows=function(){bm=!1,fm()},this.setState=function(Em,wm,Lm,Am,Pm,Cm){if(!_m||null===Em||0===Em.length||bm&&!Lm)bm?hm(null):fm();else{var Rm=bm?0:vm,Im=4*Rm,Dm=Pm.clippingState||null;Tm.value=Dm,Dm=hm(Em,Am,Im,Cm);for(var zm=0;zm!==Im;++zm)Dm[zm]=xm[zm];Pm.clippingState=Dm,this.numIntersection=wm?this.numPlanes:0,this.numPlanes+=Rm}}}function ze(fm){var hm={};return{get:function(ym){if(void 0!==hm[ym])return hm[ym];var xm;return xm='WEBGL_depth_texture'===ym?fm.getExtension('WEBGL_depth_texture')||fm.getExtension('MOZ_WEBGL_depth_texture')||fm.getExtension('WEBKIT_WEBGL_depth_texture'):'EXT_texture_filter_anisotropic'===ym?fm.getExtension('EXT_texture_filter_anisotropic')||fm.getExtension('MOZ_EXT_texture_filter_anisotropic')||fm.getExtension('WEBKIT_EXT_texture_filter_anisotropic'):'WEBGL_compressed_texture_s3tc'===ym?fm.getExtension('WEBGL_compressed_texture_s3tc')||fm.getExtension('MOZ_WEBGL_compressed_texture_s3tc')||fm.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc'):'WEBGL_compressed_texture_pvrtc'===ym?fm.getExtension('WEBGL_compressed_texture_pvrtc')||fm.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc'):fm.getExtension(ym),null===xm&&console.warn('THREE.WebGLRenderer: '+ym+' extension not supported.'),hm[ym]=xm,xm}}}function Ne(fm,hm,ym){function xm(Tm){var Em=Tm.target,wm=Mm[Em.id];for(var Lm in null!==wm.index&&hm.remove(wm.index),wm.attributes)hm.remove(wm.attributes[Lm]);Em.removeEventListener('dispose',xm),delete Mm[Em.id];var Am=Sm[wm.id];Am&&(hm.remove(Am),delete Sm[wm.id]),ym.memory.geometries--}var Mm={},Sm={};return{get:function(Tm,Em){var wm=Mm[Em.id];return wm?wm:(Em.addEventListener('dispose',xm),Em.isBufferGeometry?wm=Em:Em.isGeometry&&(void 0===Em._bufferGeometry&&(Em._bufferGeometry=new xe().setFromObject(Tm)),wm=Em._bufferGeometry),Mm[Em.id]=wm,ym.memory.geometries++,wm)},update:function(Tm){var Em=Tm.index,wm=Tm.attributes;for(var Lm in null!==Em&&hm.update(Em,34963),wm)hm.update(wm[Lm],34962);var Am=Tm.morphAttributes;for(var Lm in Am)for(var Pm=Am[Lm],Cm=0,Rm=Pm.length;Cm<Rm;Cm++)hm.update(Pm[Cm],34962)},getWireframeAttribute:function(Tm){var Em=Sm[Tm.id];if(Em)return Em;var wm=[],Lm=Tm.index,Am=Tm.attributes;if(null!==Lm)for(var Pm=Lm.array,Cm=0,Rm=Pm.length;Cm<Rm;Cm+=3){var Im=Pm[Cm+0],Dm=Pm[Cm+1],zm=Pm[Cm+2];wm.push(Im,Dm,Dm,zm,zm,Im)}else for(var Pm=Am.position.array,Cm=0,Rm=Pm.length/3-1;Cm<Rm;Cm+=3){var Im=Cm+0,Dm=Cm+1,zm=Cm+2;wm.push(Im,Dm,Dm,zm,zm,Im)}return Em=new(65535<ye(wm)?ue:le)(wm,1),hm.update(Em,34963),Sm[Tm.id]=Em,Em}}}function Be(fm,hm,ym,xm){var Sm,Tm,Em;this.setMode=function(wm){Sm=wm},this.setIndex=function(wm){Tm=wm.type,Em=wm.bytesPerElement},this.render=function(wm,Lm){fm.drawElements(Sm,Lm,Tm,wm*Em),ym.update(Lm,Sm)},this.renderInstances=function(wm,Lm,Am){var Pm;if(xm.isWebGL2)Pm=fm;else{var Pm=hm.get('ANGLE_instanced_arrays');if(null===Pm)return void console.error('THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.')}Pm[xm.isWebGL2?'drawElementsInstanced':'drawElementsInstancedANGLE'](Sm,Am,Tm,Lm*Em,wm.maxInstancedCount),ym.update(Am,Sm,wm.maxInstancedCount)}}function Ue(){var vm={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:vm,programs:null,autoReset:!0,reset:function(){vm.frame++,vm.calls=0,vm.triangles=0,vm.points=0,vm.lines=0},update:function(_m,bm,Mm){switch(Mm=Mm||1,vm.calls++,bm){case 4:vm.triangles+=Mm*(_m/3);break;case 5:case 6:vm.triangles+=Mm*(_m-2);break;case 1:vm.lines+=Mm*(_m/2);break;case 3:vm.lines+=Mm*(_m-1);break;case 2:vm.lines+=Mm*_m;break;case 0:vm.points+=Mm*_m;break;default:console.error('THREE.WebGLInfo: Unknown draw mode:',bm);}}}}function Ge(fm,hm){return Math.abs(hm[1])-Math.abs(fm[1])}function Oe(fm){var ym={},xm=new Float32Array(8);return{update:function(vm,_m,bm,Mm){var Sm=vm.morphTargetInfluences,Tm=Sm.length,Em=ym[_m.id];if(Em===void 0){Em=[];for(var wm=0;wm<Tm;wm++)Em[wm]=[wm,0];ym[_m.id]=Em}for(var Lm=bm.morphTargets&&_m.morphAttributes.position,Am=bm.morphNormals&&_m.morphAttributes.normal,wm=0,Pm;wm<Tm;wm++)Pm=Em[wm],0!==Pm[1]&&(Lm&&_m.removeAttribute('morphTarget'+wm),Am&&_m.removeAttribute('morphNormal'+wm));for(var wm=0,Pm;wm<Tm;wm++)Pm=Em[wm],Pm[0]=wm,Pm[1]=Sm[wm];Em.sort(Ge);for(var wm=0,Pm;8>wm;wm++){if(Pm=Em[wm],Pm){var Cm=Pm[0],Rm=Pm[1];if(Rm){Lm&&_m.addAttribute('morphTarget'+wm,Lm[Cm]),Am&&_m.addAttribute('morphNormal'+wm,Am[Cm]),xm[wm]=Rm;continue}}xm[wm]=0}Mm.getUniforms().setValue(fm,'morphTargetInfluences',xm)}}}function Fe(fm,hm){var vm={};return{update:function(_m){var bm=hm.render.frame,Mm=_m.geometry,Sm=fm.get(_m,Mm);return vm[Sm.id]!==bm&&(Mm.isGeometry&&Sm.updateFromObject(_m),fm.update(Sm),vm[Sm.id]=bm),Sm},dispose:function(){vm={}}}}function He(fm,hm,ym,xm,vm,_m,bm,Mm,Sm,Tm){fm=fm===void 0?[]:fm,hm=hm===void 0?Ss:hm,R.call(this,fm,hm,ym,xm,vm,_m,bm,Mm,Sm,Tm),this.flipY=!1}function Ve(fm,hm,ym,xm){R.call(this,null),this.image={data:fm,width:hm,height:ym,depth:xm},this.magFilter=Ds,this.minFilter=Ds,this.generateMipmaps=!1,this.flipY=!1}function ke(){this.seq=[],this.map={}}function We(fm,hm,ym){var xm=fm[0];if(0>=xm||0<xm)return fm;var vm=hm*ym,_m=Wc[vm];if(void 0===_m&&(_m=new Float32Array(vm),Wc[vm]=_m),0!==hm){xm.toArray(_m,0);for(var bm=1,Mm=0;bm!==hm;++bm)Mm+=ym,fm[bm].toArray(_m,Mm)}return _m}function je(fm,hm){if(fm.length!==hm.length)return!1;for(var ym=0,xm=fm.length;ym<xm;ym++)if(fm[ym]!==hm[ym])return!1;return!0}function qe(fm,hm){for(var ym=0,xm=hm.length;ym<xm;ym++)fm[ym]=hm[ym]}function Xe(fm,hm){var ym=jc[hm];ym===void 0&&(ym=new Int32Array(hm),jc[hm]=ym);for(var xm=0;xm!==hm;++xm)ym[xm]=fm.allocTextureUnit();return ym}function Ye(fm,hm){var ym=this.cache;ym[0]===hm||(fm.uniform1f(this.addr,hm),ym[0]=hm)}function Ze(fm,hm){var ym=this.cache;ym[0]===hm||(fm.uniform1i(this.addr,hm),ym[0]=hm)}function Je(fm,hm){var ym=this.cache;if(hm.x!==void 0)(ym[0]!==hm.x||ym[1]!==hm.y)&&(fm.uniform2f(this.addr,hm.x,hm.y),ym[0]=hm.x,ym[1]=hm.y);else{if(je(ym,hm))return;fm.uniform2fv(this.addr,hm),qe(ym,hm)}}function Qe(fm,hm){var ym=this.cache;if(hm.x!==void 0)(ym[0]!==hm.x||ym[1]!==hm.y||ym[2]!==hm.z)&&(fm.uniform3f(this.addr,hm.x,hm.y,hm.z),ym[0]=hm.x,ym[1]=hm.y,ym[2]=hm.z);else if(hm.r!==void 0)(ym[0]!==hm.r||ym[1]!==hm.g||ym[2]!==hm.b)&&(fm.uniform3f(this.addr,hm.r,hm.g,hm.b),ym[0]=hm.r,ym[1]=hm.g,ym[2]=hm.b);else{if(je(ym,hm))return;fm.uniform3fv(this.addr,hm),qe(ym,hm)}}function Ke(fm,hm){var ym=this.cache;if(hm.x!==void 0)(ym[0]!==hm.x||ym[1]!==hm.y||ym[2]!==hm.z||ym[3]!==hm.w)&&(fm.uniform4f(this.addr,hm.x,hm.y,hm.z,hm.w),ym[0]=hm.x,ym[1]=hm.y,ym[2]=hm.z,ym[3]=hm.w);else{if(je(ym,hm))return;fm.uniform4fv(this.addr,hm),qe(ym,hm)}}function $e(fm,hm){var ym=this.cache,xm=hm.elements;if(xm===void 0){if(je(ym,hm))return;fm.uniformMatrix2fv(this.addr,!1,hm),qe(ym,hm)}else{if(je(ym,xm))return;Yc.set(xm),fm.uniformMatrix2fv(this.addr,!1,Yc),qe(ym,xm)}}function et(fm,hm){var ym=this.cache,xm=hm.elements;if(xm===void 0){if(je(ym,hm))return;fm.uniformMatrix3fv(this.addr,!1,hm),qe(ym,hm)}else{if(je(ym,xm))return;Xc.set(xm),fm.uniformMatrix3fv(this.addr,!1,Xc),qe(ym,xm)}}function tt(fm,hm){var ym=this.cache,xm=hm.elements;if(xm===void 0){if(je(ym,hm))return;fm.uniformMatrix4fv(this.addr,!1,hm),qe(ym,hm)}else{if(je(ym,xm))return;qc.set(xm),fm.uniformMatrix4fv(this.addr,!1,qc),qe(ym,xm)}}function rt(fm,hm,ym){var xm=this.cache,vm=ym.allocTextureUnit();xm[0]!==vm&&(fm.uniform1i(this.addr,vm),xm[0]=vm),ym.setTexture2D(hm||Hc,vm)}function at(fm,hm,ym){var xm=this.cache,vm=ym.allocTextureUnit();xm[0]!==vm&&(fm.uniform1i(this.addr,vm),xm[0]=vm),ym.setTexture3D(hm||Vc,vm)}function ot(fm,hm,ym){var xm=this.cache,vm=ym.allocTextureUnit();xm[0]!==vm&&(fm.uniform1i(this.addr,vm),xm[0]=vm),ym.setTextureCube(hm||kc,vm)}function it(fm,hm){var ym=this.cache;je(ym,hm)||(fm.uniform2iv(this.addr,hm),qe(ym,hm))}function nt(fm,hm){var ym=this.cache;je(ym,hm)||(fm.uniform3iv(this.addr,hm),qe(ym,hm))}function st(fm,hm){var ym=this.cache;je(ym,hm)||(fm.uniform4iv(this.addr,hm),qe(ym,hm))}function lt(fm){return 5126===fm?Ye:35664===fm?Je:35665===fm?Qe:35666===fm?Ke:35674===fm?$e:35675===fm?et:35676===fm?tt:35678===fm||36198===fm?rt:35679===fm?at:35680===fm?ot:5124===fm||35670===fm?Ze:35667===fm||35671===fm?it:35668===fm||35672===fm?nt:35669===fm||35673===fm?st:void 0}function dt(fm,hm){var ym=this.cache;je(ym,hm)||(fm.uniform1fv(this.addr,hm),qe(ym,hm))}function ct(fm,hm){var ym=this.cache;je(ym,hm)||(fm.uniform1iv(this.addr,hm),qe(ym,hm))}function ut(fm,hm){var ym=this.cache,xm=We(hm,this.size,2);je(ym,xm)||(fm.uniform2fv(this.addr,xm),this.updateCache(xm))}function mt(fm,hm){var ym=this.cache,xm=We(hm,this.size,3);je(ym,xm)||(fm.uniform3fv(this.addr,xm),this.updateCache(xm))}function gt(fm,hm){var ym=this.cache,xm=We(hm,this.size,4);je(ym,xm)||(fm.uniform4fv(this.addr,xm),this.updateCache(xm))}function ft(fm,hm){var ym=this.cache,xm=We(hm,this.size,4);je(ym,xm)||(fm.uniformMatrix2fv(this.addr,!1,xm),this.updateCache(xm))}function ht(fm,hm){var ym=this.cache,xm=We(hm,this.size,9);je(ym,xm)||(fm.uniformMatrix3fv(this.addr,!1,xm),this.updateCache(xm))}function yt(fm,hm){var ym=this.cache,xm=We(hm,this.size,16);je(ym,xm)||(fm.uniformMatrix4fv(this.addr,!1,xm),this.updateCache(xm))}function xt(fm,hm,ym){var xm=this.cache,vm=hm.length,_m=Xe(ym,vm);!1===je(xm,_m)&&(fm.uniform1iv(this.addr,_m),qe(xm,_m));for(var bm=0;bm!==vm;++bm)ym.setTexture2D(hm[bm]||Hc,_m[bm])}function vt(fm,hm,ym){var xm=this.cache,vm=hm.length,_m=Xe(ym,vm);!1===je(xm,_m)&&(fm.uniform1iv(this.addr,_m),qe(xm,_m));for(var bm=0;bm!==vm;++bm)ym.setTextureCube(hm[bm]||kc,_m[bm])}function _t(fm){return 5126===fm?dt:35664===fm?ut:35665===fm?mt:35666===fm?gt:35674===fm?ft:35675===fm?ht:35676===fm?yt:35678===fm?xt:35680===fm?vt:5124===fm||35670===fm?ct:35667===fm||35671===fm?it:35668===fm||35672===fm?nt:35669===fm||35673===fm?st:void 0}function bt(fm,hm,ym){this.id=fm,this.addr=ym,this.cache=[],this.setValue=lt(hm.type)}function Mt(fm,hm,ym){this.id=fm,this.addr=ym,this.cache=[],this.size=hm.size,this.setValue=_t(hm.type)}function St(fm){this.id=fm,ke.call(this)}function Tt(fm,hm){fm.seq.push(hm),fm.map[hm.id]=hm}function Et(fm,hm,ym){var xm=fm.name,vm=xm.length;for(Zc.lastIndex=0;;){var _m=Zc.exec(xm),bm=Zc.lastIndex,Mm=_m[1],Sm=']'===_m[2],Tm=_m[3];if(Sm&&(Mm|=0),void 0===Tm||'['===Tm&&bm+2===vm){Tt(ym,void 0===Tm?new bt(Mm,fm,hm):new Mt(Mm,fm,hm));break}else{var Em=ym.map,wm=Em[Mm];void 0===wm&&(wm=new St(Mm),Tt(ym,wm)),ym=wm}}}function wt(fm,hm,ym){ke.call(this),this.renderer=ym;for(var xm=fm.getProgramParameter(hm,35718),vm=0;vm<xm;++vm){var _m=fm.getActiveUniform(hm,vm),bm=fm.getUniformLocation(hm,_m.name);Et(_m,bm,this)}}function Lt(fm){for(var hm=fm.split('\n'),ym=0;ym<hm.length;ym++)hm[ym]=ym+1+': '+hm[ym];return hm.join('\n')}function At(fm,hm,ym){var xm=fm.createShader(hm);return fm.shaderSource(xm,ym),fm.compileShader(xm),!1===fm.getShaderParameter(xm,35713)&&console.error('THREE.WebGLShader: Shader couldn\'t compile.'),''!==fm.getShaderInfoLog(xm)&&console.warn('THREE.WebGLShader: gl.getShaderInfoLog()',35633===hm?'vertex':'fragment',fm.getShaderInfoLog(xm),Lt(ym)),xm}function Pt(fm){switch(fm){case Kl:return['Linear','( value )'];case 3001:return['sRGB','( value )'];case 3002:return['RGBE','( value )'];case 3004:return['RGBM','( value, 7.0 )'];case 3005:return['RGBM','( value, 16.0 )'];case 3006:return['RGBD','( value, 256.0 )'];case ep:return['Gamma','( value, float( GAMMA_FACTOR ) )'];default:throw new Error('unsupported encoding: '+fm);}}function Ct(fm,hm){var ym=Pt(hm);return'vec4 '+fm+'( vec4 value ) { return '+ym[0]+'ToLinear'+ym[1]+'; }'}function Rt(fm,hm){var ym=Pt(hm);return'vec4 '+fm+'( vec4 value ) { return LinearTo'+ym[0]+ym[1]+'; }'}function It(fm,hm){var ym;switch(hm){case ys:ym='Linear';break;case 2:ym='Reinhard';break;case 3:ym='Uncharted2';break;case 4:ym='OptimizedCineon';break;default:throw new Error('unsupported toneMapping: '+hm);}return'vec3 '+fm+'( vec3 color ) { return '+ym+'ToneMapping( color ); }'}function Dt(fm,hm,ym){fm=fm||{};var xm=[fm.derivatives||hm.envMapCubeUV||hm.bumpMap||hm.normalMap&&!hm.objectSpaceNormalMap||hm.flatShading?'#extension GL_OES_standard_derivatives : enable':'',(fm.fragDepth||hm.logarithmicDepthBuffer)&&ym.get('EXT_frag_depth')?'#extension GL_EXT_frag_depth : enable':'',fm.drawBuffers&&ym.get('WEBGL_draw_buffers')?'#extension GL_EXT_draw_buffers : require':'',(fm.shaderTextureLOD||hm.envMap)&&ym.get('EXT_shader_texture_lod')?'#extension GL_EXT_shader_texture_lod : enable':''];return xm.filter(Bt).join('\n')}function zt(fm){var hm=[];for(var ym in fm){var xm=fm[ym];!1===xm||hm.push('#define '+ym+' '+xm)}return hm.join('\n')}function Nt(fm,hm){for(var ym={},xm=fm.getProgramParameter(hm,35721),vm=0;vm<xm;vm++){var _m=fm.getActiveAttrib(hm,vm),bm=_m.name;ym[bm]=fm.getAttribLocation(hm,bm)}return ym}function Bt(fm){return''!==fm}function Ut(fm,hm){return fm.replace(/NUM_DIR_LIGHTS/g,hm.numDirLights).replace(/NUM_SPOT_LIGHTS/g,hm.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,hm.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,hm.numPointLights).replace(/NUM_HEMI_LIGHTS/g,hm.numHemiLights)}function Gt(fm,hm){return fm.replace(/NUM_CLIPPING_PLANES/g,hm.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,hm.numClippingPlanes-hm.numClipIntersection)}function Ot(fm){var ym=/^[ \t]*#include +<([\w\d./]+)>/gm;return fm.replace(ym,function(xm,vm){var _m=Ic[vm];if(_m===void 0)throw new Error('Can not resolve #include <'+vm+'>');return Ot(_m)})}function Ft(fm){var ym=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return fm.replace(ym,function(xm,vm,_m,bm){for(var Mm='',Sm=parseInt(vm);Sm<parseInt(_m);Sm++)Mm+=bm.replace(/\[ i \]/g,'[ '+Sm+' ]');return Mm})}function Ht(fm,hm,ym,xm,vm,_m,bm){var Mm=fm.context,Sm=xm.defines,Tm=vm.vertexShader,Em=vm.fragmentShader,wm='SHADOWMAP_TYPE_BASIC';_m.shadowMapType===Ln?wm='SHADOWMAP_TYPE_PCF':_m.shadowMapType===2&&(wm='SHADOWMAP_TYPE_PCF_SOFT');var Lm='ENVMAP_TYPE_CUBE',Am='ENVMAP_MODE_REFLECTION',Pm='ENVMAP_BLENDING_MULTIPLY';if(_m.envMap){switch(xm.envMap.mapping){case Ss:case Ts:Lm='ENVMAP_TYPE_CUBE';break;case As:case Ps:Lm='ENVMAP_TYPE_CUBE_UV';break;case Es:case ws:Lm='ENVMAP_TYPE_EQUIREC';break;case Ls:Lm='ENVMAP_TYPE_SPHERE';}switch(xm.envMap.mapping){case Ts:case ws:Am='ENVMAP_MODE_REFRACTION';}switch(xm.combine){case ms:Pm='ENVMAP_BLENDING_MULTIPLY';break;case 1:Pm='ENVMAP_BLENDING_MIX';break;case 2:Pm='ENVMAP_BLENDING_ADD';}}var Cm=0<fm.gammaFactor?fm.gammaFactor:1,Rm=bm.isWebGL2?'':Dt(xm.extensions,_m,hm),Im=zt(Sm),Dm=Mm.createProgram(),zm,Nm;if(xm.isRawShaderMaterial?(zm=[Im].filter(Bt).join('\n'),0<zm.length&&(zm+='\n'),Nm=[Rm,Im].filter(Bt).join('\n'),0<Nm.length&&(Nm+='\n')):(zm=['precision '+_m.precision+' float;','precision '+_m.precision+' int;','#define SHADER_NAME '+vm.name,Im,_m.supportsVertexTextures?'#define VERTEX_TEXTURES':'','#define GAMMA_FACTOR '+Cm,'#define MAX_BONES '+_m.maxBones,_m.useFog&&_m.fog?'#define USE_FOG':'',_m.useFog&&_m.fogExp?'#define FOG_EXP2':'',_m.map?'#define USE_MAP':'',_m.envMap?'#define USE_ENVMAP':'',_m.envMap?'#define '+Am:'',_m.lightMap?'#define USE_LIGHTMAP':'',_m.aoMap?'#define USE_AOMAP':'',_m.emissiveMap?'#define USE_EMISSIVEMAP':'',_m.bumpMap?'#define USE_BUMPMAP':'',_m.normalMap?'#define USE_NORMALMAP':'',_m.normalMap&&_m.objectSpaceNormalMap?'#define OBJECTSPACE_NORMALMAP':'',_m.displacementMap&&_m.supportsVertexTextures?'#define USE_DISPLACEMENTMAP':'',_m.specularMap?'#define USE_SPECULARMAP':'',_m.roughnessMap?'#define USE_ROUGHNESSMAP':'',_m.metalnessMap?'#define USE_METALNESSMAP':'',_m.alphaMap?'#define USE_ALPHAMAP':'',_m.vertexColors?'#define USE_COLOR':'',_m.flatShading?'#define FLAT_SHADED':'',_m.skinning?'#define USE_SKINNING':'',_m.useVertexTexture?'#define BONE_TEXTURE':'',_m.morphTargets?'#define USE_MORPHTARGETS':'',_m.morphNormals&&!1===_m.flatShading?'#define USE_MORPHNORMALS':'',_m.doubleSided?'#define DOUBLE_SIDED':'',_m.flipSided?'#define FLIP_SIDED':'',_m.shadowMapEnabled?'#define USE_SHADOWMAP':'',_m.shadowMapEnabled?'#define '+wm:'',_m.sizeAttenuation?'#define USE_SIZEATTENUATION':'',_m.logarithmicDepthBuffer?'#define USE_LOGDEPTHBUF':'',_m.logarithmicDepthBuffer&&(bm.isWebGL2||hm.get('EXT_frag_depth'))?'#define USE_LOGDEPTHBUF_EXT':'','uniform mat4 modelMatrix;','uniform mat4 modelViewMatrix;','uniform mat4 projectionMatrix;','uniform mat4 viewMatrix;','uniform mat3 normalMatrix;','uniform vec3 cameraPosition;','attribute vec3 position;','attribute vec3 normal;','attribute vec2 uv;','#ifdef USE_COLOR','\tattribute vec3 color;','#endif','#ifdef USE_MORPHTARGETS','\tattribute vec3 morphTarget0;','\tattribute vec3 morphTarget1;','\tattribute vec3 morphTarget2;','\tattribute vec3 morphTarget3;','\t#ifdef USE_MORPHNORMALS','\t\tattribute vec3 morphNormal0;','\t\tattribute vec3 morphNormal1;','\t\tattribute vec3 morphNormal2;','\t\tattribute vec3 morphNormal3;','\t#else','\t\tattribute vec3 morphTarget4;','\t\tattribute vec3 morphTarget5;','\t\tattribute vec3 morphTarget6;','\t\tattribute vec3 morphTarget7;','\t#endif','#endif','#ifdef USE_SKINNING','\tattribute vec4 skinIndex;','\tattribute vec4 skinWeight;','#endif','\n'].filter(Bt).join('\n'),Nm=[Rm,'precision '+_m.precision+' float;','precision '+_m.precision+' int;','#define SHADER_NAME '+vm.name,Im,_m.alphaTest?'#define ALPHATEST '+_m.alphaTest+(_m.alphaTest%1?'':'.0'):'','#define GAMMA_FACTOR '+Cm,_m.useFog&&_m.fog?'#define USE_FOG':'',_m.useFog&&_m.fogExp?'#define FOG_EXP2':'',_m.map?'#define USE_MAP':'',_m.envMap?'#define USE_ENVMAP':'',_m.envMap?'#define '+Lm:'',_m.envMap?'#define '+Am:'',_m.envMap?'#define '+Pm:'',_m.lightMap?'#define USE_LIGHTMAP':'',_m.aoMap?'#define USE_AOMAP':'',_m.emissiveMap?'#define USE_EMISSIVEMAP':'',_m.bumpMap?'#define USE_BUMPMAP':'',_m.normalMap?'#define USE_NORMALMAP':'',_m.normalMap&&_m.objectSpaceNormalMap?'#define OBJECTSPACE_NORMALMAP':'',_m.specularMap?'#define USE_SPECULARMAP':'',_m.roughnessMap?'#define USE_ROUGHNESSMAP':'',_m.metalnessMap?'#define USE_METALNESSMAP':'',_m.alphaMap?'#define USE_ALPHAMAP':'',_m.vertexColors?'#define USE_COLOR':'',_m.gradientMap?'#define USE_GRADIENTMAP':'',_m.flatShading?'#define FLAT_SHADED':'',_m.doubleSided?'#define DOUBLE_SIDED':'',_m.flipSided?'#define FLIP_SIDED':'',_m.shadowMapEnabled?'#define USE_SHADOWMAP':'',_m.shadowMapEnabled?'#define '+wm:'',_m.premultipliedAlpha?'#define PREMULTIPLIED_ALPHA':'',_m.physicallyCorrectLights?'#define PHYSICALLY_CORRECT_LIGHTS':'',_m.logarithmicDepthBuffer?'#define USE_LOGDEPTHBUF':'',_m.logarithmicDepthBuffer&&(bm.isWebGL2||hm.get('EXT_frag_depth'))?'#define USE_LOGDEPTHBUF_EXT':'',_m.envMap&&(bm.isWebGL2||hm.get('EXT_shader_texture_lod'))?'#define TEXTURE_LOD_EXT':'','uniform mat4 viewMatrix;','uniform vec3 cameraPosition;',_m.toneMapping===hs?'':'#define TONE_MAPPING',_m.toneMapping===hs?'':Ic.tonemapping_pars_fragment,_m.toneMapping===hs?'':It('toneMapping',_m.toneMapping),_m.dithering?'#define DITHERING':'',_m.outputEncoding||_m.mapEncoding||_m.matcapEncoding||_m.envMapEncoding||_m.emissiveMapEncoding?Ic.encodings_pars_fragment:'',_m.mapEncoding?Ct('mapTexelToLinear',_m.mapEncoding):'',_m.matcapEncoding?Ct('matcapTexelToLinear',_m.matcapEncoding):'',_m.envMapEncoding?Ct('envMapTexelToLinear',_m.envMapEncoding):'',_m.emissiveMapEncoding?Ct('emissiveMapTexelToLinear',_m.emissiveMapEncoding):'',_m.outputEncoding?Rt('linearToOutputTexel',_m.outputEncoding):'',_m.depthPacking?'#define DEPTH_PACKING '+xm.depthPacking:'','\n'].filter(Bt).join('\n')),Tm=Ot(Tm),Tm=Ut(Tm,_m),Tm=Gt(Tm,_m),Em=Ot(Em),Em=Ut(Em,_m),Em=Gt(Em,_m),Tm=Ft(Tm),Em=Ft(Em),bm.isWebGL2&&!xm.isRawShaderMaterial){var Bm=!1,Um=/^\s*#version\s+300\s+es\s*\n/;xm.isShaderMaterial&&null!==Tm.match(Um)&&null!==Em.match(Um)&&(Bm=!0,Tm=Tm.replace(Um,''),Em=Em.replace(Um,'')),zm=['#version 300 es\n','#define attribute in','#define varying out','#define texture2D texture'].join('\n')+'\n'+zm,Nm=['#version 300 es\n','#define varying in',Bm?'':'out highp vec4 pc_fragColor;',Bm?'':'#define gl_FragColor pc_fragColor','#define gl_FragDepthEXT gl_FragDepth','#define texture2D texture','#define textureCube texture','#define texture2DProj textureProj','#define texture2DLodEXT textureLod','#define texture2DProjLodEXT textureProjLod','#define textureCubeLodEXT textureLod','#define texture2DGradEXT textureGrad','#define texture2DProjGradEXT textureProjGrad','#define textureCubeGradEXT textureGrad'].join('\n')+'\n'+Nm}var Gm=zm+Tm,Om=Nm+Em,Fm=At(Mm,35633,Gm),Hm=At(Mm,35632,Om);Mm.attachShader(Dm,Fm),Mm.attachShader(Dm,Hm),void 0===xm.index0AttributeName?!0===_m.morphTargets&&Mm.bindAttribLocation(Dm,0,'position'):Mm.bindAttribLocation(Dm,0,xm.index0AttributeName),Mm.linkProgram(Dm);var Vm=Mm.getProgramInfoLog(Dm).trim(),km=Mm.getShaderInfoLog(Fm).trim(),Wm=Mm.getShaderInfoLog(Hm).trim(),jm=!0,Xm=!0;!1===Mm.getProgramParameter(Dm,35714)?(jm=!1,console.error('THREE.WebGLProgram: shader error: ',Mm.getError(),'35715',Mm.getProgramParameter(Dm,35715),'gl.getProgramInfoLog',Vm,km,Wm)):''===Vm?(''===km||''===Wm)&&(Xm=!1):console.warn('THREE.WebGLProgram: gl.getProgramInfoLog()',Vm),Xm&&(this.diagnostics={runnable:jm,material:xm,programLog:Vm,vertexShader:{log:km,prefix:zm},fragmentShader:{log:Wm,prefix:Nm}}),Mm.deleteShader(Fm),Mm.deleteShader(Hm);var Ym;this.getUniforms=function(){return void 0==Ym&&(Ym=new wt(Mm,Dm,fm)),Ym};var Zm;return this.getAttributes=function(){return void 0==Zm&&(Zm=Nt(Mm,Dm)),Zm},this.destroy=function(){Mm.deleteProgram(Dm),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn('THREE.WebGLProgram: .uniforms is now .getUniforms().'),this.getUniforms()}},attributes:{get:function(){return console.warn('THREE.WebGLProgram: .attributes is now .getAttributes().'),this.getAttributes()}}}),this.name=vm.name,this.id=Jc++,this.code=ym,this.usedTimes=1,this.program=Dm,this.vertexShader=Fm,this.fragmentShader=Hm,this}function Vt(fm,hm,ym){function xm(Sm){var Tm=Sm.skeleton,Em=Tm.bones;if(ym.floatVertexTextures)return 1024;var wm=ym.maxVertexUniforms,Lm=Math.floor((wm-20)/4),Am=Math.min(Lm,Em.length);return Am<Em.length?(console.warn('THREE.WebGLRenderer: Skeleton has '+Em.length+' bones. This GPU supports '+Am+'.'),0):Am}function vm(Sm,Tm){var Em;return Sm?Sm.isTexture?Em=Sm.encoding:Sm.isWebGLRenderTarget&&(console.warn('THREE.WebGLPrograms.getTextureEncodingFromMap: don\'t use render targets as textures. Use their .texture property instead.'),Em=Sm.texture.encoding):Em=Kl,Em===Kl&&Tm&&(Em=ep),Em}var _m=[],bm={MeshDepthMaterial:'depth',MeshDistanceMaterial:'distanceRGBA',MeshNormalMaterial:'normal',MeshBasicMaterial:'basic',MeshLambertMaterial:'lambert',MeshPhongMaterial:'phong',MeshToonMaterial:'phong',MeshStandardMaterial:'physical',MeshPhysicalMaterial:'physical',MeshMatcapMaterial:'matcap',LineBasicMaterial:'basic',LineDashedMaterial:'dashed',PointsMaterial:'points',ShadowMaterial:'shadow',SpriteMaterial:'sprite'},Mm=['precision','supportsVertexTextures','map','mapEncoding','matcapEncoding','envMap','envMapMode','envMapEncoding','lightMap','aoMap','emissiveMap','emissiveMapEncoding','bumpMap','normalMap','objectSpaceNormalMap','displacementMap','specularMap','roughnessMap','metalnessMap','gradientMap','alphaMap','combine','vertexColors','fog','useFog','fogExp','flatShading','sizeAttenuation','logarithmicDepthBuffer','skinning','maxBones','useVertexTexture','morphTargets','morphNormals','maxMorphTargets','maxMorphNormals','premultipliedAlpha','numDirLights','numPointLights','numSpotLights','numHemiLights','numRectAreaLights','shadowMapEnabled','shadowMapType','toneMapping','physicallyCorrectLights','alphaTest','doubleSided','flipSided','numClippingPlanes','numClipIntersection','depthPacking','dithering'];this.getParameters=function(Sm,Tm,Em,wm,Lm,Am,Pm){var Cm=bm[Sm.type],Rm=Pm.isSkinnedMesh?xm(Pm):0,Im=ym.precision;null!==Sm.precision&&(Im=ym.getMaxPrecision(Sm.precision),Im!==Sm.precision&&console.warn('THREE.WebGLProgram.getParameters:',Sm.precision,'not supported, using',Im,'instead.'));var Dm=fm.getRenderTarget(),zm={shaderID:Cm,precision:Im,supportsVertexTextures:ym.vertexTextures,outputEncoding:vm(Dm?Dm.texture:null,fm.gammaOutput),map:!!Sm.map,mapEncoding:vm(Sm.map,fm.gammaInput),matcap:!!Sm.matcap,matcapEncoding:vm(Sm.matcap,fm.gammaInput),envMap:!!Sm.envMap,envMapMode:Sm.envMap&&Sm.envMap.mapping,envMapEncoding:vm(Sm.envMap,fm.gammaInput),envMapCubeUV:!!Sm.envMap&&(Sm.envMap.mapping===As||Sm.envMap.mapping===Ps),lightMap:!!Sm.lightMap,aoMap:!!Sm.aoMap,emissiveMap:!!Sm.emissiveMap,emissiveMapEncoding:vm(Sm.emissiveMap,fm.gammaInput),bumpMap:!!Sm.bumpMap,normalMap:!!Sm.normalMap,objectSpaceNormalMap:Sm.normalMapType===1,displacementMap:!!Sm.displacementMap,roughnessMap:!!Sm.roughnessMap,metalnessMap:!!Sm.metalnessMap,specularMap:!!Sm.specularMap,alphaMap:!!Sm.alphaMap,gradientMap:!!Sm.gradientMap,combine:Sm.combine,vertexColors:Sm.vertexColors,fog:!!wm,useFog:Sm.fog,fogExp:wm&&wm.isFogExp2,flatShading:Sm.flatShading,sizeAttenuation:Sm.sizeAttenuation,logarithmicDepthBuffer:ym.logarithmicDepthBuffer,skinning:Sm.skinning&&0<Rm,maxBones:Rm,useVertexTexture:ym.floatVertexTextures,morphTargets:Sm.morphTargets,morphNormals:Sm.morphNormals,maxMorphTargets:fm.maxMorphTargets,maxMorphNormals:fm.maxMorphNormals,numDirLights:Tm.directional.length,numPointLights:Tm.point.length,numSpotLights:Tm.spot.length,numRectAreaLights:Tm.rectArea.length,numHemiLights:Tm.hemi.length,numClippingPlanes:Lm,numClipIntersection:Am,dithering:Sm.dithering,shadowMapEnabled:fm.shadowMap.enabled&&Pm.receiveShadow&&0<Em.length,shadowMapType:fm.shadowMap.type,toneMapping:fm.toneMapping,physicallyCorrectLights:fm.physicallyCorrectLights,premultipliedAlpha:Sm.premultipliedAlpha,alphaTest:Sm.alphaTest,doubleSided:Sm.side===Rn,flipSided:Sm.side===Cn,depthPacking:Sm.depthPacking!==void 0&&Sm.depthPacking};return zm},this.getProgramCode=function(Sm,Tm){var Em=[];if(Tm.shaderID?Em.push(Tm.shaderID):(Em.push(Sm.fragmentShader),Em.push(Sm.vertexShader)),void 0!==Sm.defines)for(var wm in Sm.defines)Em.push(wm),Em.push(Sm.defines[wm]);for(var Lm=0;Lm<Mm.length;Lm++)Em.push(Tm[Mm[Lm]]);return Em.push(Sm.onBeforeCompile.toString()),Em.push(fm.gammaOutput),Em.push(fm.gammaFactor),Em.join()},this.acquireProgram=function(Sm,Tm,Em,wm){for(var Am=0,Pm=_m.length,Lm,Cm;Am<Pm;Am++)if(Cm=_m[Am],Cm.code===wm){Lm=Cm,++Lm.usedTimes;break}return void 0===Lm&&(Lm=new Ht(fm,hm,wm,Sm,Tm,Em,ym),_m.push(Lm)),Lm},this.releaseProgram=function(Sm){if(0==--Sm.usedTimes){var Tm=_m.indexOf(Sm);_m[Tm]=_m[_m.length-1],_m.pop(),Sm.destroy()}},this.programs=_m}function kt(){var vm=new WeakMap;return{get:function(_m){var bm=vm.get(_m);return void 0===bm&&(bm={},vm.set(_m,bm)),bm},remove:function(_m){vm.delete(_m)},update:function(_m,bm,Mm){vm.get(_m)[bm]=Mm},dispose:function(){vm=new WeakMap}}}function Wt(fm,hm){return fm.renderOrder===hm.renderOrder?fm.program&&hm.program&&fm.program!==hm.program?fm.program.id-hm.program.id:fm.material.id===hm.material.id?fm.z===hm.z?fm.id-hm.id:fm.z-hm.z:fm.material.id-hm.material.id:fm.renderOrder-hm.renderOrder}function jt(fm,hm){return fm.renderOrder===hm.renderOrder?fm.z===hm.z?fm.id-hm.id:hm.z-fm.z:fm.renderOrder-hm.renderOrder}function qt(){var xm=[],vm=0,_m=[],bm=[];return{opaque:_m,transparent:bm,init:function(){vm=0,_m.length=0,bm.length=0},push:function(Mm,Sm,Tm,Em,wm){var Lm=xm[vm];Lm===void 0?(Lm={id:Mm.id,object:Mm,geometry:Sm,material:Tm,program:Tm.program,renderOrder:Mm.renderOrder,z:Em,group:wm},xm[vm]=Lm):(Lm.id=Mm.id,Lm.object=Mm,Lm.geometry=Sm,Lm.material=Tm,Lm.program=Tm.program,Lm.renderOrder=Mm.renderOrder,Lm.z=Em,Lm.group=wm),(!0===Tm.transparent?bm:_m).push(Lm),vm++},sort:function(){1<_m.length&&_m.sort(Wt),1<bm.length&&bm.sort(jt)}}}function Xt(){var ym={};return{get:function(xm,vm){var _m=ym[xm.id],bm;return void 0===_m?(bm=new qt,ym[xm.id]={},ym[xm.id][vm.id]=bm):(bm=_m[vm.id],void 0==bm&&(bm=new qt,_m[vm.id]=bm)),bm},dispose:function(){ym={}}}}function Yt(){var fm={};return{get:function(hm){if(void 0!==fm[hm.id])return fm[hm.id];var ym;switch(hm.type){case'DirectionalLight':ym={direction:new A,color:new W,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new S};break;case'SpotLight':ym={position:new A,direction:new A,color:new W,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new S};break;case'PointLight':ym={position:new A,color:new W,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new S,shadowCameraNear:1,shadowCameraFar:1e3};break;case'HemisphereLight':ym={direction:new A,skyColor:new W,groundColor:new W};break;case'RectAreaLight':ym={color:new W,position:new A,halfWidth:new A,halfHeight:new A};}return fm[hm.id]=ym,ym}}}function Zt(){var hm=new Yt,ym={id:Qc++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},xm=new A,vm=new E,_m=new E;return{setup:function(bm,Mm,Sm){for(var Tm=0,Em=0,wm=0,Lm=0,Am=0,Pm=0,Cm=0,Rm=0,Im=Sm.matrixWorldInverse,Dm=0,zm=bm.length;Dm<zm;Dm++){var Nm=bm[Dm],Bm=Nm.color,Um=Nm.intensity,Gm=Nm.distance,Om=Nm.shadow&&Nm.shadow.map?Nm.shadow.map.texture:null;if(Nm.isAmbientLight)Tm+=Bm.r*Um,Em+=Bm.g*Um,wm+=Bm.b*Um;else if(Nm.isDirectionalLight){var Fm=hm.get(Nm);if(Fm.color.copy(Nm.color).multiplyScalar(Nm.intensity),Fm.direction.setFromMatrixPosition(Nm.matrixWorld),xm.setFromMatrixPosition(Nm.target.matrixWorld),Fm.direction.sub(xm),Fm.direction.transformDirection(Im),Fm.shadow=Nm.castShadow,Nm.castShadow){var Hm=Nm.shadow;Fm.shadowBias=Hm.bias,Fm.shadowRadius=Hm.radius,Fm.shadowMapSize=Hm.mapSize}ym.directionalShadowMap[Lm]=Om,ym.directionalShadowMatrix[Lm]=Nm.shadow.matrix,ym.directional[Lm]=Fm,Lm++}else if(Nm.isSpotLight){var Fm=hm.get(Nm);if(Fm.position.setFromMatrixPosition(Nm.matrixWorld),Fm.position.applyMatrix4(Im),Fm.color.copy(Bm).multiplyScalar(Um),Fm.distance=Gm,Fm.direction.setFromMatrixPosition(Nm.matrixWorld),xm.setFromMatrixPosition(Nm.target.matrixWorld),Fm.direction.sub(xm),Fm.direction.transformDirection(Im),Fm.coneCos=Math.cos(Nm.angle),Fm.penumbraCos=Math.cos(Nm.angle*(1-Nm.penumbra)),Fm.decay=Nm.decay,Fm.shadow=Nm.castShadow,Nm.castShadow){var Hm=Nm.shadow;Fm.shadowBias=Hm.bias,Fm.shadowRadius=Hm.radius,Fm.shadowMapSize=Hm.mapSize}ym.spotShadowMap[Pm]=Om,ym.spotShadowMatrix[Pm]=Nm.shadow.matrix,ym.spot[Pm]=Fm,Pm++}else if(Nm.isRectAreaLight){var Fm=hm.get(Nm);Fm.color.copy(Bm).multiplyScalar(Um),Fm.position.setFromMatrixPosition(Nm.matrixWorld),Fm.position.applyMatrix4(Im),_m.identity(),vm.copy(Nm.matrixWorld),vm.premultiply(Im),_m.extractRotation(vm),Fm.halfWidth.set(0.5*Nm.width,0,0),Fm.halfHeight.set(0,0.5*Nm.height,0),Fm.halfWidth.applyMatrix4(_m),Fm.halfHeight.applyMatrix4(_m),ym.rectArea[Cm]=Fm,Cm++}else if(Nm.isPointLight){var Fm=hm.get(Nm);if(Fm.position.setFromMatrixPosition(Nm.matrixWorld),Fm.position.applyMatrix4(Im),Fm.color.copy(Nm.color).multiplyScalar(Nm.intensity),Fm.distance=Nm.distance,Fm.decay=Nm.decay,Fm.shadow=Nm.castShadow,Nm.castShadow){var Hm=Nm.shadow;Fm.shadowBias=Hm.bias,Fm.shadowRadius=Hm.radius,Fm.shadowMapSize=Hm.mapSize,Fm.shadowCameraNear=Hm.camera.near,Fm.shadowCameraFar=Hm.camera.far}ym.pointShadowMap[Am]=Om,ym.pointShadowMatrix[Am]=Nm.shadow.matrix,ym.point[Am]=Fm,Am++}else if(Nm.isHemisphereLight){var Fm=hm.get(Nm);Fm.direction.setFromMatrixPosition(Nm.matrixWorld),Fm.direction.transformDirection(Im),Fm.direction.normalize(),Fm.skyColor.copy(Nm.color).multiplyScalar(Um),Fm.groundColor.copy(Nm.groundColor).multiplyScalar(Um),ym.hemi[Rm]=Fm,Rm++}}ym.ambient[0]=Tm,ym.ambient[1]=Em,ym.ambient[2]=wm,ym.directional.length=Lm,ym.spot.length=Pm,ym.rectArea.length=Cm,ym.point.length=Am,ym.hemi.length=Rm,ym.hash.stateID=ym.id,ym.hash.directionalLength=Lm,ym.hash.pointLength=Am,ym.hash.spotLength=Pm,ym.hash.rectAreaLength=Cm,ym.hash.hemiLength=Rm,ym.hash.shadowsLength=Mm.length},state:ym}}function Jt(){var vm=new Zt,_m=[],bm=[];return{init:function(){_m.length=0,bm.length=0},state:{lightsArray:_m,shadowsArray:bm,lights:vm},setupLights:function(Sm){vm.setup(_m,bm,Sm)},pushLight:function(Sm){_m.push(Sm)},pushShadow:function(Sm){bm.push(Sm)}}}function Qt(){var ym={};return{get:function(xm,vm){var _m;return void 0===ym[xm.id]?(_m=new Jt,ym[xm.id]={},ym[xm.id][vm.id]=_m):void 0===ym[xm.id][vm.id]?(_m=new Jt,ym[xm.id][vm.id]=_m):_m=ym[xm.id][vm.id],_m},dispose:function(){ym={}}}}function Kt(fm){Te.call(this),this.type='MeshDepthMaterial',this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(fm)}function $t(fm){Te.call(this),this.type='MeshDistanceMaterial',this.referencePosition=new A,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(fm)}function er(fm,hm,ym){function xm(Vm,km,Wm,jm,Xm,Ym){var Zm=Vm.geometry,Jm=null,Qm=Pm,Km=Vm.customDepthMaterial;if(Wm&&(Qm=Cm,Km=Vm.customDistanceMaterial),!Km){var $m=!1;km.morphTargets&&(Zm&&Zm.isBufferGeometry?$m=Zm.morphAttributes&&Zm.morphAttributes.position&&0<Zm.morphAttributes.position.length:Zm&&Zm.isGeometry&&($m=Zm.morphTargets&&0<Zm.morphTargets.length)),Vm.isSkinnedMesh&&!1===km.skinning&&console.warn('THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:',Vm);var eg=Vm.isSkinnedMesh&&km.skinning,tg=0;$m&&(tg|=wm),eg&&(tg|=Lm),Jm=Qm[tg]}else Jm=Km;if(fm.localClippingEnabled&&!0===km.clipShadows&&0!==km.clippingPlanes.length){var rg=Jm.uuid,ag=km.uuid,og=Rm[rg];void 0===og&&(og={},Rm[rg]=og);var ig=og[ag];void 0===ig&&(ig=Jm.clone(),og[ag]=ig),Jm=ig}return Jm.visible=km.visible,Jm.wireframe=km.wireframe,Jm.side=null==km.shadowSide?Im[km.side]:km.shadowSide,Jm.clipShadows=km.clipShadows,Jm.clippingPlanes=km.clippingPlanes,Jm.clipIntersection=km.clipIntersection,Jm.wireframeLinewidth=km.wireframeLinewidth,Jm.linewidth=km.linewidth,Wm&&Jm.isMeshDistanceMaterial&&(Jm.referencePosition.copy(jm),Jm.nearDistance=Xm,Jm.farDistance=Ym),Jm}function vm(Vm,km,Wm,jm){if(!1!==Vm.visible){var Xm=Vm.layers.test(km.layers);if(Xm&&(Vm.isMesh||Vm.isLine||Vm.isPoints)&&Vm.castShadow&&(!Vm.frustumCulled||_m.intersectsObject(Vm))){Vm.modelViewMatrix.multiplyMatrices(Wm.matrixWorldInverse,Vm.matrixWorld);var Ym=hm.update(Vm),Zm=Vm.material;if(Array.isArray(Zm))for(var Jm=Ym.groups,Qm=0,Km=Jm.length;Qm<Km;Qm++){var $m=Jm[Qm],eg=Zm[$m.materialIndex];if(eg&&eg.visible){var tg=xm(Vm,eg,jm,Em,Wm.near,Wm.far);fm.renderBufferDirect(Wm,null,Ym,tg,Vm,$m)}}else if(Zm.visible){var tg=xm(Vm,Zm,jm,Em,Wm.near,Wm.far);fm.renderBufferDirect(Wm,null,Ym,tg,Vm,null)}}for(var rg=Vm.children,ag=0,og=rg.length;ag<og;ag++)vm(rg[ag],km,Wm,jm)}}for(var _m=new V,bm=new E,Mm=new S,Sm=new S(ym,ym),Tm=new A,Em=new A,wm=1,Lm=2,Pm=[,,,,],Cm=[,,,,],Rm={},Im={0:Cn,1:Pn,2:Rn},Dm=[new A(1,0,0),new A(-1,0,0),new A(0,0,1),new A(0,0,-1),new A(0,1,0),new A(0,-1,0)],zm=[new A(0,1,0),new A(0,1,0),new A(0,1,0),new A(0,1,0),new A(0,0,1),new A(0,0,-1)],Nm=[new I,new I,new I,new I,new I,new I],Bm=0;Bm!==(wm|Lm)+1;++Bm){var Um=0!=(Bm&wm),Gm=0!=(Bm&Lm),Om=new Kt({depthPacking:3201,morphTargets:Um,skinning:Gm});Pm[Bm]=Om;var Fm=new $t({morphTargets:Um,skinning:Gm});Cm[Bm]=Fm}var Hm=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Ln,this.render=function(Vm,km,Wm){if(!1!==Hm.enabled&&(!1!==Hm.autoUpdate||!1!==Hm.needsUpdate)&&0!==Vm.length){var jm=fm.context,Xm=fm.state;Xm.disable(3042),Xm.buffers.color.setClear(1,1,1,1),Xm.buffers.depth.setTest(!0),Xm.setScissorTest(!1);for(var Zm=0,Jm=Vm.length,Ym;Zm<Jm;Zm++){var Qm=Vm[Zm],Km=Qm.shadow,$m=Qm&&Qm.isPointLight;if(void 0===Km){console.warn('THREE.WebGLShadowMap:',Qm,'has no shadow.');continue}var eg=Km.camera;if(Mm.copy(Km.mapSize),Mm.min(Sm),$m){var tg=Mm.x,rg=Mm.y;Nm[0].set(2*tg,rg,tg,rg),Nm[1].set(0,rg,tg,rg),Nm[2].set(3*tg,rg,tg,rg),Nm[3].set(tg,rg,tg,rg),Nm[4].set(3*tg,0,tg,rg),Nm[5].set(tg,0,tg,rg),Mm.x*=4,Mm.y*=2}if(null===Km.map){Km.map=new D(Mm.x,Mm.y,{minFilter:Ds,magFilter:Ds,format:$s}),Km.map.texture.name=Qm.name+'.shadowMap',eg.updateProjectionMatrix()}Km.isSpotLightShadow&&Km.update(Qm);var og=Km.map,ig=Km.matrix;Em.setFromMatrixPosition(Qm.matrixWorld),eg.position.copy(Em),$m?(Ym=6,ig.makeTranslation(-Em.x,-Em.y,-Em.z)):(Ym=1,Tm.setFromMatrixPosition(Qm.target.matrixWorld),eg.lookAt(Tm),eg.updateMatrixWorld(),ig.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1),ig.multiply(eg.projectionMatrix),ig.multiply(eg.matrixWorldInverse)),fm.setRenderTarget(og),fm.clear();for(var ng=0;ng<Ym;ng++){if($m){Tm.copy(eg.position),Tm.add(Dm[ng]),eg.up.copy(zm[ng]),eg.lookAt(Tm),eg.updateMatrixWorld();var sg=Nm[ng];Xm.viewport(sg)}bm.multiplyMatrices(eg.projectionMatrix,eg.matrixWorldInverse),_m.setFromMatrix(bm),vm(km,Wm,eg,$m)}}Hm.needsUpdate=!1}}}function tr(fm,hm,ym,xm){function Mm(wg,Lg,Ag){var Pg=new Uint8Array(4),Cg=fm.createTexture();fm.bindTexture(wg,Cg),fm.texParameteri(wg,10241,9728),fm.texParameteri(wg,10240,9728);for(var Rg=0;Rg<Ag;Rg++)fm.texImage2D(Lg+Rg,0,6408,1,1,0,6408,5121,Pg);return Cg}function Em(wg,Lg){if(Qm[wg]=1,0===Km[wg]&&(fm.enableVertexAttribArray(wg),Km[wg]=1),$m[wg]!==Lg){var Ag=xm.isWebGL2?fm:hm.get('ANGLE_instanced_arrays');Ag[xm.isWebGL2?'vertexAttribDivisor':'vertexAttribDivisorANGLE'](wg,Lg),$m[wg]=Lg}}function Lm(wg){!0!==eg[wg]&&(fm.enable(wg),eg[wg]=!0)}function Am(wg){!1!==eg[wg]&&(fm.disable(wg),eg[wg]=!1)}function Rm(wg,Lg,Ag,Pg,Cg,Rg,Ig,Dg){return wg===Bn?void(ag&&(Am(3042),ag=!1)):(ag||(Lm(3042),ag=!0),wg===Hn?void(Cg=Cg||Lg,Rg=Rg||Ag,Ig=Ig||Pg,(Lg!==ig||Cg!==lg)&&(fm.blendEquationSeparate(ym.convert(Lg),ym.convert(Cg)),ig=Lg,lg=Cg),(Ag!==ng||Pg!==sg||Rg!==pg||Ig!==dg)&&(fm.blendFuncSeparate(ym.convert(Ag),ym.convert(Pg),ym.convert(Rg),ym.convert(Ig)),ng=Ag,sg=Pg,pg=Rg,dg=Ig),og=wg,cg=null):void((wg!==og||Dg!==cg)&&((ig!==Vn||lg!==Vn)&&(fm.blendEquation(32774),ig=Vn,lg=Vn),Dg?wg===Un?fm.blendFuncSeparate(1,771,1,771):wg===Gn?fm.blendFunc(1,1):wg===On?fm.blendFuncSeparate(0,0,769,771):wg===Fn?fm.blendFuncSeparate(0,768,0,770):console.error('THREE.WebGLState: Invalid blending: ',wg):wg===Un?fm.blendFuncSeparate(770,771,1,771):wg===Gn?fm.blendFunc(770,1):wg===On?fm.blendFunc(0,769):wg===Fn?fm.blendFunc(0,768):console.error('THREE.WebGLState: Invalid blending: ',wg),ng=null,sg=null,pg=null,dg=null,og=wg,cg=Dg)))}function Dm(wg){ug!==wg&&(wg?fm.frontFace(2304):fm.frontFace(2305),ug=wg)}function zm(wg){wg===0?Am(2884):(Lm(2884),wg!==mg&&(wg===En?fm.cullFace(1029):wg===2?fm.cullFace(1028):fm.cullFace(1032))),mg=wg}function Bm(wg,Lg,Ag){wg?(Lm(32823),(fg!==Lg||hg!==Ag)&&(fm.polygonOffset(Lg,Ag),fg=Lg,hg=Ag)):Am(32823)}function Gm(wg){void 0===wg&&(wg=33984+yg-1),bg!==wg&&(fm.activeTexture(wg),bg=wg)}var Xm=new function(){var wg=!1,Lg=new I,Ag=null,Pg=new I(0,0,0,0);return{setMask:function(Cg){Ag===Cg||wg||(fm.colorMask(Cg,Cg,Cg,Cg),Ag=Cg)},setLocked:function(Cg){wg=Cg},setClear:function(Cg,Rg,Ig,Dg,zg){!0===zg&&(Cg*=Dg,Rg*=Dg,Ig*=Dg),Lg.set(Cg,Rg,Ig,Dg),!1===Pg.equals(Lg)&&(fm.clearColor(Cg,Rg,Ig,Dg),Pg.copy(Lg))},reset:function(){wg=!1,Ag=null,Pg.set(-1,0,0,0)}}},Ym=new function(){var wg=!1,Lg=null,Ag=null,Pg=null;return{setTest:function(Cg){Cg?Lm(2929):Am(2929)},setMask:function(Cg){Lg===Cg||wg||(fm.depthMask(Cg),Lg=Cg)},setFunc:function(Cg){Ag!==Cg&&(Cg?Cg===0?fm.depthFunc(512):Cg===1?fm.depthFunc(519):Cg===2?fm.depthFunc(513):Cg===ss?fm.depthFunc(515):Cg===4?fm.depthFunc(514):Cg===5?fm.depthFunc(518):Cg===6?fm.depthFunc(516):Cg===7?fm.depthFunc(517):fm.depthFunc(515):fm.depthFunc(515),Ag=Cg)},setLocked:function(Cg){wg=Cg},setClear:function(Cg){Pg!==Cg&&(fm.clearDepth(Cg),Pg=Cg)},reset:function(){wg=!1,Lg=null,Ag=null,Pg=null}}},Zm=new function(){var wg=!1,Lg=null,Ag=null,Pg=null,Cg=null,Rg=null,Ig=null,Dg=null,zg=null;return{setTest:function(Ng){Ng?Lm(2960):Am(2960)},setMask:function(Ng){Lg===Ng||wg||(fm.stencilMask(Ng),Lg=Ng)},setFunc:function(Ng,Bg,Ug){(Ag!==Ng||Pg!==Bg||Cg!==Ug)&&(fm.stencilFunc(Ng,Bg,Ug),Ag=Ng,Pg=Bg,Cg=Ug)},setOp:function(Ng,Bg,Ug){(Rg!==Ng||Ig!==Bg||Dg!==Ug)&&(fm.stencilOp(Ng,Bg,Ug),Rg=Ng,Ig=Bg,Dg=Ug)},setLocked:function(Ng){wg=Ng},setClear:function(Ng){zg!==Ng&&(fm.clearStencil(Ng),zg=Ng)},reset:function(){wg=!1,Lg=null,Ag=null,Pg=null,Cg=null,Rg=null,Ig=null,Dg=null,zg=null}}},Jm=fm.getParameter(34921),Qm=new Uint8Array(Jm),Km=new Uint8Array(Jm),$m=new Uint8Array(Jm),eg={},tg=null,rg=null,ag=null,og=null,ig=null,ng=null,sg=null,lg=null,pg=null,dg=null,cg=!1,ug=null,mg=null,gg=null,fg=null,hg=null,yg=fm.getParameter(35661),xg=!1,vg=0,_g=fm.getParameter(7938);-1===_g.indexOf('WebGL')?-1!==_g.indexOf('OpenGL ES')&&(vg=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(_g)[1]),xg=2<=vg):(vg=parseFloat(/^WebGL\ ([0-9])/.exec(_g)[1]),xg=1<=vg);var bg=null,Mg={},Sg=new I,Tg=new I,Eg={};return Eg[3553]=Mm(3553,3553,1),Eg[34067]=Mm(34067,34069,6),Xm.setClear(0,0,0,1),Ym.setClear(1),Zm.setClear(0),Lm(2929),Ym.setFunc(ss),Dm(!1),zm(En),Lm(2884),Rm(Bn),{buffers:{color:Xm,depth:Ym,stencil:Zm},initAttributes:function(){for(var wg=0,Lg=Qm.length;wg<Lg;wg++)Qm[wg]=0},enableAttribute:function(wg){Em(wg,0)},enableAttributeAndDivisor:Em,disableUnusedAttributes:function(){for(var wg=0,Lg=Km.length;wg!==Lg;++wg)Km[wg]!==Qm[wg]&&(fm.disableVertexAttribArray(wg),Km[wg]=0)},enable:Lm,disable:Am,getCompressedTextureFormats:function(){if(null===tg&&(tg=[],hm.get('WEBGL_compressed_texture_pvrtc')||hm.get('WEBGL_compressed_texture_s3tc')||hm.get('WEBGL_compressed_texture_etc1')||hm.get('WEBGL_compressed_texture_astc')))for(var wg=fm.getParameter(34467),Lg=0;Lg<wg.length;Lg++)tg.push(wg[Lg]);return tg},useProgram:function(wg){return rg!==wg&&(fm.useProgram(wg),rg=wg,!0)},setBlending:Rm,setMaterial:function(wg,Lg){wg.side===Rn?Am(2884):Lm(2884);var Ag=wg.side===Cn;Lg&&(Ag=!Ag),Dm(Ag),wg.blending===Un&&!1===wg.transparent?Rm(Bn):Rm(wg.blending,wg.blendEquation,wg.blendSrc,wg.blendDst,wg.blendEquationAlpha,wg.blendSrcAlpha,wg.blendDstAlpha,wg.premultipliedAlpha),Ym.setFunc(wg.depthFunc),Ym.setTest(wg.depthTest),Ym.setMask(wg.depthWrite),Xm.setMask(wg.colorWrite),Bm(wg.polygonOffset,wg.polygonOffsetFactor,wg.polygonOffsetUnits)},setFlipSided:Dm,setCullFace:zm,setLineWidth:function(wg){wg!==gg&&(xg&&fm.lineWidth(wg),gg=wg)},setPolygonOffset:Bm,setScissorTest:function(wg){wg?Lm(3089):Am(3089)},activeTexture:Gm,bindTexture:function(wg,Lg){null===bg&&Gm();var Ag=Mg[bg];void 0===Ag&&(Ag={type:void 0,texture:void 0},Mg[bg]=Ag),(Ag.type!==wg||Ag.texture!==Lg)&&(fm.bindTexture(wg,Lg||Eg[wg]),Ag.type=wg,Ag.texture=Lg)},compressedTexImage2D:function(){try{fm.compressedTexImage2D.apply(fm,arguments)}catch(wg){console.error('THREE.WebGLState:',wg)}},texImage2D:function(){try{fm.texImage2D.apply(fm,arguments)}catch(wg){console.error('THREE.WebGLState:',wg)}},texImage3D:function(){try{fm.texImage3D.apply(fm,arguments)}catch(wg){console.error('THREE.WebGLState:',wg)}},scissor:function(wg){!1===Sg.equals(wg)&&(fm.scissor(wg.x,wg.y,wg.z,wg.w),Sg.copy(wg))},viewport:function(wg){!1===Tg.equals(wg)&&(fm.viewport(wg.x,wg.y,wg.z,wg.w),Tg.copy(wg))},reset:function(){for(var wg=0;wg<Km.length;wg++)1===Km[wg]&&(fm.disableVertexAttribArray(wg),Km[wg]=0);eg={},tg=null,bg=null,Mg={},rg=null,og=null,ug=null,mg=null,Xm.reset(),Ym.reset(),Zm.reset()}}}function rr(fm,hm,ym,xm,vm,_m,bm){function Mm(Jm,Qm){if(Jm.width>Qm||Jm.height>Qm){if('data'in Jm)return void console.warn('THREE.WebGLRenderer: image in DataTexture is too big ('+Jm.width+'x'+Jm.height+').');var Km=Qm/Math.max(Jm.width,Jm.height),$m=document.createElementNS('http://www.w3.org/1999/xhtml','canvas');$m.width=Math.floor(Jm.width*Km),$m.height=Math.floor(Jm.height*Km);var eg=$m.getContext('2d');return eg.drawImage(Jm,0,0,Jm.width,Jm.height,0,0,$m.width,$m.height),console.warn('THREE.WebGLRenderer: image is too big ('+Jm.width+'x'+Jm.height+'). Resized to '+$m.width+'x'+$m.height),$m}return Jm}function Sm(Jm){return dp.isPowerOfTwo(Jm.width)&&dp.isPowerOfTwo(Jm.height)}function Tm(Jm){if(Jm instanceof HTMLImageElement||Jm instanceof HTMLCanvasElement||Jm instanceof ImageBitmap){void 0===Zm&&(Zm=document.createElementNS('http://www.w3.org/1999/xhtml','canvas')),Zm.width=dp.floorPowerOfTwo(Jm.width),Zm.height=dp.floorPowerOfTwo(Jm.height);var Qm=Zm.getContext('2d');return Qm.drawImage(Jm,0,0,Zm.width,Zm.height),console.warn('THREE.WebGLRenderer: image is not power of two ('+Jm.width+'x'+Jm.height+'). Resized to '+Zm.width+'x'+Zm.height),Zm}return Jm}function Em(Jm){return!vm.isWebGL2&&(Jm.wrapS!==Rs||Jm.wrapT!==Rs||Jm.minFilter!==Ds&&Jm.minFilter!==Bs)}function wm(Jm,Qm){return Jm.generateMipmaps&&Qm&&Jm.minFilter!==Ds&&Jm.minFilter!==Bs}function Lm(Jm,Qm,Km,$m){fm.generateMipmap(Jm);var eg=xm.get(Qm);eg.__maxMipLevel=Math.log(Math.max(Km,$m))*Math.LOG2E}function Am(Jm,Qm){if(!vm.isWebGL2)return Jm;if(6403===Jm){if(5126===Qm)return 33326;if(5131===Qm)return 33325;if(5121===Qm)return 33321}if(6407===Jm){if(5126===Qm)return 34837;if(5131===Qm)return 34843;if(5121===Qm)return 32849}if(6408===Jm){if(5126===Qm)return 34836;if(5131===Qm)return 34842;if(5121===Qm)return 32856}return Jm}function Pm(Jm){return Jm===Ds||Jm===zs||Jm===Ns?9728:9729}function Cm(Jm){var Qm=Jm.target;Qm.removeEventListener('dispose',Cm),Im(Qm),Qm.isVideoTexture&&delete Ym[Qm.id],bm.memory.textures--}function Rm(Jm){var Qm=Jm.target;Qm.removeEventListener('dispose',Rm),Dm(Qm),bm.memory.textures--}function Im(Jm){var Qm=xm.get(Jm);if(Jm.image&&Qm.__image__webglTextureCube)fm.deleteTexture(Qm.__image__webglTextureCube);else{if(Qm.__webglInit===void 0)return;fm.deleteTexture(Qm.__webglTexture)}xm.remove(Jm)}function Dm(Jm){var Qm=xm.get(Jm),Km=xm.get(Jm.texture);if(Jm){if(void 0!==Km.__webglTexture&&fm.deleteTexture(Km.__webglTexture),Jm.depthTexture&&Jm.depthTexture.dispose(),Jm.isWebGLRenderTargetCube)for(var $m=0;6>$m;$m++)fm.deleteFramebuffer(Qm.__webglFramebuffer[$m]),Qm.__webglDepthbuffer&&fm.deleteRenderbuffer(Qm.__webglDepthbuffer[$m]);else fm.deleteFramebuffer(Qm.__webglFramebuffer),Qm.__webglDepthbuffer&&fm.deleteRenderbuffer(Qm.__webglDepthbuffer);xm.remove(Jm.texture),xm.remove(Jm)}}function zm(Jm,Qm){var Km=xm.get(Jm);if(Jm.isVideoTexture&&Xm(Jm),0<Jm.version&&Km.__version!==Jm.version){var $m=Jm.image;if(void 0===$m)console.warn('THREE.WebGLRenderer: Texture marked for update but image is undefined');else if(!1===$m.complete)console.warn('THREE.WebGLRenderer: Texture marked for update but image is incomplete');else return void Om(Km,Jm,Qm)}ym.activeTexture(33984+Qm),ym.bindTexture(3553,Km.__webglTexture)}function Gm(Jm,Qm,Km){var $m;if(Km?(fm.texParameteri(Jm,10242,_m.convert(Qm.wrapS)),fm.texParameteri(Jm,10243,_m.convert(Qm.wrapT)),fm.texParameteri(Jm,10240,_m.convert(Qm.magFilter)),fm.texParameteri(Jm,10241,_m.convert(Qm.minFilter))):(fm.texParameteri(Jm,10242,33071),fm.texParameteri(Jm,10243,33071),(Qm.wrapS!==Rs||Qm.wrapT!==Rs)&&console.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.'),fm.texParameteri(Jm,10240,Pm(Qm.magFilter)),fm.texParameteri(Jm,10241,Pm(Qm.minFilter)),Qm.minFilter!==Ds&&Qm.minFilter!==Bs&&console.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.')),$m=hm.get('EXT_texture_filter_anisotropic'),$m){if(Qm.type===js&&null===hm.get('OES_texture_float_linear'))return;if(Qm.type===qs&&null===(vm.isWebGL2||hm.get('OES_texture_half_float_linear')))return;(1<Qm.anisotropy||xm.get(Qm).__currentAnisotropy)&&(fm.texParameterf(Jm,$m.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Qm.anisotropy,vm.getMaxAnisotropy())),xm.get(Qm).__currentAnisotropy=Qm.anisotropy)}}function Om(Jm,Qm,Km){var $m;$m=Qm.isDataTexture3D?32879:3553,Jm.__webglInit===void 0&&(Jm.__webglInit=!0,Qm.addEventListener('dispose',Cm),Jm.__webglTexture=fm.createTexture(),bm.memory.textures++),ym.activeTexture(33984+Km),ym.bindTexture($m,Jm.__webglTexture),fm.pixelStorei(37440,Qm.flipY),fm.pixelStorei(37441,Qm.premultiplyAlpha),fm.pixelStorei(3317,Qm.unpackAlignment);var eg=Mm(Qm.image,vm.maxTextureSize);Em(Qm)&&!1===Sm(eg)&&(eg=Tm(eg));var tg=Sm(eg),rg=_m.convert(Qm.format),ag=_m.convert(Qm.type),og=Am(rg,ag);Gm($m,Qm,tg);var ng=Qm.mipmaps,ig;if(Qm.isDepthTexture){if(og=6402,Qm.type===js){if(!vm.isWebGL2)throw new Error('Float Depth Texture only supported in WebGL2.0');og=36012}else vm.isWebGL2&&(og=33189);Qm.format===al&&6402===og&&Qm.type!==Vs&&Qm.type!==Ws&&(console.warn('THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.'),Qm.type=Vs,ag=_m.convert(Qm.type)),Qm.format===nl&&(og=34041,Qm.type!==Js&&(console.warn('THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.'),Qm.type=Js,ag=_m.convert(Qm.type))),ym.texImage2D(3553,0,og,eg.width,eg.height,0,rg,ag,null)}else if(Qm.isDataTexture){if(0<ng.length&&tg){for(var sg=0,lg=ng.length;sg<lg;sg++)ig=ng[sg],ym.texImage2D(3553,sg,og,ig.width,ig.height,0,rg,ag,ig.data);Qm.generateMipmaps=!1,Jm.__maxMipLevel=ng.length-1}else ym.texImage2D(3553,0,og,eg.width,eg.height,0,rg,ag,eg.data),Jm.__maxMipLevel=0;}else if(Qm.isCompressedTexture){for(var sg=0,lg=ng.length;sg<lg;sg++)ig=ng[sg],Qm.format!==$s&&Qm.format!==Ks?-1<ym.getCompressedTextureFormats().indexOf(rg)?ym.compressedTexImage2D(3553,sg,og,ig.width,ig.height,0,ig.data):console.warn('THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()'):ym.texImage2D(3553,sg,og,ig.width,ig.height,0,rg,ag,ig.data);Jm.__maxMipLevel=ng.length-1}else if(Qm.isDataTexture3D)ym.texImage3D(32879,0,og,eg.width,eg.height,eg.depth,0,rg,ag,eg.data),Jm.__maxMipLevel=0;else if(0<ng.length&&tg){for(var sg=0,lg=ng.length;sg<lg;sg++)ig=ng[sg],ym.texImage2D(3553,sg,og,rg,ag,ig);Qm.generateMipmaps=!1,Jm.__maxMipLevel=ng.length-1}else ym.texImage2D(3553,0,og,rg,ag,eg),Jm.__maxMipLevel=0;wm(Qm,tg)&&Lm(3553,Qm,eg.width,eg.height),Jm.__version=Qm.version,Qm.onUpdate&&Qm.onUpdate(Qm)}function Fm(Jm,Qm,Km,$m){var eg=_m.convert(Qm.texture.format),tg=_m.convert(Qm.texture.type),rg=Am(eg,tg);ym.texImage2D($m,0,rg,Qm.width,Qm.height,0,eg,tg,null),fm.bindFramebuffer(36160,Jm),fm.framebufferTexture2D(36160,Km,$m,xm.get(Qm.texture).__webglTexture,0),fm.bindFramebuffer(36160,null)}function Hm(Jm,Qm){fm.bindRenderbuffer(36161,Jm),Qm.depthBuffer&&!Qm.stencilBuffer?(fm.renderbufferStorage(36161,33189,Qm.width,Qm.height),fm.framebufferRenderbuffer(36160,36096,36161,Jm)):Qm.depthBuffer&&Qm.stencilBuffer?(fm.renderbufferStorage(36161,34041,Qm.width,Qm.height),fm.framebufferRenderbuffer(36160,33306,36161,Jm)):fm.renderbufferStorage(36161,32854,Qm.width,Qm.height),fm.bindRenderbuffer(36161,null)}function Vm(Jm,Qm){var Km=Qm&&Qm.isWebGLRenderTargetCube;if(Km)throw new Error('Depth Texture with cube render targets is not supported');if(fm.bindFramebuffer(36160,Jm),!(Qm.depthTexture&&Qm.depthTexture.isDepthTexture))throw new Error('renderTarget.depthTexture must be an instance of THREE.DepthTexture');xm.get(Qm.depthTexture).__webglTexture&&Qm.depthTexture.image.width===Qm.width&&Qm.depthTexture.image.height===Qm.height||(Qm.depthTexture.image.width=Qm.width,Qm.depthTexture.image.height=Qm.height,Qm.depthTexture.needsUpdate=!0),zm(Qm.depthTexture,0);var $m=xm.get(Qm.depthTexture).__webglTexture;if(Qm.depthTexture.format===al)fm.framebufferTexture2D(36160,36096,3553,$m,0);else if(Qm.depthTexture.format===nl)fm.framebufferTexture2D(36160,33306,3553,$m,0);else throw new Error('Unknown depthTexture format')}function km(Jm){var Qm=xm.get(Jm),Km=!0===Jm.isWebGLRenderTargetCube;if(Jm.depthTexture){if(Km)throw new Error('target.depthTexture not supported in Cube render targets');Vm(Qm.__webglFramebuffer,Jm)}else if(Km){Qm.__webglDepthbuffer=[];for(var $m=0;6>$m;$m++)fm.bindFramebuffer(36160,Qm.__webglFramebuffer[$m]),Qm.__webglDepthbuffer[$m]=fm.createRenderbuffer(),Hm(Qm.__webglDepthbuffer[$m],Jm)}else fm.bindFramebuffer(36160,Qm.__webglFramebuffer),Qm.__webglDepthbuffer=fm.createRenderbuffer(),Hm(Qm.__webglDepthbuffer,Jm);fm.bindFramebuffer(36160,null)}function Xm(Jm){var Qm=Jm.id,Km=bm.render.frame;Ym[Qm]!==Km&&(Ym[Qm]=Km,Jm.update())}var Ym={},Zm;this.setTexture2D=zm,this.setTexture3D=function(Jm,Qm){var Km=xm.get(Jm);return 0<Jm.version&&Km.__version!==Jm.version?void Om(Km,Jm,Qm):void(ym.activeTexture(33984+Qm),ym.bindTexture(32879,Km.__webglTexture))},this.setTextureCube=function(Jm,Qm){var Km=xm.get(Jm);if(6===Jm.image.length)if(0<Jm.version&&Km.__version!==Jm.version){Km.__image__webglTextureCube||(Jm.addEventListener('dispose',Cm),Km.__image__webglTextureCube=fm.createTexture(),bm.memory.textures++),ym.activeTexture(33984+Qm),ym.bindTexture(34067,Km.__image__webglTextureCube),fm.pixelStorei(37440,Jm.flipY);for(var $m=Jm&&Jm.isCompressedTexture,eg=Jm.image[0]&&Jm.image[0].isDataTexture,tg=[],rg=0;6>rg;rg++)tg[rg]=$m||eg?eg?Jm.image[rg].image:Jm.image[rg]:Mm(Jm.image[rg],vm.maxCubemapSize);var ag=tg[0],og=Sm(ag),ig=_m.convert(Jm.format),ng=_m.convert(Jm.type),sg=Am(ig,ng);Gm(34067,Jm,og);for(var rg=0;6>rg;rg++)if(!$m)eg?ym.texImage2D(34069+rg,0,sg,tg[rg].width,tg[rg].height,0,ig,ng,tg[rg].data):ym.texImage2D(34069+rg,0,sg,ig,ng,tg[rg]);else for(var pg=tg[rg].mipmaps,dg=0,cg=pg.length,lg;dg<cg;dg++)lg=pg[dg],Jm.format!==$s&&Jm.format!==Ks?-1<ym.getCompressedTextureFormats().indexOf(ig)?ym.compressedTexImage2D(34069+rg,dg,sg,lg.width,lg.height,0,lg.data):console.warn('THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()'):ym.texImage2D(34069+rg,dg,sg,lg.width,lg.height,0,ig,ng,lg.data);Km.__maxMipLevel=$m?pg.length-1:0,wm(Jm,og)&&Lm(34067,Jm,ag.width,ag.height),Km.__version=Jm.version,Jm.onUpdate&&Jm.onUpdate(Jm)}else ym.activeTexture(33984+Qm),ym.bindTexture(34067,Km.__image__webglTextureCube)},this.setTextureCubeDynamic=function(Jm,Qm){ym.activeTexture(33984+Qm),ym.bindTexture(34067,xm.get(Jm).__webglTexture)},this.setupRenderTarget=function(Jm){var Qm=xm.get(Jm),Km=xm.get(Jm.texture);Jm.addEventListener('dispose',Rm),Km.__webglTexture=fm.createTexture(),bm.memory.textures++;var $m=!0===Jm.isWebGLRenderTargetCube,eg=Sm(Jm);if($m){Qm.__webglFramebuffer=[];for(var tg=0;6>tg;tg++)Qm.__webglFramebuffer[tg]=fm.createFramebuffer()}else Qm.__webglFramebuffer=fm.createFramebuffer();if($m){ym.bindTexture(34067,Km.__webglTexture),Gm(34067,Jm.texture,eg);for(var tg=0;6>tg;tg++)Fm(Qm.__webglFramebuffer[tg],Jm,36064,34069+tg);wm(Jm.texture,eg)&&Lm(34067,Jm.texture,Jm.width,Jm.height),ym.bindTexture(34067,null)}else ym.bindTexture(3553,Km.__webglTexture),Gm(3553,Jm.texture,eg),Fm(Qm.__webglFramebuffer,Jm,36064,3553),wm(Jm.texture,eg)&&Lm(3553,Jm.texture,Jm.width,Jm.height),ym.bindTexture(3553,null);Jm.depthBuffer&&km(Jm)},this.updateRenderTargetMipmap=function(Jm){var Qm=Jm.texture,Km=Sm(Jm);if(wm(Qm,Km)){var $m=Jm.isWebGLRenderTargetCube?34067:3553,eg=xm.get(Qm).__webglTexture;ym.bindTexture($m,eg),Lm($m,Qm,Jm.width,Jm.height),ym.bindTexture($m,null)}}}function ar(fm,hm,ym){return{convert:function(vm){var _m;if(vm===Cs)return 10497;if(vm===Rs)return 33071;if(vm===Is)return 33648;if(vm===Ds)return 9728;if(vm===zs)return 9984;if(vm===Ns)return 9986;if(vm===Bs)return 9729;if(vm===Us)return 9985;if(vm===Gs)return 9987;if(vm===Os)return 5121;if(vm===1017)return 32819;if(vm===1018)return 32820;if(vm===1019)return 33635;if(vm===1010)return 5120;if(vm===1011)return 5122;if(vm===Vs)return 5123;if(vm===1013)return 5124;if(vm===Ws)return 5125;if(vm===js)return 5126;if(vm===qs){if(ym.isWebGL2)return 5131;if(_m=hm.get('OES_texture_half_float'),null!==_m)return _m.HALF_FLOAT_OES}if(vm===1021)return 6406;if(vm===Ks)return 6407;if(vm===$s)return 6408;if(vm===1024)return 6409;if(vm===1025)return 6410;if(vm===al)return 6402;if(vm===nl)return 34041;if(vm===1028)return 6403;if(vm===Vn)return 32774;if(vm===101)return 32778;if(vm===102)return 32779;if(vm===200)return 0;if(vm===201)return 1;if(vm===202)return 768;if(vm===203)return 769;if(vm===Qn)return 770;if(vm===Kn)return 771;if(vm===206)return 772;if(vm===207)return 773;if(vm===208)return 774;if(vm===209)return 775;if(vm===210)return 776;if((vm===dl||vm===cl||vm===ul||vm===yl)&&(_m=hm.get('WEBGL_compressed_texture_s3tc'),null!==_m)){if(vm===dl)return _m.COMPRESSED_RGB_S3TC_DXT1_EXT;if(vm===cl)return _m.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(vm===ul)return _m.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(vm===yl)return _m.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((vm===xl||vm===_l||vm===bl||vm===Ml)&&(_m=hm.get('WEBGL_compressed_texture_pvrtc'),null!==_m)){if(vm===xl)return _m.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(vm===_l)return _m.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(vm===bl)return _m.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(vm===Ml)return _m.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(vm===36196&&(_m=hm.get('WEBGL_compressed_texture_etc1'),null!==_m))return _m.COMPRESSED_RGB_ETC1_WEBGL;if((vm===37808||vm===37809||vm===37810||vm===37811||vm===37812||vm===37813||vm===37814||vm===37815||vm===37816||vm===37817||vm===37818||vm===37819||vm===37820||vm===37821)&&(_m=hm.get('WEBGL_compressed_texture_astc'),null!==_m))return vm;if(vm===jn||vm===qn){if(ym.isWebGL2){if(vm===jn)return 32775;if(vm===qn)return 32776}if(_m=hm.get('EXT_blend_minmax'),null!==_m){if(vm===jn)return _m.MIN_EXT;if(vm===qn)return _m.MAX_EXT}}if(vm===Js){if(ym.isWebGL2)return 34042;if(_m=hm.get('WEBGL_depth_texture'),null!==_m)return _m.UNSIGNED_INT_24_8_WEBGL}return 0}}}function or(){K.call(this),this.type='Group'}function ir(){K.call(this),this.type='Camera',this.matrixWorldInverse=new E,this.projectionMatrix=new E,this.projectionMatrixInverse=new E}function nr(fm,hm,ym,xm){ir.call(this),this.type='PerspectiveCamera',this.fov=fm===void 0?50:fm,this.zoom=1,this.near=ym===void 0?0.1:ym,this.far=xm===void 0?2e3:xm,this.focus=10,this.aspect=hm===void 0?1:hm,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function sr(fm){nr.call(this),this.cameras=fm||[]}function lr(fm,hm,ym){Kc.setFromMatrixPosition(hm.matrixWorld),$c.setFromMatrixPosition(ym.matrixWorld);var xm=Kc.distanceTo($c),vm=hm.projectionMatrix.elements,_m=ym.projectionMatrix.elements,bm=vm[14]/(vm[10]-1),Mm=vm[14]/(vm[10]+1),Sm=(vm[9]+1)/vm[5],Tm=(vm[9]-1)/vm[5],Em=(vm[8]-1)/vm[0],wm=(_m[8]+1)/_m[0],Pm=xm/(-Em+wm),Cm=Pm*-Em;hm.matrixWorld.decompose(fm.position,fm.quaternion,fm.scale),fm.translateX(Cm),fm.translateZ(Pm),fm.matrixWorld.compose(fm.position,fm.quaternion,fm.scale),fm.matrixWorldInverse.getInverse(fm.matrixWorld);var Rm=bm+Pm,Im=Mm+Pm;fm.projectionMatrix.makePerspective(bm*Em-Cm,bm*wm+(xm-Cm),Sm*Mm/Im*Rm,Tm*Mm/Im*Rm,Rm,Im)}function pr(fm){function hm(){return null!==bm&&!0===bm.isPresenting}function ym(){if(hm()){var Om=bm.getEyeParameters('left'),Fm=Om.renderWidth*Lm,Hm=Om.renderHeight*Lm;Bm=fm.getPixelRatio(),Nm=fm.getSize(),fm.setDrawingBufferSize(2*Fm,Hm,1),Gm.start()}else _m.enabled&&fm.setDrawingBufferSize(Nm.width,Nm.height,Bm),Gm.stop()}function xm(Om){for(var Fm=navigator.getGamepads&&navigator.getGamepads(),Hm=0,Vm=0,km=Fm.length,Wm;Hm<km;Hm++)if(Wm=Fm[Hm],Wm&&('Daydream Controller'===Wm.id||'Gear VR Controller'===Wm.id||'Oculus Go Controller'===Wm.id||'OpenVR Gamepad'===Wm.id||Wm.id.startsWith('Oculus Touch')||Wm.id.startsWith('Spatial Controller'))){if(Vm===Om)return Wm;Vm++}}function vm(){for(var Om=0;Om<Tm.length;Om++){var Fm=Tm[Om],Hm=xm(Om);if(Hm!==void 0&&Hm.pose!==void 0){if(null===Hm.pose)return;var Vm=Hm.pose;!1===Vm.hasPosition&&Fm.position.set(0.2,-0.6,-0.05),null!==Vm.position&&Fm.position.fromArray(Vm.position),null!==Vm.orientation&&Fm.quaternion.fromArray(Vm.orientation),Fm.matrix.compose(Fm.position,Fm.quaternion,Fm.scale),Fm.matrix.premultiply(Em),Fm.matrix.decompose(Fm.position,Fm.quaternion,Fm.scale),Fm.matrixWorldNeedsUpdate=!0,Fm.visible=!0;var km='Daydream Controller'===Hm.id?0:1;Um[Om]!==Hm.buttons[km].pressed&&(Um[Om]=Hm.buttons[km].pressed,!0===Um[Om]?Fm.dispatchEvent({type:'selectstart'}):(Fm.dispatchEvent({type:'selectend'}),Fm.dispatchEvent({type:'select'})))}else Fm.visible=!1}}var _m=this,bm=null,Mm=null,Sm=null,Tm=[],Em=new E,wm=new E,Lm=1,Am='stage';'undefined'!=typeof window&&'VRFrameData'in window&&(Mm=new window.VRFrameData,window.addEventListener('vrdisplaypresentchange',ym,!1));var Pm=new E,Cm=new L,Rm=new A,Im=new nr;Im.bounds=new I(0,0,0.5,1),Im.layers.enable(1);var Dm=new nr;Dm.bounds=new I(0.5,0,0.5,1),Dm.layers.enable(2);var zm=new sr([Im,Dm]);zm.layers.enable(1),zm.layers.enable(2);var Nm,Bm,Um=[];this.enabled=!1,this.getController=function(Om){var Fm=Tm[Om];return void 0===Fm&&(Fm=new or,Fm.matrixAutoUpdate=!1,Fm.visible=!1,Tm[Om]=Fm),Fm},this.getDevice=function(){return bm},this.setDevice=function(Om){Om!==void 0&&(bm=Om),Gm.setContext(Om)},this.setFramebufferScaleFactor=function(Om){Lm=Om},this.setFrameOfReferenceType=function(Om){Am=Om},this.setPoseTarget=function(Om){Om!==void 0&&(Sm=Om)},this.getCamera=function(Om){var Fm='stage'===Am?1.6:0;if(null===bm)return Om.position.set(0,Fm,0),Om;if(bm.depthNear=Om.near,bm.depthFar=Om.far,bm.getFrameData(Mm),'stage'===Am){var Hm=bm.stageParameters;Hm?Em.fromArray(Hm.sittingToStandingTransform):Em.makeTranslation(0,Fm,0)}var Vm=Mm.pose,km=null===Sm?Om:Sm;if(km.matrix.copy(Em),km.matrix.decompose(km.position,km.quaternion,km.scale),null!==Vm.orientation&&(Cm.fromArray(Vm.orientation),km.quaternion.multiply(Cm)),null!==Vm.position&&(Cm.setFromRotationMatrix(Em),Rm.fromArray(Vm.position),Rm.applyQuaternion(Cm),km.position.add(Rm)),km.updateMatrixWorld(),!1===bm.isPresenting)return Om;Im.near=Om.near,Dm.near=Om.near,Im.far=Om.far,Dm.far=Om.far,Im.matrixWorldInverse.fromArray(Mm.leftViewMatrix),Dm.matrixWorldInverse.fromArray(Mm.rightViewMatrix),wm.getInverse(Em),'stage'===Am&&(Im.matrixWorldInverse.multiply(wm),Dm.matrixWorldInverse.multiply(wm));var Wm=km.parent;null!==Wm&&(Pm.getInverse(Wm.matrixWorld),Im.matrixWorldInverse.multiply(Pm),Dm.matrixWorldInverse.multiply(Pm)),Im.matrixWorld.getInverse(Im.matrixWorldInverse),Dm.matrixWorld.getInverse(Dm.matrixWorldInverse),Im.projectionMatrix.fromArray(Mm.leftProjectionMatrix),Dm.projectionMatrix.fromArray(Mm.rightProjectionMatrix),lr(zm,Im,Dm);var jm=bm.getLayers();if(jm.length){var Xm=jm[0];null!==Xm.leftBounds&&4===Xm.leftBounds.length&&Im.bounds.fromArray(Xm.leftBounds),null!==Xm.rightBounds&&4===Xm.rightBounds.length&&Dm.bounds.fromArray(Xm.rightBounds)}return vm(),zm},this.getStandingMatrix=function(){return Em},this.isPresenting=hm;var Gm=new X;this.setAnimationLoop=function(Om){Gm.setAnimationLoop(Om)},this.submitFrame=function(){hm()&&bm.submitFrame()},this.dispose=function(){'undefined'!=typeof window&&window.removeEventListener('vrdisplaypresentchange',ym)}}function dr(fm){function hm(){return null!==Sm&&null!==Em}function ym(Nm){var Bm=Am[Pm.indexOf(Nm.inputSource)];Bm&&Bm.dispatchEvent({type:Nm.type})}function xm(){fm.setFramebuffer(null),zm.stop()}function vm(Nm,Bm){null===Bm?Nm.matrixWorld.copy(Nm.matrix):Nm.matrixWorld.multiplyMatrices(Bm.matrixWorld,Nm.matrix),Nm.matrixWorldInverse.getInverse(Nm.matrixWorld)}var bm=fm.context,Mm=null,Sm=null,Tm=1,Em=null,wm='stage',Lm=null,Am=[],Pm=[],Cm=new nr;Cm.layers.enable(1),Cm.viewport=new I;var Rm=new nr;Rm.layers.enable(2),Rm.viewport=new I;var Im=new sr([Cm,Rm]);Im.layers.enable(1),Im.layers.enable(2),this.enabled=!1,this.getController=function(Nm){var Bm=Am[Nm];return void 0===Bm&&(Bm=new or,Bm.matrixAutoUpdate=!1,Bm.visible=!1,Am[Nm]=Bm),Bm},this.getDevice=function(){return Mm},this.setDevice=function(Nm){Nm!==void 0&&(Mm=Nm),Nm instanceof XRDevice&&bm.setCompatibleXRDevice(Nm)},this.setFramebufferScaleFactor=function(Nm){Tm=Nm},this.setFrameOfReferenceType=function(Nm){wm=Nm},this.setSession=function(Nm){Sm=Nm,null!=Sm&&(Sm.addEventListener('select',ym),Sm.addEventListener('selectstart',ym),Sm.addEventListener('selectend',ym),Sm.addEventListener('end',xm),Sm.baseLayer=new XRWebGLLayer(Sm,bm,{framebufferScaleFactor:Tm}),Sm.requestFrameOfReference(wm).then(function(Bm){Em=Bm,fm.setFramebuffer(Sm.baseLayer.framebuffer),zm.setContext(Sm),zm.start()}),Pm=Sm.getInputSources(),Sm.addEventListener('inputsourceschange',function(){Pm=Sm.getInputSources(),console.log(Pm);for(var Bm=0,Um;Bm<Am.length;Bm++)Um=Am[Bm],Um.userData.inputSource=Pm[Bm]}))},this.getCamera=function(Nm){if(hm()){var Bm=Nm.parent,Um=Im.cameras;vm(Im,Bm);for(var Gm=0;Gm<Um.length;Gm++)vm(Um[Gm],Bm);Nm.matrixWorld.copy(Im.matrixWorld);for(var Om=Nm.children,Gm=0,Fm=Om.length;Gm<Fm;Gm++)Om[Gm].updateMatrixWorld(!0);return lr(Im,Cm,Rm),Im}return Nm},this.isPresenting=hm;var Dm=null,zm=new X;zm.setAnimationLoop(function(Nm,Bm){if(Lm=Bm.getDevicePose(Em),null!==Lm)for(var Um=Sm.baseLayer,Gm=Bm.views,Om=0;Om<Gm.length;Om++){var Fm=Gm[Om],Hm=Um.getViewport(Fm),Vm=Lm.getViewMatrix(Fm),km=Im.cameras[Om];km.matrix.fromArray(Vm).getInverse(km.matrix),km.projectionMatrix.fromArray(Fm.projectionMatrix),km.viewport.set(Hm.x,Hm.y,Hm.width,Hm.height),0===Om&&Im.matrix.copy(km.matrix)}for(var Om=0;Om<Am.length;Om++){var Wm=Am[Om],jm=Pm[Om];if(jm){var Xm=Bm.getInputPose(jm,Em);if(null!==Xm){'targetRay'in Xm?Wm.matrix.elements=Xm.targetRay.transformMatrix:'pointerMatrix'in Xm&&(Wm.matrix.elements=Xm.pointerMatrix),Wm.matrix.decompose(Wm.position,Wm.rotation,Wm.scale),Wm.visible=!0;continue}}Wm.visible=!1}Dm&&Dm(Nm)}),this.setAnimationLoop=function(Nm){Dm=Nm},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn('THREE.WebXRManager: getStandingMatrix() is no longer needed.'),new THREE.Matrix4},this.submitFrame=function(){}}function cr(fm){function hm(){return null===pg?bg:1}function ym(){Dg=new ze(Rg),zg=new Ie(Rg,Dg,fm),zg.isWebGL2||(Dg.get('WEBGL_depth_texture'),Dg.get('OES_texture_float'),Dg.get('OES_texture_half_float'),Dg.get('OES_texture_half_float_linear'),Dg.get('OES_standard_derivatives'),Dg.get('OES_element_index_uint'),Dg.get('ANGLE_instanced_arrays')),Dg.get('OES_texture_float_linear'),Zg=new ar(Rg,Dg,zg),Ng=new tr(Rg,Dg,Zg,zg),Ng.scissor(hg.copy(Sg).multiplyScalar(bg)),Ng.viewport(fg.copy(Mg).multiplyScalar(bg)),Bg=new Ue(Rg),Ug=new kt,Gg=new rr(Rg,Dg,Ng,Ug,zg,Zg,Bg),Og=new Y(Rg),Fg=new Ne(Rg,Og,Bg),Hg=new Fe(Fg,Bg),qg=new Oe(Rg),Vg=new Vt(ng,Dg,zg),kg=new Xt,Wg=new Qt,jg=new Ce(ng,Ng,Hg,tg),Xg=new Re(Rg,Dg,Bg,zg),Yg=new Be(Rg,Dg,Bg,zg),Bg.programs=Vg.programs,ng.context=Rg,ng.capabilities=zg,ng.extensions=Dg,ng.properties=Ug,ng.renderLists=kg,ng.state=Ng,ng.info=Bg}function xm(ef){ef.preventDefault(),console.log('THREE.WebGLRenderer: Context Lost.'),sg=!0}function vm(){console.log('THREE.WebGLRenderer: Context Restored.'),sg=!1,ym()}function _m(ef){var tf=ef.target;tf.removeEventListener('dispose',_m),bm(tf)}function bm(ef){Mm(ef),Ug.remove(ef)}function Mm(ef){var tf=Ug.get(ef).program;ef.program=void 0,tf!==void 0&&Vg.releaseProgram(tf)}function Sm(ef,tf){ef.render(function(rf){ng.renderBufferImmediate(rf,tf)})}function Tm(ef,tf,rf){if(rf&&rf.isInstancedBufferGeometry&!zg.isWebGL2&&null===Dg.get('ANGLE_instanced_arrays'))return void console.error('THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.');Ng.initAttributes();var of=rf.attributes,nf=tf.getAttributes(),lf=ef.defaultAttributeValues;for(var pf in nf){var uf=nf[pf];if(0<=uf){var mf=of[pf];if(mf!==void 0){var gf=mf.normalized,ff=mf.itemSize,hf=Og.get(mf);if(hf===void 0)continue;var yf=hf.buffer,xf=hf.type,vf=hf.bytesPerElement;if(mf.isInterleavedBufferAttribute){var _f=mf.data,Mf=_f.stride,Sf=mf.offset;_f&&_f.isInstancedInterleavedBuffer?(Ng.enableAttributeAndDivisor(uf,_f.meshPerAttribute),rf.maxInstancedCount===void 0&&(rf.maxInstancedCount=_f.meshPerAttribute*_f.count)):Ng.enableAttribute(uf),Rg.bindBuffer(34962,yf),Rg.vertexAttribPointer(uf,ff,xf,gf,Mf*vf,Sf*vf)}else mf.isInstancedBufferAttribute?(Ng.enableAttributeAndDivisor(uf,mf.meshPerAttribute),void 0===rf.maxInstancedCount&&(rf.maxInstancedCount=mf.meshPerAttribute*mf.count)):Ng.enableAttribute(uf),Rg.bindBuffer(34962,yf),Rg.vertexAttribPointer(uf,ff,xf,gf,0,0)}else if(lf!==void 0){var Tf=lf[pf];if(Tf!==void 0)switch(Tf.length){case 2:Rg.vertexAttrib2fv(uf,Tf);break;case 3:Rg.vertexAttrib3fv(uf,Tf);break;case 4:Rg.vertexAttrib4fv(uf,Tf);break;default:Rg.vertexAttrib1fv(uf,Tf);}}}}Ng.disableUnusedAttributes()}function wm(ef,tf,rf){if(!1!==ef.visible){var of=ef.layers.test(tf.layers);if(of)if(ef.isLight)ig.pushLight(ef),ef.castShadow&&ig.pushShadow(ef);else if(ef.isSprite){if(!ef.frustumCulled||Eg.intersectsSprite(ef)){rf&&Cg.setFromMatrixPosition(ef.matrixWorld).applyMatrix4(Pg);var nf=Hg.update(ef),lf=ef.material;og.push(ef,nf,lf,Cg.z,null)}}else if(ef.isImmediateRenderObject)rf&&Cg.setFromMatrixPosition(ef.matrixWorld).applyMatrix4(Pg),og.push(ef,null,ef.material,Cg.z,null);else if((ef.isMesh||ef.isLine||ef.isPoints)&&(ef.isSkinnedMesh&&ef.skeleton.update(),!ef.frustumCulled||Eg.intersectsObject(ef))){rf&&Cg.setFromMatrixPosition(ef.matrixWorld).applyMatrix4(Pg);var nf=Hg.update(ef),lf=ef.material;if(Array.isArray(lf))for(var pf=nf.groups,uf=0,mf=pf.length;uf<mf;uf++){var gf=pf[uf],ff=lf[gf.materialIndex];ff&&ff.visible&&og.push(ef,nf,ff,Cg.z,gf)}else lf.visible&&og.push(ef,nf,lf,Cg.z,null)}for(var hf=ef.children,uf=0,mf=hf.length;uf<mf;uf++)wm(hf[uf],tf,rf)}}function Lm(ef,tf,rf,of){for(var nf=0,lf=ef.length;nf<lf;nf++){var pf=ef[nf],uf=pf.object,mf=pf.geometry,gf=of===void 0?pf.material:of,ff=pf.group;if(rf.isArrayCamera){gg=rf;for(var hf=rf.cameras,yf=0,xf=hf.length,vf;yf<xf;yf++)if(vf=hf[yf],uf.layers.test(vf.layers)){if('viewport'in vf)Ng.viewport(fg.copy(vf.viewport));else{var _f=vf.bounds,Mf=_f.x*vg,Sf=_f.y*_g,Tf=_f.z*vg,Ef=_f.w*_g;Ng.viewport(fg.set(Mf,Sf,Tf,Ef).multiplyScalar(bg))}ig.setupLights(vf),Am(uf,tf,vf,mf,gf,ff)}}else gg=null,Am(uf,tf,rf,mf,gf,ff)}}function Am(ef,tf,rf,of,nf,lf){if(ef.onBeforeRender(ng,tf,rf,of,nf,lf),ig=Wg.get(tf,gg||rf),ef.modelViewMatrix.multiplyMatrices(rf.matrixWorldInverse,ef.matrixWorld),ef.normalMatrix.getNormalMatrix(ef.modelViewMatrix),ef.isImmediateRenderObject){Ng.setMaterial(nf);var pf=Cm(rf,tf.fog,nf,ef);ug.geometry=null,ug.program=null,ug.wireframe=!1,Sm(ef,pf)}else ng.renderBufferDirect(rf,tf.fog,of,nf,ef,lf);ef.onAfterRender(ng,tf,rf,of,nf,lf),ig=Wg.get(tf,gg||rf)}function Pm(ef,tf,rf){var of=Ug.get(ef),nf=ig.state.lights,lf=ig.state.shadowsArray,pf=of.lightsHash,uf=nf.state.hash,mf=Vg.getParameters(ef,nf.state,lf,tf,wg.numPlanes,wg.numIntersection,rf),gf=Vg.getProgramCode(ef,mf),ff=of.program,hf=!0;if(ff===void 0)ef.addEventListener('dispose',_m);else if(ff.code!==gf)Mm(ef);else if(pf.stateID!==uf.stateID||pf.directionalLength!==uf.directionalLength||pf.pointLength!==uf.pointLength||pf.spotLength!==uf.spotLength||pf.rectAreaLength!==uf.rectAreaLength||pf.hemiLength!==uf.hemiLength||pf.shadowsLength!==uf.shadowsLength)pf.stateID=uf.stateID,pf.directionalLength=uf.directionalLength,pf.pointLength=uf.pointLength,pf.spotLength=uf.spotLength,pf.rectAreaLength=uf.rectAreaLength,pf.hemiLength=uf.hemiLength,pf.shadowsLength=uf.shadowsLength,hf=!1;else{if(mf.shaderID!==void 0)return;hf=!1}if(hf){if(mf.shaderID){var yf=Bc[mf.shaderID];of.shader={name:ef.type,uniforms:Dc.clone(yf.uniforms),vertexShader:yf.vertexShader,fragmentShader:yf.fragmentShader}}else of.shader={name:ef.type,uniforms:ef.uniforms,vertexShader:ef.vertexShader,fragmentShader:ef.fragmentShader};ef.onBeforeCompile(of.shader,ng),gf=Vg.getProgramCode(ef,mf),ff=Vg.acquireProgram(ef,of.shader,mf,gf),of.program=ff,ef.program=ff}var xf=ff.getAttributes();if(ef.morphTargets){ef.numSupportedMorphTargets=0;for(var vf=0;vf<ng.maxMorphTargets;vf++)0<=xf['morphTarget'+vf]&&ef.numSupportedMorphTargets++}if(ef.morphNormals){ef.numSupportedMorphNormals=0;for(var vf=0;vf<ng.maxMorphNormals;vf++)0<=xf['morphNormal'+vf]&&ef.numSupportedMorphNormals++}var _f=of.shader.uniforms;(ef.isShaderMaterial||ef.isRawShaderMaterial)&&!0!==ef.clipping||(of.numClippingPlanes=wg.numPlanes,of.numIntersection=wg.numIntersection,_f.clippingPlanes=wg.uniform),of.fog=tf,pf===void 0&&(of.lightsHash=pf={}),pf.stateID=uf.stateID,pf.directionalLength=uf.directionalLength,pf.pointLength=uf.pointLength,pf.spotLength=uf.spotLength,pf.rectAreaLength=uf.rectAreaLength,pf.hemiLength=uf.hemiLength,pf.shadowsLength=uf.shadowsLength,ef.lights&&(_f.ambientLightColor.value=nf.state.ambient,_f.directionalLights.value=nf.state.directional,_f.spotLights.value=nf.state.spot,_f.rectAreaLights.value=nf.state.rectArea,_f.pointLights.value=nf.state.point,_f.hemisphereLights.value=nf.state.hemi,_f.directionalShadowMap.value=nf.state.directionalShadowMap,_f.directionalShadowMatrix.value=nf.state.directionalShadowMatrix,_f.spotShadowMap.value=nf.state.spotShadowMap,_f.spotShadowMatrix.value=nf.state.spotShadowMatrix,_f.pointShadowMap.value=nf.state.pointShadowMap,_f.pointShadowMatrix.value=nf.state.pointShadowMatrix);var Mf=of.program.getUniforms(),Sf=wt.seqWithValue(Mf.seq,_f);of.uniformsList=Sf}function Cm(ef,tf,rf,of){xg=0;var nf=Ug.get(rf),lf=ig.state.lights,pf=nf.lightsHash,uf=lf.state.hash;if(Lg&&(Ag||ef!==mg)){var mf=ef===mg&&rf.id===cg;wg.setState(rf.clippingPlanes,rf.clipIntersection,rf.clipShadows,ef,nf,mf)}!1===rf.needsUpdate&&(void 0===nf.program?rf.needsUpdate=!0:rf.fog&&nf.fog!==tf?rf.needsUpdate=!0:rf.lights&&(pf.stateID!==uf.stateID||pf.directionalLength!==uf.directionalLength||pf.pointLength!==uf.pointLength||pf.spotLength!==uf.spotLength||pf.rectAreaLength!==uf.rectAreaLength||pf.hemiLength!==uf.hemiLength||pf.shadowsLength!==uf.shadowsLength)?rf.needsUpdate=!0:void 0!==nf.numClippingPlanes&&(nf.numClippingPlanes!==wg.numPlanes||nf.numIntersection!==wg.numIntersection)&&(rf.needsUpdate=!0)),rf.needsUpdate&&(Pm(rf,tf,of),rf.needsUpdate=!1);var gf=!1,ff=!1,hf=!1,yf=nf.program,xf=yf.getUniforms(),vf=nf.shader.uniforms;if(Ng.useProgram(yf.program)&&(gf=!0,ff=!0,hf=!0),rf.id!==cg&&(cg=rf.id,ff=!0),gf||mg!==ef){if(xf.setValue(Rg,'projectionMatrix',ef.projectionMatrix),zg.logarithmicDepthBuffer&&xf.setValue(Rg,'logDepthBufFC',2/(Math.log(ef.far+1)/Math.LN2)),mg!==ef&&(mg=ef,ff=!0,hf=!0),rf.isShaderMaterial||rf.isMeshPhongMaterial||rf.isMeshStandardMaterial||rf.envMap){var _f=xf.map.cameraPosition;void 0!==_f&&_f.setValue(Rg,Cg.setFromMatrixPosition(ef.matrixWorld))}(rf.isMeshPhongMaterial||rf.isMeshLambertMaterial||rf.isMeshBasicMaterial||rf.isMeshStandardMaterial||rf.isShaderMaterial||rf.skinning)&&xf.setValue(Rg,'viewMatrix',ef.matrixWorldInverse)}if(rf.skinning){xf.setOptional(Rg,of,'bindMatrix'),xf.setOptional(Rg,of,'bindMatrixInverse');var Mf=of.skeleton;if(Mf){var Sf=Mf.bones;if(zg.floatVertexTextures){if(void 0===Mf.boneTexture){var Tf=Math.sqrt(4*Sf.length);Tf=dp.ceilPowerOfTwo(Tf),Tf=Math.max(Tf,4);var Ef=new Float32Array(4*(Tf*Tf));Ef.set(Mf.boneMatrices);var wf=new G(Ef,Tf,Tf,$s,js);wf.needsUpdate=!0,Mf.boneMatrices=Ef,Mf.boneTexture=wf,Mf.boneTextureSize=Tf}xf.setValue(Rg,'boneTexture',Mf.boneTexture),xf.setValue(Rg,'boneTextureSize',Mf.boneTextureSize)}else xf.setOptional(Rg,Mf,'boneMatrices')}}return ff&&(xf.setValue(Rg,'toneMappingExposure',ng.toneMappingExposure),xf.setValue(Rg,'toneMappingWhitePoint',ng.toneMappingWhitePoint),rf.lights&&Xm(vf,hf),tf&&rf.fog&&Bm(vf,tf),rf.isMeshBasicMaterial?Rm(vf,rf):rf.isMeshLambertMaterial?(Rm(vf,rf),Um(vf,rf)):rf.isMeshPhongMaterial?(Rm(vf,rf),rf.isMeshToonMaterial?Om(vf,rf):Gm(vf,rf)):rf.isMeshStandardMaterial?(Rm(vf,rf),rf.isMeshPhysicalMaterial?Hm(vf,rf):Fm(vf,rf)):rf.isMeshMatcapMaterial?(Rm(vf,rf),Vm(vf,rf)):rf.isMeshDepthMaterial?(Rm(vf,rf),km(vf,rf)):rf.isMeshDistanceMaterial?(Rm(vf,rf),Wm(vf,rf)):rf.isMeshNormalMaterial?(Rm(vf,rf),jm(vf,rf)):rf.isLineBasicMaterial?(Im(vf,rf),rf.isLineDashedMaterial&&Dm(vf,rf)):rf.isPointsMaterial?zm(vf,rf):rf.isSpriteMaterial?Nm(vf,rf):rf.isShadowMaterial&&(vf.color.value=rf.color,vf.opacity.value=rf.opacity),void 0!==vf.ltc_1&&(vf.ltc_1.value=Nc.LTC_1),void 0!==vf.ltc_2&&(vf.ltc_2.value=Nc.LTC_2),wt.upload(Rg,nf.uniformsList,vf,ng)),rf.isShaderMaterial&&!0===rf.uniformsNeedUpdate&&(wt.upload(Rg,nf.uniformsList,vf,ng),rf.uniformsNeedUpdate=!1),rf.isSpriteMaterial&&xf.setValue(Rg,'center',of.center),xf.setValue(Rg,'modelViewMatrix',of.modelViewMatrix),xf.setValue(Rg,'normalMatrix',of.normalMatrix),xf.setValue(Rg,'modelMatrix',of.matrixWorld),yf}function Rm(ef,tf){ef.opacity.value=tf.opacity,tf.color&&(ef.diffuse.value=tf.color),tf.emissive&&ef.emissive.value.copy(tf.emissive).multiplyScalar(tf.emissiveIntensity),tf.map&&(ef.map.value=tf.map),tf.alphaMap&&(ef.alphaMap.value=tf.alphaMap),tf.specularMap&&(ef.specularMap.value=tf.specularMap),tf.envMap&&(ef.envMap.value=tf.envMap,ef.flipEnvMap.value=tf.envMap&&tf.envMap.isCubeTexture?-1:1,ef.reflectivity.value=tf.reflectivity,ef.refractionRatio.value=tf.refractionRatio,ef.maxMipLevel.value=Ug.get(tf.envMap).__maxMipLevel),tf.lightMap&&(ef.lightMap.value=tf.lightMap,ef.lightMapIntensity.value=tf.lightMapIntensity),tf.aoMap&&(ef.aoMap.value=tf.aoMap,ef.aoMapIntensity.value=tf.aoMapIntensity);var rf;tf.map?rf=tf.map:tf.specularMap?rf=tf.specularMap:tf.displacementMap?rf=tf.displacementMap:tf.normalMap?rf=tf.normalMap:tf.bumpMap?rf=tf.bumpMap:tf.roughnessMap?rf=tf.roughnessMap:tf.metalnessMap?rf=tf.metalnessMap:tf.alphaMap?rf=tf.alphaMap:tf.emissiveMap&&(rf=tf.emissiveMap),rf!=void 0&&(rf.isWebGLRenderTarget&&(rf=rf.texture),!0===rf.matrixAutoUpdate&&rf.updateMatrix(),ef.uvTransform.value.copy(rf.matrix))}function Im(ef,tf){ef.diffuse.value=tf.color,ef.opacity.value=tf.opacity}function Dm(ef,tf){ef.dashSize.value=tf.dashSize,ef.totalSize.value=tf.dashSize+tf.gapSize,ef.scale.value=tf.scale}function zm(ef,tf){ef.diffuse.value=tf.color,ef.opacity.value=tf.opacity,ef.size.value=tf.size*bg,ef.scale.value=0.5*_g,ef.map.value=tf.map,null!==tf.map&&(!0===tf.map.matrixAutoUpdate&&tf.map.updateMatrix(),ef.uvTransform.value.copy(tf.map.matrix))}function Nm(ef,tf){ef.diffuse.value=tf.color,ef.opacity.value=tf.opacity,ef.rotation.value=tf.rotation,ef.map.value=tf.map,null!==tf.map&&(!0===tf.map.matrixAutoUpdate&&tf.map.updateMatrix(),ef.uvTransform.value.copy(tf.map.matrix))}function Bm(ef,tf){ef.fogColor.value=tf.color,tf.isFog?(ef.fogNear.value=tf.near,ef.fogFar.value=tf.far):tf.isFogExp2&&(ef.fogDensity.value=tf.density)}function Um(ef,tf){tf.emissiveMap&&(ef.emissiveMap.value=tf.emissiveMap)}function Gm(ef,tf){ef.specular.value=tf.specular,ef.shininess.value=Math.max(tf.shininess,1e-4),tf.emissiveMap&&(ef.emissiveMap.value=tf.emissiveMap),tf.bumpMap&&(ef.bumpMap.value=tf.bumpMap,ef.bumpScale.value=tf.bumpScale,tf.side===Cn&&(ef.bumpScale.value*=-1)),tf.normalMap&&(ef.normalMap.value=tf.normalMap,ef.normalScale.value.copy(tf.normalScale),tf.side===Cn&&ef.normalScale.value.negate()),tf.displacementMap&&(ef.displacementMap.value=tf.displacementMap,ef.displacementScale.value=tf.displacementScale,ef.displacementBias.value=tf.displacementBias)}function Om(ef,tf){Gm(ef,tf),tf.gradientMap&&(ef.gradientMap.value=tf.gradientMap)}function Fm(ef,tf){ef.roughness.value=tf.roughness,ef.metalness.value=tf.metalness,tf.roughnessMap&&(ef.roughnessMap.value=tf.roughnessMap),tf.metalnessMap&&(ef.metalnessMap.value=tf.metalnessMap),tf.emissiveMap&&(ef.emissiveMap.value=tf.emissiveMap),tf.bumpMap&&(ef.bumpMap.value=tf.bumpMap,ef.bumpScale.value=tf.bumpScale,tf.side===Cn&&(ef.bumpScale.value*=-1)),tf.normalMap&&(ef.normalMap.value=tf.normalMap,ef.normalScale.value.copy(tf.normalScale),tf.side===Cn&&ef.normalScale.value.negate()),tf.displacementMap&&(ef.displacementMap.value=tf.displacementMap,ef.displacementScale.value=tf.displacementScale,ef.displacementBias.value=tf.displacementBias),tf.envMap&&(ef.envMapIntensity.value=tf.envMapIntensity)}function Hm(ef,tf){Fm(ef,tf),ef.reflectivity.value=tf.reflectivity,ef.clearCoat.value=tf.clearCoat,ef.clearCoatRoughness.value=tf.clearCoatRoughness}function Vm(ef,tf){tf.matcap&&(ef.matcap.value=tf.matcap),tf.bumpMap&&(ef.bumpMap.value=tf.bumpMap,ef.bumpScale.value=tf.bumpScale,tf.side===Cn&&(ef.bumpScale.value*=-1)),tf.normalMap&&(ef.normalMap.value=tf.normalMap,ef.normalScale.value.copy(tf.normalScale),tf.side===Cn&&ef.normalScale.value.negate()),tf.displacementMap&&(ef.displacementMap.value=tf.displacementMap,ef.displacementScale.value=tf.displacementScale,ef.displacementBias.value=tf.displacementBias)}function km(ef,tf){tf.displacementMap&&(ef.displacementMap.value=tf.displacementMap,ef.displacementScale.value=tf.displacementScale,ef.displacementBias.value=tf.displacementBias)}function Wm(ef,tf){tf.displacementMap&&(ef.displacementMap.value=tf.displacementMap,ef.displacementScale.value=tf.displacementScale,ef.displacementBias.value=tf.displacementBias),ef.referencePosition.value.copy(tf.referencePosition),ef.nearDistance.value=tf.nearDistance,ef.farDistance.value=tf.farDistance}function jm(ef,tf){tf.bumpMap&&(ef.bumpMap.value=tf.bumpMap,ef.bumpScale.value=tf.bumpScale,tf.side===Cn&&(ef.bumpScale.value*=-1)),tf.normalMap&&(ef.normalMap.value=tf.normalMap,ef.normalScale.value.copy(tf.normalScale),tf.side===Cn&&ef.normalScale.value.negate()),tf.displacementMap&&(ef.displacementMap.value=tf.displacementMap,ef.displacementScale.value=tf.displacementScale,ef.displacementBias.value=tf.displacementBias)}function Xm(ef,tf){ef.ambientLightColor.needsUpdate=tf,ef.directionalLights.needsUpdate=tf,ef.pointLights.needsUpdate=tf,ef.spotLights.needsUpdate=tf,ef.rectAreaLights.needsUpdate=tf,ef.hemisphereLights.needsUpdate=tf}console.log('THREE.WebGLRenderer','99dev'),fm=fm||{};var Zm=fm.canvas===void 0?document.createElementNS('http://www.w3.org/1999/xhtml','canvas'):fm.canvas,Jm=fm.context===void 0?null:fm.context,Qm=fm.alpha!==void 0&&fm.alpha,Km=!(fm.depth!==void 0)||fm.depth,$m=!(fm.stencil!==void 0)||fm.stencil,eg=fm.antialias!==void 0&&fm.antialias,tg=!(fm.premultipliedAlpha!==void 0)||fm.premultipliedAlpha,rg=fm.preserveDrawingBuffer!==void 0&&fm.preserveDrawingBuffer,ag=fm.powerPreference===void 0?'default':fm.powerPreference,og=null,ig=null;this.domElement=Zm,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=ys,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var ng=this,sg=!1,lg=null,pg=null,dg=null,cg=-1,ug={geometry:null,program:null,wireframe:!1},mg=null,gg=null,fg=new I,hg=new I,yg=null,xg=0,vg=Zm.width,_g=Zm.height,bg=1,Mg=new I(0,0,vg,_g),Sg=new I(0,0,vg,_g),Tg=!1,Eg=new V,wg=new De,Lg=!1,Ag=!1,Pg=new E,Cg=new A,Rg;try{var Ig={alpha:Qm,depth:Km,stencil:$m,antialias:eg,premultipliedAlpha:tg,preserveDrawingBuffer:rg,powerPreference:ag};if(Zm.addEventListener('webglcontextlost',xm,!1),Zm.addEventListener('webglcontextrestored',vm,!1),Rg=Jm||Zm.getContext('webgl',Ig)||Zm.getContext('experimental-webgl',Ig),null===Rg)if(null!==Zm.getContext('webgl'))throw new Error('Error creating WebGL context with your selected attributes.');else throw new Error('Error creating WebGL context.');void 0===Rg.getShaderPrecisionFormat&&(Rg.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ef){console.error('THREE.WebGLRenderer: '+ef.message)}var Dg,zg,Ng,Bg,Ug,Gg,Og,Fg,Hg,Vg,kg,Wg,jg,qg,Xg,Yg,Zg;ym();var Jg=null;'undefined'!=typeof navigator&&(Jg='xr'in navigator?new dr(ng):new pr(ng)),this.vr=Jg;var Qg=new er(ng,Hg,zg.maxTextureSize);this.shadowMap=Qg,this.getContext=function(){return Rg},this.getContextAttributes=function(){return Rg.getContextAttributes()},this.forceContextLoss=function(){var ef=Dg.get('WEBGL_lose_context');ef&&ef.loseContext()},this.forceContextRestore=function(){var ef=Dg.get('WEBGL_lose_context');ef&&ef.restoreContext()},this.getPixelRatio=function(){return bg},this.setPixelRatio=function(ef){void 0===ef||(bg=ef,this.setSize(vg,_g,!1))},this.getSize=function(){return{width:vg,height:_g}},this.setSize=function(ef,tf,rf){return Jg.isPresenting()?void console.warn('THREE.WebGLRenderer: Can\'t change size while VR device is presenting.'):void(vg=ef,_g=tf,Zm.width=ef*bg,Zm.height=tf*bg,!1!==rf&&(Zm.style.width=ef+'px',Zm.style.height=tf+'px'),this.setViewport(0,0,ef,tf))},this.getDrawingBufferSize=function(){return{width:vg*bg,height:_g*bg}},this.setDrawingBufferSize=function(ef,tf,rf){vg=ef,_g=tf,bg=rf,Zm.width=ef*rf,Zm.height=tf*rf,this.setViewport(0,0,ef,tf)},this.getCurrentViewport=function(){return fg},this.setViewport=function(ef,tf,rf,of){Mg.set(ef,_g-tf-of,rf,of),Ng.viewport(fg.copy(Mg).multiplyScalar(bg))},this.setScissor=function(ef,tf,rf,of){Sg.set(ef,_g-tf-of,rf,of),Ng.scissor(hg.copy(Sg).multiplyScalar(bg))},this.setScissorTest=function(ef){Ng.setScissorTest(Tg=ef)},this.getClearColor=function(){return jg.getClearColor()},this.setClearColor=function(){jg.setClearColor.apply(jg,arguments)},this.getClearAlpha=function(){return jg.getClearAlpha()},this.setClearAlpha=function(){jg.setClearAlpha.apply(jg,arguments)},this.clear=function(ef,tf,rf){var of=0;(ef===void 0||ef)&&(of|=16384),(tf===void 0||tf)&&(of|=256),(rf===void 0||rf)&&(of|=1024),Rg.clear(of)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){Zm.removeEventListener('webglcontextlost',xm,!1),Zm.removeEventListener('webglcontextrestored',vm,!1),kg.dispose(),Wg.dispose(),Ug.dispose(),Hg.dispose(),Jg.dispose(),$g.stop()},this.renderBufferImmediate=function(ef,tf){Ng.initAttributes();var rf=Ug.get(ef);ef.hasPositions&&!rf.position&&(rf.position=Rg.createBuffer()),ef.hasNormals&&!rf.normal&&(rf.normal=Rg.createBuffer()),ef.hasUvs&&!rf.uv&&(rf.uv=Rg.createBuffer()),ef.hasColors&&!rf.color&&(rf.color=Rg.createBuffer());var of=tf.getAttributes();ef.hasPositions&&(Rg.bindBuffer(34962,rf.position),Rg.bufferData(34962,ef.positionArray,35048),Ng.enableAttribute(of.position),Rg.vertexAttribPointer(of.position,3,5126,!1,0,0)),ef.hasNormals&&(Rg.bindBuffer(34962,rf.normal),Rg.bufferData(34962,ef.normalArray,35048),Ng.enableAttribute(of.normal),Rg.vertexAttribPointer(of.normal,3,5126,!1,0,0)),ef.hasUvs&&(Rg.bindBuffer(34962,rf.uv),Rg.bufferData(34962,ef.uvArray,35048),Ng.enableAttribute(of.uv),Rg.vertexAttribPointer(of.uv,2,5126,!1,0,0)),ef.hasColors&&(Rg.bindBuffer(34962,rf.color),Rg.bufferData(34962,ef.colorArray,35048),Ng.enableAttribute(of.color),Rg.vertexAttribPointer(of.color,3,5126,!1,0,0)),Ng.disableUnusedAttributes(),Rg.drawArrays(4,0,ef.count),ef.count=0},this.renderBufferDirect=function(ef,tf,rf,of,nf,lf){var pf=nf.isMesh&&0>nf.normalMatrix.determinant();Ng.setMaterial(of,pf);var uf=Cm(ef,tf,of,nf),mf=!1;(ug.geometry!==rf.id||ug.program!==uf.id||ug.wireframe!==(!0===of.wireframe))&&(ug.geometry=rf.id,ug.program=uf.id,ug.wireframe=!0===of.wireframe,mf=!0),nf.morphTargetInfluences&&(qg.update(nf,rf,of,uf),mf=!0);var gf=rf.index,ff=rf.attributes.position,hf=1;!0===of.wireframe&&(gf=Fg.getWireframeAttribute(rf),hf=2);var yf,xf=Xg;null!==gf&&(yf=Og.get(gf),xf=Yg,xf.setIndex(yf)),mf&&(Tm(of,uf,rf),null!==gf&&Rg.bindBuffer(34963,yf.buffer));var vf=Infinity;null===gf?ff!==void 0&&(vf=ff.count):vf=gf.count;var _f=rf.drawRange.start*hf,Mf=rf.drawRange.count*hf,Sf=null===lf?0:lf.start*hf,Tf=null===lf?Infinity:lf.count*hf,Ef=Math.max(_f,Sf),wf=Math.min(vf,_f+Mf,Sf+Tf)-1,Lf=Math.max(0,wf-Ef+1);if(0!==Lf){if(nf.isMesh){if(!0===of.wireframe)Ng.setLineWidth(of.wireframeLinewidth*hm()),xf.setMode(1);else switch(nf.drawMode){case Zl:xf.setMode(4);break;case 1:xf.setMode(5);break;case 2:xf.setMode(6);}}else if(nf.isLine){var Af=of.linewidth;void 0===Af&&(Af=1),Ng.setLineWidth(Af*hm()),nf.isLineSegments?xf.setMode(1):nf.isLineLoop?xf.setMode(2):xf.setMode(3)}else nf.isPoints?xf.setMode(0):nf.isSprite&&xf.setMode(4);rf&&rf.isInstancedBufferGeometry?0<rf.maxInstancedCount&&xf.renderInstances(rf,Ef,Lf):xf.render(Ef,Lf)}},this.compile=function(ef,tf){ig=Wg.get(ef,tf),ig.init(),ef.traverse(function(rf){rf.isLight&&(ig.pushLight(rf),rf.castShadow&&ig.pushShadow(rf))}),ig.setupLights(tf),ef.traverse(function(rf){if(rf.material)if(Array.isArray(rf.material))for(var of=0;of<rf.material.length;of++)Pm(rf.material[of],ef.fog,rf);else Pm(rf.material,ef.fog,rf)})};var Kg=null,$g=new X;$g.setAnimationLoop(function(ef){Jg.isPresenting()||Kg&&Kg(ef)}),'undefined'!=typeof window&&$g.setContext(window),this.setAnimationLoop=function(ef){Kg=ef,Jg.setAnimationLoop(ef),$g.start()},this.render=function(ef,tf,rf,of){if(!(tf&&tf.isCamera))return void console.error('THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.');if(!sg){ug.geometry=null,ug.program=null,ug.wireframe=!1,cg=-1,mg=null,!0===ef.autoUpdate&&ef.updateMatrixWorld(),null===tf.parent&&tf.updateMatrixWorld(),Jg.enabled&&(tf=Jg.getCamera(tf)),ig=Wg.get(ef,tf),ig.init(),ef.onBeforeRender(ng,ef,tf,rf),Pg.multiplyMatrices(tf.projectionMatrix,tf.matrixWorldInverse),Eg.setFromMatrix(Pg),Ag=this.localClippingEnabled,Lg=wg.init(this.clippingPlanes,Ag,tf),og=kg.get(ef,tf),og.init(),wm(ef,tf,ng.sortObjects),!0===ng.sortObjects&&og.sort(),Lg&&wg.beginShadows();var nf=ig.state.shadowsArray;Qg.render(nf,ef,tf),ig.setupLights(tf),Lg&&wg.endShadows(),this.info.autoReset&&this.info.reset(),void 0===rf&&(rf=null),this.setRenderTarget(rf),jg.render(og,ef,tf,of);var lf=og.opaque,pf=og.transparent;if(ef.overrideMaterial){var uf=ef.overrideMaterial;lf.length&&Lm(lf,ef,tf,uf),pf.length&&Lm(pf,ef,tf,uf)}else lf.length&&Lm(lf,ef,tf),pf.length&&Lm(pf,ef,tf);rf&&Gg.updateRenderTargetMipmap(rf),Ng.buffers.depth.setTest(!0),Ng.buffers.depth.setMask(!0),Ng.buffers.color.setMask(!0),Ng.setPolygonOffset(!1),ef.onAfterRender(ng,ef,tf),Jg.enabled&&Jg.submitFrame(),og=null,ig=null}},this.allocTextureUnit=function(){var ef=xg;return ef>=zg.maxTextures&&console.warn('THREE.WebGLRenderer: Trying to use '+ef+' texture units while this GPU supports only '+zg.maxTextures),xg+=1,ef},this.setTexture2D=function(){var ef=!1;return function(rf,of){rf&&rf.isWebGLRenderTarget&&(!ef&&(console.warn('THREE.WebGLRenderer.setTexture2D: don\'t use render targets as textures. Use their .texture property instead.'),ef=!0),rf=rf.texture),Gg.setTexture2D(rf,of)}}(),this.setTexture3D=function(){return function(tf,rf){Gg.setTexture3D(tf,rf)}}(),this.setTexture=function(){var ef=!1;return function(rf,of){ef||(console.warn('THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead.'),ef=!0),Gg.setTexture2D(rf,of)}}(),this.setTextureCube=function(){var ef=!1;return function(rf,of){rf&&rf.isWebGLRenderTargetCube&&(!ef&&(console.warn('THREE.WebGLRenderer.setTextureCube: don\'t use cube render targets as textures. Use their .texture property instead.'),ef=!0),rf=rf.texture),rf&&rf.isCubeTexture||Array.isArray(rf.image)&&6===rf.image.length?Gg.setTextureCube(rf,of):Gg.setTextureCubeDynamic(rf,of)}}(),this.setFramebuffer=function(ef){lg=ef},this.getRenderTarget=function(){return pg},this.setRenderTarget=function(ef){pg=ef,ef&&void 0===Ug.get(ef).__webglFramebuffer&&Gg.setupRenderTarget(ef);var tf=lg,rf=!1;if(ef){var of=Ug.get(ef).__webglFramebuffer;ef.isWebGLRenderTargetCube?(tf=of[ef.activeCubeFace],rf=!0):tf=of,fg.copy(ef.viewport),hg.copy(ef.scissor),yg=ef.scissorTest}else fg.copy(Mg).multiplyScalar(bg),hg.copy(Sg).multiplyScalar(bg),yg=Tg;if(dg!==tf&&(Rg.bindFramebuffer(36160,tf),dg=tf),Ng.viewport(fg),Ng.scissor(hg),Ng.setScissorTest(yg),rf){var nf=Ug.get(ef.texture);Rg.framebufferTexture2D(36160,36064,34069+ef.activeCubeFace,nf.__webglTexture,ef.activeMipMapLevel)}},this.readRenderTargetPixels=function(ef,tf,rf,of,nf,lf){if(!(ef&&ef.isWebGLRenderTarget))return void console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.');var pf=Ug.get(ef).__webglFramebuffer;if(pf){var uf=!1;pf!==dg&&(Rg.bindFramebuffer(36160,pf),uf=!0);try{var mf=ef.texture,gf=mf.format,ff=mf.type;if(gf!==$s&&Zg.convert(gf)!==Rg.getParameter(35739))return void console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.');if(ff!==Os&&Zg.convert(ff)!==Rg.getParameter(35738)&&!(ff===js&&(zg.isWebGL2||Dg.get('OES_texture_float')||Dg.get('WEBGL_color_buffer_float')))&&!(ff===qs&&(zg.isWebGL2?Dg.get('EXT_color_buffer_float'):Dg.get('EXT_color_buffer_half_float'))))return void console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.');36053===Rg.checkFramebufferStatus(36160)?0<=tf&&tf<=ef.width-of&&0<=rf&&rf<=ef.height-nf&&Rg.readPixels(tf,rf,of,nf,Zg.convert(gf),Zg.convert(ff),lf):console.error('THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.')}finally{uf&&Rg.bindFramebuffer(36160,dg)}}},this.copyFramebufferToTexture=function(ef,tf,rf){var of=tf.image.width,nf=tf.image.height,lf=Zg.convert(tf.format);this.setTexture2D(tf,0),Rg.copyTexImage2D(3553,rf||0,lf,ef.x,ef.y,of,nf,0)},this.copyTextureToTexture=function(ef,tf,rf,of){var nf=tf.image.width,lf=tf.image.height,pf=Zg.convert(rf.format),uf=Zg.convert(rf.type);this.setTexture2D(rf,0),tf.isDataTexture?Rg.texSubImage2D(3553,of||0,ef.x,ef.y,nf,lf,pf,uf,tf.image.data):Rg.texSubImage2D(3553,of||0,ef.x,ef.y,pf,uf,tf.image)}}function ur(fm,hm){this.name='',this.color=new W(fm),this.density=hm===void 0?2.5e-4:hm}function mr(fm,hm,ym){this.name='',this.color=new W(fm),this.near=hm===void 0?1:hm,this.far=ym===void 0?1e3:ym}function gr(){K.call(this),this.type='Scene',this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function fr(fm,hm){this.array=fm,this.stride=hm,this.count=fm===void 0?0:fm.length/hm,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function hr(fm,hm,ym,xm){this.data=fm,this.itemSize=hm,this.offset=ym,this.normalized=!0===xm}function yr(fm){Te.call(this),this.type='SpriteMaterial',this.color=new W(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(fm)}function xr(fm){if(K.call(this),this.type='Sprite',void 0===eu){eu=new xe;var hm=new Float32Array([-0.5,-0.5,0,0,0,0.5,-0.5,0,1,0,0.5,0.5,0,1,1,-0.5,0.5,0,0,1]),ym=new fr(hm,5);eu.setIndex([0,1,2,0,2,3]),eu.addAttribute('position',new hr(ym,3,0,!1)),eu.addAttribute('uv',new hr(ym,2,3,!1))}this.geometry=eu,this.material=void 0===fm?new yr:fm,this.center=new S(0.5,0.5)}function _r(){K.call(this),this.type='LOD',Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function br(fm,hm){if(fm=fm||[],this.bones=fm.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===hm)this.calculateInverses();else if(this.bones.length===hm.length)this.boneInverses=hm.slice(0);else{console.warn('THREE.Skeleton boneInverses is the wrong length.'),this.boneInverses=[];for(var ym=0,xm=this.bones.length;ym<xm;ym++)this.boneInverses.push(new E)}}function Mr(){K.call(this),this.type='Bone'}function Sr(fm,hm){Pe.call(this,fm,hm),this.type='SkinnedMesh',this.bindMode='attached',this.bindMatrix=new E,this.bindMatrixInverse=new E;var ym=this.initBones(),xm=new br(ym);this.bind(xm,this.matrixWorld),this.normalizeSkinWeights()}function Tr(fm){Te.call(this),this.type='LineBasicMaterial',this.color=new W(16777215),this.linewidth=1,this.linecap='round',this.linejoin='round',this.lights=!1,this.setValues(fm)}function Er(fm,hm,ym){1===ym&&console.error('THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead.'),K.call(this),this.type='Line',this.geometry=fm===void 0?new xe:fm,this.material=hm===void 0?new Tr({color:16777215*Math.random()}):hm}function wr(fm,hm){Er.call(this,fm,hm),this.type='LineSegments'}function Lr(fm,hm){Er.call(this,fm,hm),this.type='LineLoop'}function Ar(fm){Te.call(this),this.type='PointsMaterial',this.color=new W(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(fm)}function Pr(fm,hm){K.call(this),this.type='Points',this.geometry=fm===void 0?new xe:fm,this.material=hm===void 0?new Ar({color:16777215*Math.random()}):hm}function Cr(fm,hm,ym,xm,vm,_m,bm,Mm,Sm){R.call(this,fm,hm,ym,xm,vm,_m,bm,Mm,Sm),this.format=bm===void 0?Ks:bm,this.minFilter=_m===void 0?Bs:_m,this.magFilter=vm===void 0?Bs:vm,this.generateMipmaps=!1}function Rr(fm,hm,ym,xm,vm,_m,bm,Mm,Sm,Tm,Em,wm){R.call(this,null,_m,bm,Mm,Sm,Tm,xm,vm,Em,wm),this.image={width:hm,height:ym},this.mipmaps=fm,this.flipY=!1,this.generateMipmaps=!1}function Ir(fm,hm,ym,xm,vm,_m,bm,Mm,Sm){R.call(this,fm,hm,ym,xm,vm,_m,bm,Mm,Sm),this.needsUpdate=!0}function Dr(fm,hm,ym,xm,vm,_m,bm,Mm,Sm,Tm){if(Tm=void 0===Tm?al:Tm,Tm!==al&&Tm!==nl)throw new Error('DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat');void 0===ym&&Tm===al&&(ym=Vs),void 0===ym&&Tm===nl&&(ym=Js),R.call(this,null,xm,vm,_m,bm,Mm,Tm,ym,Sm),this.image={width:fm,height:hm},this.magFilter=void 0===bm?Ds:bm,this.minFilter=void 0===Mm?Ds:Mm,this.flipY=!1,this.generateMipmaps=!1}function zr(fm){xe.call(this),this.type='WireframeGeometry';var hm=[],ym,xm,vm,_m,bm,Mm=[0,0],Sm={},Tm,Em,wm,Lm,Am=['a','b','c'],Pm;if(fm&&fm.isGeometry){var Cm=fm.faces;for(ym=0,vm=Cm.length;ym<vm;ym++){var Rm=Cm[ym];for(xm=0;3>xm;xm++)Em=Rm[Am[xm]],wm=Rm[Am[(xm+1)%3]],Mm[0]=Math.min(Em,wm),Mm[1]=Math.max(Em,wm),Lm=Mm[0]+','+Mm[1],void 0===Sm[Lm]&&(Sm[Lm]={index1:Mm[0],index2:Mm[1]})}for(Lm in Sm)Tm=Sm[Lm],Pm=fm.vertices[Tm.index1],hm.push(Pm.x,Pm.y,Pm.z),Pm=fm.vertices[Tm.index2],hm.push(Pm.x,Pm.y,Pm.z)}else if(fm&&fm.isBufferGeometry){var Im,Dm,zm,Nm,Bm,Um,Gm,Om;if(Pm=new A,null!==fm.index){for(Im=fm.attributes.position,Dm=fm.index,zm=fm.groups,0===zm.length&&(zm=[{start:0,count:Dm.count,materialIndex:0}]),(_m=0,bm=zm.length);_m<bm;++_m)for(Nm=zm[_m],Bm=Nm.start,Um=Nm.count,(ym=Bm,vm=Bm+Um);ym<vm;ym+=3)for(xm=0;3>xm;xm++)Em=Dm.getX(ym+xm),wm=Dm.getX(ym+(xm+1)%3),Mm[0]=Math.min(Em,wm),Mm[1]=Math.max(Em,wm),Lm=Mm[0]+','+Mm[1],void 0===Sm[Lm]&&(Sm[Lm]={index1:Mm[0],index2:Mm[1]});for(Lm in Sm)Tm=Sm[Lm],Pm.fromBufferAttribute(Im,Tm.index1),hm.push(Pm.x,Pm.y,Pm.z),Pm.fromBufferAttribute(Im,Tm.index2),hm.push(Pm.x,Pm.y,Pm.z)}else for(Im=fm.attributes.position,ym=0,vm=Im.count/3;ym<vm;ym++)for(xm=0;3>xm;xm++)Gm=3*ym+xm,Pm.fromBufferAttribute(Im,Gm),hm.push(Pm.x,Pm.y,Pm.z),Om=3*ym+(xm+1)%3,Pm.fromBufferAttribute(Im,Om),hm.push(Pm.x,Pm.y,Pm.z)}this.addAttribute('position',new ge(hm,3))}function Nr(fm,hm,ym){ee.call(this),this.type='ParametricGeometry',this.parameters={func:fm,slices:hm,stacks:ym},this.fromBufferGeometry(new Br(fm,hm,ym)),this.mergeVertices()}function Br(fm,hm,ym){xe.call(this),this.type='ParametricBufferGeometry',this.parameters={func:fm,slices:hm,stacks:ym};var xm=[],vm=[],_m=[],bm=[],Mm=1e-5,Sm=new A,Tm=new A,Em=new A,wm=new A,Lm=new A,Am,Pm;3>fm.length&&console.error('THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.');var Cm=hm+1;for(Am=0;Am<=ym;Am++){var Rm=Am/ym;for(Pm=0;Pm<=hm;Pm++){var Im=Pm/hm;fm(Im,Rm,Tm),vm.push(Tm.x,Tm.y,Tm.z),0<=Im-Mm?(fm(Im-Mm,Rm,Em),wm.subVectors(Tm,Em)):(fm(Im+Mm,Rm,Em),wm.subVectors(Em,Tm)),0<=Rm-Mm?(fm(Im,Rm-Mm,Em),Lm.subVectors(Tm,Em)):(fm(Im,Rm+Mm,Em),Lm.subVectors(Em,Tm)),Sm.crossVectors(wm,Lm).normalize(),_m.push(Sm.x,Sm.y,Sm.z),bm.push(Im,Rm)}}for(Am=0;Am<ym;Am++)for(Pm=0;Pm<hm;Pm++){var Dm=Am*Cm+Pm,zm=Am*Cm+Pm+1,Nm=(Am+1)*Cm+Pm+1,Bm=(Am+1)*Cm+Pm;xm.push(Dm,zm,Bm),xm.push(zm,Nm,Bm)}this.setIndex(xm),this.addAttribute('position',new ge(vm,3)),this.addAttribute('normal',new ge(_m,3)),this.addAttribute('uv',new ge(bm,2))}function Ur(fm,hm,ym,xm){ee.call(this),this.type='PolyhedronGeometry',this.parameters={vertices:fm,indices:hm,radius:ym,detail:xm},this.fromBufferGeometry(new Gr(fm,hm,ym,xm)),this.mergeVertices()}function Gr(fm,hm,ym,xm){function _m(Im,Dm,zm,Nm){var Bm=Math.pow(2,Nm),Um=[],Gm,Om;for(Gm=0;Gm<=Bm;Gm++){Um[Gm]=[];var Fm=Im.clone().lerp(zm,Gm/Bm),Hm=Dm.clone().lerp(zm,Gm/Bm),Vm=Bm-Gm;for(Om=0;Om<=Vm;Om++)Um[Gm][Om]=0===Om&&Gm===Bm?Fm:Fm.clone().lerp(Hm,Om/Vm)}for(Gm=0;Gm<Bm;Gm++)for(Om=0;Om<2*(Bm-Gm)-1;Om++){var km=Math.floor(Om/2);0==Om%2?(Tm(Um[Gm][km+1]),Tm(Um[Gm+1][km]),Tm(Um[Gm][km])):(Tm(Um[Gm][km+1]),Tm(Um[Gm+1][km+1]),Tm(Um[Gm+1][km]))}}function Sm(){for(var Im=0;Im<Rm.length;Im+=6){var Dm=Rm[Im+0],zm=Rm[Im+2],Nm=Rm[Im+4],Bm=Math.max(Dm,zm,Nm),Um=Math.min(Dm,zm,Nm);0.9<Bm&&0.1>Um&&(0.2>Dm&&(Rm[Im+0]+=1),0.2>zm&&(Rm[Im+2]+=1),0.2>Nm&&(Rm[Im+4]+=1))}}function Tm(Im){Cm.push(Im.x,Im.y,Im.z)}function Em(Im,Dm){var zm=3*Im;Dm.x=fm[zm+0],Dm.y=fm[zm+1],Dm.z=fm[zm+2]}function wm(){for(var Im=new A,Dm=new A,zm=new A,Nm=new A,Bm=new S,Um=new S,Gm=new S,Om=0,Fm=0;Om<Cm.length;Om+=9,Fm+=6){Im.set(Cm[Om+0],Cm[Om+1],Cm[Om+2]),Dm.set(Cm[Om+3],Cm[Om+4],Cm[Om+5]),zm.set(Cm[Om+6],Cm[Om+7],Cm[Om+8]),Bm.set(Rm[Fm+0],Rm[Fm+1]),Um.set(Rm[Fm+2],Rm[Fm+3]),Gm.set(Rm[Fm+4],Rm[Fm+5]),Nm.copy(Im).add(Dm).add(zm).divideScalar(3);var Hm=Am(Nm);Lm(Bm,Fm+0,Im,Hm),Lm(Um,Fm+2,Dm,Hm),Lm(Gm,Fm+4,zm,Hm)}}function Lm(Im,Dm,zm,Nm){0>Nm&&1===Im.x&&(Rm[Dm]=Im.x-1),0===zm.x&&0===zm.z&&(Rm[Dm]=Nm/2/Math.PI+0.5)}function Am(Im){return Math.atan2(Im.z,-Im.x)}function Pm(Im){return Math.atan2(-Im.y,Math.sqrt(Im.x*Im.x+Im.z*Im.z))}xe.call(this),this.type='PolyhedronBufferGeometry',this.parameters={vertices:fm,indices:hm,radius:ym,detail:xm},ym=ym||1,xm=xm||0;var Cm=[],Rm=[];(function(Im){for(var Dm=new A,zm=new A,Nm=new A,Bm=0;Bm<hm.length;Bm+=3)Em(hm[Bm+0],Dm),Em(hm[Bm+1],zm),Em(hm[Bm+2],Nm),_m(Dm,zm,Nm,Im)})(xm),function(Im){for(var Dm=new A,zm=0;zm<Cm.length;zm+=3)Dm.x=Cm[zm+0],Dm.y=Cm[zm+1],Dm.z=Cm[zm+2],Dm.normalize().multiplyScalar(Im),Cm[zm+0]=Dm.x,Cm[zm+1]=Dm.y,Cm[zm+2]=Dm.z}(ym),function(){for(var Im=new A,Dm=0;Dm<Cm.length;Dm+=3){Im.x=Cm[Dm+0],Im.y=Cm[Dm+1],Im.z=Cm[Dm+2];var zm=Am(Im)/2/Math.PI+0.5,Nm=Pm(Im)/Math.PI+0.5;Rm.push(zm,1-Nm)}wm(),Sm()}(),this.addAttribute('position',new ge(Cm,3)),this.addAttribute('normal',new ge(Cm.slice(),3)),this.addAttribute('uv',new ge(Rm,2)),0===xm?this.computeVertexNormals():this.normalizeNormals()}function Or(fm,hm){ee.call(this),this.type='TetrahedronGeometry',this.parameters={radius:fm,detail:hm},this.fromBufferGeometry(new Fr(fm,hm)),this.mergeVertices()}function Fr(fm,hm){Gr.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],fm,hm),this.type='TetrahedronBufferGeometry',this.parameters={radius:fm,detail:hm}}function Hr(fm,hm){ee.call(this),this.type='OctahedronGeometry',this.parameters={radius:fm,detail:hm},this.fromBufferGeometry(new Vr(fm,hm)),this.mergeVertices()}function Vr(fm,hm){Gr.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],fm,hm),this.type='OctahedronBufferGeometry',this.parameters={radius:fm,detail:hm}}function kr(fm,hm){ee.call(this),this.type='IcosahedronGeometry',this.parameters={radius:fm,detail:hm},this.fromBufferGeometry(new Wr(fm,hm)),this.mergeVertices()}function Wr(fm,hm){var ym=(1+Math.sqrt(5))/2;Gr.call(this,[-1,ym,0,1,ym,0,-1,-ym,0,1,-ym,0,0,-1,ym,0,1,ym,0,-1,-ym,0,1,-ym,ym,0,-1,ym,0,1,-ym,0,-1,-ym,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],fm,hm),this.type='IcosahedronBufferGeometry',this.parameters={radius:fm,detail:hm}}function jr(fm,hm){ee.call(this),this.type='DodecahedronGeometry',this.parameters={radius:fm,detail:hm},this.fromBufferGeometry(new qr(fm,hm)),this.mergeVertices()}function qr(fm,hm){var ym=(1+Math.sqrt(5))/2,xm=1/ym;Gr.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-xm,-ym,0,-xm,ym,0,xm,-ym,0,xm,ym,-xm,-ym,0,-xm,ym,0,xm,-ym,0,xm,ym,0,-ym,0,-xm,ym,0,-xm,-ym,0,xm,ym,0,xm],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],fm,hm),this.type='DodecahedronBufferGeometry',this.parameters={radius:fm,detail:hm}}function Xr(fm,hm,ym,xm,vm,_m){ee.call(this),this.type='TubeGeometry',this.parameters={path:fm,tubularSegments:hm,radius:ym,radialSegments:xm,closed:vm},_m!==void 0&&console.warn('THREE.TubeGeometry: taper has been removed.');var bm=new Yr(fm,hm,ym,xm,vm);this.tangents=bm.tangents,this.normals=bm.normals,this.binormals=bm.binormals,this.fromBufferGeometry(bm),this.mergeVertices()}function Yr(fm,hm,ym,xm,vm){function bm(Nm){Am=fm.getPointAt(Nm/hm,Am);var Bm=Tm.normals[Nm],Um=Tm.binormals[Nm];for(Cm=0;Cm<=xm;Cm++){var Gm=2*(Cm/xm*Math.PI),Om=Math.sin(Gm),Fm=-Math.cos(Gm);wm.x=Fm*Bm.x+Om*Um.x,wm.y=Fm*Bm.y+Om*Um.y,wm.z=Fm*Bm.z+Om*Um.z,wm.normalize(),Im.push(wm.x,wm.y,wm.z),Em.x=Am.x+ym*wm.x,Em.y=Am.y+ym*wm.y,Em.z=Am.z+ym*wm.z,Rm.push(Em.x,Em.y,Em.z)}}function Mm(){for(Cm=1;Cm<=hm;Cm++)for(Pm=1;Pm<=xm;Pm++){var Nm=(xm+1)*(Cm-1)+(Pm-1),Bm=(xm+1)*Cm+(Pm-1),Um=(xm+1)*Cm+Pm,Gm=(xm+1)*(Cm-1)+Pm;zm.push(Nm,Bm,Gm),zm.push(Bm,Um,Gm)}}function Sm(){for(Pm=0;Pm<=hm;Pm++)for(Cm=0;Cm<=xm;Cm++)Lm.x=Pm/hm,Lm.y=Cm/xm,Dm.push(Lm.x,Lm.y)}xe.call(this),this.type='TubeBufferGeometry',this.parameters={path:fm,tubularSegments:hm,radius:ym,radialSegments:xm,closed:vm},hm=hm||64,ym=ym||1,xm=xm||8,vm=vm||!1;var Tm=fm.computeFrenetFrames(hm,vm);this.tangents=Tm.tangents,this.normals=Tm.normals,this.binormals=Tm.binormals;var Em=new A,wm=new A,Lm=new S,Am=new A,Pm,Cm,Rm=[],Im=[],Dm=[],zm=[];(function(){for(Pm=0;Pm<hm;Pm++)bm(Pm);bm(!1===vm?hm:0),Sm(),Mm()})(),this.setIndex(zm),this.addAttribute('position',new ge(Rm,3)),this.addAttribute('normal',new ge(Im,3)),this.addAttribute('uv',new ge(Dm,2))}function Zr(fm,hm,ym,xm,vm,_m,bm){ee.call(this),this.type='TorusKnotGeometry',this.parameters={radius:fm,tube:hm,tubularSegments:ym,radialSegments:xm,p:vm,q:_m},bm!==void 0&&console.warn('THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.'),this.fromBufferGeometry(new Jr(fm,hm,ym,xm,vm,_m)),this.mergeVertices()}function Jr(fm,hm,ym,xm,vm,_m){function bm(km,Wm,jm,Xm,Ym){var Zm=Math.cos(km),Jm=Math.sin(km),Qm=jm/Wm*km,Km=Math.cos(Qm);Ym.x=0.5*(Xm*(2+Km))*Zm,Ym.y=0.5*(Xm*(2+Km)*Jm),Ym.z=0.5*(Xm*Math.sin(Qm))}xe.call(this),this.type='TorusKnotBufferGeometry',this.parameters={radius:fm,tube:hm,tubularSegments:ym,radialSegments:xm,p:vm,q:_m},fm=fm||1,hm=hm||0.4,ym=Math.floor(ym)||64,xm=Math.floor(xm)||8,vm=vm||2,_m=_m||3;var Mm=[],Sm=[],Tm=[],Em=[],wm,Lm,Am=new A,Pm=new A,Cm=new A,Rm=new A,Im=new A,Dm=new A,zm=new A;for(wm=0;wm<=ym;++wm){var Nm=2*(wm/ym*vm*Math.PI);for(bm(Nm,vm,_m,fm,Cm),bm(Nm+0.01,vm,_m,fm,Rm),Dm.subVectors(Rm,Cm),zm.addVectors(Rm,Cm),Im.crossVectors(Dm,zm),zm.crossVectors(Im,Dm),Im.normalize(),zm.normalize(),Lm=0;Lm<=xm;++Lm){var Bm=2*(Lm/xm*Math.PI),Um=-hm*Math.cos(Bm),Gm=hm*Math.sin(Bm);Am.x=Cm.x+(Um*zm.x+Gm*Im.x),Am.y=Cm.y+(Um*zm.y+Gm*Im.y),Am.z=Cm.z+(Um*zm.z+Gm*Im.z),Sm.push(Am.x,Am.y,Am.z),Pm.subVectors(Am,Cm).normalize(),Tm.push(Pm.x,Pm.y,Pm.z),Em.push(wm/ym),Em.push(Lm/xm)}}for(Lm=1;Lm<=ym;Lm++)for(wm=1;wm<=xm;wm++){var Om=(xm+1)*(Lm-1)+(wm-1),Fm=(xm+1)*Lm+(wm-1),Hm=(xm+1)*Lm+wm,Vm=(xm+1)*(Lm-1)+wm;Mm.push(Om,Fm,Vm),Mm.push(Fm,Hm,Vm)}this.setIndex(Mm),this.addAttribute('position',new ge(Sm,3)),this.addAttribute('normal',new ge(Tm,3)),this.addAttribute('uv',new ge(Em,2))}function Qr(fm,hm,ym,xm,vm){ee.call(this),this.type='TorusGeometry',this.parameters={radius:fm,tube:hm,radialSegments:ym,tubularSegments:xm,arc:vm},this.fromBufferGeometry(new Kr(fm,hm,ym,xm,vm)),this.mergeVertices()}function Kr(fm,hm,ym,xm,vm){xe.call(this),this.type='TorusBufferGeometry',this.parameters={radius:fm,tube:hm,radialSegments:ym,tubularSegments:xm,arc:vm},fm=fm||1,hm=hm||0.4,ym=Math.floor(ym)||8,xm=Math.floor(xm)||6,vm=vm||2*Math.PI;var _m=[],bm=[],Mm=[],Sm=[],Tm=new A,Em=new A,wm=new A,Lm,Am;for(Lm=0;Lm<=ym;Lm++)for(Am=0;Am<=xm;Am++){var Pm=Am/xm*vm,Cm=2*(Lm/ym*Math.PI);Em.x=(fm+hm*Math.cos(Cm))*Math.cos(Pm),Em.y=(fm+hm*Math.cos(Cm))*Math.sin(Pm),Em.z=hm*Math.sin(Cm),bm.push(Em.x,Em.y,Em.z),Tm.x=fm*Math.cos(Pm),Tm.y=fm*Math.sin(Pm),wm.subVectors(Em,Tm).normalize(),Mm.push(wm.x,wm.y,wm.z),Sm.push(Am/xm),Sm.push(Lm/ym)}for(Lm=1;Lm<=ym;Lm++)for(Am=1;Am<=xm;Am++){var Rm=(xm+1)*Lm+Am-1,Im=(xm+1)*(Lm-1)+Am-1,Dm=(xm+1)*(Lm-1)+Am,zm=(xm+1)*Lm+Am;_m.push(Rm,Im,zm),_m.push(Im,Dm,zm)}this.setIndex(_m),this.addAttribute('position',new ge(bm,3)),this.addAttribute('normal',new ge(Mm,3)),this.addAttribute('uv',new ge(Sm,2))}function $r(fm,hm,ym,xm,vm){var _m,bm;if(vm===0<La(fm,hm,ym,xm))for(_m=hm;_m<ym;_m+=xm)bm=Ta(_m,fm[_m],fm[_m+1],bm);else for(_m=ym-xm;_m>=hm;_m-=xm)bm=Ta(_m,fm[_m],fm[_m+1],bm);return bm&&ya(bm,bm.next)&&(Ea(bm),bm=bm.next),bm}function ea(fm,hm){if(!fm)return fm;hm||(hm=fm);var ym=fm,xm;do if(xm=!1,!ym.steiner&&(ya(ym,ym.next)||0===ha(ym.prev,ym,ym.next))){if(Ea(ym),ym=hm=ym.prev,ym===ym.next)break;xm=!0}else ym=ym.next;while(xm||ym!==hm);return hm}function ta(fm,hm,ym,xm,vm,_m,bm){if(fm){!bm&&_m&&da(fm,xm,vm,_m);for(var Mm=fm,Sm,Tm;fm.prev!==fm.next;){if(Sm=fm.prev,Tm=fm.next,_m?aa(fm,xm,vm,_m):ra(fm)){hm.push(Sm.i/ym),hm.push(fm.i/ym),hm.push(Tm.i/ym),Ea(fm),fm=Tm.next,Mm=Tm.next;continue}if(fm=Tm,fm===Mm){bm?1===bm?(fm=oa(fm,hm,ym),ta(fm,hm,ym,xm,vm,_m,2)):2==bm&&ia(fm,hm,ym,xm,vm,_m):ta(ea(fm),hm,ym,xm,vm,_m,1);break}}}}function ra(fm){var hm=fm.prev,ym=fm,xm=fm.next;if(0<=ha(hm,ym,xm))return!1;for(var vm=fm.next.next;vm!==fm.prev;){if(ga(hm.x,hm.y,ym.x,ym.y,xm.x,xm.y,vm.x,vm.y)&&0<=ha(vm.prev,vm,vm.next))return!1;vm=vm.next}return!0}function aa(fm,hm,ym,xm){var vm=fm.prev,_m=fm,bm=fm.next;if(0<=ha(vm,_m,bm))return!1;for(var Mm=vm.x<_m.x?vm.x<bm.x?vm.x:bm.x:_m.x<bm.x?_m.x:bm.x,Sm=vm.y<_m.y?vm.y<bm.y?vm.y:bm.y:_m.y<bm.y?_m.y:bm.y,Tm=vm.x>_m.x?vm.x>bm.x?vm.x:bm.x:_m.x>bm.x?_m.x:bm.x,Em=vm.y>_m.y?vm.y>bm.y?vm.y:bm.y:_m.y>bm.y?_m.y:bm.y,wm=ua(Mm,Sm,hm,ym,xm),Lm=ua(Tm,Em,hm,ym,xm),Am=fm.nextZ;Am&&Am.z<=Lm;){if(Am!==fm.prev&&Am!==fm.next&&ga(vm.x,vm.y,_m.x,_m.y,bm.x,bm.y,Am.x,Am.y)&&0<=ha(Am.prev,Am,Am.next))return!1;Am=Am.nextZ}for(Am=fm.prevZ;Am&&Am.z>=wm;){if(Am!==fm.prev&&Am!==fm.next&&ga(vm.x,vm.y,_m.x,_m.y,bm.x,bm.y,Am.x,Am.y)&&0<=ha(Am.prev,Am,Am.next))return!1;Am=Am.prevZ}return!0}function oa(fm,hm,ym){var xm=fm;do{var vm=xm.prev,_m=xm.next.next;!ya(vm,_m)&&xa(vm,xm,xm.next,_m)&&ba(vm,_m)&&ba(_m,vm)&&(hm.push(vm.i/ym),hm.push(xm.i/ym),hm.push(_m.i/ym),Ea(xm),Ea(xm.next),xm=fm=_m),xm=xm.next}while(xm!==fm);return xm}function ia(fm,hm,ym,xm,vm,_m){var bm=fm;do{for(var Mm=bm.next.next;Mm!==bm.prev;){if(bm.i!==Mm.i&&fa(bm,Mm)){var Sm=Sa(bm,Mm);return bm=ea(bm,bm.next),Sm=ea(Sm,Sm.next),ta(bm,hm,ym,xm,vm,_m),void ta(Sm,hm,ym,xm,vm,_m)}Mm=Mm.next}bm=bm.next}while(bm!==fm)}function na(fm,hm,ym,xm){var vm=[],_m,bm,Mm,Sm,Tm;for(_m=0,bm=hm.length;_m<bm;_m++)Mm=hm[_m]*xm,Sm=_m<bm-1?hm[_m+1]*xm:fm.length,Tm=$r(fm,Mm,Sm,xm,!1),Tm===Tm.next&&(Tm.steiner=!0),vm.push(ma(Tm));for(vm.sort(sa),_m=0;_m<vm.length;_m++)la(vm[_m],ym),ym=ea(ym,ym.next);return ym}function sa(fm,hm){return fm.x-hm.x}function la(fm,hm){if(hm=pa(fm,hm),hm){var ym=Sa(hm,fm);ea(ym,ym.next)}}function pa(fm,hm){var ym=hm,xm=fm.x,vm=fm.y,_m=-Infinity,bm;do{if(vm<=ym.y&&vm>=ym.next.y&&ym.next.y!==ym.y){var Mm=ym.x+(vm-ym.y)*(ym.next.x-ym.x)/(ym.next.y-ym.y);if(Mm<=xm&&Mm>_m){if(_m=Mm,Mm===xm){if(vm===ym.y)return ym;if(vm===ym.next.y)return ym.next}bm=ym.x<ym.next.x?ym:ym.next}}ym=ym.next}while(ym!==hm);if(!bm)return null;if(xm===_m)return bm.prev;var Sm=bm,Tm=bm.x,Em=bm.y,wm=Infinity,Lm;for(ym=bm.next;ym!==Sm;)xm>=ym.x&&ym.x>=Tm&&xm!==ym.x&&ga(vm<Em?xm:_m,vm,Tm,Em,vm<Em?_m:xm,vm,ym.x,ym.y)&&(Lm=Math.abs(vm-ym.y)/(xm-ym.x),(Lm<wm||Lm===wm&&ym.x>bm.x)&&ba(ym,fm)&&(bm=ym,wm=Lm)),ym=ym.next;return bm}function da(fm,hm,ym,xm){var vm=fm;do null===vm.z&&(vm.z=ua(vm.x,vm.y,hm,ym,xm)),vm.prevZ=vm.prev,vm.nextZ=vm.next,vm=vm.next;while(vm!==fm);vm.prevZ.nextZ=null,vm.prevZ=null,ca(vm)}function ca(fm){var Tm=1,hm,ym,xm,vm,_m,bm,Mm,Sm;do{for(ym=fm,fm=null,_m=null,bm=0;ym;){for(bm++,xm=ym,Mm=0,hm=0;hm<Tm&&(Mm++,xm=xm.nextZ,!!xm);hm++);for(Sm=Tm;0<Mm||0<Sm&&xm;)0!==Mm&&(0===Sm||!xm||ym.z<=xm.z)?(vm=ym,ym=ym.nextZ,Mm--):(vm=xm,xm=xm.nextZ,Sm--),_m?_m.nextZ=vm:fm=vm,vm.prevZ=_m,_m=vm;ym=xm}_m.nextZ=null,Tm*=2}while(1<bm);return fm}function ua(fm,hm,ym,xm,vm){return fm=32767*(fm-ym)*vm,hm=32767*(hm-xm)*vm,fm=16711935&(fm|fm<<8),fm=252645135&(fm|fm<<4),fm=858993459&(fm|fm<<2),fm=1431655765&(fm|fm<<1),hm=16711935&(hm|hm<<8),hm=252645135&(hm|hm<<4),hm=858993459&(hm|hm<<2),hm=1431655765&(hm|hm<<1),fm|hm<<1}function ma(fm){var hm=fm,ym=fm;do hm.x<ym.x&&(ym=hm),hm=hm.next;while(hm!==fm);return ym}function ga(fm,hm,ym,xm,vm,_m,bm,Mm){return 0<=(vm-bm)*(hm-Mm)-(fm-bm)*(_m-Mm)&&0<=(fm-bm)*(xm-Mm)-(ym-bm)*(hm-Mm)&&0<=(ym-bm)*(_m-Mm)-(vm-bm)*(xm-Mm)}function fa(fm,hm){return fm.next.i!==hm.i&&fm.prev.i!==hm.i&&!_a(fm,hm)&&ba(fm,hm)&&ba(hm,fm)&&Ma(fm,hm)}function ha(fm,hm,ym){return(hm.y-fm.y)*(ym.x-hm.x)-(hm.x-fm.x)*(ym.y-hm.y)}function ya(fm,hm){return fm.x===hm.x&&fm.y===hm.y}function xa(fm,hm,ym,xm){return ya(fm,hm)&&ya(ym,xm)||ya(fm,xm)&&ya(ym,hm)||0<ha(fm,hm,ym)!=0<ha(fm,hm,xm)&&0<ha(ym,xm,fm)!=0<ha(ym,xm,hm)}function _a(fm,hm){var ym=fm;do{if(ym.i!==fm.i&&ym.next.i!==fm.i&&ym.i!==hm.i&&ym.next.i!==hm.i&&xa(ym,ym.next,fm,hm))return!0;ym=ym.next}while(ym!==fm);return!1}function ba(fm,hm){return 0>ha(fm.prev,fm,fm.next)?0<=ha(fm,hm,fm.next)&&0<=ha(fm,fm.prev,hm):0>ha(fm,hm,fm.prev)||0>ha(fm,fm.next,hm)}function Ma(fm,hm){var ym=fm,xm=!1,vm=(fm.x+hm.x)/2,_m=(fm.y+hm.y)/2;do ym.y>_m!=ym.next.y>_m&&ym.next.y!==ym.y&&vm<(ym.next.x-ym.x)*(_m-ym.y)/(ym.next.y-ym.y)+ym.x&&(xm=!xm),ym=ym.next;while(ym!==fm);return xm}function Sa(fm,hm){var ym=new wa(fm.i,fm.x,fm.y),xm=new wa(hm.i,hm.x,hm.y),vm=fm.next,_m=hm.prev;return fm.next=hm,hm.prev=fm,ym.next=vm,vm.prev=ym,xm.next=ym,ym.prev=xm,_m.next=xm,xm.prev=_m,xm}function Ta(fm,hm,ym,xm){var vm=new wa(fm,hm,ym);return xm?(vm.next=xm.next,vm.prev=xm,xm.next.prev=vm,xm.next=vm):(vm.prev=vm,vm.next=vm),vm}function Ea(fm){fm.next.prev=fm.prev,fm.prev.next=fm.next,fm.prevZ&&(fm.prevZ.nextZ=fm.nextZ),fm.nextZ&&(fm.nextZ.prevZ=fm.prevZ)}function wa(fm,hm,ym){this.i=fm,this.x=hm,this.y=ym,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function La(fm,hm,ym,xm){for(var vm=0,_m=hm,bm=ym-xm;_m<ym;_m+=xm)vm+=(fm[bm]-fm[_m])*(fm[_m+1]+fm[bm+1]),bm=_m;return vm}function Aa(fm){var hm=fm.length;2<hm&&fm[hm-1].equals(fm[0])&&fm.pop()}function Pa(fm,hm){for(var ym=0;ym<hm.length;ym++)fm.push(hm[ym].x),fm.push(hm[ym].y)}function Ca(fm,hm){ee.call(this),this.type='ExtrudeGeometry',this.parameters={shapes:fm,options:hm},this.fromBufferGeometry(new Ra(fm,hm)),this.mergeVertices()}function Ra(fm,hm){function ym(Tm){function Em(Tg,Eg,wg){return Eg||console.error('THREE.ExtrudeGeometry: vec does not exist'),Eg.clone().multiplyScalar(wg).add(Tg)}function wm(Tg,Eg,wg){var Lg,Ag,Pg,Cg=Tg.x-Eg.x,Rg=Tg.y-Eg.y,Ig=wg.x-Tg.x,Dg=wg.y-Tg.y,zg=Cg*Cg+Rg*Rg;if(Math.abs(Cg*Dg-Rg*Ig)>Number.EPSILON){var Bg=Math.sqrt(zg),Ug=Math.sqrt(Ig*Ig+Dg*Dg),Gg=Eg.x-Rg/Bg,Og=Eg.y+Cg/Bg,Fg=wg.x-Dg/Ug,Hg=wg.y+Ig/Ug,Vg=((Fg-Gg)*Dg-(Hg-Og)*Ig)/(Cg*Dg-Rg*Ig);Lg=Gg+Cg*Vg-Tg.x,Ag=Og+Rg*Vg-Tg.y;var kg=Lg*Lg+Ag*Ag;if(2>=kg)return new S(Lg,Ag);Pg=Math.sqrt(kg/2)}else{var Wg=!1;Cg>Number.EPSILON?Ig>Number.EPSILON&&(Wg=!0):Cg<-Number.EPSILON?Ig<-Number.EPSILON&&(Wg=!0):Math.sign(Rg)===Math.sign(Dg)&&(Wg=!0),Wg?(Lg=-Rg,Ag=Cg,Pg=Math.sqrt(zg)):(Lg=Cg,Ag=Rg,Pg=Math.sqrt(zg/2))}return new S(Lg/Pg,Ag/Pg)}function Pm(Tg,Eg){var wg,Lg;for(hg=Tg.length;0<=--hg;){wg=hg,Lg=hg-1,0>Lg&&(Lg=Tg.length-1);var Ag=0,Pg=Um+2*Vm;for(Ag=0;Ag<Pg;Ag++){var Cg=ug*Ag,Rg=ug*(Ag+1),Ig=Eg+wg+Cg,Dg=Eg+Lg+Cg,zg=Eg+Lg+Rg,Ng=Eg+wg+Rg;Im(Ig,Dg,zg,Ng)}}}function Cm(Tg,Eg,wg){Nm.push(Tg),Nm.push(Eg),Nm.push(wg)}function Rm(Tg,Eg,wg){Dm(Tg),Dm(Eg),Dm(wg);var Lg=vm.length/3,Ag=Wm.generateTopUV(xm,vm,Lg-3,Lg-2,Lg-1);zm(Ag[0]),zm(Ag[1]),zm(Ag[2])}function Im(Tg,Eg,wg,Lg){Dm(Tg),Dm(Eg),Dm(Lg),Dm(Eg),Dm(wg),Dm(Lg);var Ag=vm.length/3,Pg=Wm.generateSideWallUV(xm,vm,Ag-6,Ag-3,Ag-2,Ag-1);zm(Pg[0]),zm(Pg[1]),zm(Pg[3]),zm(Pg[1]),zm(Pg[2]),zm(Pg[3])}function Dm(Tg){vm.push(Nm[3*Tg+0]),vm.push(Nm[3*Tg+1]),vm.push(Nm[3*Tg+2])}function zm(Tg){_m.push(Tg.x),_m.push(Tg.y)}var Nm=[],Bm=hm.curveSegments===void 0?12:hm.curveSegments,Um=hm.steps===void 0?1:hm.steps,Gm=hm.depth===void 0?100:hm.depth,Om=!(hm.bevelEnabled!==void 0)||hm.bevelEnabled,Fm=hm.bevelThickness===void 0?6:hm.bevelThickness,Hm=hm.bevelSize===void 0?Fm-2:hm.bevelSize,Vm=hm.bevelSegments===void 0?3:hm.bevelSegments,km=hm.extrudePath,Wm=hm.UVGenerator===void 0?au:hm.UVGenerator;hm.amount!==void 0&&(console.warn('THREE.ExtrudeBufferGeometry: amount has been renamed to depth.'),Gm=hm.amount);var Xm=!1,jm,Ym,Zm,Jm,Qm;km&&(jm=km.getSpacedPoints(Um),Xm=!0,Om=!1,Ym=km.computeFrenetFrames(Um,!1),Zm=new A,Jm=new A,Qm=new A),Om||(Vm=0,Fm=0,Hm=0);var Km,$m,eg,tg=Tm.extractPoints(Bm),rg=tg.shape,ag=tg.holes,og=!ru.isClockWise(rg);if(og)for(rg=rg.reverse(),$m=0,eg=ag.length;$m<eg;$m++)Km=ag[$m],ru.isClockWise(Km)&&(ag[$m]=Km.reverse());var ig=ru.triangulateShape(rg,ag),ng=rg;for($m=0,eg=ag.length;$m<eg;$m++)Km=ag[$m],rg=rg.concat(Km);for(var ug=rg.length,gg=ig.length,fg=[],hg=0,yg=ng.length,xg=yg-1,vg=hg+1,sg,lg,pg,dg,cg,mg;hg<yg;hg++,xg++,vg++)xg===yg&&(xg=0),vg===yg&&(vg=0),fg[hg]=wm(ng[hg],ng[xg],ng[vg]);var _g=[],Mg=fg.concat(),bg;for($m=0,eg=ag.length;$m<eg;$m++){for(Km=ag[$m],bg=[],(hg=0,yg=Km.length,xg=yg-1,vg=hg+1);hg<yg;hg++,xg++,vg++)xg===yg&&(xg=0),vg===yg&&(vg=0),bg[hg]=wm(Km[hg],Km[xg],Km[vg]);_g.push(bg),Mg=Mg.concat(bg)}for(sg=0;sg<Vm;sg++){for(pg=sg/Vm,dg=Fm*Math.cos(pg*Math.PI/2),lg=Hm*Math.sin(pg*Math.PI/2),(hg=0,yg=ng.length);hg<yg;hg++)cg=Em(ng[hg],fg[hg],lg),Cm(cg.x,cg.y,-dg);for($m=0,eg=ag.length;$m<eg;$m++)for(Km=ag[$m],bg=_g[$m],(hg=0,yg=Km.length);hg<yg;hg++)cg=Em(Km[hg],bg[hg],lg),Cm(cg.x,cg.y,-dg)}for(lg=Hm,hg=0;hg<ug;hg++)cg=Om?Em(rg[hg],Mg[hg],lg):rg[hg],Xm?(Jm.copy(Ym.normals[0]).multiplyScalar(cg.x),Zm.copy(Ym.binormals[0]).multiplyScalar(cg.y),Qm.copy(jm[0]).add(Jm).add(Zm),Cm(Qm.x,Qm.y,Qm.z)):Cm(cg.x,cg.y,0);var Sg;for(Sg=1;Sg<=Um;Sg++)for(hg=0;hg<ug;hg++)cg=Om?Em(rg[hg],Mg[hg],lg):rg[hg],Xm?(Jm.copy(Ym.normals[Sg]).multiplyScalar(cg.x),Zm.copy(Ym.binormals[Sg]).multiplyScalar(cg.y),Qm.copy(jm[Sg]).add(Jm).add(Zm),Cm(Qm.x,Qm.y,Qm.z)):Cm(cg.x,cg.y,Gm/Um*Sg);for(sg=Vm-1;0<=sg;sg--){for(pg=sg/Vm,dg=Fm*Math.cos(pg*Math.PI/2),lg=Hm*Math.sin(pg*Math.PI/2),(hg=0,yg=ng.length);hg<yg;hg++)cg=Em(ng[hg],fg[hg],lg),Cm(cg.x,cg.y,Gm+dg);for($m=0,eg=ag.length;$m<eg;$m++)for(Km=ag[$m],bg=_g[$m],(hg=0,yg=Km.length);hg<yg;hg++)cg=Em(Km[hg],bg[hg],lg),Xm?Cm(cg.x,cg.y+jm[Um-1].y,jm[Um-1].x+dg):Cm(cg.x,cg.y,Gm+dg)}(function(){var Tg=vm.length/3;if(Om){var Eg=0,wg=ug*Eg;for(hg=0;hg<gg;hg++)mg=ig[hg],Rm(mg[2]+wg,mg[1]+wg,mg[0]+wg);for(Eg=Um+2*Vm,wg=ug*Eg,hg=0;hg<gg;hg++)mg=ig[hg],Rm(mg[0]+wg,mg[1]+wg,mg[2]+wg)}else{for(hg=0;hg<gg;hg++)mg=ig[hg],Rm(mg[2],mg[1],mg[0]);for(hg=0;hg<gg;hg++)mg=ig[hg],Rm(mg[0]+ug*Um,mg[1]+ug*Um,mg[2]+ug*Um)}xm.addGroup(Tg,vm.length/3-Tg,0)})(),function(){var Tg=vm.length/3,Eg=0;for(Pm(ng,Eg),Eg+=ng.length,($m=0,eg=ag.length);$m<eg;$m++)Km=ag[$m],Pm(Km,Eg),Eg+=Km.length;xm.addGroup(Tg,vm.length/3-Tg,1)}()}xe.call(this),this.type='ExtrudeBufferGeometry',this.parameters={shapes:fm,options:hm},fm=Array.isArray(fm)?fm:[fm];for(var xm=this,vm=[],_m=[],bm=0,Mm=fm.length,Sm;bm<Mm;bm++)Sm=fm[bm],ym(Sm);this.addAttribute('position',new ge(vm,3)),this.addAttribute('uv',new ge(_m,2)),this.computeVertexNormals()}function Ia(fm,hm,ym){if(ym.shapes=[],Array.isArray(fm))for(var xm=0,vm=fm.length,_m;xm<vm;xm++)_m=fm[xm],ym.shapes.push(_m.uuid);else ym.shapes.push(fm.uuid);return void 0!==hm.extrudePath&&(ym.options.extrudePath=hm.extrudePath.toJSON()),ym}function Da(fm,hm){ee.call(this),this.type='TextGeometry',this.parameters={text:fm,parameters:hm},this.fromBufferGeometry(new za(fm,hm)),this.mergeVertices()}function za(fm,hm){hm=hm||{};var ym=hm.font;if(!(ym&&ym.isFont))return console.error('THREE.TextGeometry: font parameter is not an instance of THREE.Font.'),new ee;var xm=ym.generateShapes(fm,hm.size);hm.depth=hm.height===void 0?50:hm.height,hm.bevelThickness===void 0&&(hm.bevelThickness=10),hm.bevelSize===void 0&&(hm.bevelSize=8),hm.bevelEnabled===void 0&&(hm.bevelEnabled=!1),Ra.call(this,xm,hm),this.type='TextBufferGeometry'}function Na(fm,hm,ym,xm,vm,_m,bm){ee.call(this),this.type='SphereGeometry',this.parameters={radius:fm,widthSegments:hm,heightSegments:ym,phiStart:xm,phiLength:vm,thetaStart:_m,thetaLength:bm},this.fromBufferGeometry(new Ba(fm,hm,ym,xm,vm,_m,bm)),this.mergeVertices()}function Ba(fm,hm,ym,xm,vm,_m,bm){xe.call(this),this.type='SphereBufferGeometry',this.parameters={radius:fm,widthSegments:hm,heightSegments:ym,phiStart:xm,phiLength:vm,thetaStart:_m,thetaLength:bm},fm=fm||1,hm=Math.max(3,Math.floor(hm)||8),ym=Math.max(2,Math.floor(ym)||6),xm=xm===void 0?0:xm,vm=vm===void 0?2*Math.PI:vm,_m=_m===void 0?0:_m,bm=bm===void 0?Math.PI:bm;var Mm=_m+bm,Sm,Tm,Em=0,wm=[],Lm=new A,Am=new A,Pm=[],Cm=[],Rm=[],Im=[];for(Tm=0;Tm<=ym;Tm++){var Dm=[],zm=Tm/ym;for(Sm=0;Sm<=hm;Sm++){var Nm=Sm/hm;Lm.x=-fm*Math.cos(xm+Nm*vm)*Math.sin(_m+zm*bm),Lm.y=fm*Math.cos(_m+zm*bm),Lm.z=fm*Math.sin(xm+Nm*vm)*Math.sin(_m+zm*bm),Cm.push(Lm.x,Lm.y,Lm.z),Am.set(Lm.x,Lm.y,Lm.z).normalize(),Rm.push(Am.x,Am.y,Am.z),Im.push(Nm,1-zm),Dm.push(Em++)}wm.push(Dm)}for(Tm=0;Tm<ym;Tm++)for(Sm=0;Sm<hm;Sm++){var Bm=wm[Tm][Sm+1],Um=wm[Tm][Sm],Gm=wm[Tm+1][Sm],Om=wm[Tm+1][Sm+1];(0!==Tm||0<_m)&&Pm.push(Bm,Um,Om),(Tm!==ym-1||Mm<Math.PI)&&Pm.push(Um,Gm,Om)}this.setIndex(Pm),this.addAttribute('position',new ge(Cm,3)),this.addAttribute('normal',new ge(Rm,3)),this.addAttribute('uv',new ge(Im,2))}function Ua(fm,hm,ym,xm,vm,_m){ee.call(this),this.type='RingGeometry',this.parameters={innerRadius:fm,outerRadius:hm,thetaSegments:ym,phiSegments:xm,thetaStart:vm,thetaLength:_m},this.fromBufferGeometry(new Ga(fm,hm,ym,xm,vm,_m)),this.mergeVertices()}function Ga(fm,hm,ym,xm,vm,_m){xe.call(this),this.type='RingBufferGeometry',this.parameters={innerRadius:fm,outerRadius:hm,thetaSegments:ym,phiSegments:xm,thetaStart:vm,thetaLength:_m},fm=fm||0.5,hm=hm||1,vm=vm===void 0?0:vm,_m=_m===void 0?2*Math.PI:_m,ym=ym===void 0?8:Math.max(3,ym),xm=xm===void 0?1:Math.max(1,xm);var bm=[],Mm=[],Sm=[],Tm=[],Em,wm=fm,Lm=(hm-fm)/xm,Am=new A,Pm=new S,Cm,Rm;for(Cm=0;Cm<=xm;Cm++){for(Rm=0;Rm<=ym;Rm++)Em=vm+Rm/ym*_m,Am.x=wm*Math.cos(Em),Am.y=wm*Math.sin(Em),Mm.push(Am.x,Am.y,Am.z),Sm.push(0,0,1),Pm.x=(Am.x/hm+1)/2,Pm.y=(Am.y/hm+1)/2,Tm.push(Pm.x,Pm.y);wm+=Lm}for(Cm=0;Cm<xm;Cm++){var Im=Cm*(ym+1);for(Rm=0;Rm<ym;Rm++){Em=Rm+Im;var Dm=Em,zm=Em+ym+1,Nm=Em+ym+2,Bm=Em+1;bm.push(Dm,zm,Bm),bm.push(zm,Nm,Bm)}}this.setIndex(bm),this.addAttribute('position',new ge(Mm,3)),this.addAttribute('normal',new ge(Sm,3)),this.addAttribute('uv',new ge(Tm,2))}function Oa(fm,hm,ym,xm){ee.call(this),this.type='LatheGeometry',this.parameters={points:fm,segments:hm,phiStart:ym,phiLength:xm},this.fromBufferGeometry(new Fa(fm,hm,ym,xm)),this.mergeVertices()}function Fa(fm,hm,ym,xm){xe.call(this),this.type='LatheBufferGeometry',this.parameters={points:fm,segments:hm,phiStart:ym,phiLength:xm},hm=Math.floor(hm)||12,ym=ym||0,xm=xm||2*Math.PI,xm=dp.clamp(xm,0,2*Math.PI);var vm=[],_m=[],bm=[],Sm=1/hm,Tm=new A,Em=new S,Mm,wm,Lm;for(wm=0;wm<=hm;wm++){var Am=ym+wm*Sm*xm,Pm=Math.sin(Am),Cm=Math.cos(Am);for(Lm=0;Lm<=fm.length-1;Lm++)Tm.x=fm[Lm].x*Pm,Tm.y=fm[Lm].y,Tm.z=fm[Lm].x*Cm,_m.push(Tm.x,Tm.y,Tm.z),Em.x=wm/hm,Em.y=Lm/(fm.length-1),bm.push(Em.x,Em.y)}for(wm=0;wm<hm;wm++)for(Lm=0;Lm<fm.length-1;Lm++){Mm=Lm+wm*fm.length;var Rm=Mm,Im=Mm+fm.length,Dm=Mm+fm.length+1,zm=Mm+1;vm.push(Rm,Im,zm),vm.push(Im,Dm,zm)}if(this.setIndex(vm),this.addAttribute('position',new ge(_m,3)),this.addAttribute('uv',new ge(bm,2)),this.computeVertexNormals(),xm===2*Math.PI){var Nm=this.attributes.normal.array,Bm=new A,Um=new A,Gm=new A;for(Mm=3*(hm*fm.length),wm=0,Lm=0;wm<fm.length;wm++,Lm+=3)Bm.x=Nm[Lm+0],Bm.y=Nm[Lm+1],Bm.z=Nm[Lm+2],Um.x=Nm[Mm+Lm+0],Um.y=Nm[Mm+Lm+1],Um.z=Nm[Mm+Lm+2],Gm.addVectors(Bm,Um).normalize(),Nm[Lm+0]=Nm[Mm+Lm+0]=Gm.x,Nm[Lm+1]=Nm[Mm+Lm+1]=Gm.y,Nm[Lm+2]=Nm[Mm+Lm+2]=Gm.z}}function Ha(fm,hm){ee.call(this),this.type='ShapeGeometry','object'==typeof hm&&(console.warn('THREE.ShapeGeometry: Options parameter has been removed.'),hm=hm.curveSegments),this.parameters={shapes:fm,curveSegments:hm},this.fromBufferGeometry(new Va(fm,hm)),this.mergeVertices()}function Va(fm,hm){function ym(Em){var wm,Lm,Am,Pm=vm.length/3,Cm=Em.extractPoints(hm),Rm=Cm.shape,Im=Cm.holes;if(!1===ru.isClockWise(Rm))for(Rm=Rm.reverse(),wm=0,Lm=Im.length;wm<Lm;wm++)Am=Im[wm],!0===ru.isClockWise(Am)&&(Im[wm]=Am.reverse());var Dm=ru.triangulateShape(Rm,Im);for(wm=0,Lm=Im.length;wm<Lm;wm++)Am=Im[wm],Rm=Rm.concat(Am);for(wm=0,Lm=Rm.length;wm<Lm;wm++){var zm=Rm[wm];vm.push(zm.x,zm.y,0),_m.push(0,0,1),bm.push(zm.x,zm.y)}for(wm=0,Lm=Dm.length;wm<Lm;wm++){var Nm=Dm[wm],Bm=Nm[0]+Pm,Um=Nm[1]+Pm,Gm=Nm[2]+Pm;xm.push(Bm,Um,Gm),Sm+=3}}xe.call(this),this.type='ShapeBufferGeometry',this.parameters={shapes:fm,curveSegments:hm},hm=hm||12;var xm=[],vm=[],_m=[],bm=[],Mm=0,Sm=0;if(!1===Array.isArray(fm))ym(fm);else for(var Tm=0;Tm<fm.length;Tm++)ym(fm[Tm]),this.addGroup(Mm,Sm,Tm),Mm+=Sm,Sm=0;this.setIndex(xm),this.addAttribute('position',new ge(vm,3)),this.addAttribute('normal',new ge(_m,3)),this.addAttribute('uv',new ge(bm,2))}function ka(fm,hm){if(hm.shapes=[],Array.isArray(fm))for(var ym=0,xm=fm.length,vm;ym<xm;ym++)vm=fm[ym],hm.shapes.push(vm.uuid);else hm.shapes.push(fm.uuid);return hm}function Wa(fm,hm){xe.call(this),this.type='EdgesGeometry',this.parameters={thresholdAngle:hm},hm=hm===void 0?1:hm;var ym=[],xm=Math.cos(dp.DEG2RAD*hm),vm=[0,0],_m={},bm,Mm,Sm,Tm=['a','b','c'],Em;fm.isBufferGeometry?(Em=new ee,Em.fromBufferGeometry(fm)):Em=fm.clone(),Em.mergeVertices(),Em.computeFaceNormals();for(var wm=Em.vertices,Lm=Em.faces,Am=0,Pm=Lm.length,Cm;Am<Pm;Am++){Cm=Lm[Am];for(var Rm=0;3>Rm;Rm++)bm=Cm[Tm[Rm]],Mm=Cm[Tm[(Rm+1)%3]],vm[0]=Math.min(bm,Mm),vm[1]=Math.max(bm,Mm),Sm=vm[0]+','+vm[1],void 0===_m[Sm]?_m[Sm]={index1:vm[0],index2:vm[1],face1:Am,face2:void 0}:_m[Sm].face2=Am}for(Sm in _m){var Im=_m[Sm];if(Im.face2===void 0||Lm[Im.face1].normal.dot(Lm[Im.face2].normal)<=xm){var Dm=wm[Im.index1];ym.push(Dm.x,Dm.y,Dm.z),Dm=wm[Im.index2],ym.push(Dm.x,Dm.y,Dm.z)}}this.addAttribute('position',new ge(ym,3))}function ja(fm,hm,ym,xm,vm,_m,bm,Mm){ee.call(this),this.type='CylinderGeometry',this.parameters={radiusTop:fm,radiusBottom:hm,height:ym,radialSegments:xm,heightSegments:vm,openEnded:_m,thetaStart:bm,thetaLength:Mm},this.fromBufferGeometry(new Xa(fm,hm,ym,xm,vm,_m,bm,Mm)),this.mergeVertices()}function Xa(fm,hm,ym,xm,vm,_m,bm,Mm){function Tm(zm){var Nm,Bm,Um,Gm=new S,Om=new A,Fm=0,Hm=!0===zm?fm:hm,Vm=!0===zm?1:-1;for(Bm=Cm,Nm=1;Nm<=xm;Nm++)Lm.push(0,Im*Vm,0),Am.push(0,Vm,0),Pm.push(0.5,0.5),Cm++;for(Um=Cm,Nm=0;Nm<=xm;Nm++){var km=Nm/xm,Wm=km*Mm+bm,jm=Math.cos(Wm),Xm=Math.sin(Wm);Om.x=Hm*Xm,Om.y=Im*Vm,Om.z=Hm*jm,Lm.push(Om.x,Om.y,Om.z),Am.push(0,Vm,0),Gm.x=0.5*jm+0.5,Gm.y=0.5*Xm*Vm+0.5,Pm.push(Gm.x,Gm.y),Cm++}for(Nm=0;Nm<xm;Nm++){var Ym=Bm+Nm,Zm=Um+Nm;!0===zm?wm.push(Zm,Zm+1,Ym):wm.push(Zm+1,Zm,Ym),Fm+=3}Em.addGroup(Dm,Fm,!0===zm?1:2),Dm+=Fm}xe.call(this),this.type='CylinderBufferGeometry',this.parameters={radiusTop:fm,radiusBottom:hm,height:ym,radialSegments:xm,heightSegments:vm,openEnded:_m,thetaStart:bm,thetaLength:Mm};var Em=this;fm=fm===void 0?1:fm,hm=hm===void 0?1:hm,ym=ym||1,xm=Math.floor(xm)||8,vm=Math.floor(vm)||1,_m=_m!==void 0&&_m,bm=bm===void 0?0:bm,Mm=Mm===void 0?2*Math.PI:Mm;var wm=[],Lm=[],Am=[],Pm=[],Cm=0,Rm=[],Im=ym/2,Dm=0;(function(){var zm,Nm,Bm=new A,Um=new A,Gm=0,Om=(hm-fm)/ym;for(Nm=0;Nm<=vm;Nm++){var Fm=[],Hm=Nm/vm,Vm=Hm*(hm-fm)+fm;for(zm=0;zm<=xm;zm++){var km=zm/xm,Wm=km*Mm+bm,jm=Math.sin(Wm),Xm=Math.cos(Wm);Um.x=Vm*jm,Um.y=-Hm*ym+Im,Um.z=Vm*Xm,Lm.push(Um.x,Um.y,Um.z),Bm.set(jm,Om,Xm).normalize(),Am.push(Bm.x,Bm.y,Bm.z),Pm.push(km,1-Hm),Fm.push(Cm++)}Rm.push(Fm)}for(zm=0;zm<xm;zm++)for(Nm=0;Nm<vm;Nm++){var Ym=Rm[Nm][zm],Zm=Rm[Nm+1][zm],Jm=Rm[Nm+1][zm+1],Qm=Rm[Nm][zm+1];wm.push(Ym,Zm,Qm),wm.push(Zm,Jm,Qm),Gm+=6}Em.addGroup(Dm,Gm,0),Dm+=Gm})(),!1===_m&&(0<fm&&Tm(!0),0<hm&&Tm(!1)),this.setIndex(wm),this.addAttribute('position',new ge(Lm,3)),this.addAttribute('normal',new ge(Am,3)),this.addAttribute('uv',new ge(Pm,2))}function Ya(fm,hm,ym,xm,vm,_m,bm){ja.call(this,0,fm,hm,ym,xm,vm,_m,bm),this.type='ConeGeometry',this.parameters={radius:fm,height:hm,radialSegments:ym,heightSegments:xm,openEnded:vm,thetaStart:_m,thetaLength:bm}}function Za(fm,hm,ym,xm,vm,_m,bm){Xa.call(this,0,fm,hm,ym,xm,vm,_m,bm),this.type='ConeBufferGeometry',this.parameters={radius:fm,height:hm,radialSegments:ym,heightSegments:xm,openEnded:vm,thetaStart:_m,thetaLength:bm}}function Ja(fm,hm,ym,xm){ee.call(this),this.type='CircleGeometry',this.parameters={radius:fm,segments:hm,thetaStart:ym,thetaLength:xm},this.fromBufferGeometry(new Qa(fm,hm,ym,xm)),this.mergeVertices()}function Qa(fm,hm,ym,xm){xe.call(this),this.type='CircleBufferGeometry',this.parameters={radius:fm,segments:hm,thetaStart:ym,thetaLength:xm},fm=fm||1,hm=hm===void 0?8:Math.max(3,hm),ym=ym===void 0?0:ym,xm=xm===void 0?2*Math.PI:xm;var vm=[],_m=[],bm=[],Mm=[],Sm,Tm,Em=new A,wm=new S;for(_m.push(0,0,0),bm.push(0,0,1),Mm.push(0.5,0.5),(Tm=0,Sm=3);Tm<=hm;Tm++,Sm+=3){var Lm=ym+Tm/hm*xm;Em.x=fm*Math.cos(Lm),Em.y=fm*Math.sin(Lm),_m.push(Em.x,Em.y,Em.z),bm.push(0,0,1),wm.x=(_m[Sm]/fm+1)/2,wm.y=(_m[Sm+1]/fm+1)/2,Mm.push(wm.x,wm.y)}for(Sm=1;Sm<=hm;Sm++)vm.push(Sm,Sm+1,0);this.setIndex(vm),this.addAttribute('position',new ge(_m,3)),this.addAttribute('normal',new ge(bm,3)),this.addAttribute('uv',new ge(Mm,2))}function Ka(fm){Te.call(this),this.type='ShadowMaterial',this.color=new W(0),this.transparent=!0,this.setValues(fm)}function $a(fm){Ee.call(this,fm),this.type='RawShaderMaterial'}function eo(fm){Te.call(this),this.defines={STANDARD:''},this.type='MeshStandardMaterial',this.color=new W(16777215),this.roughness=0.5,this.metalness=0.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sp,this.normalScale=new S(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=0.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap='round',this.wireframeLinejoin='round',this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(fm)}function ro(fm){eo.call(this),this.defines={PHYSICAL:''},this.type='MeshPhysicalMaterial',this.reflectivity=0.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(fm)}function ao(fm){Te.call(this),this.type='MeshPhongMaterial',this.color=new W(16777215),this.specular=new W(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sp,this.normalScale=new S(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ms,this.reflectivity=1,this.refractionRatio=0.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap='round',this.wireframeLinejoin='round',this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(fm)}function oo(fm){ao.call(this),this.defines={TOON:''},this.type='MeshToonMaterial',this.gradientMap=null,this.setValues(fm)}function io(fm){Te.call(this),this.type='MeshNormalMaterial',this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sp,this.normalScale=new S(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(fm)}function no(fm){Te.call(this),this.type='MeshLambertMaterial',this.color=new W(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ms,this.reflectivity=1,this.refractionRatio=0.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap='round',this.wireframeLinejoin='round',this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(fm)}function so(fm){if(Te.call(this),this.defines={MATCAP:''},this.type='MeshMatcapMaterial',this.color=new W(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sp,this.normalScale=new S(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(fm),null===this.matcap){var hm=document.createElement('canvas');hm.width=1,hm.height=1;var ym=hm.getContext('2d');ym.fillStyle='#fff',ym.fillRect(0,0,1,1),this.matcap=new THREE.CanvasTexture(hm)}}function lo(fm){Tr.call(this),this.type='LineDashedMaterial',this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(fm)}function po(fm,hm,ym,xm){this.parameterPositions=fm,this._cachedIndex=0,this.resultBuffer=xm===void 0?new hm.constructor(ym):xm,this.sampleValues=hm,this.valueSize=ym}function co(fm,hm,ym,xm){po.call(this,fm,hm,ym,xm),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function uo(fm,hm,ym,xm){po.call(this,fm,hm,ym,xm)}function mo(fm,hm,ym,xm){po.call(this,fm,hm,ym,xm)}function go(fm,hm,ym,xm){if(fm===void 0)throw new Error('THREE.KeyframeTrack: track name is undefined');if(void 0===hm||0===hm.length)throw new Error('THREE.KeyframeTrack: no keyframes in track named '+fm);this.name=fm,this.times=nu.convertArray(hm,this.TimeBufferType),this.values=nu.convertArray(ym,this.ValueBufferType),this.setInterpolation(xm||this.DefaultInterpolation)}function fo(fm,hm,ym){go.call(this,fm,hm,ym)}function yo(fm,hm,ym,xm){go.call(this,fm,hm,ym,xm)}function xo(fm,hm,ym,xm){go.call(this,fm,hm,ym,xm)}function vo(fm,hm,ym,xm){po.call(this,fm,hm,ym,xm)}function _o(fm,hm,ym,xm){go.call(this,fm,hm,ym,xm)}function bo(fm,hm,ym,xm){go.call(this,fm,hm,ym,xm)}function Mo(fm,hm,ym,xm){go.call(this,fm,hm,ym,xm)}function So(fm,hm,ym){this.name=fm,this.tracks=ym,this.duration=hm===void 0?-1:hm,this.uuid=dp.generateUUID(),0>this.duration&&this.resetDuration()}function To(fm){switch(fm.toLowerCase()){case'scalar':case'double':case'float':case'number':case'integer':return xo;case'vector':case'vector2':case'vector3':case'vector4':return Mo;case'color':return yo;case'quaternion':return _o;case'bool':case'boolean':return fo;case'string':return bo;}throw new Error('THREE.KeyframeTrack: Unsupported typeName: '+fm)}function Eo(fm){if(fm.type===void 0)throw new Error('THREE.KeyframeTrack: track type undefined, can not parse');var hm=To(fm.type);if(fm.times===void 0){var ym=[],xm=[];nu.flattenJSON(fm.keys,ym,xm,'value'),fm.times=ym,fm.values=xm}return void 0===hm.parse?new hm(fm.name,fm.times,fm.values,fm.interpolation):hm.parse(fm)}function wo(fm,hm,ym){var xm=this,vm=!1,_m=0,bm=0,Mm;this.onStart=void 0,this.onLoad=fm,this.onProgress=hm,this.onError=ym,this.itemStart=function(Sm){bm++,!1==vm&&xm.onStart!==void 0&&xm.onStart(Sm,_m,bm),vm=!0},this.itemEnd=function(Sm){_m++,xm.onProgress!==void 0&&xm.onProgress(Sm,_m,bm),_m==bm&&(vm=!1,xm.onLoad!==void 0&&xm.onLoad())},this.itemError=function(Sm){xm.onError!==void 0&&xm.onError(Sm)},this.resolveURL=function(Sm){return Mm?Mm(Sm):Sm},this.setURLModifier=function(Sm){return Mm=Sm,this}}function Lo(fm){this.manager=fm===void 0?du:fm}function Ro(fm){this.manager=fm===void 0?du:fm}function Io(fm){this.manager=fm===void 0?du:fm}function Do(fm){this.manager=fm===void 0?du:fm}function zo(){this.type='Curve',this.arcLengthDivisions=200}function No(fm,hm,ym,xm,vm,_m,bm,Mm){zo.call(this),this.type='EllipseCurve',this.aX=fm||0,this.aY=hm||0,this.xRadius=ym||1,this.yRadius=xm||1,this.aStartAngle=vm||0,this.aEndAngle=_m||2*Math.PI,this.aClockwise=bm||!1,this.aRotation=Mm||0}function Bo(fm,hm,ym,xm,vm,_m){No.call(this,fm,hm,ym,ym,xm,vm,_m),this.type='ArcCurve'}function Uo(){function fm(_m,bm,Mm,Sm){hm=_m,ym=Mm,xm=-3*_m+3*bm-2*Mm-Sm,vm=2*_m-2*bm+Mm+Sm}var hm=0,ym=0,xm=0,vm=0;return{initCatmullRom:function(_m,bm,Mm,Sm,Tm){fm(bm,Mm,Tm*(Mm-_m),Tm*(Sm-bm))},initNonuniformCatmullRom:function(_m,bm,Mm,Sm,Tm,Em,wm){var Lm=(bm-_m)/Tm-(Mm-_m)/(Tm+Em)+(Mm-bm)/Em,Am=(Mm-bm)/Em-(Sm-bm)/(Em+wm)+(Sm-Mm)/wm;Lm*=Em,Am*=Em,fm(bm,Mm,Lm,Am)},calc:function(_m){var bm=_m*_m;return hm+ym*_m+xm*bm+vm*(bm*_m)}}}function Go(fm,hm,ym,xm){zo.call(this),this.type='CatmullRomCurve3',this.points=fm||[],this.closed=hm||!1,this.curveType=ym||'centripetal',this.tension=xm||0.5}function Oo(fm,hm,ym,xm,vm){var _m=0.5*(xm-hm),bm=0.5*(vm-ym),Mm=fm*fm;return(2*ym-2*xm+_m+bm)*(fm*Mm)+(-3*ym+3*xm-2*_m-bm)*Mm+_m*fm+ym}function Fo(fm,hm){var ym=1-fm;return ym*ym*hm}function Ho(fm,hm){return 2*(1-fm)*fm*hm}function Vo(fm,hm){return fm*fm*hm}function ko(fm,hm,ym,xm){return Fo(fm,hm)+Ho(fm,ym)+Vo(fm,xm)}function Wo(fm,hm){var ym=1-fm;return ym*ym*ym*hm}function jo(fm,hm){var ym=1-fm;return 3*ym*ym*fm*hm}function qo(fm,hm){return 3*(1-fm)*fm*fm*hm}function Xo(fm,hm){return fm*fm*fm*hm}function Yo(fm,hm,ym,xm,vm){return Wo(fm,hm)+jo(fm,ym)+qo(fm,xm)+Xo(fm,vm)}function Zo(fm,hm,ym,xm){zo.call(this),this.type='CubicBezierCurve',this.v0=fm||new S,this.v1=hm||new S,this.v2=ym||new S,this.v3=xm||new S}function Jo(fm,hm,ym,xm){zo.call(this),this.type='CubicBezierCurve3',this.v0=fm||new A,this.v1=hm||new A,this.v2=ym||new A,this.v3=xm||new A}function Qo(fm,hm){zo.call(this),this.type='LineCurve',this.v1=fm||new S,this.v2=hm||new S}function Ko(fm,hm){zo.call(this),this.type='LineCurve3',this.v1=fm||new A,this.v2=hm||new A}function $o(fm,hm,ym){zo.call(this),this.type='QuadraticBezierCurve',this.v0=fm||new S,this.v1=hm||new S,this.v2=ym||new S}function ei(fm,hm,ym){zo.call(this),this.type='QuadraticBezierCurve3',this.v0=fm||new A,this.v1=hm||new A,this.v2=ym||new A}function ti(fm){zo.call(this),this.type='SplineCurve',this.points=fm||[]}function ri(){zo.call(this),this.type='CurvePath',this.curves=[],this.autoClose=!1}function ai(fm){ri.call(this),this.type='Path',this.currentPoint=new S,fm&&this.setFromPoints(fm)}function oi(fm){ai.call(this,fm),this.uuid=dp.generateUUID(),this.type='Shape',this.holes=[]}function ii(fm,hm){K.call(this),this.type='Light',this.color=new W(fm),this.intensity=hm===void 0?1:hm,this.receiveShadow=void 0}function ni(fm,hm,ym){ii.call(this,fm,ym),this.type='HemisphereLight',this.castShadow=void 0,this.position.copy(K.DefaultUp),this.updateMatrix(),this.groundColor=new W(hm)}function si(fm){this.camera=fm,this.bias=0,this.radius=1,this.mapSize=new S(512,512),this.map=null,this.matrix=new E}function li(){si.call(this,new nr(50,1,0.5,500))}function pi(fm,hm,ym,xm,vm,_m){ii.call(this,fm,hm),this.type='SpotLight',this.position.copy(K.DefaultUp),this.updateMatrix(),this.target=new K,Object.defineProperty(this,'power',{get:function(){return this.intensity*Math.PI},set:function(bm){this.intensity=bm/Math.PI}}),this.distance=ym===void 0?0:ym,this.angle=xm===void 0?Math.PI/3:xm,this.penumbra=vm===void 0?0:vm,this.decay=_m===void 0?1:_m,this.shadow=new li}function di(fm,hm,ym,xm){ii.call(this,fm,hm),this.type='PointLight',Object.defineProperty(this,'power',{get:function(){return 4*this.intensity*Math.PI},set:function(vm){this.intensity=vm/(4*Math.PI)}}),this.distance=ym===void 0?0:ym,this.decay=xm===void 0?1:xm,this.shadow=new si(new nr(90,1,0.5,500))}function ci(fm,hm,ym,xm,vm,_m){ir.call(this),this.type='OrthographicCamera',this.zoom=1,this.view=null,this.left=fm===void 0?-1:fm,this.right=hm===void 0?1:hm,this.top=ym===void 0?1:ym,this.bottom=xm===void 0?-1:xm,this.near=vm===void 0?0.1:vm,this.far=_m===void 0?2e3:_m,this.updateProjectionMatrix()}function ui(){si.call(this,new ci(-5,5,5,-5,0.5,500))}function mi(fm,hm){ii.call(this,fm,hm),this.type='DirectionalLight',this.position.copy(K.DefaultUp),this.updateMatrix(),this.target=new K,this.shadow=new ui}function gi(fm,hm){ii.call(this,fm,hm),this.type='AmbientLight',this.castShadow=void 0}function hi(fm,hm,ym,xm){ii.call(this,fm,hm),this.type='RectAreaLight',this.width=ym===void 0?10:ym,this.height=xm===void 0?10:xm}function yi(fm){this.manager=fm===void 0?du:fm,this.textures={}}function xi(fm){this.manager=fm===void 0?du:fm}function vi(){}function _i(fm){'boolean'==typeof fm&&(console.warn('THREE.JSONLoader: showStatus parameter has been removed from constructor.'),fm=void 0),this.manager=fm===void 0?du:fm,this.withCredentials=!1}function bi(fm){this.manager=fm===void 0?du:fm,this.resourcePath=''}function Mi(){this.type='ShapePath',this.color=new W,this.subPaths=[],this.currentPath=null}function Si(fm){this.type='Font',this.data=fm}function Ti(fm,hm,ym){for(var xm=Array.from?Array.from(fm):(fm+'').split(''),vm=hm/ym.resolution,_m=(ym.boundingBox.yMax-ym.boundingBox.yMin+ym.underlineThickness)*vm,bm=[],Mm=0,Sm=0,Tm=0,Em;Tm<xm.length;Tm++)if(Em=xm[Tm],'\n'===Em)Mm=0,Sm-=_m;else{var wm=Ei(Em,vm,Mm,Sm,ym);Mm+=wm.offsetX,bm.push(wm.path)}return bm}function Ei(fm,hm,ym,xm,vm){var _m=vm.glyphs[fm]||vm.glyphs['?'];if(_m){var bm=new Mi,Mm,Sm,Tm,Em,wm,Lm,Am,Pm;if(_m.o)for(var Cm=_m._cachedOutline||(_m._cachedOutline=_m.o.split(' ')),Rm=0,Im=Cm.length,Dm;Rm<Im;)Dm=Cm[Rm++],'m'===Dm?(Mm=Cm[Rm++]*hm+ym,Sm=Cm[Rm++]*hm+xm,bm.moveTo(Mm,Sm)):'l'===Dm?(Mm=Cm[Rm++]*hm+ym,Sm=Cm[Rm++]*hm+xm,bm.lineTo(Mm,Sm)):'q'===Dm?(Tm=Cm[Rm++]*hm+ym,Em=Cm[Rm++]*hm+xm,wm=Cm[Rm++]*hm+ym,Lm=Cm[Rm++]*hm+xm,bm.quadraticCurveTo(wm,Lm,Tm,Em)):'b'===Dm?(Tm=Cm[Rm++]*hm+ym,Em=Cm[Rm++]*hm+xm,wm=Cm[Rm++]*hm+ym,Lm=Cm[Rm++]*hm+xm,Am=Cm[Rm++]*hm+ym,Pm=Cm[Rm++]*hm+xm,bm.bezierCurveTo(wm,Lm,Am,Pm,Tm,Em)):void 0;return{offsetX:_m.ha*hm,path:bm}}}function Li(fm){this.manager=fm===void 0?du:fm}function Pi(fm,hm,ym,xm){K.call(this),this.type='CubeCamera';var vm=90,_m=1,bm=new nr(vm,_m,fm,hm);bm.up.set(0,-1,0),bm.lookAt(new A(1,0,0)),this.add(bm);var Mm=new nr(vm,_m,fm,hm);Mm.up.set(0,-1,0),Mm.lookAt(new A(-1,0,0)),this.add(Mm);var Sm=new nr(vm,_m,fm,hm);Sm.up.set(0,0,1),Sm.lookAt(new A(0,1,0)),this.add(Sm);var Tm=new nr(vm,_m,fm,hm);Tm.up.set(0,0,-1),Tm.lookAt(new A(0,-1,0)),this.add(Tm);var Em=new nr(vm,_m,fm,hm);Em.up.set(0,-1,0),Em.lookAt(new A(0,0,1)),this.add(Em);var wm=new nr(vm,_m,fm,hm);wm.up.set(0,-1,0),wm.lookAt(new A(0,0,-1)),this.add(wm),xm=xm||{format:Ks,magFilter:Bs,minFilter:Bs},this.renderTarget=new U(ym,ym,xm),this.renderTarget.texture.name='CubeCamera',this.update=function(Lm,Am){null===this.parent&&this.updateMatrixWorld();var Pm=this.renderTarget,Cm=Pm.texture.generateMipmaps;Pm.texture.generateMipmaps=!1,Pm.activeCubeFace=0,Lm.render(Am,bm,Pm),Pm.activeCubeFace=1,Lm.render(Am,Mm,Pm),Pm.activeCubeFace=2,Lm.render(Am,Sm,Pm),Pm.activeCubeFace=3,Lm.render(Am,Tm,Pm),Pm.activeCubeFace=4,Lm.render(Am,Em,Pm),Pm.texture.generateMipmaps=Cm,Pm.activeCubeFace=5,Lm.render(Am,wm,Pm),Lm.setRenderTarget(null)},this.clear=function(Lm,Am,Pm,Cm){for(var Rm=this.renderTarget,Im=0;6>Im;Im++)Rm.activeCubeFace=Im,Lm.setRenderTarget(Rm),Lm.clear(Am,Pm,Cm);Lm.setRenderTarget(null)}}function Ci(fm){this.autoStart=!(fm!==void 0)||fm,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Ri(){K.call(this),this.type='AudioListener',this.context=Tu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function Ii(fm){K.call(this),this.type='Audio',this.listener=fm,this.context=fm.context,this.gain=this.context.createGain(),this.gain.connect(fm.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType='empty',this.filters=[]}function Di(fm){Ii.call(this,fm),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function zi(fm,hm){this.analyser=fm.context.createAnalyser(),this.analyser.fftSize=hm===void 0?2048:hm,this.data=new Uint8Array(this.analyser.frequencyBinCount),fm.getOutput().connect(this.analyser)}function Ni(fm,hm,ym){this.binding=fm,this.valueSize=ym;var xm=Float64Array,vm;'quaternion'===hm?vm=this._slerp:'string'===hm||'bool'===hm?(xm=Array,vm=this._select):vm=this._lerp;this.buffer=new xm(4*ym),this._mixBufferRegion=vm,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function Bi(fm,hm,ym){var xm=ym||Ui.parseTrackName(hm);this._targetGroup=fm,this._bindings=fm.subscribe_(hm,xm)}function Ui(fm,hm,ym){this.path=hm,this.parsedPath=ym||Ui.parseTrackName(hm),this.node=Ui.findNode(fm,this.parsedPath.nodeName)||fm,this.rootNode=fm}function Oi(fm,hm,ym){this._mixer=fm,this._clip=hm,this._localRoot=ym||null;for(var xm=hm.tracks,vm=xm.length,_m=Array(vm),bm={endingStart:ql,endingEnd:ql},Mm=0,Sm;Mm!==vm;++Mm)Sm=xm[Mm].createInterpolant(null),_m[Mm]=Sm,Sm.settings=bm;this._interpolantSettings=bm,this._interpolants=_m,this._propertyBindings=Array(vm),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=Infinity,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Fi(fm){this._root=fm,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Hi(fm){'string'==typeof fm&&(console.warn('THREE.Uniform: Type parameter is no longer needed.'),fm=arguments[1]),this.value=fm}function Vi(){xe.call(this),this.type='InstancedBufferGeometry',this.maxInstancedCount=void 0}function ki(fm,hm,ym){fr.call(this,fm,hm),this.meshPerAttribute=ym||1}function Wi(fm,hm,ym,xm){'number'==typeof ym&&(xm=ym,ym=!1,console.error('THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.')),re.call(this,fm,hm,ym),this.meshPerAttribute=xm||1}function qi(fm,hm){return fm.distance-hm.distance}function Xi(fm,hm,ym,xm){if(!1!==fm.visible&&(fm.raycast(hm,ym),!0===xm))for(var vm=fm.children,_m=0,bm=vm.length;_m<bm;_m++)Xi(vm[_m],hm,ym,!0)}function Ji(fm,hm){this.min=fm===void 0?new S(+Infinity,+Infinity):fm,this.max=hm===void 0?new S(-Infinity,-Infinity):hm}function Qi(fm,hm){this.start=fm===void 0?new A:fm,this.end=hm===void 0?new A:hm}function Ki(fm){K.call(this),this.material=fm,this.render=function(){}}function $i(fm,hm,ym,xm){this.object=fm,this.size=hm===void 0?1:hm;var vm=ym===void 0?16711680:ym,_m=xm===void 0?1:xm,bm=0,Mm=this.object.geometry;Mm&&Mm.isGeometry?bm=3*Mm.faces.length:Mm&&Mm.isBufferGeometry&&(bm=Mm.attributes.normal.count);var Sm=new xe,Tm=new ge(3*(2*bm),3);Sm.addAttribute('position',Tm),wr.call(this,Sm,new Tr({color:vm,linewidth:_m})),this.matrixAutoUpdate=!1,this.update()}function en(fm,hm){K.call(this),this.light=fm,this.light.updateMatrixWorld(),this.matrix=fm.matrixWorld,this.matrixAutoUpdate=!1,this.color=hm;for(var ym=new xe,xm=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],vm=0,_m=1,bm=32;vm<bm;vm++,_m++){var Mm=2*(vm/bm*Math.PI),Sm=2*(_m/bm*Math.PI);xm.push(Math.cos(Mm),Math.sin(Mm),1,Math.cos(Sm),Math.sin(Sm),1)}ym.addAttribute('position',new ge(xm,3));var Tm=new Tr({fog:!1});this.cone=new wr(ym,Tm),this.add(this.cone),this.update()}function tn(fm){var hm=[];fm&&fm.isBone&&hm.push(fm);for(var ym=0;ym<fm.children.length;ym++)hm.push.apply(hm,tn(fm.children[ym]));return hm}function rn(fm){for(var hm=tn(fm),ym=new xe,xm=[],vm=[],_m=new W(0,0,1),bm=new W(0,1,0),Mm=0,Sm;Mm<hm.length;Mm++)Sm=hm[Mm],Sm.parent&&Sm.parent.isBone&&(xm.push(0,0,0),xm.push(0,0,0),vm.push(_m.r,_m.g,_m.b),vm.push(bm.r,bm.g,bm.b));ym.addAttribute('position',new ge(xm,3)),ym.addAttribute('color',new ge(vm,3));var Tm=new Tr({vertexColors:Nn,depthTest:!1,depthWrite:!1,transparent:!0});wr.call(this,ym,Tm),this.root=fm,this.bones=hm,this.matrix=fm.matrixWorld,this.matrixAutoUpdate=!1}function on(fm,hm,ym){this.light=fm,this.light.updateMatrixWorld(),this.color=ym;var xm=new Ba(hm,4,2),vm=new Ae({wireframe:!0,fog:!1});Pe.call(this,xm,vm),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function nn(fm,hm){K.call(this),this.light=fm,this.light.updateMatrixWorld(),this.matrix=fm.matrixWorld,this.matrixAutoUpdate=!1,this.color=hm;var ym=new Tr({fog:!1}),xm=new xe;xm.addAttribute('position',new re(new Float32Array(15),3)),this.line=new Er(xm,ym),this.add(this.line),this.update()}function sn(fm,hm,ym){K.call(this),this.light=fm,this.light.updateMatrixWorld(),this.matrix=fm.matrixWorld,this.matrixAutoUpdate=!1,this.color=ym;var xm=new Vr(hm);xm.rotateY(0.5*Math.PI),this.material=new Ae({wireframe:!0,fog:!1}),this.color===void 0&&(this.material.vertexColors=Nn);var vm=xm.getAttribute('position'),_m=new Float32Array(3*vm.count);xm.addAttribute('color',new re(_m,3)),this.add(new Pe(xm,this.material)),this.update()}function ln(fm,hm,ym,xm){fm=fm||10,hm=hm||10,ym=new W(ym===void 0?4473924:ym),xm=new W(xm===void 0?8947848:xm);for(var vm=hm/2,_m=fm/hm,bm=fm/2,Mm=[],Sm=[],Tm=0,Em=0,wm=-bm;Tm<=hm;Tm++,wm+=_m){Mm.push(-bm,0,wm,bm,0,wm),Mm.push(wm,0,-bm,wm,0,bm);var Lm=Tm===vm?ym:xm;Lm.toArray(Sm,Em),Em+=3,Lm.toArray(Sm,Em),Em+=3,Lm.toArray(Sm,Em),Em+=3,Lm.toArray(Sm,Em),Em+=3}var Am=new xe;Am.addAttribute('position',new ge(Mm,3)),Am.addAttribute('color',new ge(Sm,3));var Pm=new Tr({vertexColors:Nn});wr.call(this,Am,Pm)}function pn(fm,hm,ym,xm,vm,_m){fm=fm||10,hm=hm||16,ym=ym||8,xm=xm||64,vm=new W(vm===void 0?4473924:vm),_m=new W(_m===void 0?8947848:_m);var bm=[],Mm=[],Sm,Tm,Em,wm,Lm,Am,Pm;for(wm=0;wm<=hm;wm++)Em=wm/hm*(2*Math.PI),Sm=Math.sin(Em)*fm,Tm=Math.cos(Em)*fm,bm.push(0,0,0),bm.push(Sm,0,Tm),Pm=1&wm?vm:_m,Mm.push(Pm.r,Pm.g,Pm.b),Mm.push(Pm.r,Pm.g,Pm.b);for(wm=0;wm<=ym;wm++)for(Pm=1&wm?vm:_m,Am=fm-fm/ym*wm,Lm=0;Lm<xm;Lm++)Em=Lm/xm*(2*Math.PI),Sm=Math.sin(Em)*Am,Tm=Math.cos(Em)*Am,bm.push(Sm,0,Tm),Mm.push(Pm.r,Pm.g,Pm.b),Em=(Lm+1)/xm*(2*Math.PI),Sm=Math.sin(Em)*Am,Tm=Math.cos(Em)*Am,bm.push(Sm,0,Tm),Mm.push(Pm.r,Pm.g,Pm.b);var Cm=new xe;Cm.addAttribute('position',new ge(bm,3)),Cm.addAttribute('color',new ge(Mm,3));var Rm=new Tr({vertexColors:Nn});wr.call(this,Cm,Rm)}function dn(fm,hm,ym,xm){this.object=fm,this.size=hm===void 0?1:hm;var vm=ym===void 0?16776960:ym,_m=xm===void 0?1:xm,bm=0,Mm=this.object.geometry;Mm&&Mm.isGeometry?bm=Mm.faces.length:console.warn('THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.');var Sm=new xe,Tm=new ge(3*(2*bm),3);Sm.addAttribute('position',Tm),wr.call(this,Sm,new Tr({color:vm,linewidth:_m})),this.matrixAutoUpdate=!1,this.update()}function cn(fm,hm,ym){K.call(this),this.light=fm,this.light.updateMatrixWorld(),this.matrix=fm.matrixWorld,this.matrixAutoUpdate=!1,this.color=ym,hm===void 0&&(hm=1);var xm=new xe;xm.addAttribute('position',new ge([-hm,hm,0,hm,hm,0,hm,-hm,0,-hm,-hm,0,-hm,hm,0],3));var vm=new Tr({fog:!1});this.lightPlane=new Er(xm,vm),this.add(this.lightPlane),xm=new xe,xm.addAttribute('position',new ge([0,0,0,0,0,1],3)),this.targetLine=new Er(xm,vm),this.add(this.targetLine),this.update()}function un(fm){function hm(Am,Pm,Cm){ym(Am,Cm),ym(Pm,Cm)}function ym(Am,Pm){_m.push(0,0,0),bm.push(Pm.r,Pm.g,Pm.b),Mm[Am]===void 0&&(Mm[Am]=[]),Mm[Am].push(_m.length/3-1)}var xm=new xe,vm=new Tr({color:16777215,vertexColors:zn}),_m=[],bm=[],Mm={},Sm=new W(16755200),Tm=new W(16711680),Em=new W(43775),wm=new W(16777215),Lm=new W(3355443);hm('n1','n2',Sm),hm('n2','n4',Sm),hm('n4','n3',Sm),hm('n3','n1',Sm),hm('f1','f2',Sm),hm('f2','f4',Sm),hm('f4','f3',Sm),hm('f3','f1',Sm),hm('n1','f1',Sm),hm('n2','f2',Sm),hm('n3','f3',Sm),hm('n4','f4',Sm),hm('p','n1',Tm),hm('p','n2',Tm),hm('p','n3',Tm),hm('p','n4',Tm),hm('u1','u2',Em),hm('u2','u3',Em),hm('u3','u1',Em),hm('c','t',wm),hm('p','c',Lm),hm('cn1','cn2',Lm),hm('cn3','cn4',Lm),hm('cf1','cf2',Lm),hm('cf3','cf4',Lm),xm.addAttribute('position',new ge(_m,3)),xm.addAttribute('color',new ge(bm,3)),wr.call(this,xm,vm),this.camera=fm,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=fm.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=Mm,this.update()}function mn(fm,hm){this.object=fm,hm===void 0&&(hm=16776960);var ym=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),xm=new Float32Array(24),vm=new xe;vm.setIndex(new re(ym,1)),vm.addAttribute('position',new re(xm,3)),wr.call(this,vm,new Tr({color:hm})),this.matrixAutoUpdate=!1,this.update()}function gn(fm,hm){this.type='Box3Helper',this.box=fm;var ym=hm===void 0?16776960:hm,xm=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_m=new xe;_m.setIndex(new re(xm,1)),_m.addAttribute('position',new ge([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),wr.call(this,_m,new Tr({color:ym})),this.geometry.computeBoundingSphere()}function fn(fm,hm,ym){this.type='PlaneHelper',this.plane=fm,this.size=hm===void 0?1:hm;var xm=ym===void 0?16776960:ym,_m=new xe;_m.addAttribute('position',new ge([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),_m.computeBoundingSphere(),Er.call(this,_m,new Tr({color:xm}));var Mm=new xe;Mm.addAttribute('position',new ge([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),Mm.computeBoundingSphere(),this.add(new Pe(Mm,new Ae({color:xm,opacity:0.2,transparent:!0,depthWrite:!1})))}function hn(fm,hm,ym,xm,vm,_m){K.call(this),fm===void 0&&(fm=new THREE.Vector3(0,0,1)),hm===void 0&&(hm=new THREE.Vector3(0,0,0)),ym===void 0&&(ym=1),xm===void 0&&(xm=16776960),vm===void 0&&(vm=0.2*ym),_m===void 0&&(_m=0.2*vm),wu===void 0&&(wu=new xe,wu.addAttribute('position',new ge([0,0,0,0,1,0],3)),Lu=new Xa(0,0.5,1,5,1),Lu.translate(0,-0.5,0)),this.position.copy(hm),this.line=new Er(wu,new Tr({color:xm})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Pe(Lu,new Ae({color:xm})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(fm),this.setLength(ym,vm,_m)}function yn(fm){fm=fm||1;var hm=[0,0,0,fm,0,0,0,0,0,0,fm,0,0,0,0,0,0,fm],xm=new xe;xm.addAttribute('position',new ge(hm,3)),xm.addAttribute('color',new ge([1,0,0,1,0.6,0,0,1,0,0.6,1,0,0,0,1,0,0.6,1],3));var vm=new Tr({vertexColors:Nn});wr.call(this,xm,vm)}function xn(fm){console.warn('THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.'),Go.call(this,fm),this.type='catmullrom'}function _n(){bn(),Mn(),gm.play()}function bn(){gm=document.getElementById('gameMusic')}function Mn(){gm.muted='true'!=mm}Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52)),Number.isInteger===void 0&&(Number.isInteger=function(fm){return'number'==typeof fm&&isFinite(fm)&&Math.floor(fm)===fm}),Math.sign===void 0&&(Math.sign=function(fm){return 0>fm?-1:0<fm?1:+fm}),!1=='name'in Function.prototype&&Object.defineProperty(Function.prototype,'name',{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),Object.assign===void 0&&function(){Object.assign=function(fm){if(fm===void 0||null===fm)throw new TypeError('Cannot convert undefined or null to object');for(var hm=Object(fm),ym=1,xm;ym<arguments.length;ym++)if(xm=arguments[ym],void 0!==xm&&null!==xm)for(var vm in xm)Object.prototype.hasOwnProperty.call(xm,vm)&&(hm[vm]=xm[vm]);return hm}}(),Object.assign(M.prototype,{addEventListener:function(fm,hm){this._listeners===void 0&&(this._listeners={});var ym=this._listeners;ym[fm]===void 0&&(ym[fm]=[]),-1===ym[fm].indexOf(hm)&&ym[fm].push(hm)},hasEventListener:function(fm,hm){if(this._listeners===void 0)return!1;var ym=this._listeners;return ym[fm]!==void 0&&-1!==ym[fm].indexOf(hm)},removeEventListener:function(fm,hm){if(void 0!==this._listeners){var ym=this._listeners,xm=ym[fm];if(void 0!==xm){var vm=xm.indexOf(hm);-1!==vm&&xm.splice(vm,1)}}},dispatchEvent:function(fm){if(void 0!==this._listeners){var hm=this._listeners,ym=hm[fm.type];if(void 0!==ym){fm.target=this;for(var xm=ym.slice(0),vm=0,_m=xm.length;vm<_m;vm++)xm[vm].call(this,fm)}}}});var En=1,Ln=1,Pn=0,Cn=1,Rn=2,In=1,Dn=0,zn=1,Nn=2,Bn=0,Un=1,Gn=2,On=3,Fn=4,Hn=5,Vn=100,jn=103,qn=104,Qn=204,Kn=205,ss=3,ms=0,hs=0,ys=1,Ms=300,Ss=301,Ts=302,Es=303,ws=304,Ls=305,As=306,Ps=307,Cs=1e3,Rs=1001,Is=1002,Ds=1003,zs=1004,Ns=1005,Bs=1006,Us=1007,Gs=1008,Os=1009,Vs=1012,Ws=1014,js=1015,qs=1016,Js=1020,Ks=1022,$s=1023,al=1026,nl=1027,dl=33776,cl=33777,ul=33778,yl=33779,xl=35840,_l=35841,bl=35842,Ml=35843,Hl=2300,Vl=2301,Wl=2302,ql=2400,Xl=2401,Yl=2402,Zl=0,Kl=3e3,ep=3007,sp=0,dp={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var fm=[],hm=0;256>hm;hm++)fm[hm]=(16>hm?'0':'')+hm.toString(16);return function(){var xm=0|4294967295*Math.random(),vm=0|4294967295*Math.random(),_m=0|4294967295*Math.random(),bm=0|4294967295*Math.random(),Mm=fm[255&xm]+fm[255&xm>>8]+fm[255&xm>>16]+fm[255&xm>>24]+'-'+fm[255&vm]+fm[255&vm>>8]+'-'+fm[64|15&vm>>16]+fm[255&vm>>24]+'-'+fm[128|63&_m]+fm[255&_m>>8]+'-'+fm[255&_m>>16]+fm[255&_m>>24]+fm[255&bm]+fm[255&bm>>8]+fm[255&bm>>16]+fm[255&bm>>24];return Mm.toUpperCase()}}(),clamp:function(fm,hm,ym){return Math.max(hm,Math.min(ym,fm))},euclideanModulo:function(fm,hm){return(fm%hm+hm)%hm},mapLinear:function(fm,hm,ym,xm,vm){return xm+(fm-hm)*(vm-xm)/(ym-hm)},lerp:function(fm,hm,ym){return(1-ym)*fm+ym*hm},smoothstep:function(fm,hm,ym){return fm<=hm?0:fm>=ym?1:(fm=(fm-hm)/(ym-hm),fm*fm*(3-2*fm))},smootherstep:function(fm,hm,ym){return fm<=hm?0:fm>=ym?1:(fm=(fm-hm)/(ym-hm),fm*fm*fm*(fm*(6*fm-15)+10))},randInt:function(fm,hm){return fm+Math.floor(Math.random()*(hm-fm+1))},randFloat:function(fm,hm){return fm+Math.random()*(hm-fm)},randFloatSpread:function(fm){return fm*(0.5-Math.random())},degToRad:function(fm){return fm*dp.DEG2RAD},radToDeg:function(fm){return fm*dp.RAD2DEG},isPowerOfTwo:function(fm){return 0==(fm&fm-1)&&0!==fm},ceilPowerOfTwo:function(fm){return Math.pow(2,Math.ceil(Math.log(fm)/Math.LN2))},floorPowerOfTwo:function(fm){return Math.pow(2,Math.floor(Math.log(fm)/Math.LN2))}};Object.defineProperties(S.prototype,{width:{get:function(){return this.x},set:function(fm){this.x=fm}},height:{get:function(){return this.y},set:function(fm){this.y=fm}}}),Object.assign(S.prototype,{isVector2:!0,set:function(fm,hm){return this.x=fm,this.y=hm,this},setScalar:function(fm){return this.x=fm,this.y=fm,this},setX:function(fm){return this.x=fm,this},setY:function(fm){return this.y=fm,this},setComponent:function(fm,hm){switch(fm){case 0:this.x=hm;break;case 1:this.y=hm;break;default:throw new Error('index is out of range: '+fm);}return this},getComponent:function(fm){switch(fm){case 0:return this.x;case 1:return this.y;default:throw new Error('index is out of range: '+fm);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(fm){return this.x=fm.x,this.y=fm.y,this},add:function(fm,hm){return void 0===hm?(this.x+=fm.x,this.y+=fm.y,this):(console.warn('THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.'),this.addVectors(fm,hm))},addScalar:function(fm){return this.x+=fm,this.y+=fm,this},addVectors:function(fm,hm){return this.x=fm.x+hm.x,this.y=fm.y+hm.y,this},addScaledVector:function(fm,hm){return this.x+=fm.x*hm,this.y+=fm.y*hm,this},sub:function(fm,hm){return void 0===hm?(this.x-=fm.x,this.y-=fm.y,this):(console.warn('THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.'),this.subVectors(fm,hm))},subScalar:function(fm){return this.x-=fm,this.y-=fm,this},subVectors:function(fm,hm){return this.x=fm.x-hm.x,this.y=fm.y-hm.y,this},multiply:function(fm){return this.x*=fm.x,this.y*=fm.y,this},multiplyScalar:function(fm){return this.x*=fm,this.y*=fm,this},divide:function(fm){return this.x/=fm.x,this.y/=fm.y,this},divideScalar:function(fm){return this.multiplyScalar(1/fm)},applyMatrix3:function(fm){var hm=this.x,ym=this.y,xm=fm.elements;return this.x=xm[0]*hm+xm[3]*ym+xm[6],this.y=xm[1]*hm+xm[4]*ym+xm[7],this},min:function(fm){return this.x=Math.min(this.x,fm.x),this.y=Math.min(this.y,fm.y),this},max:function(fm){return this.x=Math.max(this.x,fm.x),this.y=Math.max(this.y,fm.y),this},clamp:function(fm,hm){return this.x=Math.max(fm.x,Math.min(hm.x,this.x)),this.y=Math.max(fm.y,Math.min(hm.y,this.y)),this},clampScalar:function(){var fm=new S,hm=new S;return function(xm,vm){return fm.set(xm,xm),hm.set(vm,vm),this.clamp(fm,hm)}}(),clampLength:function(fm,hm){var ym=this.length();return this.divideScalar(ym||1).multiplyScalar(Math.max(fm,Math.min(hm,ym)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(fm){return this.x*fm.x+this.y*fm.y},cross:function(fm){return this.x*fm.y-this.y*fm.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var fm=Math.atan2(this.y,this.x);return 0>fm&&(fm+=2*Math.PI),fm},distanceTo:function(fm){return Math.sqrt(this.distanceToSquared(fm))},distanceToSquared:function(fm){var hm=this.x-fm.x,ym=this.y-fm.y;return hm*hm+ym*ym},manhattanDistanceTo:function(fm){return Math.abs(this.x-fm.x)+Math.abs(this.y-fm.y)},setLength:function(fm){return this.normalize().multiplyScalar(fm)},lerp:function(fm,hm){return this.x+=(fm.x-this.x)*hm,this.y+=(fm.y-this.y)*hm,this},lerpVectors:function(fm,hm,ym){return this.subVectors(hm,fm).multiplyScalar(ym).add(fm)},equals:function(fm){return fm.x===this.x&&fm.y===this.y},fromArray:function(fm,hm){return void 0===hm&&(hm=0),this.x=fm[hm],this.y=fm[hm+1],this},toArray:function(fm,hm){return void 0===fm&&(fm=[]),void 0===hm&&(hm=0),fm[hm]=this.x,fm[hm+1]=this.y,fm},fromBufferAttribute:function(fm,hm,ym){return void 0!==ym&&console.warn('THREE.Vector2: offset has been removed from .fromBufferAttribute().'),this.x=fm.getX(hm),this.y=fm.getY(hm),this},rotateAround:function(fm,hm){var ym=Math.cos(hm),xm=Math.sin(hm),vm=this.x-fm.x,_m=this.y-fm.y;return this.x=vm*ym-_m*xm+fm.x,this.y=vm*xm+_m*ym+fm.y,this}}),Object.assign(E.prototype,{isMatrix4:!0,set:function(fm,hm,ym,xm,vm,_m,bm,Mm,Sm,Tm,Em,wm,Lm,Am,Pm,Cm){var Rm=this.elements;return Rm[0]=fm,Rm[4]=hm,Rm[8]=ym,Rm[12]=xm,Rm[1]=vm,Rm[5]=_m,Rm[9]=bm,Rm[13]=Mm,Rm[2]=Sm,Rm[6]=Tm,Rm[10]=Em,Rm[14]=wm,Rm[3]=Lm,Rm[7]=Am,Rm[11]=Pm,Rm[15]=Cm,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new E().fromArray(this.elements)},copy:function(fm){var hm=this.elements,ym=fm.elements;return hm[0]=ym[0],hm[1]=ym[1],hm[2]=ym[2],hm[3]=ym[3],hm[4]=ym[4],hm[5]=ym[5],hm[6]=ym[6],hm[7]=ym[7],hm[8]=ym[8],hm[9]=ym[9],hm[10]=ym[10],hm[11]=ym[11],hm[12]=ym[12],hm[13]=ym[13],hm[14]=ym[14],hm[15]=ym[15],this},copyPosition:function(fm){var hm=this.elements,ym=fm.elements;return hm[12]=ym[12],hm[13]=ym[13],hm[14]=ym[14],this},extractBasis:function(fm,hm,ym){return fm.setFromMatrixColumn(this,0),hm.setFromMatrixColumn(this,1),ym.setFromMatrixColumn(this,2),this},makeBasis:function(fm,hm,ym){return this.set(fm.x,hm.x,ym.x,0,fm.y,hm.y,ym.y,0,fm.z,hm.z,ym.z,0,0,0,0,1),this},extractRotation:function(){var fm=new A;return function(ym){var xm=this.elements,vm=ym.elements,_m=1/fm.setFromMatrixColumn(ym,0).length(),bm=1/fm.setFromMatrixColumn(ym,1).length(),Mm=1/fm.setFromMatrixColumn(ym,2).length();return xm[0]=vm[0]*_m,xm[1]=vm[1]*_m,xm[2]=vm[2]*_m,xm[3]=0,xm[4]=vm[4]*bm,xm[5]=vm[5]*bm,xm[6]=vm[6]*bm,xm[7]=0,xm[8]=vm[8]*Mm,xm[9]=vm[9]*Mm,xm[10]=vm[10]*Mm,xm[11]=0,xm[12]=0,xm[13]=0,xm[14]=0,xm[15]=1,this}}(),makeRotationFromEuler:function(fm){fm&&fm.isEuler||console.error('THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.');var hm=this.elements,ym=fm.x,xm=fm.y,vm=fm.z,_m=Math.cos(ym),bm=Math.sin(ym),Mm=Math.cos(xm),Sm=Math.sin(xm),Tm=Math.cos(vm),Em=Math.sin(vm);if('XYZ'===fm.order){var wm=_m*Tm,Lm=_m*Em,Am=bm*Tm,Pm=bm*Em;hm[0]=Mm*Tm,hm[4]=-Mm*Em,hm[8]=Sm,hm[1]=Lm+Am*Sm,hm[5]=wm-Pm*Sm,hm[9]=-bm*Mm,hm[2]=Pm-wm*Sm,hm[6]=Am+Lm*Sm,hm[10]=_m*Mm}else if('YXZ'===fm.order){var Cm=Mm*Tm,Rm=Mm*Em,Im=Sm*Tm,Dm=Sm*Em;hm[0]=Cm+Dm*bm,hm[4]=Im*bm-Rm,hm[8]=_m*Sm,hm[1]=_m*Em,hm[5]=_m*Tm,hm[9]=-bm,hm[2]=Rm*bm-Im,hm[6]=Dm+Cm*bm,hm[10]=_m*Mm}else if('ZXY'===fm.order){var Cm=Mm*Tm,Rm=Mm*Em,Im=Sm*Tm,Dm=Sm*Em;hm[0]=Cm-Dm*bm,hm[4]=-_m*Em,hm[8]=Im+Rm*bm,hm[1]=Rm+Im*bm,hm[5]=_m*Tm,hm[9]=Dm-Cm*bm,hm[2]=-_m*Sm,hm[6]=bm,hm[10]=_m*Mm}else if('ZYX'===fm.order){var wm=_m*Tm,Lm=_m*Em,Am=bm*Tm,Pm=bm*Em;hm[0]=Mm*Tm,hm[4]=Am*Sm-Lm,hm[8]=wm*Sm+Pm,hm[1]=Mm*Em,hm[5]=Pm*Sm+wm,hm[9]=Lm*Sm-Am,hm[2]=-Sm,hm[6]=bm*Mm,hm[10]=_m*Mm}else if('YZX'===fm.order){var zm=_m*Mm,Nm=_m*Sm,Bm=bm*Mm,Um=bm*Sm;hm[0]=Mm*Tm,hm[4]=Um-zm*Em,hm[8]=Bm*Em+Nm,hm[1]=Em,hm[5]=_m*Tm,hm[9]=-bm*Tm,hm[2]=-Sm*Tm,hm[6]=Nm*Em+Bm,hm[10]=zm-Um*Em}else if('XZY'===fm.order){var zm=_m*Mm,Nm=_m*Sm,Bm=bm*Mm,Um=bm*Sm;hm[0]=Mm*Tm,hm[4]=-Em,hm[8]=Sm*Tm,hm[1]=zm*Em+Um,hm[5]=_m*Tm,hm[9]=Nm*Em-Bm,hm[2]=Bm*Em-Nm,hm[6]=bm*Tm,hm[10]=Um*Em+zm}return hm[3]=0,hm[7]=0,hm[11]=0,hm[12]=0,hm[13]=0,hm[14]=0,hm[15]=1,this},makeRotationFromQuaternion:function(){var fm=new A(0,0,0),hm=new A(1,1,1);return function(xm){return this.compose(fm,xm,hm)}}(),lookAt:function(){var fm=new A,hm=new A,ym=new A;return function(vm,_m,bm){var Mm=this.elements;return ym.subVectors(vm,_m),0===ym.lengthSq()&&(ym.z=1),ym.normalize(),fm.crossVectors(bm,ym),0===fm.lengthSq()&&(1===Math.abs(bm.z)?ym.x+=1e-4:ym.z+=1e-4,ym.normalize(),fm.crossVectors(bm,ym)),fm.normalize(),hm.crossVectors(ym,fm),Mm[0]=fm.x,Mm[4]=hm.x,Mm[8]=ym.x,Mm[1]=fm.y,Mm[5]=hm.y,Mm[9]=ym.y,Mm[2]=fm.z,Mm[6]=hm.z,Mm[10]=ym.z,this}}(),multiply:function(fm,hm){return void 0===hm?this.multiplyMatrices(this,fm):(console.warn('THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.'),this.multiplyMatrices(fm,hm))},premultiply:function(fm){return this.multiplyMatrices(fm,this)},multiplyMatrices:function(fm,hm){var ym=fm.elements,xm=hm.elements,vm=this.elements,_m=ym[0],bm=ym[4],Mm=ym[8],Sm=ym[12],Tm=ym[1],Em=ym[5],wm=ym[9],Lm=ym[13],Am=ym[2],Pm=ym[6],Cm=ym[10],Rm=ym[14],Im=ym[3],Dm=ym[7],zm=ym[11],Nm=ym[15],Bm=xm[0],Um=xm[4],Gm=xm[8],Om=xm[12],Fm=xm[1],Hm=xm[5],Vm=xm[9],km=xm[13],Wm=xm[2],jm=xm[6],Xm=xm[10],Ym=xm[14],Zm=xm[3],Jm=xm[7],Qm=xm[11],Km=xm[15];return vm[0]=_m*Bm+bm*Fm+Mm*Wm+Sm*Zm,vm[4]=_m*Um+bm*Hm+Mm*jm+Sm*Jm,vm[8]=_m*Gm+bm*Vm+Mm*Xm+Sm*Qm,vm[12]=_m*Om+bm*km+Mm*Ym+Sm*Km,vm[1]=Tm*Bm+Em*Fm+wm*Wm+Lm*Zm,vm[5]=Tm*Um+Em*Hm+wm*jm+Lm*Jm,vm[9]=Tm*Gm+Em*Vm+wm*Xm+Lm*Qm,vm[13]=Tm*Om+Em*km+wm*Ym+Lm*Km,vm[2]=Am*Bm+Pm*Fm+Cm*Wm+Rm*Zm,vm[6]=Am*Um+Pm*Hm+Cm*jm+Rm*Jm,vm[10]=Am*Gm+Pm*Vm+Cm*Xm+Rm*Qm,vm[14]=Am*Om+Pm*km+Cm*Ym+Rm*Km,vm[3]=Im*Bm+Dm*Fm+zm*Wm+Nm*Zm,vm[7]=Im*Um+Dm*Hm+zm*jm+Nm*Jm,vm[11]=Im*Gm+Dm*Vm+zm*Xm+Nm*Qm,vm[15]=Im*Om+Dm*km+zm*Ym+Nm*Km,this},multiplyScalar:function(fm){var hm=this.elements;return hm[0]*=fm,hm[4]*=fm,hm[8]*=fm,hm[12]*=fm,hm[1]*=fm,hm[5]*=fm,hm[9]*=fm,hm[13]*=fm,hm[2]*=fm,hm[6]*=fm,hm[10]*=fm,hm[14]*=fm,hm[3]*=fm,hm[7]*=fm,hm[11]*=fm,hm[15]*=fm,this},applyToBufferAttribute:function(){var fm=new A;return function(ym){for(var xm=0,vm=ym.count;xm<vm;xm++)fm.x=ym.getX(xm),fm.y=ym.getY(xm),fm.z=ym.getZ(xm),fm.applyMatrix4(this),ym.setXYZ(xm,fm.x,fm.y,fm.z);return ym}}(),determinant:function(){var fm=this.elements,hm=fm[0],ym=fm[4],xm=fm[8],vm=fm[12],_m=fm[1],bm=fm[5],Mm=fm[9],Sm=fm[13],Tm=fm[2],Em=fm[6],wm=fm[10],Lm=fm[14],Am=fm[3],Pm=fm[7],Cm=fm[11],Rm=fm[15];return Am*(+vm*Mm*Em-xm*Sm*Em-vm*bm*wm+ym*Sm*wm+xm*bm*Lm-ym*Mm*Lm)+Pm*(+hm*Mm*Lm-hm*Sm*wm+vm*_m*wm-xm*_m*Lm+xm*Sm*Tm-vm*Mm*Tm)+Cm*(+hm*Sm*Em-hm*bm*Lm-vm*_m*Em+ym*_m*Lm+vm*bm*Tm-ym*Sm*Tm)+Rm*(-xm*bm*Tm-hm*Mm*Em+hm*bm*wm+xm*_m*Em-ym*_m*wm+ym*Mm*Tm)},transpose:function(){var fm=this.elements,hm;return hm=fm[1],fm[1]=fm[4],fm[4]=hm,hm=fm[2],fm[2]=fm[8],fm[8]=hm,hm=fm[6],fm[6]=fm[9],fm[9]=hm,hm=fm[3],fm[3]=fm[12],fm[12]=hm,hm=fm[7],fm[7]=fm[13],fm[13]=hm,hm=fm[11],fm[11]=fm[14],fm[14]=hm,this},setPosition:function(fm){var hm=this.elements;return hm[12]=fm.x,hm[13]=fm.y,hm[14]=fm.z,this},getInverse:function(fm,hm){var ym=this.elements,xm=fm.elements,vm=xm[0],_m=xm[1],bm=xm[2],Mm=xm[3],Sm=xm[4],Tm=xm[5],Em=xm[6],wm=xm[7],Lm=xm[8],Am=xm[9],Pm=xm[10],Cm=xm[11],Rm=xm[12],Im=xm[13],Dm=xm[14],zm=xm[15],Nm=Am*Dm*wm-Im*Pm*wm+Im*Em*Cm-Tm*Dm*Cm-Am*Em*zm+Tm*Pm*zm,Bm=Rm*Pm*wm-Lm*Dm*wm-Rm*Em*Cm+Sm*Dm*Cm+Lm*Em*zm-Sm*Pm*zm,Um=Lm*Im*wm-Rm*Am*wm+Rm*Tm*Cm-Sm*Im*Cm-Lm*Tm*zm+Sm*Am*zm,Gm=Rm*Am*Em-Lm*Im*Em-Rm*Tm*Pm+Sm*Im*Pm+Lm*Tm*Dm-Sm*Am*Dm,Om=vm*Nm+_m*Bm+bm*Um+Mm*Gm;if(0==Om){var Fm='THREE.Matrix4: .getInverse() can\'t invert matrix, determinant is 0';if(!0===hm)throw new Error(Fm);else console.warn(Fm);return this.identity()}var Hm=1/Om;return ym[0]=Nm*Hm,ym[1]=(Im*Pm*Mm-Am*Dm*Mm-Im*bm*Cm+_m*Dm*Cm+Am*bm*zm-_m*Pm*zm)*Hm,ym[2]=(Tm*Dm*Mm-Im*Em*Mm+Im*bm*wm-_m*Dm*wm-Tm*bm*zm+_m*Em*zm)*Hm,ym[3]=(Am*Em*Mm-Tm*Pm*Mm-Am*bm*wm+_m*Pm*wm+Tm*bm*Cm-_m*Em*Cm)*Hm,ym[4]=Bm*Hm,ym[5]=(Lm*Dm*Mm-Rm*Pm*Mm+Rm*bm*Cm-vm*Dm*Cm-Lm*bm*zm+vm*Pm*zm)*Hm,ym[6]=(Rm*Em*Mm-Sm*Dm*Mm-Rm*bm*wm+vm*Dm*wm+Sm*bm*zm-vm*Em*zm)*Hm,ym[7]=(Sm*Pm*Mm-Lm*Em*Mm+Lm*bm*wm-vm*Pm*wm-Sm*bm*Cm+vm*Em*Cm)*Hm,ym[8]=Um*Hm,ym[9]=(Rm*Am*Mm-Lm*Im*Mm-Rm*_m*Cm+vm*Im*Cm+Lm*_m*zm-vm*Am*zm)*Hm,ym[10]=(Sm*Im*Mm-Rm*Tm*Mm+Rm*_m*wm-vm*Im*wm-Sm*_m*zm+vm*Tm*zm)*Hm,ym[11]=(Lm*Tm*Mm-Sm*Am*Mm-Lm*_m*wm+vm*Am*wm+Sm*_m*Cm-vm*Tm*Cm)*Hm,ym[12]=Gm*Hm,ym[13]=(Lm*Im*bm-Rm*Am*bm+Rm*_m*Pm-vm*Im*Pm-Lm*_m*Dm+vm*Am*Dm)*Hm,ym[14]=(Rm*Tm*bm-Sm*Im*bm-Rm*_m*Em+vm*Im*Em+Sm*_m*Dm-vm*Tm*Dm)*Hm,ym[15]=(Sm*Am*bm-Lm*Tm*bm+Lm*_m*Em-vm*Am*Em-Sm*_m*Pm+vm*Tm*Pm)*Hm,this},scale:function(fm){var hm=this.elements,ym=fm.x,xm=fm.y,vm=fm.z;return hm[0]*=ym,hm[4]*=xm,hm[8]*=vm,hm[1]*=ym,hm[5]*=xm,hm[9]*=vm,hm[2]*=ym,hm[6]*=xm,hm[10]*=vm,hm[3]*=ym,hm[7]*=xm,hm[11]*=vm,this},getMaxScaleOnAxis:function(){var fm=this.elements,hm=fm[0]*fm[0]+fm[1]*fm[1]+fm[2]*fm[2],ym=fm[4]*fm[4]+fm[5]*fm[5]+fm[6]*fm[6],xm=fm[8]*fm[8]+fm[9]*fm[9]+fm[10]*fm[10];return Math.sqrt(Math.max(hm,ym,xm))},makeTranslation:function(fm,hm,ym){return this.set(1,0,0,fm,0,1,0,hm,0,0,1,ym,0,0,0,1),this},makeRotationX:function(fm){var hm=Math.cos(fm),ym=Math.sin(fm);return this.set(1,0,0,0,0,hm,-ym,0,0,ym,hm,0,0,0,0,1),this},makeRotationY:function(fm){var hm=Math.cos(fm),ym=Math.sin(fm);return this.set(hm,0,ym,0,0,1,0,0,-ym,0,hm,0,0,0,0,1),this},makeRotationZ:function(fm){var hm=Math.cos(fm),ym=Math.sin(fm);return this.set(hm,-ym,0,0,ym,hm,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(fm,hm){var ym=Math.cos(hm),xm=Math.sin(hm),vm=1-ym,_m=fm.x,bm=fm.y,Mm=fm.z,Sm=vm*_m,Tm=vm*bm;return this.set(Sm*_m+ym,Sm*bm-xm*Mm,Sm*Mm+xm*bm,0,Sm*bm+xm*Mm,Tm*bm+ym,Tm*Mm-xm*_m,0,Sm*Mm-xm*bm,Tm*Mm+xm*_m,vm*Mm*Mm+ym,0,0,0,0,1),this},makeScale:function(fm,hm,ym){return this.set(fm,0,0,0,0,hm,0,0,0,0,ym,0,0,0,0,1),this},makeShear:function(fm,hm,ym){return this.set(1,hm,ym,0,fm,1,ym,0,fm,hm,1,0,0,0,0,1),this},compose:function(fm,hm,ym){var xm=this.elements,vm=hm._x,_m=hm._y,bm=hm._z,Mm=hm._w,Sm=vm+vm,Tm=_m+_m,Em=bm+bm,wm=vm*Sm,Lm=vm*Tm,Am=vm*Em,Pm=_m*Tm,Cm=_m*Em,Rm=bm*Em,Im=Mm*Sm,Dm=Mm*Tm,zm=Mm*Em,Nm=ym.x,Bm=ym.y,Um=ym.z;return xm[0]=(1-(Pm+Rm))*Nm,xm[1]=(Lm+zm)*Nm,xm[2]=(Am-Dm)*Nm,xm[3]=0,xm[4]=(Lm-zm)*Bm,xm[5]=(1-(wm+Rm))*Bm,xm[6]=(Cm+Im)*Bm,xm[7]=0,xm[8]=(Am+Dm)*Um,xm[9]=(Cm-Im)*Um,xm[10]=(1-(wm+Pm))*Um,xm[11]=0,xm[12]=fm.x,xm[13]=fm.y,xm[14]=fm.z,xm[15]=1,this},decompose:function(){var fm=new A,hm=new E;return function(xm,vm,_m){var bm=this.elements,Mm=fm.set(bm[0],bm[1],bm[2]).length(),Sm=fm.set(bm[4],bm[5],bm[6]).length(),Tm=fm.set(bm[8],bm[9],bm[10]).length(),Em=this.determinant();0>Em&&(Mm=-Mm),xm.x=bm[12],xm.y=bm[13],xm.z=bm[14],hm.copy(this);var wm=1/Mm,Lm=1/Sm,Am=1/Tm;return hm.elements[0]*=wm,hm.elements[1]*=wm,hm.elements[2]*=wm,hm.elements[4]*=Lm,hm.elements[5]*=Lm,hm.elements[6]*=Lm,hm.elements[8]*=Am,hm.elements[9]*=Am,hm.elements[10]*=Am,vm.setFromRotationMatrix(hm),_m.x=Mm,_m.y=Sm,_m.z=Tm,this}}(),makePerspective:function(fm,hm,ym,xm,vm,_m){void 0===_m&&console.warn('THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.');var bm=this.elements;return bm[0]=2*vm/(hm-fm),bm[4]=0,bm[8]=(hm+fm)/(hm-fm),bm[12]=0,bm[1]=0,bm[5]=2*vm/(ym-xm),bm[9]=(ym+xm)/(ym-xm),bm[13]=0,bm[2]=0,bm[6]=0,bm[10]=-(_m+vm)/(_m-vm),bm[14]=-2*_m*vm/(_m-vm),bm[3]=0,bm[7]=0,bm[11]=-1,bm[15]=0,this},makeOrthographic:function(fm,hm,ym,xm,vm,_m){var bm=this.elements,Mm=1/(hm-fm),Sm=1/(ym-xm),Tm=1/(_m-vm);return bm[0]=2*Mm,bm[4]=0,bm[8]=0,bm[12]=-((hm+fm)*Mm),bm[1]=0,bm[5]=2*Sm,bm[9]=0,bm[13]=-((ym+xm)*Sm),bm[2]=0,bm[6]=0,bm[10]=-2*Tm,bm[14]=-((_m+vm)*Tm),bm[3]=0,bm[7]=0,bm[11]=0,bm[15]=1,this},equals:function(fm){for(var hm=this.elements,ym=fm.elements,xm=0;16>xm;xm++)if(hm[xm]!==ym[xm])return!1;return!0},fromArray:function(fm,hm){hm===void 0&&(hm=0);for(var ym=0;16>ym;ym++)this.elements[ym]=fm[ym+hm];return this},toArray:function(fm,hm){void 0===fm&&(fm=[]),void 0===hm&&(hm=0);var ym=this.elements;return fm[hm]=ym[0],fm[hm+1]=ym[1],fm[hm+2]=ym[2],fm[hm+3]=ym[3],fm[hm+4]=ym[4],fm[hm+5]=ym[5],fm[hm+6]=ym[6],fm[hm+7]=ym[7],fm[hm+8]=ym[8],fm[hm+9]=ym[9],fm[hm+10]=ym[10],fm[hm+11]=ym[11],fm[hm+12]=ym[12],fm[hm+13]=ym[13],fm[hm+14]=ym[14],fm[hm+15]=ym[15],fm}}),Object.assign(L,{slerp:function(fm,hm,ym,xm){return ym.copy(fm).slerp(hm,xm)},slerpFlat:function(fm,hm,ym,xm,vm,_m,bm){var Mm=ym[xm+0],Sm=ym[xm+1],Tm=ym[xm+2],Em=ym[xm+3],wm=vm[_m+0],Lm=vm[_m+1],Am=vm[_m+2],Pm=vm[_m+3];if(Em!==Pm||Mm!==wm||Sm!==Lm||Tm!==Am){var Cm=1-bm,Rm=Mm*wm+Sm*Lm+Tm*Am+Em*Pm,Im=0<=Rm?1:-1,Dm=1-Rm*Rm;if(Dm>Number.EPSILON){var zm=Math.sqrt(Dm),Nm=Math.atan2(zm,Rm*Im);Cm=Math.sin(Cm*Nm)/zm,bm=Math.sin(bm*Nm)/zm}var Bm=bm*Im;if(Mm=Mm*Cm+wm*Bm,Sm=Sm*Cm+Lm*Bm,Tm=Tm*Cm+Am*Bm,Em=Em*Cm+Pm*Bm,Cm==1-bm){var Um=1/Math.sqrt(Mm*Mm+Sm*Sm+Tm*Tm+Em*Em);Mm*=Um,Sm*=Um,Tm*=Um,Em*=Um}}fm[hm]=Mm,fm[hm+1]=Sm,fm[hm+2]=Tm,fm[hm+3]=Em}}),Object.defineProperties(L.prototype,{x:{get:function(){return this._x},set:function(fm){this._x=fm,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(fm){this._y=fm,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(fm){this._z=fm,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(fm){this._w=fm,this.onChangeCallback()}}}),Object.assign(L.prototype,{isQuaternion:!0,set:function(fm,hm,ym,xm){return this._x=fm,this._y=hm,this._z=ym,this._w=xm,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(fm){return this._x=fm.x,this._y=fm.y,this._z=fm.z,this._w=fm.w,this.onChangeCallback(),this},setFromEuler:function(fm,hm){if(!(fm&&fm.isEuler))throw new Error('THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.');var ym=fm._x,xm=fm._y,vm=fm._z,_m=fm.order,bm=Math.cos,Mm=Math.sin,Sm=bm(ym/2),Tm=bm(xm/2),Em=bm(vm/2),wm=Mm(ym/2),Lm=Mm(xm/2),Am=Mm(vm/2);return'XYZ'===_m?(this._x=wm*Tm*Em+Sm*Lm*Am,this._y=Sm*Lm*Em-wm*Tm*Am,this._z=Sm*Tm*Am+wm*Lm*Em,this._w=Sm*Tm*Em-wm*Lm*Am):'YXZ'===_m?(this._x=wm*Tm*Em+Sm*Lm*Am,this._y=Sm*Lm*Em-wm*Tm*Am,this._z=Sm*Tm*Am-wm*Lm*Em,this._w=Sm*Tm*Em+wm*Lm*Am):'ZXY'===_m?(this._x=wm*Tm*Em-Sm*Lm*Am,this._y=Sm*Lm*Em+wm*Tm*Am,this._z=Sm*Tm*Am+wm*Lm*Em,this._w=Sm*Tm*Em-wm*Lm*Am):'ZYX'===_m?(this._x=wm*Tm*Em-Sm*Lm*Am,this._y=Sm*Lm*Em+wm*Tm*Am,this._z=Sm*Tm*Am-wm*Lm*Em,this._w=Sm*Tm*Em+wm*Lm*Am):'YZX'===_m?(this._x=wm*Tm*Em+Sm*Lm*Am,this._y=Sm*Lm*Em+wm*Tm*Am,this._z=Sm*Tm*Am-wm*Lm*Em,this._w=Sm*Tm*Em-wm*Lm*Am):'XZY'===_m&&(this._x=wm*Tm*Em-Sm*Lm*Am,this._y=Sm*Lm*Em-wm*Tm*Am,this._z=Sm*Tm*Am+wm*Lm*Em,this._w=Sm*Tm*Em+wm*Lm*Am),!1!==hm&&this.onChangeCallback(),this},setFromAxisAngle:function(fm,hm){var ym=hm/2,xm=Math.sin(ym);return this._x=fm.x*xm,this._y=fm.y*xm,this._z=fm.z*xm,this._w=Math.cos(ym),this.onChangeCallback(),this},setFromRotationMatrix:function(fm){var hm=fm.elements,ym=hm[0],xm=hm[4],vm=hm[8],_m=hm[1],bm=hm[5],Mm=hm[9],Sm=hm[2],Tm=hm[6],Em=hm[10],wm=ym+bm+Em,Lm;return 0<wm?(Lm=0.5/Math.sqrt(wm+1),this._w=0.25/Lm,this._x=(Tm-Mm)*Lm,this._y=(vm-Sm)*Lm,this._z=(_m-xm)*Lm):ym>bm&&ym>Em?(Lm=2*Math.sqrt(1+ym-bm-Em),this._w=(Tm-Mm)/Lm,this._x=0.25*Lm,this._y=(xm+_m)/Lm,this._z=(vm+Sm)/Lm):bm>Em?(Lm=2*Math.sqrt(1+bm-ym-Em),this._w=(vm-Sm)/Lm,this._x=(xm+_m)/Lm,this._y=0.25*Lm,this._z=(Mm+Tm)/Lm):(Lm=2*Math.sqrt(1+Em-ym-bm),this._w=(_m-xm)/Lm,this._x=(vm+Sm)/Lm,this._y=(Mm+Tm)/Lm,this._z=0.25*Lm),this.onChangeCallback(),this},setFromUnitVectors:function(){var fm=new A,hm;return function(vm,_m){return void 0===fm&&(fm=new A),hm=vm.dot(_m)+1,hm<1e-6?(hm=0,Math.abs(vm.x)>Math.abs(vm.z)?fm.set(-vm.y,vm.x,0):fm.set(0,-vm.z,vm.y)):fm.crossVectors(vm,_m),this._x=fm.x,this._y=fm.y,this._z=fm.z,this._w=hm,this.normalize()}}(),angleTo:function(fm){return 2*Math.acos(Math.abs(dp.clamp(this.dot(fm),-1,1)))},rotateTowards:function(fm,hm){var ym=this.angleTo(fm);if(0===ym)return this;var xm=Math.min(1,hm/ym);return this.slerp(fm,xm),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(fm){return this._x*fm._x+this._y*fm._y+this._z*fm._z+this._w*fm._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var fm=this.length();return 0===fm?(this._x=0,this._y=0,this._z=0,this._w=1):(fm=1/fm,this._x*=fm,this._y*=fm,this._z*=fm,this._w*=fm),this.onChangeCallback(),this},multiply:function(fm,hm){return void 0===hm?this.multiplyQuaternions(this,fm):(console.warn('THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.'),this.multiplyQuaternions(fm,hm))},premultiply:function(fm){return this.multiplyQuaternions(fm,this)},multiplyQuaternions:function(fm,hm){var ym=fm._x,xm=fm._y,vm=fm._z,_m=fm._w,bm=hm._x,Mm=hm._y,Sm=hm._z,Tm=hm._w;return this._x=ym*Tm+_m*bm+xm*Sm-vm*Mm,this._y=xm*Tm+_m*Mm+vm*bm-ym*Sm,this._z=vm*Tm+_m*Sm+ym*Mm-xm*bm,this._w=_m*Tm-ym*bm-xm*Mm-vm*Sm,this.onChangeCallback(),this},slerp:function(fm,hm){if(0===hm)return this;if(1===hm)return this.copy(fm);var ym=this._x,xm=this._y,vm=this._z,_m=this._w,bm=_m*fm._w+ym*fm._x+xm*fm._y+vm*fm._z;if(0>bm?(this._w=-fm._w,this._x=-fm._x,this._y=-fm._y,this._z=-fm._z,bm=-bm):this.copy(fm),1<=bm)return this._w=_m,this._x=ym,this._y=xm,this._z=vm,this;var Mm=1-bm*bm;if(Mm<=Number.EPSILON){var Sm=1-hm;return this._w=Sm*_m+hm*this._w,this._x=Sm*ym+hm*this._x,this._y=Sm*xm+hm*this._y,this._z=Sm*vm+hm*this._z,this.normalize()}var Tm=Math.sqrt(Mm),Em=Math.atan2(Tm,bm),wm=Math.sin((1-hm)*Em)/Tm,Lm=Math.sin(hm*Em)/Tm;return this._w=_m*wm+this._w*Lm,this._x=ym*wm+this._x*Lm,this._y=xm*wm+this._y*Lm,this._z=vm*wm+this._z*Lm,this.onChangeCallback(),this},equals:function(fm){return fm._x===this._x&&fm._y===this._y&&fm._z===this._z&&fm._w===this._w},fromArray:function(fm,hm){return void 0===hm&&(hm=0),this._x=fm[hm],this._y=fm[hm+1],this._z=fm[hm+2],this._w=fm[hm+3],this.onChangeCallback(),this},toArray:function(fm,hm){return void 0===fm&&(fm=[]),void 0===hm&&(hm=0),fm[hm]=this._x,fm[hm+1]=this._y,fm[hm+2]=this._z,fm[hm+3]=this._w,fm},onChange:function(fm){return this.onChangeCallback=fm,this},onChangeCallback:function(){}}),Object.assign(A.prototype,{isVector3:!0,set:function(fm,hm,ym){return this.x=fm,this.y=hm,this.z=ym,this},setScalar:function(fm){return this.x=fm,this.y=fm,this.z=fm,this},setX:function(fm){return this.x=fm,this},setY:function(fm){return this.y=fm,this},setZ:function(fm){return this.z=fm,this},setComponent:function(fm,hm){switch(fm){case 0:this.x=hm;break;case 1:this.y=hm;break;case 2:this.z=hm;break;default:throw new Error('index is out of range: '+fm);}return this},getComponent:function(fm){switch(fm){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error('index is out of range: '+fm);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(fm){return this.x=fm.x,this.y=fm.y,this.z=fm.z,this},add:function(fm,hm){return void 0===hm?(this.x+=fm.x,this.y+=fm.y,this.z+=fm.z,this):(console.warn('THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.'),this.addVectors(fm,hm))},addScalar:function(fm){return this.x+=fm,this.y+=fm,this.z+=fm,this},addVectors:function(fm,hm){return this.x=fm.x+hm.x,this.y=fm.y+hm.y,this.z=fm.z+hm.z,this},addScaledVector:function(fm,hm){return this.x+=fm.x*hm,this.y+=fm.y*hm,this.z+=fm.z*hm,this},sub:function(fm,hm){return void 0===hm?(this.x-=fm.x,this.y-=fm.y,this.z-=fm.z,this):(console.warn('THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.'),this.subVectors(fm,hm))},subScalar:function(fm){return this.x-=fm,this.y-=fm,this.z-=fm,this},subVectors:function(fm,hm){return this.x=fm.x-hm.x,this.y=fm.y-hm.y,this.z=fm.z-hm.z,this},multiply:function(fm,hm){return void 0===hm?(this.x*=fm.x,this.y*=fm.y,this.z*=fm.z,this):(console.warn('THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.'),this.multiplyVectors(fm,hm))},multiplyScalar:function(fm){return this.x*=fm,this.y*=fm,this.z*=fm,this},multiplyVectors:function(fm,hm){return this.x=fm.x*hm.x,this.y=fm.y*hm.y,this.z=fm.z*hm.z,this},applyEuler:function(){var fm=new L;return function(ym){return ym&&ym.isEuler||console.error('THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.'),this.applyQuaternion(fm.setFromEuler(ym))}}(),applyAxisAngle:function(){var fm=new L;return function(ym,xm){return this.applyQuaternion(fm.setFromAxisAngle(ym,xm))}}(),applyMatrix3:function(fm){var hm=this.x,ym=this.y,xm=this.z,vm=fm.elements;return this.x=vm[0]*hm+vm[3]*ym+vm[6]*xm,this.y=vm[1]*hm+vm[4]*ym+vm[7]*xm,this.z=vm[2]*hm+vm[5]*ym+vm[8]*xm,this},applyMatrix4:function(fm){var hm=this.x,ym=this.y,xm=this.z,vm=fm.elements,_m=1/(vm[3]*hm+vm[7]*ym+vm[11]*xm+vm[15]);return this.x=(vm[0]*hm+vm[4]*ym+vm[8]*xm+vm[12])*_m,this.y=(vm[1]*hm+vm[5]*ym+vm[9]*xm+vm[13])*_m,this.z=(vm[2]*hm+vm[6]*ym+vm[10]*xm+vm[14])*_m,this},applyQuaternion:function(fm){var hm=this.x,ym=this.y,xm=this.z,vm=fm.x,_m=fm.y,bm=fm.z,Mm=fm.w,Sm=Mm*hm+_m*xm-bm*ym,Tm=Mm*ym+bm*hm-vm*xm,Em=Mm*xm+vm*ym-_m*hm,wm=-vm*hm-_m*ym-bm*xm;return this.x=Sm*Mm+wm*-vm+Tm*-bm-Em*-_m,this.y=Tm*Mm+wm*-_m+Em*-vm-Sm*-bm,this.z=Em*Mm+wm*-bm+Sm*-_m-Tm*-vm,this},project:function(fm){return this.applyMatrix4(fm.matrixWorldInverse).applyMatrix4(fm.projectionMatrix)},unproject:function(){var fm=new E;return function(ym){return this.applyMatrix4(fm.getInverse(ym.projectionMatrix)).applyMatrix4(ym.matrixWorld)}}(),transformDirection:function(fm){var hm=this.x,ym=this.y,xm=this.z,vm=fm.elements;return this.x=vm[0]*hm+vm[4]*ym+vm[8]*xm,this.y=vm[1]*hm+vm[5]*ym+vm[9]*xm,this.z=vm[2]*hm+vm[6]*ym+vm[10]*xm,this.normalize()},divide:function(fm){return this.x/=fm.x,this.y/=fm.y,this.z/=fm.z,this},divideScalar:function(fm){return this.multiplyScalar(1/fm)},min:function(fm){return this.x=Math.min(this.x,fm.x),this.y=Math.min(this.y,fm.y),this.z=Math.min(this.z,fm.z),this},max:function(fm){return this.x=Math.max(this.x,fm.x),this.y=Math.max(this.y,fm.y),this.z=Math.max(this.z,fm.z),this},clamp:function(fm,hm){return this.x=Math.max(fm.x,Math.min(hm.x,this.x)),this.y=Math.max(fm.y,Math.min(hm.y,this.y)),this.z=Math.max(fm.z,Math.min(hm.z,this.z)),this},clampScalar:function(){var fm=new A,hm=new A;return function(xm,vm){return fm.set(xm,xm,xm),hm.set(vm,vm,vm),this.clamp(fm,hm)}}(),clampLength:function(fm,hm){var ym=this.length();return this.divideScalar(ym||1).multiplyScalar(Math.max(fm,Math.min(hm,ym)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(fm){return this.x*fm.x+this.y*fm.y+this.z*fm.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(fm){return this.normalize().multiplyScalar(fm)},lerp:function(fm,hm){return this.x+=(fm.x-this.x)*hm,this.y+=(fm.y-this.y)*hm,this.z+=(fm.z-this.z)*hm,this},lerpVectors:function(fm,hm,ym){return this.subVectors(hm,fm).multiplyScalar(ym).add(fm)},cross:function(fm,hm){return void 0===hm?this.crossVectors(this,fm):(console.warn('THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.'),this.crossVectors(fm,hm))},crossVectors:function(fm,hm){var ym=fm.x,xm=fm.y,vm=fm.z,_m=hm.x,bm=hm.y,Mm=hm.z;return this.x=xm*Mm-vm*bm,this.y=vm*_m-ym*Mm,this.z=ym*bm-xm*_m,this},projectOnVector:function(fm){var hm=fm.dot(this)/fm.lengthSq();return this.copy(fm).multiplyScalar(hm)},projectOnPlane:function(){var fm=new A;return function(ym){return fm.copy(this).projectOnVector(ym),this.sub(fm)}}(),reflect:function(){var fm=new A;return function(ym){return this.sub(fm.copy(ym).multiplyScalar(2*this.dot(ym)))}}(),angleTo:function(fm){var hm=this.dot(fm)/Math.sqrt(this.lengthSq()*fm.lengthSq());return Math.acos(dp.clamp(hm,-1,1))},distanceTo:function(fm){return Math.sqrt(this.distanceToSquared(fm))},distanceToSquared:function(fm){var hm=this.x-fm.x,ym=this.y-fm.y,xm=this.z-fm.z;return hm*hm+ym*ym+xm*xm},manhattanDistanceTo:function(fm){return Math.abs(this.x-fm.x)+Math.abs(this.y-fm.y)+Math.abs(this.z-fm.z)},setFromSpherical:function(fm){return this.setFromSphericalCoords(fm.radius,fm.phi,fm.theta)},setFromSphericalCoords:function(fm,hm,ym){var xm=Math.sin(hm)*fm;return this.x=xm*Math.sin(ym),this.y=Math.cos(hm)*fm,this.z=xm*Math.cos(ym),this},setFromCylindrical:function(fm){return this.setFromCylindricalCoords(fm.radius,fm.theta,fm.y)},setFromCylindricalCoords:function(fm,hm,ym){return this.x=fm*Math.sin(hm),this.y=ym,this.z=fm*Math.cos(hm),this},setFromMatrixPosition:function(fm){var hm=fm.elements;return this.x=hm[12],this.y=hm[13],this.z=hm[14],this},setFromMatrixScale:function(fm){var hm=this.setFromMatrixColumn(fm,0).length(),ym=this.setFromMatrixColumn(fm,1).length(),xm=this.setFromMatrixColumn(fm,2).length();return this.x=hm,this.y=ym,this.z=xm,this},setFromMatrixColumn:function(fm,hm){return this.fromArray(fm.elements,4*hm)},equals:function(fm){return fm.x===this.x&&fm.y===this.y&&fm.z===this.z},fromArray:function(fm,hm){return void 0===hm&&(hm=0),this.x=fm[hm],this.y=fm[hm+1],this.z=fm[hm+2],this},toArray:function(fm,hm){return void 0===fm&&(fm=[]),void 0===hm&&(hm=0),fm[hm]=this.x,fm[hm+1]=this.y,fm[hm+2]=this.z,fm},fromBufferAttribute:function(fm,hm,ym){return void 0!==ym&&console.warn('THREE.Vector3: offset has been removed from .fromBufferAttribute().'),this.x=fm.getX(hm),this.y=fm.getY(hm),this.z=fm.getZ(hm),this}}),Object.assign(C.prototype,{isMatrix3:!0,set:function(fm,hm,ym,xm,vm,_m,bm,Mm,Sm){var Tm=this.elements;return Tm[0]=fm,Tm[1]=xm,Tm[2]=bm,Tm[3]=hm,Tm[4]=vm,Tm[5]=Mm,Tm[6]=ym,Tm[7]=_m,Tm[8]=Sm,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(fm){var hm=this.elements,ym=fm.elements;return hm[0]=ym[0],hm[1]=ym[1],hm[2]=ym[2],hm[3]=ym[3],hm[4]=ym[4],hm[5]=ym[5],hm[6]=ym[6],hm[7]=ym[7],hm[8]=ym[8],this},setFromMatrix4:function(fm){var hm=fm.elements;return this.set(hm[0],hm[4],hm[8],hm[1],hm[5],hm[9],hm[2],hm[6],hm[10]),this},applyToBufferAttribute:function(){var fm=new A;return function(ym){for(var xm=0,vm=ym.count;xm<vm;xm++)fm.x=ym.getX(xm),fm.y=ym.getY(xm),fm.z=ym.getZ(xm),fm.applyMatrix3(this),ym.setXYZ(xm,fm.x,fm.y,fm.z);return ym}}(),multiply:function(fm){return this.multiplyMatrices(this,fm)},premultiply:function(fm){return this.multiplyMatrices(fm,this)},multiplyMatrices:function(fm,hm){var ym=fm.elements,xm=hm.elements,vm=this.elements,_m=ym[0],bm=ym[3],Mm=ym[6],Sm=ym[1],Tm=ym[4],Em=ym[7],wm=ym[2],Lm=ym[5],Am=ym[8],Pm=xm[0],Cm=xm[3],Rm=xm[6],Im=xm[1],Dm=xm[4],zm=xm[7],Nm=xm[2],Bm=xm[5],Um=xm[8];return vm[0]=_m*Pm+bm*Im+Mm*Nm,vm[3]=_m*Cm+bm*Dm+Mm*Bm,vm[6]=_m*Rm+bm*zm+Mm*Um,vm[1]=Sm*Pm+Tm*Im+Em*Nm,vm[4]=Sm*Cm+Tm*Dm+Em*Bm,vm[7]=Sm*Rm+Tm*zm+Em*Um,vm[2]=wm*Pm+Lm*Im+Am*Nm,vm[5]=wm*Cm+Lm*Dm+Am*Bm,vm[8]=wm*Rm+Lm*zm+Am*Um,this},multiplyScalar:function(fm){var hm=this.elements;return hm[0]*=fm,hm[3]*=fm,hm[6]*=fm,hm[1]*=fm,hm[4]*=fm,hm[7]*=fm,hm[2]*=fm,hm[5]*=fm,hm[8]*=fm,this},determinant:function(){var fm=this.elements,hm=fm[0],ym=fm[1],xm=fm[2],vm=fm[3],_m=fm[4],bm=fm[5],Mm=fm[6],Sm=fm[7],Tm=fm[8];return hm*_m*Tm-hm*bm*Sm-ym*vm*Tm+ym*bm*Mm+xm*vm*Sm-xm*_m*Mm},getInverse:function(fm,hm){fm&&fm.isMatrix4&&console.error('THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.');var ym=fm.elements,xm=this.elements,vm=ym[0],_m=ym[1],bm=ym[2],Mm=ym[3],Sm=ym[4],Tm=ym[5],Em=ym[6],wm=ym[7],Lm=ym[8],Am=Lm*Sm-Tm*wm,Pm=Tm*Em-Lm*Mm,Cm=wm*Mm-Sm*Em,Rm=vm*Am+_m*Pm+bm*Cm;if(0==Rm){var Im='THREE.Matrix3: .getInverse() can\'t invert matrix, determinant is 0';if(!0===hm)throw new Error(Im);else console.warn(Im);return this.identity()}var Dm=1/Rm;return xm[0]=Am*Dm,xm[1]=(bm*wm-Lm*_m)*Dm,xm[2]=(Tm*_m-bm*Sm)*Dm,xm[3]=Pm*Dm,xm[4]=(Lm*vm-bm*Em)*Dm,xm[5]=(bm*Mm-Tm*vm)*Dm,xm[6]=Cm*Dm,xm[7]=(_m*Em-wm*vm)*Dm,xm[8]=(Sm*vm-_m*Mm)*Dm,this},transpose:function(){var hm=this.elements,fm;return fm=hm[1],hm[1]=hm[3],hm[3]=fm,fm=hm[2],hm[2]=hm[6],hm[6]=fm,fm=hm[5],hm[5]=hm[7],hm[7]=fm,this},getNormalMatrix:function(fm){return this.setFromMatrix4(fm).getInverse(this).transpose()},transposeIntoArray:function(fm){var hm=this.elements;return fm[0]=hm[0],fm[1]=hm[3],fm[2]=hm[6],fm[3]=hm[1],fm[4]=hm[4],fm[5]=hm[7],fm[6]=hm[2],fm[7]=hm[5],fm[8]=hm[8],this},setUvTransform:function(fm,hm,ym,xm,vm,_m,bm){var Mm=Math.cos(vm),Sm=Math.sin(vm);this.set(ym*Mm,ym*Sm,-ym*(Mm*_m+Sm*bm)+_m+fm,-xm*Sm,xm*Mm,-xm*(-Sm*_m+Mm*bm)+bm+hm,0,0,1)},scale:function(fm,hm){var ym=this.elements;return ym[0]*=fm,ym[3]*=fm,ym[6]*=fm,ym[1]*=hm,ym[4]*=hm,ym[7]*=hm,this},rotate:function(fm){var hm=Math.cos(fm),ym=Math.sin(fm),xm=this.elements,vm=xm[0],_m=xm[3],bm=xm[6],Mm=xm[1],Sm=xm[4],Tm=xm[7];return xm[0]=hm*vm+ym*Mm,xm[3]=hm*_m+ym*Sm,xm[6]=hm*bm+ym*Tm,xm[1]=-ym*vm+hm*Mm,xm[4]=-ym*_m+hm*Sm,xm[7]=-ym*bm+hm*Tm,this},translate:function(fm,hm){var ym=this.elements;return ym[0]+=fm*ym[2],ym[3]+=fm*ym[5],ym[6]+=fm*ym[8],ym[1]+=hm*ym[2],ym[4]+=hm*ym[5],ym[7]+=hm*ym[8],this},equals:function(fm){for(var hm=this.elements,ym=fm.elements,xm=0;9>xm;xm++)if(hm[xm]!==ym[xm])return!1;return!0},fromArray:function(fm,hm){hm===void 0&&(hm=0);for(var ym=0;9>ym;ym++)this.elements[ym]=fm[ym+hm];return this},toArray:function(fm,hm){void 0===fm&&(fm=[]),void 0===hm&&(hm=0);var ym=this.elements;return fm[hm]=ym[0],fm[hm+1]=ym[1],fm[hm+2]=ym[2],fm[hm+3]=ym[3],fm[hm+4]=ym[4],fm[hm+5]=ym[5],fm[hm+6]=ym[6],fm[hm+7]=ym[7],fm[hm+8]=ym[8],fm}});var cp={getDataURL:function(fm){var hm;if('undefined'==typeof HTMLCanvasElement)return fm.src;if(fm instanceof HTMLCanvasElement)hm=fm;else{hm=document.createElementNS('http://www.w3.org/1999/xhtml','canvas'),hm.width=fm.width,hm.height=fm.height;var ym=hm.getContext('2d');fm instanceof ImageData?ym.putImageData(fm,0,0):ym.drawImage(fm,0,0,fm.width,fm.height)}return 2048<hm.width||2048<hm.height?hm.toDataURL('image/jpeg',0.6):hm.toDataURL('image/png')}},mp=0;R.DEFAULT_IMAGE=void 0,R.DEFAULT_MAPPING=Ms,R.prototype=Object.assign(Object.create(M.prototype),{constructor:R,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.name=fm.name,this.image=fm.image,this.mipmaps=fm.mipmaps.slice(0),this.mapping=fm.mapping,this.wrapS=fm.wrapS,this.wrapT=fm.wrapT,this.magFilter=fm.magFilter,this.minFilter=fm.minFilter,this.anisotropy=fm.anisotropy,this.format=fm.format,this.type=fm.type,this.offset.copy(fm.offset),this.repeat.copy(fm.repeat),this.center.copy(fm.center),this.rotation=fm.rotation,this.matrixAutoUpdate=fm.matrixAutoUpdate,this.matrix.copy(fm.matrix),this.generateMipmaps=fm.generateMipmaps,this.premultiplyAlpha=fm.premultiplyAlpha,this.flipY=fm.flipY,this.unpackAlignment=fm.unpackAlignment,this.encoding=fm.encoding,this},toJSON:function(fm){var hm=void 0===fm||'string'==typeof fm;if(!hm&&void 0!==fm.textures[this.uuid])return fm.textures[this.uuid];var ym={metadata:{version:4.5,type:'Texture',generator:'Texture.toJSON'},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var xm=this.image;if(void 0===xm.uuid&&(xm.uuid=dp.generateUUID()),!hm&&void 0===fm.images[xm.uuid]){var vm;if(Array.isArray(xm)){vm=[];for(var _m=0,bm=xm.length;_m<bm;_m++)vm.push(cp.getDataURL(xm[_m]))}else vm=cp.getDataURL(xm);fm.images[xm.uuid]={uuid:xm.uuid,url:vm}}ym.image=xm.uuid}return hm||(fm.textures[this.uuid]=ym),ym},dispose:function(){this.dispatchEvent({type:'dispose'})},transformUv:function(fm){if(this.mapping!==Ms)return fm;if(fm.applyMatrix3(this.matrix),0>fm.x||1<fm.x)switch(this.wrapS){case Cs:fm.x-=Math.floor(fm.x);break;case Rs:fm.x=0>fm.x?0:1;break;case Is:1===Math.abs(Math.floor(fm.x)%2)?fm.x=Math.ceil(fm.x)-fm.x:fm.x-=Math.floor(fm.x);}if(0>fm.y||1<fm.y)switch(this.wrapT){case Cs:fm.y-=Math.floor(fm.y);break;case Rs:fm.y=0>fm.y?0:1;break;case Is:1===Math.abs(Math.floor(fm.y)%2)?fm.y=Math.ceil(fm.y)-fm.y:fm.y-=Math.floor(fm.y);}return this.flipY&&(fm.y=1-fm.y),fm}}),Object.defineProperty(R.prototype,'needsUpdate',{set:function(fm){!0===fm&&this.version++}}),Object.assign(I.prototype,{isVector4:!0,set:function(fm,hm,ym,xm){return this.x=fm,this.y=hm,this.z=ym,this.w=xm,this},setScalar:function(fm){return this.x=fm,this.y=fm,this.z=fm,this.w=fm,this},setX:function(fm){return this.x=fm,this},setY:function(fm){return this.y=fm,this},setZ:function(fm){return this.z=fm,this},setW:function(fm){return this.w=fm,this},setComponent:function(fm,hm){switch(fm){case 0:this.x=hm;break;case 1:this.y=hm;break;case 2:this.z=hm;break;case 3:this.w=hm;break;default:throw new Error('index is out of range: '+fm);}return this},getComponent:function(fm){switch(fm){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error('index is out of range: '+fm);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(fm){return this.x=fm.x,this.y=fm.y,this.z=fm.z,this.w=void 0===fm.w?1:fm.w,this},add:function(fm,hm){return void 0===hm?(this.x+=fm.x,this.y+=fm.y,this.z+=fm.z,this.w+=fm.w,this):(console.warn('THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.'),this.addVectors(fm,hm))},addScalar:function(fm){return this.x+=fm,this.y+=fm,this.z+=fm,this.w+=fm,this},addVectors:function(fm,hm){return this.x=fm.x+hm.x,this.y=fm.y+hm.y,this.z=fm.z+hm.z,this.w=fm.w+hm.w,this},addScaledVector:function(fm,hm){return this.x+=fm.x*hm,this.y+=fm.y*hm,this.z+=fm.z*hm,this.w+=fm.w*hm,this},sub:function(fm,hm){return void 0===hm?(this.x-=fm.x,this.y-=fm.y,this.z-=fm.z,this.w-=fm.w,this):(console.warn('THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.'),this.subVectors(fm,hm))},subScalar:function(fm){return this.x-=fm,this.y-=fm,this.z-=fm,this.w-=fm,this},subVectors:function(fm,hm){return this.x=fm.x-hm.x,this.y=fm.y-hm.y,this.z=fm.z-hm.z,this.w=fm.w-hm.w,this},multiplyScalar:function(fm){return this.x*=fm,this.y*=fm,this.z*=fm,this.w*=fm,this},applyMatrix4:function(fm){var hm=this.x,ym=this.y,xm=this.z,vm=this.w,_m=fm.elements;return this.x=_m[0]*hm+_m[4]*ym+_m[8]*xm+_m[12]*vm,this.y=_m[1]*hm+_m[5]*ym+_m[9]*xm+_m[13]*vm,this.z=_m[2]*hm+_m[6]*ym+_m[10]*xm+_m[14]*vm,this.w=_m[3]*hm+_m[7]*ym+_m[11]*xm+_m[15]*vm,this},divideScalar:function(fm){return this.multiplyScalar(1/fm)},setAxisAngleFromQuaternion:function(fm){this.w=2*Math.acos(fm.w);var hm=Math.sqrt(1-fm.w*fm.w);return 1e-4>hm?(this.x=1,this.y=0,this.z=0):(this.x=fm.x/hm,this.y=fm.y/hm,this.z=fm.z/hm),this},setAxisAngleFromRotationMatrix:function(fm){var _m=0.01,bm=0.1,Mm=fm.elements,Sm=Mm[0],Tm=Mm[4],Em=Mm[8],wm=Mm[1],Lm=Mm[5],Am=Mm[9],Pm=Mm[2],Cm=Mm[6],Rm=Mm[10],hm,ym,xm,vm;if(Math.abs(Tm-wm)<_m&&Math.abs(Em-Pm)<_m&&Math.abs(Am-Cm)<_m){if(Math.abs(Tm+wm)<bm&&Math.abs(Em+Pm)<bm&&Math.abs(Am+Cm)<bm&&Math.abs(Sm+Lm+Rm-3)<bm)return this.set(1,0,0,0),this;hm=Math.PI;var Im=(Sm+1)/2,Dm=(Lm+1)/2,zm=(Rm+1)/2,Nm=(Tm+wm)/4,Bm=(Em+Pm)/4,Um=(Am+Cm)/4;return Im>Dm&&Im>zm?Im<_m?(ym=0,xm=0.707106781,vm=0.707106781):(ym=Math.sqrt(Im),xm=Nm/ym,vm=Bm/ym):Dm>zm?Dm<_m?(ym=0.707106781,xm=0,vm=0.707106781):(xm=Math.sqrt(Dm),ym=Nm/xm,vm=Um/xm):zm<_m?(ym=0.707106781,xm=0.707106781,vm=0):(vm=Math.sqrt(zm),ym=Bm/vm,xm=Um/vm),this.set(ym,xm,vm,hm),this}var Gm=Math.sqrt((Cm-Am)*(Cm-Am)+(Em-Pm)*(Em-Pm)+(wm-Tm)*(wm-Tm));return 1e-3>Math.abs(Gm)&&(Gm=1),this.x=(Cm-Am)/Gm,this.y=(Em-Pm)/Gm,this.z=(wm-Tm)/Gm,this.w=Math.acos((Sm+Lm+Rm-1)/2),this},min:function(fm){return this.x=Math.min(this.x,fm.x),this.y=Math.min(this.y,fm.y),this.z=Math.min(this.z,fm.z),this.w=Math.min(this.w,fm.w),this},max:function(fm){return this.x=Math.max(this.x,fm.x),this.y=Math.max(this.y,fm.y),this.z=Math.max(this.z,fm.z),this.w=Math.max(this.w,fm.w),this},clamp:function(fm,hm){return this.x=Math.max(fm.x,Math.min(hm.x,this.x)),this.y=Math.max(fm.y,Math.min(hm.y,this.y)),this.z=Math.max(fm.z,Math.min(hm.z,this.z)),this.w=Math.max(fm.w,Math.min(hm.w,this.w)),this},clampScalar:function(){var fm,hm;return function(xm,vm){return void 0==fm&&(fm=new I,hm=new I),fm.set(xm,xm,xm,xm),hm.set(vm,vm,vm,vm),this.clamp(fm,hm)}}(),clampLength:function(fm,hm){var ym=this.length();return this.divideScalar(ym||1).multiplyScalar(Math.max(fm,Math.min(hm,ym)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(fm){return this.x*fm.x+this.y*fm.y+this.z*fm.z+this.w*fm.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(fm){return this.normalize().multiplyScalar(fm)},lerp:function(fm,hm){return this.x+=(fm.x-this.x)*hm,this.y+=(fm.y-this.y)*hm,this.z+=(fm.z-this.z)*hm,this.w+=(fm.w-this.w)*hm,this},lerpVectors:function(fm,hm,ym){return this.subVectors(hm,fm).multiplyScalar(ym).add(fm)},equals:function(fm){return fm.x===this.x&&fm.y===this.y&&fm.z===this.z&&fm.w===this.w},fromArray:function(fm,hm){return void 0===hm&&(hm=0),this.x=fm[hm],this.y=fm[hm+1],this.z=fm[hm+2],this.w=fm[hm+3],this},toArray:function(fm,hm){return void 0===fm&&(fm=[]),void 0===hm&&(hm=0),fm[hm]=this.x,fm[hm+1]=this.y,fm[hm+2]=this.z,fm[hm+3]=this.w,fm},fromBufferAttribute:function(fm,hm,ym){return void 0!==ym&&console.warn('THREE.Vector4: offset has been removed from .fromBufferAttribute().'),this.x=fm.getX(hm),this.y=fm.getY(hm),this.z=fm.getZ(hm),this.w=fm.getW(hm),this}}),D.prototype=Object.assign(Object.create(M.prototype),{constructor:D,isWebGLRenderTarget:!0,setSize:function(fm,hm){(this.width!==fm||this.height!==hm)&&(this.width=fm,this.height=hm,this.dispose()),this.viewport.set(0,0,fm,hm),this.scissor.set(0,0,fm,hm)},clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.width=fm.width,this.height=fm.height,this.viewport.copy(fm.viewport),this.texture=fm.texture.clone(),this.depthBuffer=fm.depthBuffer,this.stencilBuffer=fm.stencilBuffer,this.depthTexture=fm.depthTexture,this},dispose:function(){this.dispatchEvent({type:'dispose'})}}),U.prototype=Object.create(D.prototype),U.prototype.constructor=U,U.prototype.isWebGLRenderTargetCube=!0,G.prototype=Object.create(R.prototype),G.prototype.constructor=G,G.prototype.isDataTexture=!0,Object.assign(O.prototype,{isBox3:!0,set:function(fm,hm){return this.min.copy(fm),this.max.copy(hm),this},setFromArray:function(fm){for(var hm=+Infinity,ym=+Infinity,xm=+Infinity,vm=-Infinity,_m=-Infinity,bm=-Infinity,Mm=0,Sm=fm.length;Mm<Sm;Mm+=3){var Tm=fm[Mm],Em=fm[Mm+1],wm=fm[Mm+2];Tm<hm&&(hm=Tm),Em<ym&&(ym=Em),wm<xm&&(xm=wm),Tm>vm&&(vm=Tm),Em>_m&&(_m=Em),wm>bm&&(bm=wm)}return this.min.set(hm,ym,xm),this.max.set(vm,_m,bm),this},setFromBufferAttribute:function(fm){for(var hm=+Infinity,ym=+Infinity,xm=+Infinity,vm=-Infinity,_m=-Infinity,bm=-Infinity,Mm=0,Sm=fm.count;Mm<Sm;Mm++){var Tm=fm.getX(Mm),Em=fm.getY(Mm),wm=fm.getZ(Mm);Tm<hm&&(hm=Tm),Em<ym&&(ym=Em),wm<xm&&(xm=wm),Tm>vm&&(vm=Tm),Em>_m&&(_m=Em),wm>bm&&(bm=wm)}return this.min.set(hm,ym,xm),this.max.set(vm,_m,bm),this},setFromPoints:function(fm){this.makeEmpty();for(var hm=0,ym=fm.length;hm<ym;hm++)this.expandByPoint(fm[hm]);return this},setFromCenterAndSize:function(){var fm=new A;return function(ym,xm){var vm=fm.copy(xm).multiplyScalar(0.5);return this.min.copy(ym).sub(vm),this.max.copy(ym).add(vm),this}}(),setFromObject:function(fm){return this.makeEmpty(),this.expandByObject(fm)},clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.min.copy(fm.min),this.max.copy(fm.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=+Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(fm){return void 0===fm&&(console.warn('THREE.Box3: .getCenter() target is now required'),fm=new A),this.isEmpty()?fm.set(0,0,0):fm.addVectors(this.min,this.max).multiplyScalar(0.5)},getSize:function(fm){return void 0===fm&&(console.warn('THREE.Box3: .getSize() target is now required'),fm=new A),this.isEmpty()?fm.set(0,0,0):fm.subVectors(this.max,this.min)},expandByPoint:function(fm){return this.min.min(fm),this.max.max(fm),this},expandByVector:function(fm){return this.min.sub(fm),this.max.add(fm),this},expandByScalar:function(fm){return this.min.addScalar(-fm),this.max.addScalar(fm),this},expandByObject:function(){function fm(_m){var bm=_m.geometry;if(bm!==void 0)if(bm.isGeometry){var Mm=bm.vertices;for(ym=0,xm=Mm.length;ym<xm;ym++)vm.copy(Mm[ym]),vm.applyMatrix4(_m.matrixWorld),hm.expandByPoint(vm)}else if(bm.isBufferGeometry){var Sm=bm.attributes.position;if(void 0!==Sm)for(ym=0,xm=Sm.count;ym<xm;ym++)vm.fromBufferAttribute(Sm,ym).applyMatrix4(_m.matrixWorld),hm.expandByPoint(vm)}}var hm,ym,xm,vm=new A;return function(bm){return hm=this,bm.updateMatrixWorld(!0),bm.traverse(fm),this}}(),containsPoint:function(fm){return fm.x<this.min.x||fm.x>this.max.x||fm.y<this.min.y||fm.y>this.max.y||fm.z<this.min.z||fm.z>this.max.z?!1:!0},containsBox:function(fm){return this.min.x<=fm.min.x&&fm.max.x<=this.max.x&&this.min.y<=fm.min.y&&fm.max.y<=this.max.y&&this.min.z<=fm.min.z&&fm.max.z<=this.max.z},getParameter:function(fm,hm){return void 0===hm&&(console.warn('THREE.Box3: .getParameter() target is now required'),hm=new A),hm.set((fm.x-this.min.x)/(this.max.x-this.min.x),(fm.y-this.min.y)/(this.max.y-this.min.y),(fm.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(fm){return fm.max.x<this.min.x||fm.min.x>this.max.x||fm.max.y<this.min.y||fm.min.y>this.max.y||fm.max.z<this.min.z||fm.min.z>this.max.z?!1:!0},intersectsSphere:function(){var fm=new A;return function(ym){return this.clampPoint(ym.center,fm),fm.distanceToSquared(ym.center)<=ym.radius*ym.radius}}(),intersectsPlane:function(fm){var hm,ym;return 0<fm.normal.x?(hm=fm.normal.x*this.min.x,ym=fm.normal.x*this.max.x):(hm=fm.normal.x*this.max.x,ym=fm.normal.x*this.min.x),0<fm.normal.y?(hm+=fm.normal.y*this.min.y,ym+=fm.normal.y*this.max.y):(hm+=fm.normal.y*this.max.y,ym+=fm.normal.y*this.min.y),0<fm.normal.z?(hm+=fm.normal.z*this.min.z,ym+=fm.normal.z*this.max.z):(hm+=fm.normal.z*this.max.z,ym+=fm.normal.z*this.min.z),hm<=-fm.constant&&ym>=-fm.constant},intersectsTriangle:function(){function fm(wm){var Lm,Am;for(Lm=0,Am=wm.length-3;Lm<=Am;Lm+=3){Mm.fromArray(wm,Lm);var Pm=Tm.x*Math.abs(Mm.x)+Tm.y*Math.abs(Mm.y)+Tm.z*Math.abs(Mm.z),Cm=hm.dot(Mm),Rm=ym.dot(Mm),Im=xm.dot(Mm);if(Math.max(-Math.max(Cm,Rm,Im),Math.min(Cm,Rm,Im))>Pm)return!1}return!0}var hm=new A,ym=new A,xm=new A,vm=new A,_m=new A,bm=new A,Mm=new A,Sm=new A,Tm=new A,Em=new A;return function(Lm){if(this.isEmpty())return!1;this.getCenter(Sm),Tm.subVectors(this.max,Sm),hm.subVectors(Lm.a,Sm),ym.subVectors(Lm.b,Sm),xm.subVectors(Lm.c,Sm),vm.subVectors(ym,hm),_m.subVectors(xm,ym),bm.subVectors(hm,xm);var Am=[0,-vm.z,vm.y,0,-_m.z,_m.y,0,-bm.z,bm.y,vm.z,0,-vm.x,_m.z,0,-_m.x,bm.z,0,-bm.x,-vm.y,vm.x,0,-_m.y,_m.x,0,-bm.y,bm.x,0];return!!fm(Am)&&(Am=[1,0,0,0,1,0,0,0,1],!!fm(Am))&&(Em.crossVectors(vm,_m),Am=[Em.x,Em.y,Em.z],fm(Am))}}(),clampPoint:function(fm,hm){return void 0===hm&&(console.warn('THREE.Box3: .clampPoint() target is now required'),hm=new A),hm.copy(fm).clamp(this.min,this.max)},distanceToPoint:function(){var fm=new A;return function(ym){var xm=fm.copy(ym).clamp(this.min,this.max);return xm.sub(ym).length()}}(),getBoundingSphere:function(){var fm=new A;return function(ym){return void 0===ym&&(console.warn('THREE.Box3: .getBoundingSphere() target is now required'),ym=new F),this.getCenter(ym.center),ym.radius=0.5*this.getSize(fm).length(),ym}}(),intersect:function(fm){return this.min.max(fm.min),this.max.min(fm.max),this.isEmpty()&&this.makeEmpty(),this},union:function(fm){return this.min.min(fm.min),this.max.max(fm.max),this},applyMatrix4:function(){var fm=[new A,new A,new A,new A,new A,new A,new A,new A];return function(ym){return this.isEmpty()?this:(fm[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(ym),fm[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(ym),fm[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(ym),fm[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(ym),fm[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(ym),fm[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(ym),fm[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(ym),fm[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(ym),this.setFromPoints(fm),this)}}(),translate:function(fm){return this.min.add(fm),this.max.add(fm),this},equals:function(fm){return fm.min.equals(this.min)&&fm.max.equals(this.max)}}),Object.assign(F.prototype,{set:function(fm,hm){return this.center.copy(fm),this.radius=hm,this},setFromPoints:function(){var fm=new O;return function(ym,xm){var vm=this.center;void 0===xm?fm.setFromPoints(ym).getCenter(vm):vm.copy(xm);for(var _m=0,bm=0,Mm=ym.length;bm<Mm;bm++)_m=Math.max(_m,vm.distanceToSquared(ym[bm]));return this.radius=Math.sqrt(_m),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.center.copy(fm.center),this.radius=fm.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(fm){return fm.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(fm){return fm.distanceTo(this.center)-this.radius},intersectsSphere:function(fm){var hm=this.radius+fm.radius;return fm.center.distanceToSquared(this.center)<=hm*hm},intersectsBox:function(fm){return fm.intersectsSphere(this)},intersectsPlane:function(fm){return Math.abs(fm.distanceToPoint(this.center))<=this.radius},clampPoint:function(fm,hm){var ym=this.center.distanceToSquared(fm);return void 0===hm&&(console.warn('THREE.Sphere: .clampPoint() target is now required'),hm=new A),hm.copy(fm),ym>this.radius*this.radius&&(hm.sub(this.center).normalize(),hm.multiplyScalar(this.radius).add(this.center)),hm},getBoundingBox:function(fm){return void 0===fm&&(console.warn('THREE.Sphere: .getBoundingBox() target is now required'),fm=new O),fm.set(this.center,this.center),fm.expandByScalar(this.radius),fm},applyMatrix4:function(fm){return this.center.applyMatrix4(fm),this.radius*=fm.getMaxScaleOnAxis(),this},translate:function(fm){return this.center.add(fm),this},equals:function(fm){return fm.center.equals(this.center)&&fm.radius===this.radius}}),Object.assign(H.prototype,{set:function(fm,hm){return this.normal.copy(fm),this.constant=hm,this},setComponents:function(fm,hm,ym,xm){return this.normal.set(fm,hm,ym),this.constant=xm,this},setFromNormalAndCoplanarPoint:function(fm,hm){return this.normal.copy(fm),this.constant=-hm.dot(this.normal),this},setFromCoplanarPoints:function(){var fm=new A,hm=new A;return function(xm,vm,_m){var bm=fm.subVectors(_m,vm).cross(hm.subVectors(xm,vm)).normalize();return this.setFromNormalAndCoplanarPoint(bm,xm),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.normal.copy(fm.normal),this.constant=fm.constant,this},normalize:function(){var fm=1/this.normal.length();return this.normal.multiplyScalar(fm),this.constant*=fm,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(fm){return this.normal.dot(fm)+this.constant},distanceToSphere:function(fm){return this.distanceToPoint(fm.center)-fm.radius},projectPoint:function(fm,hm){return void 0===hm&&(console.warn('THREE.Plane: .projectPoint() target is now required'),hm=new A),hm.copy(this.normal).multiplyScalar(-this.distanceToPoint(fm)).add(fm)},intersectLine:function(){var fm=new A;return function(ym,xm){xm===void 0&&(console.warn('THREE.Plane: .intersectLine() target is now required'),xm=new A);var vm=ym.delta(fm),_m=this.normal.dot(vm);if(0===_m)return 0===this.distanceToPoint(ym.start)?xm.copy(ym.start):void 0;var bm=-(ym.start.dot(this.normal)+this.constant)/_m;return 0>bm||1<bm?void 0:xm.copy(vm).multiplyScalar(bm).add(ym.start)}}(),intersectsLine:function(fm){var hm=this.distanceToPoint(fm.start),ym=this.distanceToPoint(fm.end);return 0>hm&&0<ym||0>ym&&0<hm},intersectsBox:function(fm){return fm.intersectsPlane(this)},intersectsSphere:function(fm){return fm.intersectsPlane(this)},coplanarPoint:function(fm){return void 0===fm&&(console.warn('THREE.Plane: .coplanarPoint() target is now required'),fm=new A),fm.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var fm=new A,hm=new C;return function(xm,vm){var _m=vm||hm.getNormalMatrix(xm),bm=this.coplanarPoint(fm).applyMatrix4(xm),Mm=this.normal.applyMatrix3(_m).normalize();return this.constant=-bm.dot(Mm),this}}(),translate:function(fm){return this.constant-=fm.dot(this.normal),this},equals:function(fm){return fm.normal.equals(this.normal)&&fm.constant===this.constant}}),Object.assign(V.prototype,{set:function(fm,hm,ym,xm,vm,_m){var bm=this.planes;return bm[0].copy(fm),bm[1].copy(hm),bm[2].copy(ym),bm[3].copy(xm),bm[4].copy(vm),bm[5].copy(_m),this},clone:function(){return new this.constructor().copy(this)},copy:function(fm){for(var hm=this.planes,ym=0;6>ym;ym++)hm[ym].copy(fm.planes[ym]);return this},setFromMatrix:function(fm){var hm=this.planes,ym=fm.elements,xm=ym[0],vm=ym[1],_m=ym[2],bm=ym[3],Mm=ym[4],Sm=ym[5],Tm=ym[6],Em=ym[7],wm=ym[8],Lm=ym[9],Am=ym[10],Pm=ym[11],Cm=ym[12],Rm=ym[13],Im=ym[14],Dm=ym[15];return hm[0].setComponents(bm-xm,Em-Mm,Pm-wm,Dm-Cm).normalize(),hm[1].setComponents(bm+xm,Em+Mm,Pm+wm,Dm+Cm).normalize(),hm[2].setComponents(bm+vm,Em+Sm,Pm+Lm,Dm+Rm).normalize(),hm[3].setComponents(bm-vm,Em-Sm,Pm-Lm,Dm-Rm).normalize(),hm[4].setComponents(bm-_m,Em-Tm,Pm-Am,Dm-Im).normalize(),hm[5].setComponents(bm+_m,Em+Tm,Pm+Am,Dm+Im).normalize(),this},intersectsObject:function(){var fm=new F;return function(ym){var xm=ym.geometry;return null===xm.boundingSphere&&xm.computeBoundingSphere(),fm.copy(xm.boundingSphere).applyMatrix4(ym.matrixWorld),this.intersectsSphere(fm)}}(),intersectsSprite:function(){var fm=new F;return function(ym){return fm.center.set(0,0,0),fm.radius=0.7071067811865476,fm.applyMatrix4(ym.matrixWorld),this.intersectsSphere(fm)}}(),intersectsSphere:function(fm){for(var hm=this.planes,ym=fm.center,xm=-fm.radius,vm=0,_m;6>vm;vm++)if(_m=hm[vm].distanceToPoint(ym),_m<xm)return!1;return!0},intersectsBox:function(){var fm=new A;return function(ym){for(var xm=this.planes,vm=0,_m;6>vm;vm++)if(_m=xm[vm],fm.x=0<_m.normal.x?ym.max.x:ym.min.x,fm.y=0<_m.normal.y?ym.max.y:ym.min.y,fm.z=0<_m.normal.z?ym.max.z:ym.min.z,0>_m.distanceToPoint(fm))return!1;return!0}}(),containsPoint:function(fm){for(var hm=this.planes,ym=0;6>ym;ym++)if(0>hm[ym].distanceToPoint(fm))return!1;return!0}});var Ic={alphamap_fragment:'#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n',alphamap_pars_fragment:'#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n',alphatest_fragment:'#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n',aomap_fragment:'#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n',aomap_pars_fragment:'#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif',begin_vertex:'\nvec3 transformed = vec3( position );\n',beginnormal_vertex:'\nvec3 objectNormal = vec3( normal );\n',bsdfs:'float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n',bumpmap_pars_fragment:'#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n',clipping_planes_fragment:'#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n',clipping_planes_pars_fragment:'#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n',clipping_planes_pars_vertex:'#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif\n',clipping_planes_vertex:'#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n',color_fragment:'#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif',color_pars_fragment:'#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n',color_pars_vertex:'#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif',color_vertex:'#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif',common:'#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n',cube_uv_reflection_fragment:'#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n',defaultnormal_vertex:'vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n',displacementmap_pars_vertex:'#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n',displacementmap_vertex:'#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n',emissivemap_fragment:'#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n',emissivemap_pars_fragment:'#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n',encodings_fragment:'  gl_FragColor = linearToOutputTexel( gl_FragColor );\n',encodings_pars_fragment:'\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n',envmap_fragment:'#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n',envmap_pars_fragment:'#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n',envmap_pars_vertex:'#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n',envmap_physical_pars_fragment:'#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n',envmap_vertex:'#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n',fog_vertex:'#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif\n',fog_pars_vertex:'#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif\n',fog_fragment:'#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n',fog_pars_fragment:'#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n',gradientmap_pars_fragment:'#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n',lightmap_fragment:'#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n',lightmap_pars_fragment:'#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif',lights_lambert_vertex:'vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n',lights_pars_begin:'uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n',lights_phong_fragment:'BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n',lights_phong_pars_fragment:'varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n',lights_physical_fragment:'PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n',lights_physical_pars_fragment:'struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n',lights_fragment_begin:'\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n',lights_fragment_maps:'#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n',lights_fragment_end:'#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n',logdepthbuf_fragment:'#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif',logdepthbuf_pars_fragment:'#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif\n',logdepthbuf_pars_vertex:'#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif\n',logdepthbuf_vertex:'#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n',map_fragment:'#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n',map_pars_fragment:'#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n',map_particle_fragment:'#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n',map_particle_pars_fragment:'#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n',metalnessmap_fragment:'float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n',metalnessmap_pars_fragment:'#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif',morphnormal_vertex:'#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n',morphtarget_pars_vertex:'#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif',morphtarget_vertex:'#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n',normal_fragment_begin:'#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n',normal_fragment_maps:'#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n',normalmap_pars_fragment:'#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif\n',packing:'vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n',premultiplied_alpha_fragment:'#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n',project_vertex:'vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n',dithering_fragment:'#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n',dithering_pars_fragment:'#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n',roughnessmap_fragment:'float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n',roughnessmap_pars_fragment:'#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif',shadowmap_pars_fragment:'#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n',shadowmap_pars_vertex:'#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n',shadowmap_vertex:'#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n',shadowmask_pars_fragment:'float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n',skinbase_vertex:'#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif',skinning_pars_vertex:'#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n',skinning_vertex:'#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n',skinnormal_vertex:'#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n',specularmap_fragment:'float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif',specularmap_pars_fragment:'#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif',tonemapping_fragment:'#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n',tonemapping_pars_fragment:'#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n',uv_pars_fragment:'#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif',uv_pars_vertex:'#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n',uv_vertex:'#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif',uv2_pars_fragment:'#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif',uv2_pars_vertex:'#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif',uv2_vertex:'#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif',worldpos_vertex:'#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n',background_frag:'uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}\n',background_vert:'varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}\n',cube_frag:'uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = envMapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}\n',cube_vert:'varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n',depth_frag:'#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n',depth_vert:'#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n',distanceRGBA_frag:'#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n',distanceRGBA_vert:'#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n',equirect_frag:'uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n',equirect_vert:'varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n',linedashed_frag:'uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n',linedashed_vert:'uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n',meshbasic_frag:'uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n',meshbasic_vert:'#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n',meshlambert_frag:'uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n',meshlambert_vert:'#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n',meshmatcap_frag:'#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\tvec4 matcapColor = texture2D( matcap, uv );\n\tmatcapColor = matcapTexelToLinear( matcapColor );\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n',meshmatcap_vert:'#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}\n',meshphong_frag:'#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n',meshphong_vert:'#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n',meshphysical_frag:'#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n',meshphysical_vert:'#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n',normal_frag:'#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n',normal_vert:'#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n',points_frag:'uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n',points_vert:'uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}\n',shadow_frag:'uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n',shadow_vert:'#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n',sprite_frag:'uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n',sprite_vert:'uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n'},Dc={merge:function(fm){for(var hm={},ym=0,xm;ym<fm.length;ym++)for(var vm in xm=this.clone(fm[ym]),xm)hm[vm]=xm[vm];return hm},clone:function(fm){var hm={};for(var ym in fm)for(var xm in hm[ym]={},fm[ym]){var vm=fm[ym][xm];hm[ym][xm]=vm&&(vm.isColor||vm.isMatrix3||vm.isMatrix4||vm.isVector2||vm.isVector3||vm.isVector4||vm.isTexture)?vm.clone():Array.isArray(vm)?vm.slice():vm}return hm}},zc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(W.prototype,{isColor:!0,r:1,g:1,b:1,set:function(fm){return fm&&fm.isColor?this.copy(fm):'number'==typeof fm?this.setHex(fm):'string'==typeof fm&&this.setStyle(fm),this},setScalar:function(fm){return this.r=fm,this.g=fm,this.b=fm,this},setHex:function(fm){return fm=Math.floor(fm),this.r=(255&fm>>16)/255,this.g=(255&fm>>8)/255,this.b=(255&fm)/255,this},setRGB:function(fm,hm,ym){return this.r=fm,this.g=hm,this.b=ym,this},setHSL:function(){function fm(hm,ym,xm){return 0>xm&&(xm+=1),1<xm&&(xm-=1),xm<1/6?hm+6*(ym-hm)*xm:xm<1/2?ym:xm<2/3?hm+6*(ym-hm)*(2/3-xm):hm}return function(ym,xm,vm){if(ym=dp.euclideanModulo(ym,1),xm=dp.clamp(xm,0,1),vm=dp.clamp(vm,0,1),0===xm)this.r=this.g=this.b=vm;else{var _m=0.5>=vm?vm*(1+xm):vm+xm-vm*xm,bm=2*vm-_m;this.r=fm(bm,_m,ym+1/3),this.g=fm(bm,_m,ym),this.b=fm(bm,_m,ym-1/3)}return this}}(),setStyle:function(fm){function hm(wm){void 0===wm||1>parseFloat(wm)&&console.warn('THREE.Color: Alpha component of '+fm+' will be ignored.')}var ym;if(ym=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(fm)){var xm,vm=ym[1],_m=ym[2];switch(vm){case'rgb':case'rgba':if(xm=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(_m))return this.r=Math.min(255,parseInt(xm[1],10))/255,this.g=Math.min(255,parseInt(xm[2],10))/255,this.b=Math.min(255,parseInt(xm[3],10))/255,hm(xm[5]),this;if(xm=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(_m))return this.r=Math.min(100,parseInt(xm[1],10))/100,this.g=Math.min(100,parseInt(xm[2],10))/100,this.b=Math.min(100,parseInt(xm[3],10))/100,hm(xm[5]),this;break;case'hsl':case'hsla':if(xm=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(_m)){var bm=parseFloat(xm[1])/360,Mm=parseInt(xm[2],10)/100,Sm=parseInt(xm[3],10)/100;return hm(xm[5]),this.setHSL(bm,Mm,Sm)}}}else if(ym=/^\#([A-Fa-f0-9]+)$/.exec(fm)){var Tm=ym[1],Em=Tm.length;if(3===Em)return this.r=parseInt(Tm.charAt(0)+Tm.charAt(0),16)/255,this.g=parseInt(Tm.charAt(1)+Tm.charAt(1),16)/255,this.b=parseInt(Tm.charAt(2)+Tm.charAt(2),16)/255,this;if(6===Em)return this.r=parseInt(Tm.charAt(0)+Tm.charAt(1),16)/255,this.g=parseInt(Tm.charAt(2)+Tm.charAt(3),16)/255,this.b=parseInt(Tm.charAt(4)+Tm.charAt(5),16)/255,this}if(fm&&0<fm.length){var Tm=zc[fm];void 0===Tm?console.warn('THREE.Color: Unknown color '+fm):this.setHex(Tm)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(fm){return this.r=fm.r,this.g=fm.g,this.b=fm.b,this},copyGammaToLinear:function(fm,hm){return void 0===hm&&(hm=2),this.r=Math.pow(fm.r,hm),this.g=Math.pow(fm.g,hm),this.b=Math.pow(fm.b,hm),this},copyLinearToGamma:function(fm,hm){void 0===hm&&(hm=2);var ym=0<hm?1/hm:1;return this.r=Math.pow(fm.r,ym),this.g=Math.pow(fm.g,ym),this.b=Math.pow(fm.b,ym),this},convertGammaToLinear:function(fm){return this.copyGammaToLinear(this,fm),this},convertLinearToGamma:function(fm){return this.copyLinearToGamma(this,fm),this},copySRGBToLinear:function(){function fm(hm){return 0.04045>hm?0.0773993808*hm:Math.pow(0.9478672986*hm+0.0521327014,2.4)}return function(ym){return this.r=fm(ym.r),this.g=fm(ym.g),this.b=fm(ym.b),this}}(),copyLinearToSRGB:function(){function fm(hm){return 0.0031308>hm?12.92*hm:1.055*Math.pow(hm,0.41666)-0.055}return function(ym){return this.r=fm(ym.r),this.g=fm(ym.g),this.b=fm(ym.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return('000000'+this.getHex().toString(16)).slice(-6)},getHSL:function(fm){void 0===fm&&(console.warn('THREE.Color: .getHSL() target is now required'),fm={h:0,s:0,l:0});var hm=this.r,ym=this.g,xm=this.b,vm=Math.max(hm,ym,xm),_m=Math.min(hm,ym,xm),Sm=(_m+vm)/2,bm,Mm;if(_m===vm)bm=0,Mm=0;else{var Tm=vm-_m;Mm=0.5>=Sm?Tm/(vm+_m):Tm/(2-vm-_m),vm===hm?bm=(ym-xm)/Tm+(ym<xm?6:0):vm===ym?bm=(xm-hm)/Tm+2:vm===xm?bm=(hm-ym)/Tm+4:void 0,bm/=6}return fm.h=bm,fm.s=Mm,fm.l=Sm,fm},getStyle:function(){return'rgb('+(0|255*this.r)+','+(0|255*this.g)+','+(0|255*this.b)+')'},offsetHSL:function(){var fm={};return function(hm,ym,xm){return this.getHSL(fm),fm.h+=hm,fm.s+=ym,fm.l+=xm,this.setHSL(fm.h,fm.s,fm.l),this}}(),add:function(fm){return this.r+=fm.r,this.g+=fm.g,this.b+=fm.b,this},addColors:function(fm,hm){return this.r=fm.r+hm.r,this.g=fm.g+hm.g,this.b=fm.b+hm.b,this},addScalar:function(fm){return this.r+=fm,this.g+=fm,this.b+=fm,this},sub:function(fm){return this.r=Math.max(0,this.r-fm.r),this.g=Math.max(0,this.g-fm.g),this.b=Math.max(0,this.b-fm.b),this},multiply:function(fm){return this.r*=fm.r,this.g*=fm.g,this.b*=fm.b,this},multiplyScalar:function(fm){return this.r*=fm,this.g*=fm,this.b*=fm,this},lerp:function(fm,hm){return this.r+=(fm.r-this.r)*hm,this.g+=(fm.g-this.g)*hm,this.b+=(fm.b-this.b)*hm,this},lerpHSL:function(){var fm={h:0,s:0,l:0},hm={h:0,s:0,l:0};return function(xm,vm){this.getHSL(fm),xm.getHSL(hm);var _m=dp.lerp(fm.h,hm.h,vm),bm=dp.lerp(fm.s,hm.s,vm),Mm=dp.lerp(fm.l,hm.l,vm);return this.setHSL(_m,bm,Mm),this}}(),equals:function(fm){return fm.r===this.r&&fm.g===this.g&&fm.b===this.b},fromArray:function(fm,hm){return void 0===hm&&(hm=0),this.r=fm[hm],this.g=fm[hm+1],this.b=fm[hm+2],this},toArray:function(fm,hm){return void 0===fm&&(fm=[]),void 0===hm&&(hm=0),fm[hm]=this.r,fm[hm+1]=this.g,fm[hm+2]=this.b,fm},toJSON:function(){return this.getHex()}});var Nc={common:{diffuse:{value:new W(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new C},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:0.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new S(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:2.5e-4},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new W(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new W(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new C}},sprite:{diffuse:{value:new W(15658734)},opacity:{value:1},center:{value:new S(0.5,0.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new C}}},Bc={basic:{uniforms:Dc.merge([Nc.common,Nc.specularmap,Nc.envmap,Nc.aomap,Nc.lightmap,Nc.fog]),vertexShader:Ic.meshbasic_vert,fragmentShader:Ic.meshbasic_frag},lambert:{uniforms:Dc.merge([Nc.common,Nc.specularmap,Nc.envmap,Nc.aomap,Nc.lightmap,Nc.emissivemap,Nc.fog,Nc.lights,{emissive:{value:new W(0)}}]),vertexShader:Ic.meshlambert_vert,fragmentShader:Ic.meshlambert_frag},phong:{uniforms:Dc.merge([Nc.common,Nc.specularmap,Nc.envmap,Nc.aomap,Nc.lightmap,Nc.emissivemap,Nc.bumpmap,Nc.normalmap,Nc.displacementmap,Nc.gradientmap,Nc.fog,Nc.lights,{emissive:{value:new W(0)},specular:{value:new W(1118481)},shininess:{value:30}}]),vertexShader:Ic.meshphong_vert,fragmentShader:Ic.meshphong_frag},standard:{uniforms:Dc.merge([Nc.common,Nc.envmap,Nc.aomap,Nc.lightmap,Nc.emissivemap,Nc.bumpmap,Nc.normalmap,Nc.displacementmap,Nc.roughnessmap,Nc.metalnessmap,Nc.fog,Nc.lights,{emissive:{value:new W(0)},roughness:{value:0.5},metalness:{value:0.5},envMapIntensity:{value:1}}]),vertexShader:Ic.meshphysical_vert,fragmentShader:Ic.meshphysical_frag},matcap:{uniforms:Dc.merge([Nc.common,Nc.bumpmap,Nc.normalmap,Nc.displacementmap,Nc.fog,{matcap:{value:null}}]),vertexShader:Ic.meshmatcap_vert,fragmentShader:Ic.meshmatcap_frag},points:{uniforms:Dc.merge([Nc.points,Nc.fog]),vertexShader:Ic.points_vert,fragmentShader:Ic.points_frag},dashed:{uniforms:Dc.merge([Nc.common,Nc.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ic.linedashed_vert,fragmentShader:Ic.linedashed_frag},depth:{uniforms:Dc.merge([Nc.common,Nc.displacementmap]),vertexShader:Ic.depth_vert,fragmentShader:Ic.depth_frag},normal:{uniforms:Dc.merge([Nc.common,Nc.bumpmap,Nc.normalmap,Nc.displacementmap,{opacity:{value:1}}]),vertexShader:Ic.normal_vert,fragmentShader:Ic.normal_frag},sprite:{uniforms:Dc.merge([Nc.sprite,Nc.fog]),vertexShader:Ic.sprite_vert,fragmentShader:Ic.sprite_frag},background:{uniforms:{uvTransform:{value:new C},t2D:{value:null}},vertexShader:Ic.background_vert,fragmentShader:Ic.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ic.cube_vert,fragmentShader:Ic.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ic.equirect_vert,fragmentShader:Ic.equirect_frag},distanceRGBA:{uniforms:Dc.merge([Nc.common,Nc.displacementmap,{referencePosition:{value:new A},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ic.distanceRGBA_vert,fragmentShader:Ic.distanceRGBA_frag},shadow:{uniforms:Dc.merge([Nc.lights,Nc.fog,{color:{value:new W(0)},opacity:{value:1}}]),vertexShader:Ic.shadow_vert,fragmentShader:Ic.shadow_frag}};Bc.physical={uniforms:Dc.merge([Bc.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Ic.meshphysical_vert,fragmentShader:Ic.meshphysical_frag},Object.assign(Z.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(fm){this.a=fm.a,this.b=fm.b,this.c=fm.c,this.normal.copy(fm.normal),this.color.copy(fm.color),this.materialIndex=fm.materialIndex;for(var hm=0,ym=fm.vertexNormals.length;hm<ym;hm++)this.vertexNormals[hm]=fm.vertexNormals[hm].clone();for(var hm=0,ym=fm.vertexColors.length;hm<ym;hm++)this.vertexColors[hm]=fm.vertexColors[hm].clone();return this}}),J.RotationOrders=['XYZ','YZX','ZXY','XZY','YXZ','ZYX'],J.DefaultOrder='XYZ',Object.defineProperties(J.prototype,{x:{get:function(){return this._x},set:function(fm){this._x=fm,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(fm){this._y=fm,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(fm){this._z=fm,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(fm){this._order=fm,this.onChangeCallback()}}}),Object.assign(J.prototype,{isEuler:!0,set:function(fm,hm,ym,xm){return this._x=fm,this._y=hm,this._z=ym,this._order=xm||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(fm){return this._x=fm._x,this._y=fm._y,this._z=fm._z,this._order=fm._order,this.onChangeCallback(),this},setFromRotationMatrix:function(fm,hm,ym){var xm=dp.clamp,vm=fm.elements,_m=vm[0],bm=vm[4],Mm=vm[8],Sm=vm[1],Tm=vm[5],Em=vm[9],wm=vm[2],Lm=vm[6],Am=vm[10];return hm=hm||this._order,'XYZ'===hm?(this._y=Math.asin(xm(Mm,-1,1)),0.99999>Math.abs(Mm)?(this._x=Math.atan2(-Em,Am),this._z=Math.atan2(-bm,_m)):(this._x=Math.atan2(Lm,Tm),this._z=0)):'YXZ'===hm?(this._x=Math.asin(-xm(Em,-1,1)),0.99999>Math.abs(Em)?(this._y=Math.atan2(Mm,Am),this._z=Math.atan2(Sm,Tm)):(this._y=Math.atan2(-wm,_m),this._z=0)):'ZXY'===hm?(this._x=Math.asin(xm(Lm,-1,1)),0.99999>Math.abs(Lm)?(this._y=Math.atan2(-wm,Am),this._z=Math.atan2(-bm,Tm)):(this._y=0,this._z=Math.atan2(Sm,_m))):'ZYX'===hm?(this._y=Math.asin(-xm(wm,-1,1)),0.99999>Math.abs(wm)?(this._x=Math.atan2(Lm,Am),this._z=Math.atan2(Sm,_m)):(this._x=0,this._z=Math.atan2(-bm,Tm))):'YZX'===hm?(this._z=Math.asin(xm(Sm,-1,1)),0.99999>Math.abs(Sm)?(this._x=Math.atan2(-Em,Tm),this._y=Math.atan2(-wm,_m)):(this._x=0,this._y=Math.atan2(Mm,Am))):'XZY'===hm?(this._z=Math.asin(-xm(bm,-1,1)),0.99999>Math.abs(bm)?(this._x=Math.atan2(Lm,Tm),this._y=Math.atan2(Mm,_m)):(this._x=Math.atan2(-Em,Am),this._y=0)):console.warn('THREE.Euler: .setFromRotationMatrix() given unsupported order: '+hm),this._order=hm,!1!==ym&&this.onChangeCallback(),this},setFromQuaternion:function(){var fm=new E;return function(ym,xm,vm){return fm.makeRotationFromQuaternion(ym),this.setFromRotationMatrix(fm,xm,vm)}}(),setFromVector3:function(fm,hm){return this.set(fm.x,fm.y,fm.z,hm||this._order)},reorder:function(){var fm=new L;return function(ym){return fm.setFromEuler(this),this.setFromQuaternion(fm,ym)}}(),equals:function(fm){return fm._x===this._x&&fm._y===this._y&&fm._z===this._z&&fm._order===this._order},fromArray:function(fm){return this._x=fm[0],this._y=fm[1],this._z=fm[2],void 0!==fm[3]&&(this._order=fm[3]),this.onChangeCallback(),this},toArray:function(fm,hm){return void 0===fm&&(fm=[]),void 0===hm&&(hm=0),fm[hm]=this._x,fm[hm+1]=this._y,fm[hm+2]=this._z,fm[hm+3]=this._order,fm},toVector3:function(fm){return fm?fm.set(this._x,this._y,this._z):new A(this._x,this._y,this._z)},onChange:function(fm){return this.onChangeCallback=fm,this},onChangeCallback:function(){}}),Object.assign(Q.prototype,{set:function(fm){this.mask=0|1<<fm},enable:function(fm){this.mask|=0|1<<fm},toggle:function(fm){this.mask^=0|1<<fm},disable:function(fm){this.mask&=~(0|1<<fm)},test:function(fm){return 0!=(this.mask&fm.mask)}});var Uc=0;K.DefaultUp=new A(0,1,0),K.DefaultMatrixAutoUpdate=!0,K.prototype=Object.assign(Object.create(M.prototype),{constructor:K,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(fm){this.matrix.multiplyMatrices(fm,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(fm){return this.quaternion.premultiply(fm),this},setRotationFromAxisAngle:function(fm,hm){this.quaternion.setFromAxisAngle(fm,hm)},setRotationFromEuler:function(fm){this.quaternion.setFromEuler(fm,!0)},setRotationFromMatrix:function(fm){this.quaternion.setFromRotationMatrix(fm)},setRotationFromQuaternion:function(fm){this.quaternion.copy(fm)},rotateOnAxis:function(){var fm=new L;return function(ym,xm){return fm.setFromAxisAngle(ym,xm),this.quaternion.multiply(fm),this}}(),rotateOnWorldAxis:function(){var fm=new L;return function(ym,xm){return fm.setFromAxisAngle(ym,xm),this.quaternion.premultiply(fm),this}}(),rotateX:function(){var fm=new A(1,0,0);return function(ym){return this.rotateOnAxis(fm,ym)}}(),rotateY:function(){var fm=new A(0,1,0);return function(ym){return this.rotateOnAxis(fm,ym)}}(),rotateZ:function(){var fm=new A(0,0,1);return function(ym){return this.rotateOnAxis(fm,ym)}}(),translateOnAxis:function(){var fm=new A;return function(ym,xm){return fm.copy(ym).applyQuaternion(this.quaternion),this.position.add(fm.multiplyScalar(xm)),this}}(),translateX:function(){var fm=new A(1,0,0);return function(ym){return this.translateOnAxis(fm,ym)}}(),translateY:function(){var fm=new A(0,1,0);return function(ym){return this.translateOnAxis(fm,ym)}}(),translateZ:function(){var fm=new A(0,0,1);return function(ym){return this.translateOnAxis(fm,ym)}}(),localToWorld:function(fm){return fm.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var fm=new E;return function(ym){return ym.applyMatrix4(fm.getInverse(this.matrixWorld))}}(),lookAt:function(){var fm=new L,hm=new E,ym=new A,xm=new A;return function(_m,bm,Mm){_m.isVector3?ym.copy(_m):ym.set(_m,bm,Mm);var Sm=this.parent;this.updateWorldMatrix(!0,!1),xm.setFromMatrixPosition(this.matrixWorld),this.isCamera?hm.lookAt(xm,ym,this.up):hm.lookAt(ym,xm,this.up),this.quaternion.setFromRotationMatrix(hm),Sm&&(hm.extractRotation(Sm.matrixWorld),fm.setFromRotationMatrix(hm),this.quaternion.premultiply(fm.inverse()))}}(),add:function(fm){if(1<arguments.length){for(var hm=0;hm<arguments.length;hm++)this.add(arguments[hm]);return this}return fm===this?(console.error('THREE.Object3D.add: object can\'t be added as a child of itself.',fm),this):(fm&&fm.isObject3D?(null!==fm.parent&&fm.parent.remove(fm),fm.parent=this,fm.dispatchEvent({type:'added'}),this.children.push(fm)):console.error('THREE.Object3D.add: object not an instance of THREE.Object3D.',fm),this)},remove:function(fm){if(1<arguments.length){for(var hm=0;hm<arguments.length;hm++)this.remove(arguments[hm]);return this}var ym=this.children.indexOf(fm);return-1!==ym&&(fm.parent=null,fm.dispatchEvent({type:'removed'}),this.children.splice(ym,1)),this},getObjectById:function(fm){return this.getObjectByProperty('id',fm)},getObjectByName:function(fm){return this.getObjectByProperty('name',fm)},getObjectByProperty:function(fm,hm){if(this[fm]===hm)return this;for(var ym=0,xm=this.children.length;ym<xm;ym++){var vm=this.children[ym],_m=vm.getObjectByProperty(fm,hm);if(_m!==void 0)return _m}},getWorldPosition:function(fm){return void 0===fm&&(console.warn('THREE.Object3D: .getWorldPosition() target is now required'),fm=new A),this.updateMatrixWorld(!0),fm.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var fm=new A,hm=new A;return function(xm){return void 0===xm&&(console.warn('THREE.Object3D: .getWorldQuaternion() target is now required'),xm=new L),this.updateMatrixWorld(!0),this.matrixWorld.decompose(fm,xm,hm),xm}}(),getWorldScale:function(){var fm=new A,hm=new L;return function(xm){return void 0===xm&&(console.warn('THREE.Object3D: .getWorldScale() target is now required'),xm=new A),this.updateMatrixWorld(!0),this.matrixWorld.decompose(fm,hm,xm),xm}}(),getWorldDirection:function(fm){fm===void 0&&(console.warn('THREE.Object3D: .getWorldDirection() target is now required'),fm=new A),this.updateMatrixWorld(!0);var hm=this.matrixWorld.elements;return fm.set(hm[8],hm[9],hm[10]).normalize()},raycast:function(){},traverse:function(fm){fm(this);for(var hm=this.children,ym=0,xm=hm.length;ym<xm;ym++)hm[ym].traverse(fm)},traverseVisible:function(fm){if(!1!==this.visible){fm(this);for(var hm=this.children,ym=0,xm=hm.length;ym<xm;ym++)hm[ym].traverseVisible(fm)}},traverseAncestors:function(fm){var hm=this.parent;null!==hm&&(fm(hm),hm.traverseAncestors(fm))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(fm){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||fm)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,fm=!0);for(var hm=this.children,ym=0,xm=hm.length;ym<xm;ym++)hm[ym].updateMatrixWorld(fm)},updateWorldMatrix:function(fm,hm){var ym=this.parent;if(!0===fm&&null!==ym&&ym.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===hm)for(var xm=this.children,vm=0,_m=xm.length;vm<_m;vm++)xm[vm].updateWorldMatrix(!1,!0)},toJSON:function(fm){function hm(Rm,Im){return void 0===Rm[Im.uuid]&&(Rm[Im.uuid]=Im.toJSON(fm)),Im.uuid}function ym(Rm){var Im=[];for(var Dm in Rm){var zm=Rm[Dm];delete zm.metadata,Im.push(zm)}return Im}var xm=void 0===fm||'string'==typeof fm,vm={};xm&&(fm={geometries:{},materials:{},textures:{},images:{},shapes:{}},vm.metadata={version:4.5,type:'Object',generator:'Object3D.toJSON'});var _m={};if(_m.uuid=this.uuid,_m.type=this.type,''!==this.name&&(_m.name=this.name),!0===this.castShadow&&(_m.castShadow=!0),!0===this.receiveShadow&&(_m.receiveShadow=!0),!1===this.visible&&(_m.visible=!1),!1===this.frustumCulled&&(_m.frustumCulled=!1),0!==this.renderOrder&&(_m.renderOrder=this.renderOrder),'{}'!==JSON.stringify(this.userData)&&(_m.userData=this.userData),_m.layers=this.layers.mask,_m.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(_m.matrixAutoUpdate=!1),this.isMesh||this.isLine||this.isPoints){_m.geometry=hm(fm.geometries,this.geometry);var bm=this.geometry.parameters;if(void 0!==bm&&void 0!==bm.shapes){var Mm=bm.shapes;if(Array.isArray(Mm))for(var Sm=0,Tm=Mm.length,Em;Sm<Tm;Sm++)Em=Mm[Sm],hm(fm.shapes,Em);else hm(fm.shapes,Mm)}}if(void 0!==this.material)if(Array.isArray(this.material)){for(var wm=[],Sm=0,Tm=this.material.length;Sm<Tm;Sm++)wm.push(hm(fm.materials,this.material[Sm]));_m.material=wm}else _m.material=hm(fm.materials,this.material);if(0<this.children.length){_m.children=[];for(var Sm=0;Sm<this.children.length;Sm++)_m.children.push(this.children[Sm].toJSON(fm).object)}if(xm){var Lm=ym(fm.geometries),Am=ym(fm.materials),Pm=ym(fm.textures),Cm=ym(fm.images),Mm=ym(fm.shapes);0<Lm.length&&(vm.geometries=Lm),0<Am.length&&(vm.materials=Am),0<Pm.length&&(vm.textures=Pm),0<Cm.length&&(vm.images=Cm),0<Mm.length&&(vm.shapes=Mm)}return vm.object=_m,vm},clone:function(fm){return new this.constructor().copy(this,fm)},copy:function(fm,hm){if(void 0===hm&&(hm=!0),this.name=fm.name,this.up.copy(fm.up),this.position.copy(fm.position),this.quaternion.copy(fm.quaternion),this.scale.copy(fm.scale),this.matrix.copy(fm.matrix),this.matrixWorld.copy(fm.matrixWorld),this.matrixAutoUpdate=fm.matrixAutoUpdate,this.matrixWorldNeedsUpdate=fm.matrixWorldNeedsUpdate,this.layers.mask=fm.layers.mask,this.visible=fm.visible,this.castShadow=fm.castShadow,this.receiveShadow=fm.receiveShadow,this.frustumCulled=fm.frustumCulled,this.renderOrder=fm.renderOrder,this.userData=JSON.parse(JSON.stringify(fm.userData)),!0===hm)for(var ym=0,xm;ym<fm.children.length;ym++)xm=fm.children[ym],this.add(xm.clone());return this}});var Gc=0;ee.prototype=Object.assign(Object.create(M.prototype),{constructor:ee,isGeometry:!0,applyMatrix:function(fm){for(var hm=new C().getNormalMatrix(fm),ym=0,xm=this.vertices.length,vm;ym<xm;ym++)vm=this.vertices[ym],vm.applyMatrix4(fm);for(var ym=0,xm=this.faces.length,_m;ym<xm;ym++){_m=this.faces[ym],_m.normal.applyMatrix3(hm).normalize();for(var bm=0,Mm=_m.vertexNormals.length;bm<Mm;bm++)_m.vertexNormals[bm].applyMatrix3(hm).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var fm=new E;return function(ym){return fm.makeRotationX(ym),this.applyMatrix(fm),this}}(),rotateY:function(){var fm=new E;return function(ym){return fm.makeRotationY(ym),this.applyMatrix(fm),this}}(),rotateZ:function(){var fm=new E;return function(ym){return fm.makeRotationZ(ym),this.applyMatrix(fm),this}}(),translate:function(){var fm=new E;return function(ym,xm,vm){return fm.makeTranslation(ym,xm,vm),this.applyMatrix(fm),this}}(),scale:function(){var fm=new E;return function(ym,xm,vm){return fm.makeScale(ym,xm,vm),this.applyMatrix(fm),this}}(),lookAt:function(){var fm=new K;return function(ym){fm.lookAt(ym),fm.updateMatrix(),this.applyMatrix(fm.matrix)}}(),fromBufferGeometry:function(fm){function hm(Im,Dm,zm,Nm){var Bm=void 0===Mm?[]:[ym.colors[Im].clone(),ym.colors[Dm].clone(),ym.colors[zm].clone()],Um=void 0===bm?[]:[new A().fromArray(bm,3*Im),new A().fromArray(bm,3*Dm),new A().fromArray(bm,3*zm)],Gm=new Z(Im,Dm,zm,Um,Bm,Nm);ym.faces.push(Gm),void 0!==Sm&&ym.faceVertexUvs[0].push([new S().fromArray(Sm,2*Im),new S().fromArray(Sm,2*Dm),new S().fromArray(Sm,2*zm)]),void 0!==Tm&&ym.faceVertexUvs[1].push([new S().fromArray(Tm,2*Im),new S().fromArray(Tm,2*Dm),new S().fromArray(Tm,2*zm)])}var ym=this,xm=null===fm.index?void 0:fm.index.array,vm=fm.attributes,_m=vm.position.array,bm=void 0===vm.normal?void 0:vm.normal.array,Mm=void 0===vm.color?void 0:vm.color.array,Sm=void 0===vm.uv?void 0:vm.uv.array,Tm=void 0===vm.uv2?void 0:vm.uv2.array;void 0!==Tm&&(this.faceVertexUvs[1]=[]);for(var Em=0,wm=0;Em<_m.length;Em+=3,wm+=2)ym.vertices.push(new A().fromArray(_m,Em)),void 0!==Mm&&ym.colors.push(new W().fromArray(Mm,Em));var Lm=fm.groups;if(0<Lm.length)for(var Em=0;Em<Lm.length;Em++)for(var Am=Lm[Em],Pm=Am.start,Cm=Am.count,wm=Pm;wm<Pm+Cm;wm+=3)void 0===xm?hm(wm,wm+1,wm+2,Am.materialIndex):hm(xm[wm],xm[wm+1],xm[wm+2],Am.materialIndex);else if(void 0!==xm)for(var Em=0;Em<xm.length;Em+=3)hm(xm[Em],xm[Em+1],xm[Em+2]);else for(var Em=0;Em<_m.length/3;Em+=3)hm(Em,Em+1,Em+2);return this.computeFaceNormals(),null!==fm.boundingBox&&(this.boundingBox=fm.boundingBox.clone()),null!==fm.boundingSphere&&(this.boundingSphere=fm.boundingSphere.clone()),this},center:function(){var fm=new A;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(fm).negate(),this.translate(fm.x,fm.y,fm.z),this}}(),normalize:function(){this.computeBoundingSphere();var fm=this.boundingSphere.center,hm=this.boundingSphere.radius,ym=0===hm?1:1/hm,xm=new E;return xm.set(ym,0,0,-ym*fm.x,0,ym,0,-ym*fm.y,0,0,ym,-ym*fm.z,0,0,0,1),this.applyMatrix(xm),this},computeFaceNormals:function(){for(var fm=new A,hm=new A,ym=0,xm=this.faces.length;ym<xm;ym++){var vm=this.faces[ym],_m=this.vertices[vm.a],bm=this.vertices[vm.b],Mm=this.vertices[vm.c];fm.subVectors(Mm,bm),hm.subVectors(_m,bm),fm.cross(hm),fm.normalize(),vm.normal.copy(fm)}},computeVertexNormals:function(fm){fm===void 0&&(fm=!0);var hm,ym,xm,vm,_m,bm;for(bm=Array(this.vertices.length),hm=0,ym=this.vertices.length;hm<ym;hm++)bm[hm]=new A;if(fm){var Mm,Sm,Tm,Em=new A,wm=new A;for(xm=0,vm=this.faces.length;xm<vm;xm++)_m=this.faces[xm],Mm=this.vertices[_m.a],Sm=this.vertices[_m.b],Tm=this.vertices[_m.c],Em.subVectors(Tm,Sm),wm.subVectors(Mm,Sm),Em.cross(wm),bm[_m.a].add(Em),bm[_m.b].add(Em),bm[_m.c].add(Em)}else for(this.computeFaceNormals(),xm=0,vm=this.faces.length;xm<vm;xm++)_m=this.faces[xm],bm[_m.a].add(_m.normal),bm[_m.b].add(_m.normal),bm[_m.c].add(_m.normal);for(hm=0,ym=this.vertices.length;hm<ym;hm++)bm[hm].normalize();for(xm=0,vm=this.faces.length;xm<vm;xm++){_m=this.faces[xm];var Lm=_m.vertexNormals;3===Lm.length?(Lm[0].copy(bm[_m.a]),Lm[1].copy(bm[_m.b]),Lm[2].copy(bm[_m.c])):(Lm[0]=bm[_m.a].clone(),Lm[1]=bm[_m.b].clone(),Lm[2]=bm[_m.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var fm,hm,ym;for(this.computeFaceNormals(),fm=0,hm=this.faces.length;fm<hm;fm++){ym=this.faces[fm];var xm=ym.vertexNormals;3===xm.length?(xm[0].copy(ym.normal),xm[1].copy(ym.normal),xm[2].copy(ym.normal)):(xm[0]=ym.normal.clone(),xm[1]=ym.normal.clone(),xm[2]=ym.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var fm,hm,ym,xm,vm;for(ym=0,xm=this.faces.length;ym<xm;ym++)for(vm=this.faces[ym],vm.__originalFaceNormal?vm.__originalFaceNormal.copy(vm.normal):vm.__originalFaceNormal=vm.normal.clone(),vm.__originalVertexNormals||(vm.__originalVertexNormals=[]),(fm=0,hm=vm.vertexNormals.length);fm<hm;fm++)vm.__originalVertexNormals[fm]?vm.__originalVertexNormals[fm].copy(vm.vertexNormals[fm]):vm.__originalVertexNormals[fm]=vm.vertexNormals[fm].clone();var _m=new ee;for(_m.faces=this.faces,fm=0,hm=this.morphTargets.length;fm<hm;fm++){if(!this.morphNormals[fm]){this.morphNormals[fm]={},this.morphNormals[fm].faceNormals=[],this.morphNormals[fm].vertexNormals=[];var bm=this.morphNormals[fm].faceNormals,Mm=this.morphNormals[fm].vertexNormals,Sm,Tm;for(ym=0,xm=this.faces.length;ym<xm;ym++)Sm=new A,Tm={a:new A,b:new A,c:new A},bm.push(Sm),Mm.push(Tm)}var Em=this.morphNormals[fm];_m.vertices=this.morphTargets[fm].vertices,_m.computeFaceNormals(),_m.computeVertexNormals();var Sm,Tm;for(ym=0,xm=this.faces.length;ym<xm;ym++)vm=this.faces[ym],Sm=Em.faceNormals[ym],Tm=Em.vertexNormals[ym],Sm.copy(vm.normal),Tm.a.copy(vm.vertexNormals[0]),Tm.b.copy(vm.vertexNormals[1]),Tm.c.copy(vm.vertexNormals[2])}for(ym=0,xm=this.faces.length;ym<xm;ym++)vm=this.faces[ym],vm.normal=vm.__originalFaceNormal,vm.vertexNormals=vm.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new O),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new F),this.boundingSphere.setFromPoints(this.vertices)},merge:function(fm,hm,ym){if(!(fm&&fm.isGeometry))return void console.error('THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.',fm);var vm=this.vertices.length,_m=this.vertices,bm=fm.vertices,Mm=this.faces,Sm=fm.faces,Tm=this.faceVertexUvs[0],Em=fm.faceVertexUvs[0],wm=this.colors,Lm=fm.colors,xm;ym===void 0&&(ym=0),hm!==void 0&&(xm=new C().getNormalMatrix(hm));for(var Am=0,Pm=bm.length;Am<Pm;Am++){var Cm=bm[Am],Rm=Cm.clone();hm!==void 0&&Rm.applyMatrix4(hm),_m.push(Rm)}for(var Am=0,Pm=Lm.length;Am<Pm;Am++)wm.push(Lm[Am].clone());for(Am=0,Pm=Sm.length;Am<Pm;Am++){var Im=Sm[Am],Bm=Im.vertexNormals,Um=Im.vertexColors,Dm,zm,Nm;Dm=new Z(Im.a+vm,Im.b+vm,Im.c+vm),Dm.normal.copy(Im.normal),xm!=void 0&&Dm.normal.applyMatrix3(xm).normalize();for(var Gm=0,Om=Bm.length;Gm<Om;Gm++)zm=Bm[Gm].clone(),void 0!=xm&&zm.applyMatrix3(xm).normalize(),Dm.vertexNormals.push(zm);Dm.color.copy(Im.color);for(var Gm=0,Om=Um.length;Gm<Om;Gm++)Nm=Um[Gm],Dm.vertexColors.push(Nm.clone());Dm.materialIndex=Im.materialIndex+ym,Mm.push(Dm)}for(Am=0,Pm=Em.length;Am<Pm;Am++){var Fm=Em[Am],Hm=[];if(void 0!==Fm){for(var Gm=0,Om=Fm.length;Gm<Om;Gm++)Hm.push(Fm[Gm].clone());Tm.push(Hm)}}},mergeMesh:function(fm){return fm&&fm.isMesh?void(fm.matrixAutoUpdate&&fm.updateMatrix(),this.merge(fm.geometry,fm.matrix)):void console.error('THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.',fm)},mergeVertices:function(){var fm={},hm=[],ym=[],bm=Math.pow(10,4),xm,vm,Mm,Sm,Tm,Em,wm,Lm;for(Mm=0,Sm=this.vertices.length;Mm<Sm;Mm++)xm=this.vertices[Mm],vm=Math.round(xm.x*bm)+'_'+Math.round(xm.y*bm)+'_'+Math.round(xm.z*bm),void 0===fm[vm]?(fm[vm]=Mm,hm.push(this.vertices[Mm]),ym[Mm]=hm.length-1):ym[Mm]=ym[fm[vm]];var Am=[];for(Mm=0,Sm=this.faces.length;Mm<Sm;Mm++){Tm=this.faces[Mm],Tm.a=ym[Tm.a],Tm.b=ym[Tm.b],Tm.c=ym[Tm.c],Em=[Tm.a,Tm.b,Tm.c];for(var Pm=0;3>Pm;Pm++)if(Em[Pm]===Em[(Pm+1)%3]){Am.push(Mm);break}}for(Mm=Am.length-1;0<=Mm;Mm--){var Cm=Am[Mm];for(this.faces.splice(Cm,1),wm=0,Lm=this.faceVertexUvs.length;wm<Lm;wm++)this.faceVertexUvs[wm].splice(Cm,1)}var Rm=this.vertices.length-hm.length;return this.vertices=hm,Rm},setFromPoints:function(fm){this.vertices=[];for(var hm=0,ym=fm.length,xm;hm<ym;hm++)xm=fm[hm],this.vertices.push(new A(xm.x,xm.y,xm.z||0));return this},sortFacesByMaterialIndex:function(){for(var hm=this.faces,ym=hm.length,xm=0;xm<ym;xm++)hm[xm]._id=xm;hm.sort(function(Tm,Em){return Tm.materialIndex-Em.materialIndex});var vm=this.faceVertexUvs[0],_m=this.faceVertexUvs[1],bm,Mm;vm&&vm.length===ym&&(bm=[]),_m&&_m.length===ym&&(Mm=[]);for(var xm=0,Sm;xm<ym;xm++)Sm=hm[xm]._id,bm&&bm.push(vm[Sm]),Mm&&Mm.push(_m[Sm]);bm&&(this.faceVertexUvs[0]=bm),Mm&&(this.faceVertexUvs[1]=Mm)},toJSON:function(){function fm(Wm,jm,Xm){return Xm?Wm|1<<jm:Wm&~(1<<jm)}function hm(Wm){var jm=Wm.x.toString()+Wm.y.toString()+Wm.z.toString();return void 0===Lm[jm]?(Lm[jm]=wm.length/3,wm.push(Wm.x,Wm.y,Wm.z),Lm[jm]):Lm[jm]}function ym(Wm){var jm=Wm.r.toString()+Wm.g.toString()+Wm.b.toString();return void 0===Pm[jm]?(Pm[jm]=Am.length,Am.push(Wm.getHex()),Pm[jm]):Pm[jm]}function xm(Wm){var jm=Wm.x.toString()+Wm.y.toString();return void 0===Rm[jm]?(Rm[jm]=Cm.length/2,Cm.push(Wm.x,Wm.y),Rm[jm]):Rm[jm]}var vm={metadata:{version:4.5,type:'Geometry',generator:'Geometry.toJSON'}};if(vm.uuid=this.uuid,vm.type=this.type,''!==this.name&&(vm.name=this.name),void 0!==this.parameters){var _m=this.parameters;for(var bm in _m)void 0!==_m[bm]&&(vm[bm]=_m[bm]);return vm}for(var Mm=[],Sm=0,Tm;Sm<this.vertices.length;Sm++)Tm=this.vertices[Sm],Mm.push(Tm.x,Tm.y,Tm.z);for(var Em=[],wm=[],Lm={},Am=[],Pm={},Cm=[],Rm={},Sm=0;Sm<this.faces.length;Sm++){var Im=this.faces[Sm],Nm=void 0!==this.faceVertexUvs[0][Sm],Bm=0<Im.normal.length(),Um=0<Im.vertexNormals.length,Gm=1!==Im.color.r||1!==Im.color.g||1!==Im.color.b,Om=0<Im.vertexColors.length,Fm=0;if(Fm=fm(Fm,0,0),Fm=fm(Fm,1,!0),Fm=fm(Fm,2,!1),Fm=fm(Fm,3,Nm),Fm=fm(Fm,4,Bm),Fm=fm(Fm,5,Um),Fm=fm(Fm,6,Gm),Fm=fm(Fm,7,Om),Em.push(Fm),Em.push(Im.a,Im.b,Im.c),Em.push(Im.materialIndex),Nm){var Hm=this.faceVertexUvs[0][Sm];Em.push(xm(Hm[0]),xm(Hm[1]),xm(Hm[2]))}if(Bm&&Em.push(hm(Im.normal)),Um){var Vm=Im.vertexNormals;Em.push(hm(Vm[0]),hm(Vm[1]),hm(Vm[2]))}if(Gm&&Em.push(ym(Im.color)),Om){var km=Im.vertexColors;Em.push(ym(km[0]),ym(km[1]),ym(km[2]))}}return vm.data={},vm.data.vertices=Mm,vm.data.normals=wm,0<Am.length&&(vm.data.colors=Am),0<Cm.length&&(vm.data.uvs=[Cm]),vm.data.faces=Em,vm},clone:function(){return new ee().copy(this)},copy:function(fm){var hm,ym,xm,vm,_m,bm;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=fm.name;var Mm=fm.vertices;for(hm=0,ym=Mm.length;hm<ym;hm++)this.vertices.push(Mm[hm].clone());var Sm=fm.colors;for(hm=0,ym=Sm.length;hm<ym;hm++)this.colors.push(Sm[hm].clone());var Tm=fm.faces;for(hm=0,ym=Tm.length;hm<ym;hm++)this.faces.push(Tm[hm].clone());for(hm=0,ym=fm.faceVertexUvs.length;hm<ym;hm++){var Em=fm.faceVertexUvs[hm];for(void 0===this.faceVertexUvs[hm]&&(this.faceVertexUvs[hm]=[]),xm=0,vm=Em.length;xm<vm;xm++){var wm=Em[xm],Lm=[];for(_m=0,bm=wm.length;_m<bm;_m++){var Am=wm[_m];Lm.push(Am.clone())}this.faceVertexUvs[hm].push(Lm)}}var Pm=fm.morphTargets;for(hm=0,ym=Pm.length;hm<ym;hm++){var Cm={name:Pm[hm].name};if(void 0!==Pm[hm].vertices)for(Cm.vertices=[],xm=0,vm=Pm[hm].vertices.length;xm<vm;xm++)Cm.vertices.push(Pm[hm].vertices[xm].clone());if(void 0!==Pm[hm].normals)for(Cm.normals=[],xm=0,vm=Pm[hm].normals.length;xm<vm;xm++)Cm.normals.push(Pm[hm].normals[xm].clone());this.morphTargets.push(Cm)}var Rm=fm.morphNormals;for(hm=0,ym=Rm.length;hm<ym;hm++){var Im={};if(void 0!==Rm[hm].vertexNormals)for(Im.vertexNormals=[],xm=0,vm=Rm[hm].vertexNormals.length;xm<vm;xm++){var Dm=Rm[hm].vertexNormals[xm],zm={};zm.a=Dm.a.clone(),zm.b=Dm.b.clone(),zm.c=Dm.c.clone(),Im.vertexNormals.push(zm)}if(void 0!==Rm[hm].faceNormals)for(Im.faceNormals=[],xm=0,vm=Rm[hm].faceNormals.length;xm<vm;xm++)Im.faceNormals.push(Rm[hm].faceNormals[xm].clone());this.morphNormals.push(Im)}var Nm=fm.skinWeights;for(hm=0,ym=Nm.length;hm<ym;hm++)this.skinWeights.push(Nm[hm].clone());var Bm=fm.skinIndices;for(hm=0,ym=Bm.length;hm<ym;hm++)this.skinIndices.push(Bm[hm].clone());var Um=fm.lineDistances;for(hm=0,ym=Um.length;hm<ym;hm++)this.lineDistances.push(Um[hm]);var Gm=fm.boundingBox;null!==Gm&&(this.boundingBox=Gm.clone());var Om=fm.boundingSphere;return null!==Om&&(this.boundingSphere=Om.clone()),this.elementsNeedUpdate=fm.elementsNeedUpdate,this.verticesNeedUpdate=fm.verticesNeedUpdate,this.uvsNeedUpdate=fm.uvsNeedUpdate,this.normalsNeedUpdate=fm.normalsNeedUpdate,this.colorsNeedUpdate=fm.colorsNeedUpdate,this.lineDistancesNeedUpdate=fm.lineDistancesNeedUpdate,this.groupsNeedUpdate=fm.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:'dispose'})}}),Object.defineProperty(re.prototype,'needsUpdate',{set:function(fm){!0===fm&&this.version++}}),Object.assign(re.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(fm){if(Array.isArray(fm))throw new TypeError('THREE.BufferAttribute: array should be a Typed Array.');return this.count=void 0===fm?0:fm.length/this.itemSize,this.array=fm,this},setDynamic:function(fm){return this.dynamic=fm,this},copy:function(fm){return this.name=fm.name,this.array=new fm.array.constructor(fm.array),this.itemSize=fm.itemSize,this.count=fm.count,this.normalized=fm.normalized,this.dynamic=fm.dynamic,this},copyAt:function(fm,hm,ym){fm*=this.itemSize,ym*=hm.itemSize;for(var xm=0,vm=this.itemSize;xm<vm;xm++)this.array[fm+xm]=hm.array[ym+xm];return this},copyArray:function(fm){return this.array.set(fm),this},copyColorsArray:function(fm){for(var hm=this.array,ym=0,xm=0,vm=fm.length,_m;xm<vm;xm++)_m=fm[xm],void 0===_m&&(console.warn('THREE.BufferAttribute.copyColorsArray(): color is undefined',xm),_m=new W),hm[ym++]=_m.r,hm[ym++]=_m.g,hm[ym++]=_m.b;return this},copyVector2sArray:function(fm){for(var hm=this.array,ym=0,xm=0,vm=fm.length,_m;xm<vm;xm++)_m=fm[xm],void 0===_m&&(console.warn('THREE.BufferAttribute.copyVector2sArray(): vector is undefined',xm),_m=new S),hm[ym++]=_m.x,hm[ym++]=_m.y;return this},copyVector3sArray:function(fm){for(var hm=this.array,ym=0,xm=0,vm=fm.length,_m;xm<vm;xm++)_m=fm[xm],void 0===_m&&(console.warn('THREE.BufferAttribute.copyVector3sArray(): vector is undefined',xm),_m=new A),hm[ym++]=_m.x,hm[ym++]=_m.y,hm[ym++]=_m.z;return this},copyVector4sArray:function(fm){for(var hm=this.array,ym=0,xm=0,vm=fm.length,_m;xm<vm;xm++)_m=fm[xm],void 0===_m&&(console.warn('THREE.BufferAttribute.copyVector4sArray(): vector is undefined',xm),_m=new I),hm[ym++]=_m.x,hm[ym++]=_m.y,hm[ym++]=_m.z,hm[ym++]=_m.w;return this},set:function(fm,hm){return void 0===hm&&(hm=0),this.array.set(fm,hm),this},getX:function(fm){return this.array[fm*this.itemSize]},setX:function(fm,hm){return this.array[fm*this.itemSize]=hm,this},getY:function(fm){return this.array[fm*this.itemSize+1]},setY:function(fm,hm){return this.array[fm*this.itemSize+1]=hm,this},getZ:function(fm){return this.array[fm*this.itemSize+2]},setZ:function(fm,hm){return this.array[fm*this.itemSize+2]=hm,this},getW:function(fm){return this.array[fm*this.itemSize+3]},setW:function(fm,hm){return this.array[fm*this.itemSize+3]=hm,this},setXY:function(fm,hm,ym){return fm*=this.itemSize,this.array[fm+0]=hm,this.array[fm+1]=ym,this},setXYZ:function(fm,hm,ym,xm){return fm*=this.itemSize,this.array[fm+0]=hm,this.array[fm+1]=ym,this.array[fm+2]=xm,this},setXYZW:function(fm,hm,ym,xm,vm){return fm*=this.itemSize,this.array[fm+0]=hm,this.array[fm+1]=ym,this.array[fm+2]=xm,this.array[fm+3]=vm,this},onUpload:function(fm){return this.onUploadCallback=fm,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),oe.prototype=Object.create(re.prototype),oe.prototype.constructor=oe,ie.prototype=Object.create(re.prototype),ie.prototype.constructor=ie,ne.prototype=Object.create(re.prototype),ne.prototype.constructor=ne,se.prototype=Object.create(re.prototype),se.prototype.constructor=se,le.prototype=Object.create(re.prototype),le.prototype.constructor=le,pe.prototype=Object.create(re.prototype),pe.prototype.constructor=pe,ue.prototype=Object.create(re.prototype),ue.prototype.constructor=ue,ge.prototype=Object.create(re.prototype),ge.prototype.constructor=ge,fe.prototype=Object.create(re.prototype),fe.prototype.constructor=fe,Object.assign(he.prototype,{computeGroups:function(fm){for(var ym=[],xm=void 0,vm=fm.faces,_m=0,hm,bm;_m<vm.length;_m++)bm=vm[_m],bm.materialIndex!==xm&&(xm=bm.materialIndex,void 0!=hm&&(hm.count=3*_m-hm.start,ym.push(hm)),hm={start:3*_m,materialIndex:xm});hm!==void 0&&(hm.count=3*_m-hm.start,ym.push(hm)),this.groups=ym},fromGeometry:function(fm){var hm=fm.faces,ym=fm.vertices,xm=fm.faceVertexUvs,vm=xm[0]&&0<xm[0].length,_m=xm[1]&&0<xm[1].length,bm=fm.morphTargets,Mm=bm.length,Sm;if(0<Mm){Sm=[];for(var Tm=0;Tm<Mm;Tm++)Sm[Tm]={name:bm[Tm].name,data:[]};this.morphTargets.position=Sm}var Em=fm.morphNormals,wm=Em.length,Lm;if(0<wm){Lm=[];for(var Tm=0;Tm<wm;Tm++)Lm[Tm]={name:Em[Tm].name,data:[]};this.morphTargets.normal=Lm}var Am=fm.skinIndices,Pm=fm.skinWeights,Cm=Am.length===ym.length,Rm=Pm.length===ym.length;0<ym.length&&0===hm.length&&console.error('THREE.DirectGeometry: Faceless geometries are not supported.');for(var Tm=0,Im;Tm<hm.length;Tm++){Im=hm[Tm],this.vertices.push(ym[Im.a],ym[Im.b],ym[Im.c]);var Dm=Im.vertexNormals;if(3===Dm.length)this.normals.push(Dm[0],Dm[1],Dm[2]);else{var zm=Im.normal;this.normals.push(zm,zm,zm)}var Nm=Im.vertexColors;if(3===Nm.length)this.colors.push(Nm[0],Nm[1],Nm[2]);else{var Bm=Im.color;this.colors.push(Bm,Bm,Bm)}if(!0===vm){var Um=xm[0][Tm];void 0===Um?(console.warn('THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ',Tm),this.uvs.push(new S,new S,new S)):this.uvs.push(Um[0],Um[1],Um[2])}if(!0===_m){var Um=xm[1][Tm];void 0===Um?(console.warn('THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ',Tm),this.uvs2.push(new S,new S,new S)):this.uvs2.push(Um[0],Um[1],Um[2])}for(var Gm=0,Om;Gm<Mm;Gm++)Om=bm[Gm].vertices,Sm[Gm].data.push(Om[Im.a],Om[Im.b],Om[Im.c]);for(var Gm=0,Fm;Gm<wm;Gm++)Fm=Em[Gm].vertexNormals[Tm],Lm[Gm].data.push(Fm.a,Fm.b,Fm.c);Cm&&this.skinIndices.push(Am[Im.a],Am[Im.b],Am[Im.c]),Rm&&this.skinWeights.push(Pm[Im.a],Pm[Im.b],Pm[Im.c])}return this.computeGroups(fm),this.verticesNeedUpdate=fm.verticesNeedUpdate,this.normalsNeedUpdate=fm.normalsNeedUpdate,this.colorsNeedUpdate=fm.colorsNeedUpdate,this.uvsNeedUpdate=fm.uvsNeedUpdate,this.groupsNeedUpdate=fm.groupsNeedUpdate,this}});var Oc=1;xe.prototype=Object.assign(Object.create(M.prototype),{constructor:xe,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(fm){this.index=Array.isArray(fm)?new(65535<ye(fm)?ue:le)(fm,1):fm},addAttribute:function(fm,hm){return hm&&hm.isBufferAttribute||hm&&hm.isInterleavedBufferAttribute?'index'===fm?(console.warn('THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.'),this.setIndex(hm),this):(this.attributes[fm]=hm,this):(console.warn('THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).'),this.addAttribute(fm,new re(arguments[1],arguments[2])))},getAttribute:function(fm){return this.attributes[fm]},removeAttribute:function(fm){return delete this.attributes[fm],this},addGroup:function(fm,hm,ym){this.groups.push({start:fm,count:hm,materialIndex:ym===void 0?0:ym})},clearGroups:function(){this.groups=[]},setDrawRange:function(fm,hm){this.drawRange.start=fm,this.drawRange.count=hm},applyMatrix:function(fm){var hm=this.attributes.position;void 0!==hm&&(fm.applyToBufferAttribute(hm),hm.needsUpdate=!0);var ym=this.attributes.normal;if(void 0!==ym){var xm=new C().getNormalMatrix(fm);xm.applyToBufferAttribute(ym),ym.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var fm=new E;return function(ym){return fm.makeRotationX(ym),this.applyMatrix(fm),this}}(),rotateY:function(){var fm=new E;return function(ym){return fm.makeRotationY(ym),this.applyMatrix(fm),this}}(),rotateZ:function(){var fm=new E;return function(ym){return fm.makeRotationZ(ym),this.applyMatrix(fm),this}}(),translate:function(){var fm=new E;return function(ym,xm,vm){return fm.makeTranslation(ym,xm,vm),this.applyMatrix(fm),this}}(),scale:function(){var fm=new E;return function(ym,xm,vm){return fm.makeScale(ym,xm,vm),this.applyMatrix(fm),this}}(),lookAt:function(){var fm=new K;return function(ym){fm.lookAt(ym),fm.updateMatrix(),this.applyMatrix(fm.matrix)}}(),center:function(){var fm=new A;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(fm).negate(),this.translate(fm.x,fm.y,fm.z),this}}(),setFromObject:function(fm){var hm=fm.geometry;if(fm.isPoints||fm.isLine){var ym=new ge(3*hm.vertices.length,3),xm=new ge(3*hm.colors.length,3);if(this.addAttribute('position',ym.copyVector3sArray(hm.vertices)),this.addAttribute('color',xm.copyColorsArray(hm.colors)),hm.lineDistances&&hm.lineDistances.length===hm.vertices.length){var vm=new ge(hm.lineDistances.length,1);this.addAttribute('lineDistance',vm.copyArray(hm.lineDistances))}null!==hm.boundingSphere&&(this.boundingSphere=hm.boundingSphere.clone()),null!==hm.boundingBox&&(this.boundingBox=hm.boundingBox.clone())}else fm.isMesh&&hm&&hm.isGeometry&&this.fromGeometry(hm);return this},setFromPoints:function(fm){for(var hm=[],ym=0,xm=fm.length,vm;ym<xm;ym++)vm=fm[ym],hm.push(vm.x,vm.y,vm.z||0);return this.addAttribute('position',new ge(hm,3)),this},updateFromObject:function(fm){var hm=fm.geometry;if(fm.isMesh){var ym=hm.__directGeometry;if(!0===hm.elementsNeedUpdate&&(ym=void 0,hm.elementsNeedUpdate=!1),void 0===ym)return this.fromGeometry(hm);ym.verticesNeedUpdate=hm.verticesNeedUpdate,ym.normalsNeedUpdate=hm.normalsNeedUpdate,ym.colorsNeedUpdate=hm.colorsNeedUpdate,ym.uvsNeedUpdate=hm.uvsNeedUpdate,ym.groupsNeedUpdate=hm.groupsNeedUpdate,hm.verticesNeedUpdate=!1,hm.normalsNeedUpdate=!1,hm.colorsNeedUpdate=!1,hm.uvsNeedUpdate=!1,hm.groupsNeedUpdate=!1,hm=ym}var xm;return!0===hm.verticesNeedUpdate&&(xm=this.attributes.position,void 0!=xm&&(xm.copyVector3sArray(hm.vertices),xm.needsUpdate=!0),hm.verticesNeedUpdate=!1),!0===hm.normalsNeedUpdate&&(xm=this.attributes.normal,void 0!=xm&&(xm.copyVector3sArray(hm.normals),xm.needsUpdate=!0),hm.normalsNeedUpdate=!1),!0===hm.colorsNeedUpdate&&(xm=this.attributes.color,void 0!=xm&&(xm.copyColorsArray(hm.colors),xm.needsUpdate=!0),hm.colorsNeedUpdate=!1),hm.uvsNeedUpdate&&(xm=this.attributes.uv,void 0!=xm&&(xm.copyVector2sArray(hm.uvs),xm.needsUpdate=!0),hm.uvsNeedUpdate=!1),hm.lineDistancesNeedUpdate&&(xm=this.attributes.lineDistance,void 0!=xm&&(xm.copyArray(hm.lineDistances),xm.needsUpdate=!0),hm.lineDistancesNeedUpdate=!1),hm.groupsNeedUpdate&&(hm.computeGroups(fm.geometry),this.groups=hm.groups,hm.groupsNeedUpdate=!1),this},fromGeometry:function(fm){return fm.__directGeometry=new he().fromGeometry(fm),this.fromDirectGeometry(fm.__directGeometry)},fromDirectGeometry:function(fm){var hm=new Float32Array(3*fm.vertices.length);if(this.addAttribute('position',new re(hm,3).copyVector3sArray(fm.vertices)),0<fm.normals.length){var ym=new Float32Array(3*fm.normals.length);this.addAttribute('normal',new re(ym,3).copyVector3sArray(fm.normals))}if(0<fm.colors.length){var xm=new Float32Array(3*fm.colors.length);this.addAttribute('color',new re(xm,3).copyColorsArray(fm.colors))}if(0<fm.uvs.length){var vm=new Float32Array(2*fm.uvs.length);this.addAttribute('uv',new re(vm,2).copyVector2sArray(fm.uvs))}if(0<fm.uvs2.length){var _m=new Float32Array(2*fm.uvs2.length);this.addAttribute('uv2',new re(_m,2).copyVector2sArray(fm.uvs2))}for(var bm in this.groups=fm.groups,fm.morphTargets){for(var Mm=[],Sm=fm.morphTargets[bm],Tm=0,Em=Sm.length;Tm<Em;Tm++){var wm=Sm[Tm],Lm=new ge(3*wm.data.length,3);Lm.name=wm.name,Mm.push(Lm.copyVector3sArray(wm.data))}this.morphAttributes[bm]=Mm}if(0<fm.skinIndices.length){var Am=new ge(4*fm.skinIndices.length,4);this.addAttribute('skinIndex',Am.copyVector4sArray(fm.skinIndices))}if(0<fm.skinWeights.length){var Pm=new ge(4*fm.skinWeights.length,4);this.addAttribute('skinWeight',Pm.copyVector4sArray(fm.skinWeights))}return null!==fm.boundingSphere&&(this.boundingSphere=fm.boundingSphere.clone()),null!==fm.boundingBox&&(this.boundingBox=fm.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new O);var fm=this.attributes.position;fm===void 0?this.boundingBox.makeEmpty():this.boundingBox.setFromBufferAttribute(fm),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var fm=new O,hm=new A;return function(){null===this.boundingSphere&&(this.boundingSphere=new F);var xm=this.attributes.position;if(xm){var vm=this.boundingSphere.center;fm.setFromBufferAttribute(xm),fm.getCenter(vm);for(var _m=0,bm=0,Mm=xm.count;bm<Mm;bm++)hm.x=xm.getX(bm),hm.y=xm.getY(bm),hm.z=xm.getZ(bm),_m=Math.max(_m,vm.distanceToSquared(hm));this.boundingSphere.radius=Math.sqrt(_m),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var fm=this.index,hm=this.attributes;if(hm.position){var ym=hm.position.array;if(hm.normal===void 0)this.addAttribute('normal',new re(new Float32Array(ym.length),3));else for(var xm=hm.normal.array,vm=0,_m=xm.length;vm<_m;vm++)xm[vm]=0;var bm=hm.normal.array,Mm,Sm,Tm,Em=new A,wm=new A,Lm=new A,Am=new A,Pm=new A;if(fm)for(var Cm=fm.array,vm=0,_m=fm.count;vm<_m;vm+=3)Mm=3*Cm[vm+0],Sm=3*Cm[vm+1],Tm=3*Cm[vm+2],Em.fromArray(ym,Mm),wm.fromArray(ym,Sm),Lm.fromArray(ym,Tm),Am.subVectors(Lm,wm),Pm.subVectors(Em,wm),Am.cross(Pm),bm[Mm]+=Am.x,bm[Mm+1]+=Am.y,bm[Mm+2]+=Am.z,bm[Sm]+=Am.x,bm[Sm+1]+=Am.y,bm[Sm+2]+=Am.z,bm[Tm]+=Am.x,bm[Tm+1]+=Am.y,bm[Tm+2]+=Am.z;else for(var vm=0,_m=ym.length;vm<_m;vm+=9)Em.fromArray(ym,vm),wm.fromArray(ym,vm+3),Lm.fromArray(ym,vm+6),Am.subVectors(Lm,wm),Pm.subVectors(Em,wm),Am.cross(Pm),bm[vm]=Am.x,bm[vm+1]=Am.y,bm[vm+2]=Am.z,bm[vm+3]=Am.x,bm[vm+4]=Am.y,bm[vm+5]=Am.z,bm[vm+6]=Am.x,bm[vm+7]=Am.y,bm[vm+8]=Am.z;this.normalizeNormals(),hm.normal.needsUpdate=!0}},merge:function(fm,hm){if(!(fm&&fm.isBufferGeometry))return void console.error('THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.',fm);hm===void 0&&(hm=0,console.warn('THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge.'));var ym=this.attributes;for(var xm in ym)if(fm.attributes[xm]!==void 0)for(var vm=ym[xm],_m=vm.array,bm=fm.attributes[xm],Mm=bm.array,Sm=bm.itemSize,Tm=0,Em=Sm*hm;Tm<Mm.length;Tm++,Em++)_m[Em]=Mm[Tm];return this},normalizeNormals:function(){var fm=new A;return function(){for(var ym=this.attributes.normal,xm=0,vm=ym.count;xm<vm;xm++)fm.x=ym.getX(xm),fm.y=ym.getY(xm),fm.z=ym.getZ(xm),fm.normalize(),ym.setXYZ(xm,fm.x,fm.y,fm.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn('THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed.'),this;var fm=new xe,hm=this.index.array,ym=this.attributes;for(var xm in ym){for(var vm=ym[xm],_m=vm.array,bm=vm.itemSize,Mm=new _m.constructor(hm.length*bm),Sm=0,Tm=0,Em=0,wm=hm.length;Em<wm;Em++){Sm=hm[Em]*bm;for(var Lm=0;Lm<bm;Lm++)Mm[Tm++]=_m[Sm++]}fm.addAttribute(xm,new re(Mm,bm))}for(var Am=this.groups,Em=0,wm=Am.length,Pm;Em<wm;Em++)Pm=Am[Em],fm.addGroup(Pm.start,Pm.count,Pm.materialIndex);return fm},toJSON:function(){var fm={metadata:{version:4.5,type:'BufferGeometry',generator:'BufferGeometry.toJSON'}};if(fm.uuid=this.uuid,fm.type=this.type,''!==this.name&&(fm.name=this.name),0<Object.keys(this.userData).length&&(fm.userData=this.userData),void 0!==this.parameters){var hm=this.parameters;for(var ym in hm)void 0!==hm[ym]&&(fm[ym]=hm[ym]);return fm}fm.data={attributes:{}};var xm=this.index;if(null!==xm){var vm=Array.prototype.slice.call(xm.array);fm.data.index={type:xm.array.constructor.name,array:vm}}var _m=this.attributes;for(var ym in _m){var bm=_m[ym],vm=Array.prototype.slice.call(bm.array);fm.data.attributes[ym]={itemSize:bm.itemSize,type:bm.array.constructor.name,array:vm,normalized:bm.normalized}}var Mm=this.groups;0<Mm.length&&(fm.data.groups=JSON.parse(JSON.stringify(Mm)));var Sm=this.boundingSphere;return null!==Sm&&(fm.data.boundingSphere={center:Sm.center.toArray(),radius:Sm.radius}),fm},clone:function(){return new xe().copy(this)},copy:function(fm){var hm,ym,xm;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=fm.name;var vm=fm.index;null!==vm&&this.setIndex(vm.clone());var _m=fm.attributes;for(hm in _m){var bm=_m[hm];this.addAttribute(hm,bm.clone())}var Mm=fm.morphAttributes;for(hm in Mm){var Sm=[],Tm=Mm[hm];for(ym=0,xm=Tm.length;ym<xm;ym++)Sm.push(Tm[ym].clone());this.morphAttributes[hm]=Sm}var Em=fm.groups;for(ym=0,xm=Em.length;ym<xm;ym++){var wm=Em[ym];this.addGroup(wm.start,wm.count,wm.materialIndex)}var Lm=fm.boundingBox;null!==Lm&&(this.boundingBox=Lm.clone());var Am=fm.boundingSphere;return null!==Am&&(this.boundingSphere=Am.clone()),this.drawRange.start=fm.drawRange.start,this.drawRange.count=fm.drawRange.count,this.userData=fm.userData,this},dispose:function(){this.dispatchEvent({type:'dispose'})}}),ve.prototype=Object.create(ee.prototype),ve.prototype.constructor=ve,_e.prototype=Object.create(xe.prototype),_e.prototype.constructor=_e,Me.prototype=Object.create(ee.prototype),Me.prototype.constructor=Me,Se.prototype=Object.create(xe.prototype),Se.prototype.constructor=Se;var Fc=0;Te.prototype=Object.assign(Object.create(M.prototype),{constructor:Te,isMaterial:!0,onBeforeCompile:function(){},setValues:function(fm){if(void 0!==fm)for(var hm in fm){var ym=fm[hm];if(void 0===ym){console.warn('THREE.Material: \''+hm+'\' parameter is undefined.');continue}if('shading'==hm){console.warn('THREE.'+this.type+': .shading has been removed. Use the boolean .flatShading instead.'),this.flatShading=ym===In;continue}var xm=this[hm];if(void 0===xm){console.warn('THREE.'+this.type+': \''+hm+'\' is not a property of this material.');continue}xm&&xm.isColor?xm.set(ym):xm&&xm.isVector3&&ym&&ym.isVector3?xm.copy(ym):this[hm]=ym}},toJSON:function(fm){function hm(bm){var Mm=[];for(var Sm in bm){var Tm=bm[Sm];delete Tm.metadata,Mm.push(Tm)}return Mm}var ym=void 0===fm||'string'==typeof fm;ym&&(fm={textures:{},images:{}});var xm={metadata:{version:4.5,type:'Material',generator:'Material.toJSON'}};if(xm.uuid=this.uuid,xm.type=this.type,''!==this.name&&(xm.name=this.name),this.color&&this.color.isColor&&(xm.color=this.color.getHex()),void 0!==this.roughness&&(xm.roughness=this.roughness),void 0!==this.metalness&&(xm.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(xm.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(xm.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(xm.specular=this.specular.getHex()),void 0!==this.shininess&&(xm.shininess=this.shininess),void 0!==this.clearCoat&&(xm.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(xm.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(xm.map=this.map.toJSON(fm).uuid),this.alphaMap&&this.alphaMap.isTexture&&(xm.alphaMap=this.alphaMap.toJSON(fm).uuid),this.lightMap&&this.lightMap.isTexture&&(xm.lightMap=this.lightMap.toJSON(fm).uuid),this.aoMap&&this.aoMap.isTexture&&(xm.aoMap=this.aoMap.toJSON(fm).uuid,xm.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(xm.bumpMap=this.bumpMap.toJSON(fm).uuid,xm.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(xm.normalMap=this.normalMap.toJSON(fm).uuid,xm.normalMapType=this.normalMapType,xm.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(xm.displacementMap=this.displacementMap.toJSON(fm).uuid,xm.displacementScale=this.displacementScale,xm.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(xm.roughnessMap=this.roughnessMap.toJSON(fm).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(xm.metalnessMap=this.metalnessMap.toJSON(fm).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(xm.emissiveMap=this.emissiveMap.toJSON(fm).uuid),this.specularMap&&this.specularMap.isTexture&&(xm.specularMap=this.specularMap.toJSON(fm).uuid),this.envMap&&this.envMap.isTexture&&(xm.envMap=this.envMap.toJSON(fm).uuid,xm.reflectivity=this.reflectivity,void 0!==this.combine&&(xm.combine=this.combine),void 0!==this.envMapIntensity&&(xm.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(xm.gradientMap=this.gradientMap.toJSON(fm).uuid),void 0!==this.size&&(xm.size=this.size),void 0!==this.sizeAttenuation&&(xm.sizeAttenuation=this.sizeAttenuation),this.blending!==Un&&(xm.blending=this.blending),!0===this.flatShading&&(xm.flatShading=this.flatShading),this.side!==Pn&&(xm.side=this.side),this.vertexColors!==Dn&&(xm.vertexColors=this.vertexColors),1>this.opacity&&(xm.opacity=this.opacity),!0===this.transparent&&(xm.transparent=this.transparent),xm.depthFunc=this.depthFunc,xm.depthTest=this.depthTest,xm.depthWrite=this.depthWrite,0!==this.rotation&&(xm.rotation=this.rotation),!0===this.polygonOffset&&(xm.polygonOffset=!0),0!==this.polygonOffsetFactor&&(xm.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(xm.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(xm.linewidth=this.linewidth),void 0!==this.dashSize&&(xm.dashSize=this.dashSize),void 0!==this.gapSize&&(xm.gapSize=this.gapSize),void 0!==this.scale&&(xm.scale=this.scale),!0===this.dithering&&(xm.dithering=!0),0<this.alphaTest&&(xm.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(xm.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(xm.wireframe=this.wireframe),1<this.wireframeLinewidth&&(xm.wireframeLinewidth=this.wireframeLinewidth),'round'!==this.wireframeLinecap&&(xm.wireframeLinecap=this.wireframeLinecap),'round'!==this.wireframeLinejoin&&(xm.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(xm.morphTargets=!0),!0===this.skinning&&(xm.skinning=!0),!1===this.visible&&(xm.visible=!1),'{}'!==JSON.stringify(this.userData)&&(xm.userData=this.userData),ym){var vm=hm(fm.textures),_m=hm(fm.images);0<vm.length&&(xm.textures=vm),0<_m.length&&(xm.images=_m)}return xm},clone:function(){return new this.constructor().copy(this)},copy:function(fm){this.name=fm.name,this.fog=fm.fog,this.lights=fm.lights,this.blending=fm.blending,this.side=fm.side,this.flatShading=fm.flatShading,this.vertexColors=fm.vertexColors,this.opacity=fm.opacity,this.transparent=fm.transparent,this.blendSrc=fm.blendSrc,this.blendDst=fm.blendDst,this.blendEquation=fm.blendEquation,this.blendSrcAlpha=fm.blendSrcAlpha,this.blendDstAlpha=fm.blendDstAlpha,this.blendEquationAlpha=fm.blendEquationAlpha,this.depthFunc=fm.depthFunc,this.depthTest=fm.depthTest,this.depthWrite=fm.depthWrite,this.colorWrite=fm.colorWrite,this.precision=fm.precision,this.polygonOffset=fm.polygonOffset,this.polygonOffsetFactor=fm.polygonOffsetFactor,this.polygonOffsetUnits=fm.polygonOffsetUnits,this.dithering=fm.dithering,this.alphaTest=fm.alphaTest,this.premultipliedAlpha=fm.premultipliedAlpha,this.visible=fm.visible,this.userData=JSON.parse(JSON.stringify(fm.userData)),this.clipShadows=fm.clipShadows,this.clipIntersection=fm.clipIntersection;var hm=fm.clippingPlanes,ym=null;if(null!==hm){var xm=hm.length;ym=Array(xm);for(var vm=0;vm!==xm;++vm)ym[vm]=hm[vm].clone()}return this.clippingPlanes=ym,this.shadowSide=fm.shadowSide,this},dispose:function(){this.dispatchEvent({type:'dispose'})}}),Ee.prototype=Object.create(Te.prototype),Ee.prototype.constructor=Ee,Ee.prototype.isShaderMaterial=!0,Ee.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.fragmentShader=fm.fragmentShader,this.vertexShader=fm.vertexShader,this.uniforms=Dc.clone(fm.uniforms),this.defines=Object.assign({},fm.defines),this.wireframe=fm.wireframe,this.wireframeLinewidth=fm.wireframeLinewidth,this.lights=fm.lights,this.clipping=fm.clipping,this.skinning=fm.skinning,this.morphTargets=fm.morphTargets,this.morphNormals=fm.morphNormals,this.extensions=fm.extensions,this},Ee.prototype.toJSON=function(fm){var hm=Te.prototype.toJSON.call(this,fm);for(var ym in hm.uniforms={},this.uniforms){var xm=this.uniforms[ym],vm=xm.value;hm.uniforms[ym]=vm.isTexture?{type:'t',value:vm.toJSON(fm).uuid}:vm.isColor?{type:'c',value:vm.getHex()}:vm.isVector2?{type:'v2',value:vm.toArray()}:vm.isVector3?{type:'v3',value:vm.toArray()}:vm.isVector4?{type:'v4',value:vm.toArray()}:vm.isMatrix4?{type:'m4',value:vm.toArray()}:{value:vm}}return 0<Object.keys(this.defines).length&&(hm.defines=this.defines),hm.vertexShader=this.vertexShader,hm.fragmentShader=this.fragmentShader,hm},Object.assign(we.prototype,{set:function(fm,hm){return this.origin.copy(fm),this.direction.copy(hm),this},clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.origin.copy(fm.origin),this.direction.copy(fm.direction),this},at:function(fm,hm){return void 0===hm&&(console.warn('THREE.Ray: .at() target is now required'),hm=new A),hm.copy(this.direction).multiplyScalar(fm).add(this.origin)},lookAt:function(fm){return this.direction.copy(fm).sub(this.origin).normalize(),this},recast:function(){var fm=new A;return function(ym){return this.origin.copy(this.at(ym,fm)),this}}(),closestPointToPoint:function(fm,hm){hm===void 0&&(console.warn('THREE.Ray: .closestPointToPoint() target is now required'),hm=new A),hm.subVectors(fm,this.origin);var ym=hm.dot(this.direction);return 0>ym?hm.copy(this.origin):hm.copy(this.direction).multiplyScalar(ym).add(this.origin)},distanceToPoint:function(fm){return Math.sqrt(this.distanceSqToPoint(fm))},distanceSqToPoint:function(){var fm=new A;return function(ym){var xm=fm.subVectors(ym,this.origin).dot(this.direction);return 0>xm?this.origin.distanceToSquared(ym):(fm.copy(this.direction).multiplyScalar(xm).add(this.origin),fm.distanceToSquared(ym))}}(),distanceSqToSegment:function(){var fm=new A,hm=new A,ym=new A;return function(vm,_m,bm,Mm){fm.copy(vm).add(_m).multiplyScalar(0.5),hm.copy(_m).sub(vm).normalize(),ym.copy(this.origin).sub(fm);var Sm=0.5*vm.distanceTo(_m),Tm=-this.direction.dot(hm),Em=ym.dot(this.direction),wm=-ym.dot(hm),Lm=ym.lengthSq(),Am=Math.abs(1-Tm*Tm),Pm,Cm,Rm,Im;if(!(0<Am))Cm=0<Tm?-Sm:Sm,Pm=Math.max(0,-(Tm*Cm+Em)),Rm=-Pm*Pm+Cm*(Cm+2*wm)+Lm;else if(Pm=Tm*wm-Em,Cm=Tm*Em-wm,Im=Sm*Am,!(0<=Pm))Cm<=-Im?(Pm=Math.max(0,-(-Tm*Sm+Em)),Cm=0<Pm?-Sm:Math.min(Math.max(-Sm,-wm),Sm),Rm=-Pm*Pm+Cm*(Cm+2*wm)+Lm):Cm<=Im?(Pm=0,Cm=Math.min(Math.max(-Sm,-wm),Sm),Rm=Cm*(Cm+2*wm)+Lm):(Pm=Math.max(0,-(Tm*Sm+Em)),Cm=0<Pm?Sm:Math.min(Math.max(-Sm,-wm),Sm),Rm=-Pm*Pm+Cm*(Cm+2*wm)+Lm);else if(!(Cm>=-Im))Cm=-Sm,Pm=Math.max(0,-(Tm*Cm+Em)),Rm=-Pm*Pm+Cm*(Cm+2*wm)+Lm;else if(Cm<=Im){var Dm=1/Am;Pm*=Dm,Cm*=Dm,Rm=Pm*(Pm+Tm*Cm+2*Em)+Cm*(Tm*Pm+Cm+2*wm)+Lm}else Cm=Sm,Pm=Math.max(0,-(Tm*Cm+Em)),Rm=-Pm*Pm+Cm*(Cm+2*wm)+Lm;return bm&&bm.copy(this.direction).multiplyScalar(Pm).add(this.origin),Mm&&Mm.copy(hm).multiplyScalar(Cm).add(fm),Rm}}(),intersectSphere:function(){var fm=new A;return function(ym,xm){fm.subVectors(ym.center,this.origin);var vm=fm.dot(this.direction),_m=fm.dot(fm)-vm*vm,bm=ym.radius*ym.radius;if(_m>bm)return null;var Mm=Math.sqrt(bm-_m),Sm=vm-Mm,Tm=vm+Mm;return 0>Sm&&0>Tm?null:0>Sm?this.at(Tm,xm):this.at(Sm,xm)}}(),intersectsSphere:function(fm){return this.distanceSqToPoint(fm.center)<=fm.radius*fm.radius},distanceToPlane:function(fm){var hm=fm.normal.dot(this.direction);if(0===hm)return 0===fm.distanceToPoint(this.origin)?0:null;var ym=-(this.origin.dot(fm.normal)+fm.constant)/hm;return 0<=ym?ym:null},intersectPlane:function(fm,hm){var ym=this.distanceToPlane(fm);return null===ym?null:this.at(ym,hm)},intersectsPlane:function(fm){var hm=fm.distanceToPoint(this.origin);if(0===hm)return!0;var ym=fm.normal.dot(this.direction);return!!(0>ym*hm)},intersectBox:function(fm,hm){var Sm=1/this.direction.x,Tm=1/this.direction.y,Em=1/this.direction.z,wm=this.origin,ym,xm,vm,_m,bm,Mm;return(0<=Sm?(ym=(fm.min.x-wm.x)*Sm,xm=(fm.max.x-wm.x)*Sm):(ym=(fm.max.x-wm.x)*Sm,xm=(fm.min.x-wm.x)*Sm),0<=Tm?(vm=(fm.min.y-wm.y)*Tm,_m=(fm.max.y-wm.y)*Tm):(vm=(fm.max.y-wm.y)*Tm,_m=(fm.min.y-wm.y)*Tm),ym>_m||vm>xm)?null:((vm>ym||ym!=ym)&&(ym=vm),(_m<xm||xm!=xm)&&(xm=_m),0<=Em?(bm=(fm.min.z-wm.z)*Em,Mm=(fm.max.z-wm.z)*Em):(bm=(fm.max.z-wm.z)*Em,Mm=(fm.min.z-wm.z)*Em),ym>Mm||bm>xm)?null:((bm>ym||ym!=ym)&&(ym=bm),(Mm<xm||xm!=xm)&&(xm=Mm),0>xm?null:this.at(0<=ym?ym:xm,hm))},intersectsBox:function(){var fm=new A;return function(ym){return null!==this.intersectBox(ym,fm)}}(),intersectTriangle:function(){var fm=new A,hm=new A,ym=new A,xm=new A;return function(_m,bm,Mm,Sm,Tm){hm.subVectors(bm,_m),ym.subVectors(Mm,_m),xm.crossVectors(hm,ym);var Em=this.direction.dot(xm),wm;if(0<Em){if(Sm)return null;wm=1}else if(0>Em)wm=-1,Em=-Em;else return null;fm.subVectors(this.origin,_m);var Lm=wm*this.direction.dot(ym.crossVectors(fm,ym));if(0>Lm)return null;var Am=wm*this.direction.dot(hm.cross(fm));if(0>Am)return null;if(Lm+Am>Em)return null;var Pm=-wm*fm.dot(xm);return 0>Pm?null:this.at(Pm/Em,Tm)}}(),applyMatrix4:function(fm){return this.origin.applyMatrix4(fm),this.direction.transformDirection(fm),this},equals:function(fm){return fm.origin.equals(this.origin)&&fm.direction.equals(this.direction)}}),Object.assign(Le,{getNormal:function(){var fm=new A;return function(ym,xm,vm,_m){_m===void 0&&(console.warn('THREE.Triangle: .getNormal() target is now required'),_m=new A),_m.subVectors(vm,xm),fm.subVectors(ym,xm),_m.cross(fm);var bm=_m.lengthSq();return 0<bm?_m.multiplyScalar(1/Math.sqrt(bm)):_m.set(0,0,0)}}(),getBarycoord:function(){var fm=new A,hm=new A,ym=new A;return function(vm,_m,bm,Mm,Sm){fm.subVectors(Mm,_m),hm.subVectors(bm,_m),ym.subVectors(vm,_m);var Tm=fm.dot(fm),Em=fm.dot(hm),wm=fm.dot(ym),Lm=hm.dot(hm),Am=hm.dot(ym),Pm=Tm*Lm-Em*Em;if(void 0===Sm&&(console.warn('THREE.Triangle: .getBarycoord() target is now required'),Sm=new A),0==Pm)return Sm.set(-2,-1,-1);var Cm=1/Pm,Rm=(Lm*wm-Em*Am)*Cm,Im=(Tm*Am-Em*wm)*Cm;return Sm.set(1-Rm-Im,Im,Rm)}}(),containsPoint:function(){var fm=new A;return function(ym,xm,vm,_m){return Le.getBarycoord(ym,xm,vm,_m,fm),0<=fm.x&&0<=fm.y&&1>=fm.x+fm.y}}(),getUV:function(){var fm=new A;return function(ym,xm,vm,_m,bm,Mm,Sm,Tm){return this.getBarycoord(ym,xm,vm,_m,fm),Tm.set(0,0),Tm.addScaledVector(bm,fm.x),Tm.addScaledVector(Mm,fm.y),Tm.addScaledVector(Sm,fm.z),Tm}}()}),Object.assign(Le.prototype,{set:function(fm,hm,ym){return this.a.copy(fm),this.b.copy(hm),this.c.copy(ym),this},setFromPointsAndIndices:function(fm,hm,ym,xm){return this.a.copy(fm[hm]),this.b.copy(fm[ym]),this.c.copy(fm[xm]),this},clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.a.copy(fm.a),this.b.copy(fm.b),this.c.copy(fm.c),this},getArea:function(){var fm=new A,hm=new A;return function(){return fm.subVectors(this.c,this.b),hm.subVectors(this.a,this.b),0.5*fm.cross(hm).length()}}(),getMidpoint:function(fm){return void 0===fm&&(console.warn('THREE.Triangle: .getMidpoint() target is now required'),fm=new A),fm.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(fm){return Le.getNormal(this.a,this.b,this.c,fm)},getPlane:function(fm){return void 0===fm&&(console.warn('THREE.Triangle: .getPlane() target is now required'),fm=new A),fm.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(fm,hm){return Le.getBarycoord(fm,this.a,this.b,this.c,hm)},containsPoint:function(fm){return Le.containsPoint(fm,this.a,this.b,this.c)},getUV:function(fm,hm,ym,xm,vm){return Le.getUV(fm,this.a,this.b,this.c,hm,ym,xm,vm)},intersectsBox:function(fm){return fm.intersectsTriangle(this)},closestPointToPoint:function(){var fm=new A,hm=new A,ym=new A,xm=new A,vm=new A,_m=new A;return function(Mm,Sm){void 0===Sm&&(console.warn('THREE.Triangle: .closestPointToPoint() target is now required'),Sm=new A);var Tm=this.a,Em=this.b,wm=this.c,Lm,Am;fm.subVectors(Em,Tm),hm.subVectors(wm,Tm),xm.subVectors(Mm,Tm);var Pm=fm.dot(xm),Cm=hm.dot(xm);if(0>=Pm&&0>=Cm)return Sm.copy(Tm);vm.subVectors(Mm,Em);var Rm=fm.dot(vm),Im=hm.dot(vm);if(0<=Rm&&Im<=Rm)return Sm.copy(Em);var Dm=Pm*Im-Rm*Cm;if(0>=Dm&&0<=Pm&&0>=Rm)return Lm=Pm/(Pm-Rm),Sm.copy(Tm).addScaledVector(fm,Lm);_m.subVectors(Mm,wm);var zm=fm.dot(_m),Nm=hm.dot(_m);if(0<=Nm&&zm<=Nm)return Sm.copy(wm);var Bm=zm*Cm-Pm*Nm;if(0>=Bm&&0<=Cm&&0>=Nm)return Am=Cm/(Cm-Nm),Sm.copy(Tm).addScaledVector(hm,Am);var Um=Rm*Nm-zm*Im;if(0>=Um&&0<=Im-Rm&&0<=zm-Nm)return ym.subVectors(wm,Em),Am=(Im-Rm)/(Im-Rm+(zm-Nm)),Sm.copy(Em).addScaledVector(ym,Am);var Gm=1/(Um+Bm+Dm);return Lm=Bm*Gm,Am=Dm*Gm,Sm.copy(Tm).addScaledVector(fm,Lm).addScaledVector(hm,Am)}}(),equals:function(fm){return fm.a.equals(this.a)&&fm.b.equals(this.b)&&fm.c.equals(this.c)}}),Ae.prototype=Object.create(Te.prototype),Ae.prototype.constructor=Ae,Ae.prototype.isMeshBasicMaterial=!0,Ae.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.color.copy(fm.color),this.map=fm.map,this.lightMap=fm.lightMap,this.lightMapIntensity=fm.lightMapIntensity,this.aoMap=fm.aoMap,this.aoMapIntensity=fm.aoMapIntensity,this.specularMap=fm.specularMap,this.alphaMap=fm.alphaMap,this.envMap=fm.envMap,this.combine=fm.combine,this.reflectivity=fm.reflectivity,this.refractionRatio=fm.refractionRatio,this.wireframe=fm.wireframe,this.wireframeLinewidth=fm.wireframeLinewidth,this.wireframeLinecap=fm.wireframeLinecap,this.wireframeLinejoin=fm.wireframeLinejoin,this.skinning=fm.skinning,this.morphTargets=fm.morphTargets,this},Pe.prototype=Object.assign(Object.create(K.prototype),{constructor:Pe,isMesh:!0,setDrawMode:function(fm){this.drawMode=fm},copy:function(fm){return K.prototype.copy.call(this,fm),this.drawMode=fm.drawMode,void 0!==fm.morphTargetInfluences&&(this.morphTargetInfluences=fm.morphTargetInfluences.slice()),void 0!==fm.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},fm.morphTargetDictionary)),this},updateMorphTargets:function(){var fm=this.geometry,hm,ym,xm;if(fm.isBufferGeometry){var vm=fm.morphAttributes,_m=Object.keys(vm);if(0<_m.length){var bm=vm[_m[0]];if(bm!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},(hm=0,ym=bm.length);hm<ym;hm++)xm=bm[hm].name||hm+'',this.morphTargetInfluences.push(0),this.morphTargetDictionary[xm]=hm}}else{var Mm=fm.morphTargets;if(Mm!==void 0&&0<Mm.length)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},(hm=0,ym=Mm.length);hm<ym;hm++)xm=Mm[hm].name||hm+'',this.morphTargetInfluences.push(0),this.morphTargetDictionary[xm]=hm}},raycast:function(){function fm(Rm,Im,Dm,zm,Nm,Bm,Um,Gm){var Om;if(Om=Im.side===Cn?zm.intersectTriangle(Um,Bm,Nm,!0,Gm):zm.intersectTriangle(Nm,Bm,Um,Im.side!==Rn,Gm),null===Om)return null;Cm.copy(Gm),Cm.applyMatrix4(Rm.matrixWorld);var Fm=Dm.ray.origin.distanceTo(Cm);return Fm<Dm.near||Fm>Dm.far?null:{distance:Fm,point:Cm.clone(),object:Rm}}function hm(Rm,Im,Dm,zm,Nm,Bm,Um,Gm,Om){_m.fromBufferAttribute(Nm,Um),bm.fromBufferAttribute(Nm,Gm),Mm.fromBufferAttribute(Nm,Om);var Fm=fm(Rm,Im,Dm,zm,_m,bm,Mm,Pm);if(Fm){Bm&&(wm.fromBufferAttribute(Bm,Um),Lm.fromBufferAttribute(Bm,Gm),Am.fromBufferAttribute(Bm,Om),Fm.uv=Le.getUV(Pm,_m,bm,Mm,wm,Lm,Am,new S));var Hm=new Z(Um,Gm,Om);Le.getNormal(_m,bm,Mm,Hm.normal),Fm.face=Hm}return Fm}var ym=new E,xm=new we,vm=new F,_m=new A,bm=new A,Mm=new A,Sm=new A,Tm=new A,Em=new A,wm=new S,Lm=new S,Am=new S,Pm=new A,Cm=new A;return function(Im,Dm){var zm=this.geometry,Nm=this.material,Bm=this.matrixWorld;if(void 0!==Nm&&(null===zm.boundingSphere&&zm.computeBoundingSphere(),vm.copy(zm.boundingSphere),vm.applyMatrix4(Bm),!1!==Im.ray.intersectsSphere(vm))&&(ym.getInverse(Bm),xm.copy(Im.ray).applyMatrix4(ym),null===zm.boundingBox||!1!==xm.intersectsBox(zm.boundingBox))){var Um;if(zm.isBufferGeometry){var Hm=zm.index,Vm=zm.attributes.position,km=zm.attributes.uv,Wm=zm.groups,jm=zm.drawRange,Gm,Om,Fm,Xm,Ym,Zm,Jm,Qm,Km,$m,eg;if(null!==Hm){if(Array.isArray(Nm))for(Xm=0,Zm=Wm.length;Xm<Zm;Xm++)for(Qm=Wm[Xm],Km=Nm[Qm.materialIndex],$m=Math.max(Qm.start,jm.start),eg=Math.min(Qm.start+Qm.count,jm.start+jm.count),(Ym=$m,Jm=eg);Ym<Jm;Ym+=3)Gm=Hm.getX(Ym),Om=Hm.getX(Ym+1),Fm=Hm.getX(Ym+2),Um=hm(this,Km,Im,xm,Vm,km,Gm,Om,Fm),Um&&(Um.faceIndex=Math.floor(Ym/3),Dm.push(Um));else for($m=Math.max(0,jm.start),eg=Math.min(Hm.count,jm.start+jm.count),(Xm=$m,Zm=eg);Xm<Zm;Xm+=3)Gm=Hm.getX(Xm),Om=Hm.getX(Xm+1),Fm=Hm.getX(Xm+2),Um=hm(this,Nm,Im,xm,Vm,km,Gm,Om,Fm),Um&&(Um.faceIndex=Math.floor(Xm/3),Dm.push(Um));}else if(void 0!==Vm)if(Array.isArray(Nm))for(Xm=0,Zm=Wm.length;Xm<Zm;Xm++)for(Qm=Wm[Xm],Km=Nm[Qm.materialIndex],$m=Math.max(Qm.start,jm.start),eg=Math.min(Qm.start+Qm.count,jm.start+jm.count),(Ym=$m,Jm=eg);Ym<Jm;Ym+=3)Gm=Ym,Om=Ym+1,Fm=Ym+2,Um=hm(this,Km,Im,xm,Vm,km,Gm,Om,Fm),Um&&(Um.faceIndex=Math.floor(Ym/3),Dm.push(Um));else for($m=Math.max(0,jm.start),eg=Math.min(Vm.count,jm.start+jm.count),(Xm=$m,Zm=eg);Xm<Zm;Xm+=3)Gm=Xm,Om=Xm+1,Fm=Xm+2,Um=hm(this,Nm,Im,xm,Vm,km,Gm,Om,Fm),Um&&(Um.faceIndex=Math.floor(Xm/3),Dm.push(Um))}else if(zm.isGeometry){var og=Array.isArray(Nm),ig=zm.vertices,ng=zm.faces,lg=zm.faceVertexUvs[0],tg,rg,ag,sg;0<lg.length&&(sg=lg);for(var pg=0,dg=ng.length;pg<dg;pg++){var cg=ng[pg],ug=og?Nm[cg.materialIndex]:Nm;if(void 0!==ug){if(tg=ig[cg.a],rg=ig[cg.b],ag=ig[cg.c],!0===ug.morphTargets){var mg=zm.morphTargets,gg=this.morphTargetInfluences;_m.set(0,0,0),bm.set(0,0,0),Mm.set(0,0,0);for(var fg=0,hg=mg.length,yg;fg<hg;fg++)if(yg=gg[fg],0!==yg){var xg=mg[fg].vertices;_m.addScaledVector(Sm.subVectors(xg[cg.a],tg),yg),bm.addScaledVector(Tm.subVectors(xg[cg.b],rg),yg),Mm.addScaledVector(Em.subVectors(xg[cg.c],ag),yg)}_m.add(tg),bm.add(rg),Mm.add(ag),tg=_m,rg=bm,ag=Mm}if(Um=fm(this,ug,Im,xm,tg,rg,ag,Pm),Um){if(sg&&sg[pg]){var vg=sg[pg];wm.copy(vg[0]),Lm.copy(vg[1]),Am.copy(vg[2]),Um.uv=Le.getUV(Pm,tg,rg,ag,wm,Lm,Am,new S)}Um.face=cg,Um.faceIndex=pg,Dm.push(Um)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),He.prototype=Object.create(R.prototype),He.prototype.constructor=He,He.prototype.isCubeTexture=!0,Object.defineProperty(He.prototype,'images',{get:function(){return this.image},set:function(fm){this.image=fm}}),Ve.prototype=Object.create(R.prototype),Ve.prototype.constructor=Ve,Ve.prototype.isDataTexture3D=!0;var Hc=new R,Vc=new Ve,kc=new He,Wc=[],jc=[],qc=new Float32Array(16),Xc=new Float32Array(9),Yc=new Float32Array(4);Mt.prototype.updateCache=function(fm){var hm=this.cache;fm instanceof Float32Array&&hm.length!==fm.length&&(this.cache=new Float32Array(fm.length)),qe(hm,fm)},St.prototype.setValue=function(fm,hm,ym){for(var xm=this.seq,vm=0,_m=xm.length,bm;vm!==_m;++vm)bm=xm[vm],bm.setValue(fm,hm[bm.id],ym)};var Zc=/([\w\d_]+)(\])?(\[|\.)?/g;wt.prototype.setValue=function(fm,hm,ym){var xm=this.map[hm];xm!==void 0&&xm.setValue(fm,ym,this.renderer)},wt.prototype.setOptional=function(fm,hm,ym){var xm=hm[ym];xm!==void 0&&this.setValue(fm,ym,xm)},wt.upload=function(fm,hm,ym,xm){for(var vm=0,_m=hm.length;vm!==_m;++vm){var bm=hm[vm],Mm=ym[bm.id];!1!==Mm.needsUpdate&&bm.setValue(fm,Mm.value,xm)}},wt.seqWithValue=function(fm,hm){for(var ym=[],xm=0,vm=fm.length,_m;xm!==vm;++xm)_m=fm[xm],_m.id in hm&&ym.push(_m);return ym};var Jc=0,Qc=0;Kt.prototype=Object.create(Te.prototype),Kt.prototype.constructor=Kt,Kt.prototype.isMeshDepthMaterial=!0,Kt.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.depthPacking=fm.depthPacking,this.skinning=fm.skinning,this.morphTargets=fm.morphTargets,this.map=fm.map,this.alphaMap=fm.alphaMap,this.displacementMap=fm.displacementMap,this.displacementScale=fm.displacementScale,this.displacementBias=fm.displacementBias,this.wireframe=fm.wireframe,this.wireframeLinewidth=fm.wireframeLinewidth,this},$t.prototype=Object.create(Te.prototype),$t.prototype.constructor=$t,$t.prototype.isMeshDistanceMaterial=!0,$t.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.referencePosition.copy(fm.referencePosition),this.nearDistance=fm.nearDistance,this.farDistance=fm.farDistance,this.skinning=fm.skinning,this.morphTargets=fm.morphTargets,this.map=fm.map,this.alphaMap=fm.alphaMap,this.displacementMap=fm.displacementMap,this.displacementScale=fm.displacementScale,this.displacementBias=fm.displacementBias,this},or.prototype=Object.assign(Object.create(K.prototype),{constructor:or,isGroup:!0}),ir.prototype=Object.assign(Object.create(K.prototype),{constructor:ir,isCamera:!0,copy:function(fm,hm){return K.prototype.copy.call(this,fm,hm),this.matrixWorldInverse.copy(fm.matrixWorldInverse),this.projectionMatrix.copy(fm.projectionMatrix),this.projectionMatrixInverse.copy(fm.projectionMatrixInverse),this},getWorldDirection:function(fm){fm===void 0&&(console.warn('THREE.Camera: .getWorldDirection() target is now required'),fm=new A),this.updateMatrixWorld(!0);var hm=this.matrixWorld.elements;return fm.set(-hm[8],-hm[9],-hm[10]).normalize()},updateMatrixWorld:function(fm){K.prototype.updateMatrixWorld.call(this,fm),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}}),nr.prototype=Object.assign(Object.create(ir.prototype),{constructor:nr,isPerspectiveCamera:!0,copy:function(fm,hm){return ir.prototype.copy.call(this,fm,hm),this.fov=fm.fov,this.zoom=fm.zoom,this.near=fm.near,this.far=fm.far,this.focus=fm.focus,this.aspect=fm.aspect,this.view=null===fm.view?null:Object.assign({},fm.view),this.filmGauge=fm.filmGauge,this.filmOffset=fm.filmOffset,this},setFocalLength:function(fm){var hm=0.5*this.getFilmHeight()/fm;this.fov=2*dp.RAD2DEG*Math.atan(hm),this.updateProjectionMatrix()},getFocalLength:function(){var fm=Math.tan(0.5*dp.DEG2RAD*this.fov);return 0.5*this.getFilmHeight()/fm},getEffectiveFOV:function(){return 2*dp.RAD2DEG*Math.atan(Math.tan(0.5*dp.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(fm,hm,ym,xm,vm,_m){this.aspect=fm/hm,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=fm,this.view.fullHeight=hm,this.view.offsetX=ym,this.view.offsetY=xm,this.view.width=vm,this.view.height=_m,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var fm=this.near,hm=fm*Math.tan(0.5*dp.DEG2RAD*this.fov)/this.zoom,ym=2*hm,xm=this.aspect*ym,vm=-0.5*xm,_m=this.view;if(null!==this.view&&this.view.enabled){var bm=_m.fullWidth,Mm=_m.fullHeight;vm+=_m.offsetX*xm/bm,hm-=_m.offsetY*ym/Mm,xm*=_m.width/bm,ym*=_m.height/Mm}var Sm=this.filmOffset;0!==Sm&&(vm+=fm*Sm/this.getFilmWidth()),this.projectionMatrix.makePerspective(vm,vm+xm,hm,hm-ym,fm,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(fm){var hm=K.prototype.toJSON.call(this,fm);return hm.object.fov=this.fov,hm.object.zoom=this.zoom,hm.object.near=this.near,hm.object.far=this.far,hm.object.focus=this.focus,hm.object.aspect=this.aspect,null!==this.view&&(hm.object.view=Object.assign({},this.view)),hm.object.filmGauge=this.filmGauge,hm.object.filmOffset=this.filmOffset,hm}}),sr.prototype=Object.assign(Object.create(nr.prototype),{constructor:sr,isArrayCamera:!0});var Kc=new A,$c=new A;ur.prototype.isFogExp2=!0,ur.prototype.clone=function(){return new ur(this.color,this.density)},ur.prototype.toJSON=function(){return{type:'FogExp2',color:this.color.getHex(),density:this.density}},mr.prototype.isFog=!0,mr.prototype.clone=function(){return new mr(this.color,this.near,this.far)},mr.prototype.toJSON=function(){return{type:'Fog',color:this.color.getHex(),near:this.near,far:this.far}},gr.prototype=Object.assign(Object.create(K.prototype),{constructor:gr,copy:function(fm,hm){return K.prototype.copy.call(this,fm,hm),null!==fm.background&&(this.background=fm.background.clone()),null!==fm.fog&&(this.fog=fm.fog.clone()),null!==fm.overrideMaterial&&(this.overrideMaterial=fm.overrideMaterial.clone()),this.autoUpdate=fm.autoUpdate,this.matrixAutoUpdate=fm.matrixAutoUpdate,this},toJSON:function(fm){var hm=K.prototype.toJSON.call(this,fm);return null!==this.background&&(hm.object.background=this.background.toJSON(fm)),null!==this.fog&&(hm.object.fog=this.fog.toJSON()),hm}}),Object.defineProperty(fr.prototype,'needsUpdate',{set:function(fm){!0===fm&&this.version++}}),Object.assign(fr.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(fm){if(Array.isArray(fm))throw new TypeError('THREE.BufferAttribute: array should be a Typed Array.');return this.count=void 0===fm?0:fm.length/this.stride,this.array=fm,this},setDynamic:function(fm){return this.dynamic=fm,this},copy:function(fm){return this.array=new fm.array.constructor(fm.array),this.count=fm.count,this.stride=fm.stride,this.dynamic=fm.dynamic,this},copyAt:function(fm,hm,ym){fm*=this.stride,ym*=hm.stride;for(var xm=0,vm=this.stride;xm<vm;xm++)this.array[fm+xm]=hm.array[ym+xm];return this},set:function(fm,hm){return void 0===hm&&(hm=0),this.array.set(fm,hm),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(fm){return this.onUploadCallback=fm,this}}),Object.defineProperties(hr.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(hr.prototype,{isInterleavedBufferAttribute:!0,setX:function(fm,hm){return this.data.array[fm*this.data.stride+this.offset]=hm,this},setY:function(fm,hm){return this.data.array[fm*this.data.stride+this.offset+1]=hm,this},setZ:function(fm,hm){return this.data.array[fm*this.data.stride+this.offset+2]=hm,this},setW:function(fm,hm){return this.data.array[fm*this.data.stride+this.offset+3]=hm,this},getX:function(fm){return this.data.array[fm*this.data.stride+this.offset]},getY:function(fm){return this.data.array[fm*this.data.stride+this.offset+1]},getZ:function(fm){return this.data.array[fm*this.data.stride+this.offset+2]},getW:function(fm){return this.data.array[fm*this.data.stride+this.offset+3]},setXY:function(fm,hm,ym){return fm=fm*this.data.stride+this.offset,this.data.array[fm+0]=hm,this.data.array[fm+1]=ym,this},setXYZ:function(fm,hm,ym,xm){return fm=fm*this.data.stride+this.offset,this.data.array[fm+0]=hm,this.data.array[fm+1]=ym,this.data.array[fm+2]=xm,this},setXYZW:function(fm,hm,ym,xm,vm){return fm=fm*this.data.stride+this.offset,this.data.array[fm+0]=hm,this.data.array[fm+1]=ym,this.data.array[fm+2]=xm,this.data.array[fm+3]=vm,this}}),yr.prototype=Object.create(Te.prototype),yr.prototype.constructor=yr,yr.prototype.isSpriteMaterial=!0,yr.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.color.copy(fm.color),this.map=fm.map,this.rotation=fm.rotation,this.sizeAttenuation=fm.sizeAttenuation,this};var eu;xr.prototype=Object.assign(Object.create(K.prototype),{constructor:xr,isSprite:!0,raycast:function(){function fm(Am,Pm,Cm,Rm,Im,Dm){vm.subVectors(Am,Cm).addScalar(0.5).multiply(Rm),Im===void 0?_m.copy(vm):(_m.x=Dm*vm.x-Im*vm.y,_m.y=Im*vm.x+Dm*vm.y),Am.copy(Pm),Am.x+=_m.x,Am.y+=_m.y,Am.applyMatrix4(bm)}var hm=new A,ym=new A,xm=new A,vm=new S,_m=new S,bm=new E,Mm=new A,Sm=new A,Tm=new A,Em=new S,wm=new S,Lm=new S;return function(Pm,Cm){ym.setFromMatrixScale(this.matrixWorld),bm.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),xm.setFromMatrixPosition(this.modelViewMatrix);var Rm=this.material.rotation,Im,Dm;0!==Rm&&(Dm=Math.cos(Rm),Im=Math.sin(Rm));var zm=this.center;fm(Mm.set(-0.5,-0.5,0),xm,zm,ym,Im,Dm),fm(Sm.set(0.5,-0.5,0),xm,zm,ym,Im,Dm),fm(Tm.set(0.5,0.5,0),xm,zm,ym,Im,Dm),Em.set(0,0),wm.set(1,0),Lm.set(1,1);var Nm=Pm.ray.intersectTriangle(Mm,Sm,Tm,!1,hm);if(!(null===Nm&&(fm(Sm.set(-0.5,0.5,0),xm,zm,ym,Im,Dm),wm.set(0,1),Nm=Pm.ray.intersectTriangle(Mm,Tm,Sm,!1,hm),null===Nm))){var Bm=Pm.ray.origin.distanceTo(hm);Bm<Pm.near||Bm>Pm.far||Cm.push({distance:Bm,point:hm.clone(),uv:Le.getUV(hm,Mm,Sm,Tm,Em,wm,Lm,new S),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(fm){return K.prototype.copy.call(this,fm),void 0!==fm.center&&this.center.copy(fm.center),this}}),_r.prototype=Object.assign(Object.create(K.prototype),{constructor:_r,copy:function(fm){K.prototype.copy.call(this,fm,!1);for(var hm=fm.levels,ym=0,xm=hm.length,vm;ym<xm;ym++)vm=hm[ym],this.addLevel(vm.object.clone(),vm.distance);return this},addLevel:function(fm,hm){hm===void 0&&(hm=0),hm=Math.abs(hm);for(var ym=this.levels,xm=0;xm<ym.length&&!(hm<ym[xm].distance);xm++);ym.splice(xm,0,{distance:hm,object:fm}),this.add(fm)},getObjectForDistance:function(fm){for(var hm=this.levels,ym=1,xm=hm.length;ym<xm&&!(fm<hm[ym].distance);ym++);return hm[ym-1].object},raycast:function(){var fm=new A;return function(ym,xm){fm.setFromMatrixPosition(this.matrixWorld);var vm=ym.ray.origin.distanceTo(fm);this.getObjectForDistance(vm).raycast(ym,xm)}}(),update:function(){var fm=new A,hm=new A;return function(xm){var vm=this.levels;if(1<vm.length){fm.setFromMatrixPosition(xm.matrixWorld),hm.setFromMatrixPosition(this.matrixWorld);var _m=fm.distanceTo(hm);vm[0].object.visible=!0;for(var bm=1,Mm=vm.length;bm<Mm&&_m>=vm[bm].distance;bm++)vm[bm-1].object.visible=!1,vm[bm].object.visible=!0;for(;bm<Mm;bm++)vm[bm].object.visible=!1}}}(),toJSON:function(fm){var hm=K.prototype.toJSON.call(this,fm);hm.object.levels=[];for(var ym=this.levels,xm=0,vm=ym.length,_m;xm<vm;xm++)_m=ym[xm],hm.object.levels.push({object:_m.object.uuid,distance:_m.distance});return hm}}),Object.assign(br.prototype,{calculateInverses:function(){this.boneInverses=[];for(var fm=0,hm=this.bones.length,ym;fm<hm;fm++)ym=new E,this.bones[fm]&&ym.getInverse(this.bones[fm].matrixWorld),this.boneInverses.push(ym)},pose:function(){var fm,hm,ym;for(hm=0,ym=this.bones.length;hm<ym;hm++)fm=this.bones[hm],fm&&fm.matrixWorld.getInverse(this.boneInverses[hm]);for(hm=0,ym=this.bones.length;hm<ym;hm++)fm=this.bones[hm],fm&&(fm.parent&&fm.parent.isBone?(fm.matrix.getInverse(fm.parent.matrixWorld),fm.matrix.multiply(fm.matrixWorld)):fm.matrix.copy(fm.matrixWorld),fm.matrix.decompose(fm.position,fm.quaternion,fm.scale))},update:function(){var fm=new E,hm=new E;return function(){for(var xm=this.bones,vm=this.boneInverses,_m=this.boneMatrices,bm=this.boneTexture,Mm=0,Sm=xm.length,Tm;Mm<Sm;Mm++)Tm=xm[Mm]?xm[Mm].matrixWorld:hm,fm.multiplyMatrices(Tm,vm[Mm]),fm.toArray(_m,16*Mm);bm!==void 0&&(bm.needsUpdate=!0)}}(),clone:function(){return new br(this.bones,this.boneInverses)},getBoneByName:function(fm){for(var hm=0,ym=this.bones.length,xm;hm<ym;hm++)if(xm=this.bones[hm],xm.name===fm)return xm}}),Mr.prototype=Object.assign(Object.create(K.prototype),{constructor:Mr,isBone:!0}),Sr.prototype=Object.assign(Object.create(Pe.prototype),{constructor:Sr,isSkinnedMesh:!0,initBones:function(){var fm=[],hm,ym,xm,vm;if(this.geometry&&void 0!==this.geometry.bones){for(xm=0,vm=this.geometry.bones.length;xm<vm;xm++)ym=this.geometry.bones[xm],hm=new Mr,fm.push(hm),hm.name=ym.name,hm.position.fromArray(ym.pos),hm.quaternion.fromArray(ym.rotq),void 0!==ym.scl&&hm.scale.fromArray(ym.scl);for(xm=0,vm=this.geometry.bones.length;xm<vm;xm++)ym=this.geometry.bones[xm],-1!==ym.parent&&null!==ym.parent&&void 0!==fm[ym.parent]?fm[ym.parent].add(fm[xm]):this.add(fm[xm])}return this.updateMatrixWorld(!0),fm},bind:function(fm,hm){this.skeleton=fm,hm===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),hm=this.matrixWorld),this.bindMatrix.copy(hm),this.bindMatrixInverse.getInverse(hm)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var fm,hm;if(this.geometry&&this.geometry.isGeometry)for(hm=0;hm<this.geometry.skinWeights.length;hm++){var ym=this.geometry.skinWeights[hm];fm=1/ym.manhattanLength(),fm===Infinity?ym.set(1,0,0,0):ym.multiplyScalar(fm)}else if(this.geometry&&this.geometry.isBufferGeometry){var xm=new I,vm=this.geometry.attributes.skinWeight;for(hm=0;hm<vm.count;hm++)xm.x=vm.getX(hm),xm.y=vm.getY(hm),xm.z=vm.getZ(hm),xm.w=vm.getW(hm),fm=1/xm.manhattanLength(),fm===Infinity?xm.set(1,0,0,0):xm.multiplyScalar(fm),vm.setXYZW(hm,xm.x,xm.y,xm.z,xm.w)}},updateMatrixWorld:function(fm){Pe.prototype.updateMatrixWorld.call(this,fm),'attached'===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):'detached'===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn('THREE.SkinnedMesh: Unrecognized bindMode: '+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Tr.prototype=Object.create(Te.prototype),Tr.prototype.constructor=Tr,Tr.prototype.isLineBasicMaterial=!0,Tr.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.color.copy(fm.color),this.linewidth=fm.linewidth,this.linecap=fm.linecap,this.linejoin=fm.linejoin,this},Er.prototype=Object.assign(Object.create(K.prototype),{constructor:Er,isLine:!0,computeLineDistances:function(){var fm=new A,hm=new A;return function(){var xm=this.geometry;if(xm.isBufferGeometry){if(null===xm.index){for(var vm=xm.attributes.position,_m=[0],bm=1,Mm=vm.count;bm<Mm;bm++)fm.fromBufferAttribute(vm,bm-1),hm.fromBufferAttribute(vm,bm),_m[bm]=_m[bm-1],_m[bm]+=fm.distanceTo(hm);xm.addAttribute('lineDistance',new ge(_m,1))}else console.warn('THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.');}else if(xm.isGeometry){var Sm=xm.vertices,_m=xm.lineDistances;_m[0]=0;for(var bm=1,Mm=Sm.length;bm<Mm;bm++)_m[bm]=_m[bm-1],_m[bm]+=Sm[bm-1].distanceTo(Sm[bm])}return this}}(),raycast:function(){var fm=new E,hm=new we,ym=new F;return function(vm,_m){var bm=vm.linePrecision,Mm=this.geometry,Sm=this.matrixWorld;if(null===Mm.boundingSphere&&Mm.computeBoundingSphere(),ym.copy(Mm.boundingSphere),ym.applyMatrix4(Sm),ym.radius+=bm,!1!==vm.ray.intersectsSphere(ym)){fm.getInverse(Sm),hm.copy(vm.ray).applyMatrix4(fm);var Tm=bm/((this.scale.x+this.scale.y+this.scale.z)/3),Em=Tm*Tm,wm=new A,Lm=new A,Am=new A,Pm=new A,Cm=this&&this.isLineSegments?2:1;if(Mm.isBufferGeometry){var Rm=Mm.index,Im=Mm.attributes,Dm=Im.position.array;if(null!==Rm)for(var zm=Rm.array,Nm=0,Bm=zm.length-1;Nm<Bm;Nm+=Cm){var Um=zm[Nm],Gm=zm[Nm+1];wm.fromArray(Dm,3*Um),Lm.fromArray(Dm,3*Gm);var Om=hm.distanceSqToSegment(wm,Lm,Pm,Am);if(!(Om>Em)){Pm.applyMatrix4(this.matrixWorld);var Fm=vm.ray.origin.distanceTo(Pm);Fm<vm.near||Fm>vm.far||_m.push({distance:Fm,point:Am.clone().applyMatrix4(this.matrixWorld),index:Nm,face:null,faceIndex:null,object:this})}}else for(var Nm=0,Bm=Dm.length/3-1;Nm<Bm;Nm+=Cm){wm.fromArray(Dm,3*Nm),Lm.fromArray(Dm,3*Nm+3);var Om=hm.distanceSqToSegment(wm,Lm,Pm,Am);if(!(Om>Em)){Pm.applyMatrix4(this.matrixWorld);var Fm=vm.ray.origin.distanceTo(Pm);Fm<vm.near||Fm>vm.far||_m.push({distance:Fm,point:Am.clone().applyMatrix4(this.matrixWorld),index:Nm,face:null,faceIndex:null,object:this})}}}else if(Mm.isGeometry)for(var Hm=Mm.vertices,Vm=Hm.length,Nm=0,Om;Nm<Vm-1;Nm+=Cm)if(Om=hm.distanceSqToSegment(Hm[Nm],Hm[Nm+1],Pm,Am),!(Om>Em)){Pm.applyMatrix4(this.matrixWorld);var Fm=vm.ray.origin.distanceTo(Pm);Fm<vm.near||Fm>vm.far||_m.push({distance:Fm,point:Am.clone().applyMatrix4(this.matrixWorld),index:Nm,face:null,faceIndex:null,object:this})}}}}(),copy:function(fm){return K.prototype.copy.call(this,fm),this.geometry.copy(fm.geometry),this.material.copy(fm.material),this},clone:function(){return new this.constructor().copy(this)}}),wr.prototype=Object.assign(Object.create(Er.prototype),{constructor:wr,isLineSegments:!0,computeLineDistances:function(){var fm=new A,hm=new A;return function(){var xm=this.geometry;if(xm.isBufferGeometry){if(null===xm.index){for(var vm=xm.attributes.position,_m=[],bm=0,Mm=vm.count;bm<Mm;bm+=2)fm.fromBufferAttribute(vm,bm),hm.fromBufferAttribute(vm,bm+1),_m[bm]=0==bm?0:_m[bm-1],_m[bm+1]=_m[bm]+fm.distanceTo(hm);xm.addAttribute('lineDistance',new ge(_m,1))}else console.warn('THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.');}else if(xm.isGeometry)for(var Sm=xm.vertices,_m=xm.lineDistances,bm=0,Mm=Sm.length;bm<Mm;bm+=2)fm.copy(Sm[bm]),hm.copy(Sm[bm+1]),_m[bm]=0==bm?0:_m[bm-1],_m[bm+1]=_m[bm]+fm.distanceTo(hm);return this}}()}),Lr.prototype=Object.assign(Object.create(Er.prototype),{constructor:Lr,isLineLoop:!0}),Ar.prototype=Object.create(Te.prototype),Ar.prototype.constructor=Ar,Ar.prototype.isPointsMaterial=!0,Ar.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.color.copy(fm.color),this.map=fm.map,this.size=fm.size,this.sizeAttenuation=fm.sizeAttenuation,this.morphTargets=fm.morphTargets,this},Pr.prototype=Object.assign(Object.create(K.prototype),{constructor:Pr,isPoints:!0,raycast:function(){var fm=new E,hm=new we,ym=new F;return function(vm,_m){function bm(Om,Fm){var Hm=hm.distanceSqToPoint(Om);if(Hm<Lm){hm.closestPointToPoint(Om,Pm),Pm.applyMatrix4(Tm);var Vm=vm.ray.origin.distanceTo(Pm);if(Vm<vm.near||Vm>vm.far)return;_m.push({distance:Vm,distanceToRay:Math.sqrt(Hm),point:Pm.clone(),index:Fm,face:null,object:Mm})}}var Mm=this,Sm=this.geometry,Tm=this.matrixWorld,Em=vm.params.Points.threshold;if(null===Sm.boundingSphere&&Sm.computeBoundingSphere(),ym.copy(Sm.boundingSphere),ym.applyMatrix4(Tm),ym.radius+=Em,!1!==vm.ray.intersectsSphere(ym)){fm.getInverse(Tm),hm.copy(vm.ray).applyMatrix4(fm);var wm=Em/((this.scale.x+this.scale.y+this.scale.z)/3),Lm=wm*wm,Am=new A,Pm=new A;if(Sm.isBufferGeometry){var Cm=Sm.index,Rm=Sm.attributes,Im=Rm.position.array;if(null!==Cm)for(var Dm=Cm.array,zm=0,Nm=Dm.length,Bm;zm<Nm;zm++)Bm=Dm[zm],Am.fromArray(Im,3*Bm),bm(Am,Bm);else for(var zm=0,Um=Im.length/3;zm<Um;zm++)Am.fromArray(Im,3*zm),bm(Am,zm)}else for(var Gm=Sm.vertices,zm=0,Um=Gm.length;zm<Um;zm++)bm(Gm[zm],zm)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Cr.prototype=Object.assign(Object.create(R.prototype),{constructor:Cr,isVideoTexture:!0,update:function(){var fm=this.image;fm.readyState>=fm.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Rr.prototype=Object.create(R.prototype),Rr.prototype.constructor=Rr,Rr.prototype.isCompressedTexture=!0,Ir.prototype=Object.create(R.prototype),Ir.prototype.constructor=Ir,Ir.prototype.isCanvasTexture=!0,Dr.prototype=Object.create(R.prototype),Dr.prototype.constructor=Dr,Dr.prototype.isDepthTexture=!0,zr.prototype=Object.create(xe.prototype),zr.prototype.constructor=zr,Nr.prototype=Object.create(ee.prototype),Nr.prototype.constructor=Nr,Br.prototype=Object.create(xe.prototype),Br.prototype.constructor=Br,Ur.prototype=Object.create(ee.prototype),Ur.prototype.constructor=Ur,Gr.prototype=Object.create(xe.prototype),Gr.prototype.constructor=Gr,Or.prototype=Object.create(ee.prototype),Or.prototype.constructor=Or,Fr.prototype=Object.create(Gr.prototype),Fr.prototype.constructor=Fr,Hr.prototype=Object.create(ee.prototype),Hr.prototype.constructor=Hr,Vr.prototype=Object.create(Gr.prototype),Vr.prototype.constructor=Vr,kr.prototype=Object.create(ee.prototype),kr.prototype.constructor=kr,Wr.prototype=Object.create(Gr.prototype),Wr.prototype.constructor=Wr,jr.prototype=Object.create(ee.prototype),jr.prototype.constructor=jr,qr.prototype=Object.create(Gr.prototype),qr.prototype.constructor=qr,Xr.prototype=Object.create(ee.prototype),Xr.prototype.constructor=Xr,Yr.prototype=Object.create(xe.prototype),Yr.prototype.constructor=Yr,Zr.prototype=Object.create(ee.prototype),Zr.prototype.constructor=Zr,Jr.prototype=Object.create(xe.prototype),Jr.prototype.constructor=Jr,Qr.prototype=Object.create(ee.prototype),Qr.prototype.constructor=Qr,Kr.prototype=Object.create(xe.prototype),Kr.prototype.constructor=Kr;var tu={triangulate:function(fm,hm,ym){ym=ym||2;var xm=hm&&hm.length,vm=xm?hm[0]*ym:fm.length,_m=$r(fm,0,vm,ym,!0),bm=[];if(!_m)return bm;var Mm,Sm,Tm,Em,wm,Lm,Am;if(xm&&(_m=na(fm,hm,_m,ym)),fm.length>80*ym){Mm=Tm=fm[0],Sm=Em=fm[1];for(var Pm=ym;Pm<vm;Pm+=ym)wm=fm[Pm],Lm=fm[Pm+1],wm<Mm&&(Mm=wm),Lm<Sm&&(Sm=Lm),wm>Tm&&(Tm=wm),Lm>Em&&(Em=Lm);Am=Math.max(Tm-Mm,Em-Sm),Am=0===Am?0:1/Am}return ta(_m,bm,ym,Mm,Sm,Am),bm}},ru={area:function(fm){for(var hm=fm.length,ym=0,xm=hm-1,vm=0;vm<hm;xm=vm++)ym+=fm[xm].x*fm[vm].y-fm[vm].x*fm[xm].y;return 0.5*ym},isClockWise:function(fm){return 0>ru.area(fm)},triangulateShape:function(fm,hm){var ym=[],xm=[],vm=[];Aa(fm),Pa(ym,fm);var _m=fm.length;hm.forEach(Aa);for(var bm=0;bm<hm.length;bm++)xm.push(_m),_m+=hm[bm].length,Pa(ym,hm[bm]);for(var Mm=tu.triangulate(ym,xm),bm=0;bm<Mm.length;bm+=3)vm.push(Mm.slice(bm,bm+3));return vm}};Ca.prototype=Object.create(ee.prototype),Ca.prototype.constructor=Ca,Ca.prototype.toJSON=function(){var fm=ee.prototype.toJSON.call(this),hm=this.parameters.shapes,ym=this.parameters.options;return Ia(hm,ym,fm)},Ra.prototype=Object.create(xe.prototype),Ra.prototype.constructor=Ra,Ra.prototype.toJSON=function(){var fm=xe.prototype.toJSON.call(this),hm=this.parameters.shapes,ym=this.parameters.options;return Ia(hm,ym,fm)};var au={generateTopUV:function(fm,hm,ym,xm,vm){var _m=hm[3*ym],bm=hm[3*ym+1],Mm=hm[3*xm],Sm=hm[3*xm+1],Tm=hm[3*vm],Em=hm[3*vm+1];return[new S(_m,bm),new S(Mm,Sm),new S(Tm,Em)]},generateSideWallUV:function(fm,hm,ym,xm,vm,_m){var bm=hm[3*ym],Mm=hm[3*ym+1],Sm=hm[3*ym+2],Tm=hm[3*xm],Em=hm[3*xm+1],wm=hm[3*xm+2],Lm=hm[3*vm],Am=hm[3*vm+1],Pm=hm[3*vm+2],Cm=hm[3*_m],Rm=hm[3*_m+1],Im=hm[3*_m+2];return 0.01>Math.abs(Mm-Em)?[new S(bm,1-Sm),new S(Tm,1-wm),new S(Lm,1-Pm),new S(Cm,1-Im)]:[new S(Mm,1-Sm),new S(Em,1-wm),new S(Am,1-Pm),new S(Rm,1-Im)]}};Da.prototype=Object.create(ee.prototype),Da.prototype.constructor=Da,za.prototype=Object.create(Ra.prototype),za.prototype.constructor=za,Na.prototype=Object.create(ee.prototype),Na.prototype.constructor=Na,Ba.prototype=Object.create(xe.prototype),Ba.prototype.constructor=Ba,Ua.prototype=Object.create(ee.prototype),Ua.prototype.constructor=Ua,Ga.prototype=Object.create(xe.prototype),Ga.prototype.constructor=Ga,Oa.prototype=Object.create(ee.prototype),Oa.prototype.constructor=Oa,Fa.prototype=Object.create(xe.prototype),Fa.prototype.constructor=Fa,Ha.prototype=Object.create(ee.prototype),Ha.prototype.constructor=Ha,Ha.prototype.toJSON=function(){var fm=ee.prototype.toJSON.call(this),hm=this.parameters.shapes;return ka(hm,fm)},Va.prototype=Object.create(xe.prototype),Va.prototype.constructor=Va,Va.prototype.toJSON=function(){var fm=xe.prototype.toJSON.call(this),hm=this.parameters.shapes;return ka(hm,fm)},Wa.prototype=Object.create(xe.prototype),Wa.prototype.constructor=Wa,ja.prototype=Object.create(ee.prototype),ja.prototype.constructor=ja,Xa.prototype=Object.create(xe.prototype),Xa.prototype.constructor=Xa,Ya.prototype=Object.create(ja.prototype),Ya.prototype.constructor=Ya,Za.prototype=Object.create(Xa.prototype),Za.prototype.constructor=Za,Ja.prototype=Object.create(ee.prototype),Ja.prototype.constructor=Ja,Qa.prototype=Object.create(xe.prototype),Qa.prototype.constructor=Qa;var ou=Object.freeze({WireframeGeometry:zr,ParametricGeometry:Nr,ParametricBufferGeometry:Br,TetrahedronGeometry:Or,TetrahedronBufferGeometry:Fr,OctahedronGeometry:Hr,OctahedronBufferGeometry:Vr,IcosahedronGeometry:kr,IcosahedronBufferGeometry:Wr,DodecahedronGeometry:jr,DodecahedronBufferGeometry:qr,PolyhedronGeometry:Ur,PolyhedronBufferGeometry:Gr,TubeGeometry:Xr,TubeBufferGeometry:Yr,TorusKnotGeometry:Zr,TorusKnotBufferGeometry:Jr,TorusGeometry:Qr,TorusBufferGeometry:Kr,TextGeometry:Da,TextBufferGeometry:za,SphereGeometry:Na,SphereBufferGeometry:Ba,RingGeometry:Ua,RingBufferGeometry:Ga,PlaneGeometry:Me,PlaneBufferGeometry:Se,LatheGeometry:Oa,LatheBufferGeometry:Fa,ShapeGeometry:Ha,ShapeBufferGeometry:Va,ExtrudeGeometry:Ca,ExtrudeBufferGeometry:Ra,EdgesGeometry:Wa,ConeGeometry:Ya,ConeBufferGeometry:Za,CylinderGeometry:ja,CylinderBufferGeometry:Xa,CircleGeometry:Ja,CircleBufferGeometry:Qa,BoxGeometry:ve,BoxBufferGeometry:_e});Ka.prototype=Object.create(Te.prototype),Ka.prototype.constructor=Ka,Ka.prototype.isShadowMaterial=!0,Ka.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.color.copy(fm.color),this},$a.prototype=Object.create(Ee.prototype),$a.prototype.constructor=$a,$a.prototype.isRawShaderMaterial=!0,eo.prototype=Object.create(Te.prototype),eo.prototype.constructor=eo,eo.prototype.isMeshStandardMaterial=!0,eo.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.defines={STANDARD:''},this.color.copy(fm.color),this.roughness=fm.roughness,this.metalness=fm.metalness,this.map=fm.map,this.lightMap=fm.lightMap,this.lightMapIntensity=fm.lightMapIntensity,this.aoMap=fm.aoMap,this.aoMapIntensity=fm.aoMapIntensity,this.emissive.copy(fm.emissive),this.emissiveMap=fm.emissiveMap,this.emissiveIntensity=fm.emissiveIntensity,this.bumpMap=fm.bumpMap,this.bumpScale=fm.bumpScale,this.normalMap=fm.normalMap,this.normalMapType=fm.normalMapType,this.normalScale.copy(fm.normalScale),this.displacementMap=fm.displacementMap,this.displacementScale=fm.displacementScale,this.displacementBias=fm.displacementBias,this.roughnessMap=fm.roughnessMap,this.metalnessMap=fm.metalnessMap,this.alphaMap=fm.alphaMap,this.envMap=fm.envMap,this.envMapIntensity=fm.envMapIntensity,this.refractionRatio=fm.refractionRatio,this.wireframe=fm.wireframe,this.wireframeLinewidth=fm.wireframeLinewidth,this.wireframeLinecap=fm.wireframeLinecap,this.wireframeLinejoin=fm.wireframeLinejoin,this.skinning=fm.skinning,this.morphTargets=fm.morphTargets,this.morphNormals=fm.morphNormals,this},ro.prototype=Object.create(eo.prototype),ro.prototype.constructor=ro,ro.prototype.isMeshPhysicalMaterial=!0,ro.prototype.copy=function(fm){return eo.prototype.copy.call(this,fm),this.defines={PHYSICAL:''},this.reflectivity=fm.reflectivity,this.clearCoat=fm.clearCoat,this.clearCoatRoughness=fm.clearCoatRoughness,this},ao.prototype=Object.create(Te.prototype),ao.prototype.constructor=ao,ao.prototype.isMeshPhongMaterial=!0,ao.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.color.copy(fm.color),this.specular.copy(fm.specular),this.shininess=fm.shininess,this.map=fm.map,this.lightMap=fm.lightMap,this.lightMapIntensity=fm.lightMapIntensity,this.aoMap=fm.aoMap,this.aoMapIntensity=fm.aoMapIntensity,this.emissive.copy(fm.emissive),this.emissiveMap=fm.emissiveMap,this.emissiveIntensity=fm.emissiveIntensity,this.bumpMap=fm.bumpMap,this.bumpScale=fm.bumpScale,this.normalMap=fm.normalMap,this.normalMapType=fm.normalMapType,this.normalScale.copy(fm.normalScale),this.displacementMap=fm.displacementMap,this.displacementScale=fm.displacementScale,this.displacementBias=fm.displacementBias,this.specularMap=fm.specularMap,this.alphaMap=fm.alphaMap,this.envMap=fm.envMap,this.combine=fm.combine,this.reflectivity=fm.reflectivity,this.refractionRatio=fm.refractionRatio,this.wireframe=fm.wireframe,this.wireframeLinewidth=fm.wireframeLinewidth,this.wireframeLinecap=fm.wireframeLinecap,this.wireframeLinejoin=fm.wireframeLinejoin,this.skinning=fm.skinning,this.morphTargets=fm.morphTargets,this.morphNormals=fm.morphNormals,this},oo.prototype=Object.create(ao.prototype),oo.prototype.constructor=oo,oo.prototype.isMeshToonMaterial=!0,oo.prototype.copy=function(fm){return ao.prototype.copy.call(this,fm),this.gradientMap=fm.gradientMap,this},io.prototype=Object.create(Te.prototype),io.prototype.constructor=io,io.prototype.isMeshNormalMaterial=!0,io.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.bumpMap=fm.bumpMap,this.bumpScale=fm.bumpScale,this.normalMap=fm.normalMap,this.normalMapType=fm.normalMapType,this.normalScale.copy(fm.normalScale),this.displacementMap=fm.displacementMap,this.displacementScale=fm.displacementScale,this.displacementBias=fm.displacementBias,this.wireframe=fm.wireframe,this.wireframeLinewidth=fm.wireframeLinewidth,this.skinning=fm.skinning,this.morphTargets=fm.morphTargets,this.morphNormals=fm.morphNormals,this},no.prototype=Object.create(Te.prototype),no.prototype.constructor=no,no.prototype.isMeshLambertMaterial=!0,no.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.color.copy(fm.color),this.map=fm.map,this.lightMap=fm.lightMap,this.lightMapIntensity=fm.lightMapIntensity,this.aoMap=fm.aoMap,this.aoMapIntensity=fm.aoMapIntensity,this.emissive.copy(fm.emissive),this.emissiveMap=fm.emissiveMap,this.emissiveIntensity=fm.emissiveIntensity,this.specularMap=fm.specularMap,this.alphaMap=fm.alphaMap,this.envMap=fm.envMap,this.combine=fm.combine,this.reflectivity=fm.reflectivity,this.refractionRatio=fm.refractionRatio,this.wireframe=fm.wireframe,this.wireframeLinewidth=fm.wireframeLinewidth,this.wireframeLinecap=fm.wireframeLinecap,this.wireframeLinejoin=fm.wireframeLinejoin,this.skinning=fm.skinning,this.morphTargets=fm.morphTargets,this.morphNormals=fm.morphNormals,this},so.prototype=Object.create(Te.prototype),so.prototype.constructor=so,so.prototype.isMeshMatcapMaterial=!0,so.prototype.copy=function(fm){return Te.prototype.copy.call(this,fm),this.defines={MATCAP:''},this.color.copy(fm.color),this.matcap=fm.matcap,this.map=fm.map,this.bumpMap=fm.bumpMap,this.bumpScale=fm.bumpScale,this.normalMap=fm.normalMap,this.normalMapType=fm.normalMapType,this.normalScale.copy(fm.normalScale),this.displacementMap=fm.displacementMap,this.displacementScale=fm.displacementScale,this.displacementBias=fm.displacementBias,this.alphaMap=fm.alphaMap,this.skinning=fm.skinning,this.morphTargets=fm.morphTargets,this.morphNormals=fm.morphNormals,this},lo.prototype=Object.create(Tr.prototype),lo.prototype.constructor=lo,lo.prototype.isLineDashedMaterial=!0,lo.prototype.copy=function(fm){return Tr.prototype.copy.call(this,fm),this.scale=fm.scale,this.dashSize=fm.dashSize,this.gapSize=fm.gapSize,this};var iu=Object.freeze({ShadowMaterial:Ka,SpriteMaterial:yr,RawShaderMaterial:$a,ShaderMaterial:Ee,PointsMaterial:Ar,MeshPhysicalMaterial:ro,MeshStandardMaterial:eo,MeshPhongMaterial:ao,MeshToonMaterial:oo,MeshNormalMaterial:io,MeshLambertMaterial:no,MeshDepthMaterial:Kt,MeshDistanceMaterial:$t,MeshBasicMaterial:Ae,MeshMatcapMaterial:so,LineDashedMaterial:lo,LineBasicMaterial:Tr,Material:Te}),nu={arraySlice:function(fm,hm,ym){return nu.isTypedArray(fm)?new fm.constructor(fm.subarray(hm,void 0===ym?fm.length:ym)):fm.slice(hm,ym)},convertArray:function(fm,hm,ym){return fm&&(ym||fm.constructor!==hm)?'number'==typeof hm.BYTES_PER_ELEMENT?new hm(fm):Array.prototype.slice.call(fm):fm},isTypedArray:function(fm){return ArrayBuffer.isView(fm)&&!(fm instanceof DataView)},getKeyframeOrder:function(fm){for(var ym=fm.length,xm=Array(ym),vm=0;vm!==ym;++vm)xm[vm]=vm;return xm.sort(function(_m,bm){return fm[_m]-fm[bm]}),xm},sortedArray:function(fm,hm,ym){for(var xm=fm.length,vm=new fm.constructor(xm),_m=0,bm=0,Mm;bm!==xm;++_m){Mm=ym[_m]*hm;for(var Sm=0;Sm!==hm;++Sm)vm[bm++]=fm[Mm+Sm]}return vm},flattenJSON:function(fm,hm,ym,xm){for(var vm=1,_m=fm[0];_m!==void 0&&_m[xm]===void 0;)_m=fm[vm++];if(void 0!==_m){var bm=_m[xm];if(void 0!==bm)if(Array.isArray(bm))do bm=_m[xm],void 0!==bm&&(hm.push(_m.time),ym.push.apply(ym,bm)),_m=fm[vm++];while(void 0!==_m);else if(void 0!==bm.toArray)do bm=_m[xm],void 0!==bm&&(hm.push(_m.time),bm.toArray(ym,ym.length)),_m=fm[vm++];while(void 0!==_m);else do bm=_m[xm],void 0!==bm&&(hm.push(_m.time),ym.push(bm)),_m=fm[vm++];while(void 0!==_m)}}};Object.assign(po.prototype,{evaluate:function(fm){var hm=this.parameterPositions,ym=this._cachedIndex,xm=hm[ym],vm=hm[ym-1];validate_interval:{seek:{var _m;linear_scan:{forward_scan:if(!(fm<xm)){for(var bm=ym+2;;){if(void 0===xm){if(fm<vm)break forward_scan;return ym=hm.length,this._cachedIndex=ym,this.afterEnd_(ym-1,fm,vm)}if(ym===bm)break;if(vm=xm,xm=hm[++ym],fm<xm)break seek}_m=hm.length;break linear_scan}if(!(fm>=vm)){var Mm=hm[1];fm<Mm&&(ym=2,vm=Mm);for(var bm=ym-2;;){if(void 0===vm)return this._cachedIndex=0,this.beforeStart_(0,fm,xm);if(ym===bm)break;if(xm=vm,vm=hm[--ym-1],fm>=vm)break seek}_m=ym,ym=0;break linear_scan}break validate_interval}for(;ym<_m;){var Sm=ym+_m>>>1;fm<hm[Sm]?_m=Sm:ym=Sm+1}if(xm=hm[ym],vm=hm[ym-1],void 0===vm)return this._cachedIndex=0,this.beforeStart_(0,fm,xm);if(void 0===xm)return ym=hm.length,this._cachedIndex=ym,this.afterEnd_(ym-1,vm,fm)}this._cachedIndex=ym,this.intervalChanged_(ym,vm,xm)}return this.interpolate_(ym,vm,fm,xm)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(fm){for(var hm=this.resultBuffer,ym=this.sampleValues,xm=this.valueSize,_m=0;_m!==xm;++_m)hm[_m]=ym[fm*xm+_m];return hm},interpolate_:function(){throw new Error('call to abstract method')},intervalChanged_:function(){}}),Object.assign(po.prototype,{beforeStart_:po.prototype.copySampleValue_,afterEnd_:po.prototype.copySampleValue_}),co.prototype=Object.assign(Object.create(po.prototype),{constructor:co,DefaultSettings_:{endingStart:ql,endingEnd:ql},intervalChanged_:function(fm,hm,ym){var xm=this.parameterPositions,vm=fm-2,_m=fm+1,bm=xm[vm],Mm=xm[_m];if(bm===void 0)switch(this.getSettings_().endingStart){case Xl:vm=fm,bm=2*hm-ym;break;case Yl:vm=xm.length-2,bm=hm+xm[vm]-xm[vm+1];break;default:vm=fm,bm=ym;}if(void 0===Mm)switch(this.getSettings_().endingEnd){case Xl:_m=fm,Mm=2*ym-hm;break;case Yl:_m=1,Mm=ym+xm[1]-xm[0];break;default:_m=fm-1,Mm=hm;}var Sm=0.5*(ym-hm),Tm=this.valueSize;this._weightPrev=Sm/(hm-bm),this._weightNext=Sm/(Mm-ym),this._offsetPrev=vm*Tm,this._offsetNext=_m*Tm},interpolate_:function(fm,hm,ym,xm){for(var vm=this.resultBuffer,_m=this.sampleValues,bm=this.valueSize,Mm=fm*bm,Tm=this._offsetPrev,Em=this._offsetNext,wm=this._weightPrev,Lm=this._weightNext,Am=(ym-hm)/(xm-hm),Pm=Am*Am,Cm=Pm*Am,Nm=0;Nm!==bm;++Nm)vm[Nm]=(-wm*Cm+2*wm*Pm-wm*Am)*_m[Tm+Nm]+((1+wm)*Cm+(-1.5-2*wm)*Pm+(-0.5+wm)*Am+1)*_m[Mm-bm+Nm]+((-1-Lm)*Cm+(1.5+Lm)*Pm+0.5*Am)*_m[Mm+Nm]+(Lm*Cm-Lm*Pm)*_m[Em+Nm];return vm}}),uo.prototype=Object.assign(Object.create(po.prototype),{constructor:uo,interpolate_:function(fm,hm,ym,xm){for(var vm=this.resultBuffer,_m=this.sampleValues,bm=this.valueSize,Mm=fm*bm,Tm=(ym-hm)/(xm-hm),wm=0;wm!==bm;++wm)vm[wm]=_m[Mm-bm+wm]*(1-Tm)+_m[Mm+wm]*Tm;return vm}}),mo.prototype=Object.assign(Object.create(po.prototype),{constructor:mo,interpolate_:function(fm){return this.copySampleValue_(fm-1)}}),Object.assign(go,{toJSON:function(fm){var hm=fm.constructor,ym;if(void 0!==hm.toJSON)ym=hm.toJSON(fm);else{ym={name:fm.name,times:nu.convertArray(fm.times,Array),values:nu.convertArray(fm.values,Array)};var xm=fm.getInterpolation();xm!==fm.DefaultInterpolation&&(ym.interpolation=xm)}return ym.type=fm.ValueTypeName,ym}}),Object.assign(go.prototype,{constructor:go,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Vl,InterpolantFactoryMethodDiscrete:function(fm){return new mo(this.times,this.values,this.getValueSize(),fm)},InterpolantFactoryMethodLinear:function(fm){return new uo(this.times,this.values,this.getValueSize(),fm)},InterpolantFactoryMethodSmooth:function(fm){return new co(this.times,this.values,this.getValueSize(),fm)},setInterpolation:function(fm){var hm;if(fm===Hl?hm=this.InterpolantFactoryMethodDiscrete:fm===Vl?hm=this.InterpolantFactoryMethodLinear:fm===Wl?hm=this.InterpolantFactoryMethodSmooth:void 0,void 0===hm){var ym='unsupported interpolation for '+this.ValueTypeName+' keyframe track named '+this.name;if(void 0===this.createInterpolant)if(fm!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(ym);return console.warn('THREE.KeyframeTrack:',ym),this}return this.createInterpolant=hm,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Hl;case this.InterpolantFactoryMethodLinear:return Vl;case this.InterpolantFactoryMethodSmooth:return Wl;}},getValueSize:function(){return this.values.length/this.times.length},shift:function(fm){if(0!==fm)for(var hm=this.times,ym=0,xm=hm.length;ym!==xm;++ym)hm[ym]+=fm;return this},scale:function(fm){if(1!==fm)for(var hm=this.times,ym=0,xm=hm.length;ym!==xm;++ym)hm[ym]*=fm;return this},trim:function(fm,hm){for(var ym=this.times,xm=ym.length,vm=0,_m=xm-1;vm!==xm&&ym[vm]<fm;)++vm;for(;-1!=_m&&ym[_m]>hm;)--_m;if(++_m,0!==vm||_m!==xm){vm>=_m&&(_m=Math.max(_m,1),vm=_m-1);var bm=this.getValueSize();this.times=nu.arraySlice(ym,vm,_m),this.values=nu.arraySlice(this.values,vm*bm,_m*bm)}return this},validate:function(){var fm=!0,hm=this.getValueSize();0!=hm-Math.floor(hm)&&(console.error('THREE.KeyframeTrack: Invalid value size in track.',this),fm=!1);var ym=this.times,xm=this.values,vm=ym.length;0===vm&&(console.error('THREE.KeyframeTrack: Track is empty.',this),fm=!1);for(var _m=null,bm=0,Mm;bm!==vm;bm++){if(Mm=ym[bm],'number'==typeof Mm&&isNaN(Mm)){console.error('THREE.KeyframeTrack: Time is not a valid number.',this,bm,Mm),fm=!1;break}if(null!=_m&&_m>Mm){console.error('THREE.KeyframeTrack: Out of order keys.',this,bm,Mm,_m),fm=!1;break}_m=Mm}if(xm!==void 0&&nu.isTypedArray(xm))for(var bm=0,Sm=xm.length,Tm;bm!==Sm;++bm)if(Tm=xm[bm],isNaN(Tm)){console.error('THREE.KeyframeTrack: Value is not a valid number.',this,bm,Tm),fm=!1;break}return fm},optimize:function(){for(var fm=this.times,hm=this.values,ym=this.getValueSize(),xm=this.getInterpolation()===Wl,vm=1,_m=fm.length-1,bm=1;bm<_m;++bm){var Mm=!1,Sm=fm[bm],Tm=fm[bm+1];if(Sm!==Tm&&(1!==bm||Sm!==Sm[0]))if(!xm){for(var Em=bm*ym,Am=0,Pm;Am!==ym;++Am)if(Pm=hm[Em+Am],Pm!==hm[Em-ym+Am]||Pm!==hm[Em+ym+Am]){Mm=!0;break}}else Mm=!0;if(Mm){if(bm!==vm){fm[vm]=fm[bm];for(var Cm=bm*ym,Rm=vm*ym,Am=0;Am!==ym;++Am)hm[Rm+Am]=hm[Cm+Am]}++vm}}if(0<_m){fm[vm]=fm[_m];for(var Cm=_m*ym,Rm=vm*ym,Am=0;Am!==ym;++Am)hm[Rm+Am]=hm[Cm+Am];++vm}return vm!==fm.length&&(this.times=nu.arraySlice(fm,0,vm),this.values=nu.arraySlice(hm,0,vm*ym)),this}}),fo.prototype=Object.assign(Object.create(go.prototype),{constructor:fo,ValueTypeName:'bool',ValueBufferType:Array,DefaultInterpolation:Hl,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),yo.prototype=Object.assign(Object.create(go.prototype),{constructor:yo,ValueTypeName:'color'}),xo.prototype=Object.assign(Object.create(go.prototype),{constructor:xo,ValueTypeName:'number'}),vo.prototype=Object.assign(Object.create(po.prototype),{constructor:vo,interpolate_:function(fm,hm,ym,xm){for(var vm=this.resultBuffer,_m=this.sampleValues,bm=this.valueSize,Mm=fm*bm,Tm=Mm+bm;Mm!==Tm;Mm+=4)L.slerpFlat(vm,0,_m,Mm-bm,_m,Mm,(ym-hm)/(xm-hm));return vm}}),_o.prototype=Object.assign(Object.create(go.prototype),{constructor:_o,ValueTypeName:'quaternion',DefaultInterpolation:Vl,InterpolantFactoryMethodLinear:function(fm){return new vo(this.times,this.values,this.getValueSize(),fm)},InterpolantFactoryMethodSmooth:void 0}),bo.prototype=Object.assign(Object.create(go.prototype),{constructor:bo,ValueTypeName:'string',ValueBufferType:Array,DefaultInterpolation:Hl,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Mo.prototype=Object.assign(Object.create(go.prototype),{constructor:Mo,ValueTypeName:'vector'}),Object.assign(So,{parse:function(fm){for(var hm=[],ym=fm.tracks,xm=1/(fm.fps||1),vm=0,_m=ym.length;vm!==_m;++vm)hm.push(Eo(ym[vm]).scale(xm));return new So(fm.name,fm.duration,hm)},toJSON:function(fm){for(var hm=[],ym=fm.tracks,xm={name:fm.name,duration:fm.duration,tracks:hm,uuid:fm.uuid},vm=0,_m=ym.length;vm!==_m;++vm)hm.push(go.toJSON(ym[vm]));return xm},CreateFromMorphTargetSequence:function(fm,hm,ym,xm){for(var vm=hm.length,_m=[],bm=0;bm<vm;bm++){var Mm=[],Sm=[];Mm.push((bm+vm-1)%vm,bm,(bm+1)%vm),Sm.push(0,1,0);var Tm=nu.getKeyframeOrder(Mm);Mm=nu.sortedArray(Mm,1,Tm),Sm=nu.sortedArray(Sm,1,Tm),xm||0!==Mm[0]||(Mm.push(vm),Sm.push(Sm[0])),_m.push(new xo('.morphTargetInfluences['+hm[bm].name+']',Mm,Sm).scale(1/ym))}return new So(fm,-1,_m)},findByName:function(fm,hm){var ym=fm;if(!Array.isArray(fm)){var xm=fm;ym=xm.geometry&&xm.geometry.animations||xm.animations}for(var vm=0;vm<ym.length;vm++)if(ym[vm].name===hm)return ym[vm];return null},CreateClipsFromMorphTargetSequences:function(fm,hm,ym){for(var xm={},vm=/^([\w-]*?)([\d]+)$/,_m=0,bm=fm.length;_m<bm;_m++){var Mm=fm[_m],Sm=Mm.name.match(vm);if(Sm&&1<Sm.length){var Tm=Sm[1],Em=xm[Tm];Em||(xm[Tm]=Em=[]),Em.push(Mm)}}var wm=[];for(var Tm in xm)wm.push(So.CreateFromMorphTargetSequence(Tm,xm[Tm],hm,ym));return wm},parseAnimation:function(fm,hm){if(!fm)return console.error('THREE.AnimationClip: No animation in JSONLoader data.'),null;for(var ym=function(zm,Nm,Bm,Um,Gm){if(0!==Bm.length){var Om=[],Fm=[];nu.flattenJSON(Bm,Om,Fm,Um),0!==Om.length&&Gm.push(new zm(Nm,Om,Fm))}},xm=[],vm=fm.name||'default',_m=fm.length||-1,bm=fm.fps||30,Mm=fm.hierarchy||[],Sm=0,Tm;Sm<Mm.length;Sm++)if(Tm=Mm[Sm].keys,Tm&&0!==Tm.length)if(Tm[0].morphTargets){for(var Em={},wm=0;wm<Tm.length;wm++)if(Tm[wm].morphTargets)for(var Lm=0;Lm<Tm[wm].morphTargets.length;Lm++)Em[Tm[wm].morphTargets[Lm]]=-1;for(var Am in Em){for(var Pm=[],Cm=[],Lm=0,Rm;Lm!==Tm[wm].morphTargets.length;++Lm)Rm=Tm[wm],Pm.push(Rm.time),Cm.push(Rm.morphTarget===Am?1:0);xm.push(new xo('.morphTargetInfluence['+Am+']',Pm,Cm))}_m=Em.length*(bm||1)}else{var Im='.bones['+hm[Sm].name+']';ym(Mo,Im+'.position',Tm,'pos',xm),ym(_o,Im+'.quaternion',Tm,'rot',xm),ym(Mo,Im+'.scale',Tm,'scl',xm)}if(0===xm.length)return null;var Dm=new So(vm,_m,xm);return Dm}}),Object.assign(So.prototype,{resetDuration:function(){for(var fm=this.tracks,hm=0,ym=0,xm=fm.length,vm;ym!==xm;++ym)vm=this.tracks[ym],hm=Math.max(hm,vm.times[vm.times.length-1]);return this.duration=hm,this},trim:function(){for(var fm=0;fm<this.tracks.length;fm++)this.tracks[fm].trim(0,this.duration);return this},validate:function(){for(var fm=!0,hm=0;hm<this.tracks.length;hm++)fm=fm&&this.tracks[hm].validate();return fm},optimize:function(){for(var fm=0;fm<this.tracks.length;fm++)this.tracks[fm].optimize();return this}});var lu={enabled:!1,files:{},add:function(fm,hm){!1===this.enabled||(this.files[fm]=hm)},get:function(fm){return!1===this.enabled?void 0:this.files[fm]},remove:function(fm){delete this.files[fm]},clear:function(){this.files={}}},du=new wo,uu={};Object.assign(Lo.prototype,{load:function(fm,hm,ym,xm){void 0===fm&&(fm=''),void 0!==this.path&&(fm=this.path+fm),fm=this.manager.resolveURL(fm);var vm=this,_m=lu.get(fm);if(void 0!==_m)return vm.manager.itemStart(fm),setTimeout(function(){hm&&hm(_m),vm.manager.itemEnd(fm)},0),_m;if(void 0!==uu[fm])return void uu[fm].push({onLoad:hm,onProgress:ym,onError:xm});var bm=/^data:(.*?)(;base64)?,(.*)$/,Mm=fm.match(bm);if(Mm){var Sm=Mm[1],Tm=!!Mm[2],Em=Mm[3];Em=decodeURIComponent(Em),Tm&&(Em=atob(Em));try{var Lm=(this.responseType||'').toLowerCase(),wm;switch(Lm){case'arraybuffer':case'blob':for(var Am=new Uint8Array(Em.length),Pm=0;Pm<Em.length;Pm++)Am[Pm]=Em.charCodeAt(Pm);wm='blob'===Lm?new Blob([Am.buffer],{type:Sm}):Am.buffer;break;case'document':var Cm=new DOMParser;wm=Cm.parseFromString(Em,Sm);break;case'json':wm=JSON.parse(Em);break;default:wm=Em;}setTimeout(function(){hm&&hm(wm),vm.manager.itemEnd(fm)},0)}catch(Dm){setTimeout(function(){xm&&xm(Dm),vm.manager.itemError(fm),vm.manager.itemEnd(fm)},0)}}else{uu[fm]=[],uu[fm].push({onLoad:hm,onProgress:ym,onError:xm});var Rm=new XMLHttpRequest;for(var Im in Rm.open('GET',fm,!0),Rm.addEventListener('load',function(Dm){var zm=this.response;lu.add(fm,zm);var Nm=uu[fm];if(delete uu[fm],200===this.status||0===this.status){0===this.status&&console.warn('THREE.FileLoader: HTTP Status 0 received.');for(var Bm=0,Um=Nm.length,Gm;Bm<Um;Bm++)Gm=Nm[Bm],Gm.onLoad&&Gm.onLoad(zm);vm.manager.itemEnd(fm)}else{for(var Bm=0,Um=Nm.length,Gm;Bm<Um;Bm++)Gm=Nm[Bm],Gm.onError&&Gm.onError(Dm);vm.manager.itemError(fm),vm.manager.itemEnd(fm)}},!1),Rm.addEventListener('progress',function(Dm){for(var zm=uu[fm],Nm=0,Bm=zm.length,Um;Nm<Bm;Nm++)Um=zm[Nm],Um.onProgress&&Um.onProgress(Dm)},!1),Rm.addEventListener('error',function(Dm){var zm=uu[fm];delete uu[fm];for(var Nm=0,Bm=zm.length,Um;Nm<Bm;Nm++)Um=zm[Nm],Um.onError&&Um.onError(Dm);vm.manager.itemError(fm),vm.manager.itemEnd(fm)},!1),Rm.addEventListener('abort',function(Dm){var zm=uu[fm];delete uu[fm];for(var Nm=0,Bm=zm.length,Um;Nm<Bm;Nm++)Um=zm[Nm],Um.onError&&Um.onError(Dm);vm.manager.itemError(fm),vm.manager.itemEnd(fm)},!1),void 0!==this.responseType&&(Rm.responseType=this.responseType),void 0!==this.withCredentials&&(Rm.withCredentials=this.withCredentials),Rm.overrideMimeType&&Rm.overrideMimeType(void 0===this.mimeType?'text/plain':this.mimeType),this.requestHeader)Rm.setRequestHeader(Im,this.requestHeader[Im]);Rm.send(null)}return vm.manager.itemStart(fm),Rm},setPath:function(fm){return this.path=fm,this},setResponseType:function(fm){return this.responseType=fm,this},setWithCredentials:function(fm){return this.withCredentials=fm,this},setMimeType:function(fm){return this.mimeType=fm,this},setRequestHeader:function(fm){return this.requestHeader=fm,this}}),Object.assign(function(fm){this.manager=fm===void 0?du:fm}.prototype,{load:function(fm,hm,ym,xm){var vm=this,_m=new Lo(vm.manager);_m.setPath(vm.path),_m.load(fm,function(bm){hm(vm.parse(JSON.parse(bm)))},ym,xm)},parse:function(fm,hm){for(var ym=[],xm=0,vm;xm<fm.length;xm++)vm=So.parse(fm[xm]),ym.push(vm);hm(ym)},setPath:function(fm){return this.path=fm,this}}),Object.assign(function(fm){this.manager=fm===void 0?du:fm,this._parser=null}.prototype,{load:function(fm,hm,ym,xm){function vm(Lm){Sm.load(fm[Lm],function(Am){var Pm=_m._parser(Am,!0);bm[Lm]={width:Pm.width,height:Pm.height,format:Pm.format,mipmaps:Pm.mipmaps},Tm+=1,6===Tm&&(1===Pm.mipmapCount&&(Mm.minFilter=Bs),Mm.format=Pm.format,Mm.needsUpdate=!0,hm&&hm(Mm))},ym,xm)}var _m=this,bm=[],Mm=new Rr;Mm.image=bm;var Sm=new Lo(this.manager);if(Sm.setPath(this.path),Sm.setResponseType('arraybuffer'),Array.isArray(fm))for(var Tm=0,Em=0,wm=fm.length;Em<wm;++Em)vm(Em);else Sm.load(fm,function(Lm){var Am=_m._parser(Lm,!0);if(Am.isCubemap)for(var Pm=Am.mipmaps.length/Am.mipmapCount,Cm=0;Cm<Pm;Cm++){bm[Cm]={mipmaps:[]};for(var Rm=0;Rm<Am.mipmapCount;Rm++)bm[Cm].mipmaps.push(Am.mipmaps[Cm*Am.mipmapCount+Rm]),bm[Cm].format=Am.format,bm[Cm].width=Am.width,bm[Cm].height=Am.height}else Mm.image.width=Am.width,Mm.image.height=Am.height,Mm.mipmaps=Am.mipmaps;1===Am.mipmapCount&&(Mm.minFilter=Bs),Mm.format=Am.format,Mm.needsUpdate=!0,hm&&hm(Mm)},ym,xm);return Mm},setPath:function(fm){return this.path=fm,this}}),Object.assign(function(fm){this.manager=fm===void 0?du:fm,this._parser=null}.prototype,{load:function(fm,hm,ym,xm){var vm=this,_m=new G,bm=new Lo(this.manager);return bm.setResponseType('arraybuffer'),bm.setPath(this.path),bm.load(fm,function(Mm){var Sm=vm._parser(Mm);Sm&&(void 0===Sm.image?void 0!==Sm.data&&(_m.image.width=Sm.width,_m.image.height=Sm.height,_m.image.data=Sm.data):_m.image=Sm.image,_m.wrapS=void 0===Sm.wrapS?Rs:Sm.wrapS,_m.wrapT=void 0===Sm.wrapT?Rs:Sm.wrapT,_m.magFilter=void 0===Sm.magFilter?Bs:Sm.magFilter,_m.minFilter=void 0===Sm.minFilter?Gs:Sm.minFilter,_m.anisotropy=void 0===Sm.anisotropy?1:Sm.anisotropy,void 0!==Sm.format&&(_m.format=Sm.format),void 0!==Sm.type&&(_m.type=Sm.type),void 0!==Sm.mipmaps&&(_m.mipmaps=Sm.mipmaps),1===Sm.mipmapCount&&(_m.minFilter=Bs),_m.needsUpdate=!0,hm&&hm(_m,Sm))},ym,xm),_m},setPath:function(fm){return this.path=fm,this}}),Object.assign(Ro.prototype,{crossOrigin:'anonymous',load:function(fm,hm,ym,xm){function vm(){Sm.removeEventListener('load',vm,!1),Sm.removeEventListener('error',_m,!1),lu.add(fm,this),hm&&hm(this),bm.manager.itemEnd(fm)}function _m(Tm){Sm.removeEventListener('load',vm,!1),Sm.removeEventListener('error',_m,!1),xm&&xm(Tm),bm.manager.itemError(fm),bm.manager.itemEnd(fm)}void 0===fm&&(fm=''),void 0!==this.path&&(fm=this.path+fm),fm=this.manager.resolveURL(fm);var bm=this,Mm=lu.get(fm);if(void 0!==Mm)return bm.manager.itemStart(fm),setTimeout(function(){hm&&hm(Mm),bm.manager.itemEnd(fm)},0),Mm;var Sm=document.createElementNS('http://www.w3.org/1999/xhtml','img');return Sm.addEventListener('load',vm,!1),Sm.addEventListener('error',_m,!1),'data:'!==fm.substr(0,5)&&void 0!==this.crossOrigin&&(Sm.crossOrigin=this.crossOrigin),bm.manager.itemStart(fm),Sm.src=fm,Sm},setCrossOrigin:function(fm){return this.crossOrigin=fm,this},setPath:function(fm){return this.path=fm,this}}),Object.assign(Io.prototype,{crossOrigin:'anonymous',load:function(fm,hm,ym,xm){function vm(Tm){bm.load(fm[Tm],function(Em){_m.images[Tm]=Em,Mm++,6===Mm&&(_m.needsUpdate=!0,hm&&hm(_m))},void 0,xm)}var _m=new He,bm=new Ro(this.manager);bm.setCrossOrigin(this.crossOrigin),bm.setPath(this.path);for(var Mm=0,Sm=0;Sm<fm.length;++Sm)vm(Sm);return _m},setCrossOrigin:function(fm){return this.crossOrigin=fm,this},setPath:function(fm){return this.path=fm,this}}),Object.assign(Do.prototype,{crossOrigin:'anonymous',load:function(fm,hm,ym,xm){var vm=new R,_m=new Ro(this.manager);return _m.setCrossOrigin(this.crossOrigin),_m.setPath(this.path),_m.load(fm,function(bm){vm.image=bm;var Mm=0<fm.search(/\.jpe?g$/i)||0===fm.search(/^data\:image\/jpeg/);vm.format=Mm?Ks:$s,vm.needsUpdate=!0,void 0!==hm&&hm(vm)},ym,xm),vm},setCrossOrigin:function(fm){return this.crossOrigin=fm,this},setPath:function(fm){return this.path=fm,this}}),Object.assign(zo.prototype,{getPoint:function(){return console.warn('THREE.Curve: .getPoint() not implemented.'),null},getPointAt:function(fm,hm){var ym=this.getUtoTmapping(fm);return this.getPoint(ym,hm)},getPoints:function(fm){fm===void 0&&(fm=5);for(var hm=[],ym=0;ym<=fm;ym++)hm.push(this.getPoint(ym/fm));return hm},getSpacedPoints:function(fm){fm===void 0&&(fm=5);for(var hm=[],ym=0;ym<=fm;ym++)hm.push(this.getPointAt(ym/fm));return hm},getLength:function(){var fm=this.getLengths();return fm[fm.length-1]},getLengths:function(fm){if(void 0===fm&&(fm=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===fm+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var hm=[],xm=this.getPoint(0),_m=0,ym,vm;for(hm.push(0),vm=1;vm<=fm;vm++)ym=this.getPoint(vm/fm),_m+=ym.distanceTo(xm),hm.push(_m),xm=ym;return this.cacheArcLengths=hm,hm},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(fm,hm){var ym=this.getLengths(),xm=0,vm=ym.length,_m;_m=hm?hm:fm*ym[vm-1];for(var bm=0,Mm=vm-1,Sm;bm<=Mm;)if(xm=Math.floor(bm+(Mm-bm)/2),Sm=ym[xm]-_m,0>Sm)bm=xm+1;else if(0<Sm)Mm=xm-1;else{Mm=xm;break}if(xm=Mm,ym[xm]===_m)return xm/(vm-1);var Tm=ym[xm],Em=ym[xm+1],Lm=(_m-Tm)/(Em-Tm),Am=(xm+Lm)/(vm-1);return Am},getTangent:function(fm){var hm=1e-4,ym=fm-hm,xm=fm+hm;0>ym&&(ym=0),1<xm&&(xm=1);var vm=this.getPoint(ym),_m=this.getPoint(xm),bm=_m.clone().sub(vm);return bm.normalize()},getTangentAt:function(fm){var hm=this.getUtoTmapping(fm);return this.getTangent(hm)},computeFrenetFrames:function(fm,hm){var ym=new A,xm=[],vm=[],_m=[],bm=new A,Mm=new E,Sm,Tm,Em;for(Sm=0;Sm<=fm;Sm++)Tm=Sm/fm,xm[Sm]=this.getTangentAt(Tm),xm[Sm].normalize();vm[0]=new A,_m[0]=new A;var wm=Number.MAX_VALUE,Lm=Math.abs(xm[0].x),Am=Math.abs(xm[0].y),Pm=Math.abs(xm[0].z);for(Lm<=wm&&(wm=Lm,ym.set(1,0,0)),Am<=wm&&(wm=Am,ym.set(0,1,0)),Pm<=wm&&ym.set(0,0,1),bm.crossVectors(xm[0],ym).normalize(),vm[0].crossVectors(xm[0],bm),_m[0].crossVectors(xm[0],vm[0]),Sm=1;Sm<=fm;Sm++)vm[Sm]=vm[Sm-1].clone(),_m[Sm]=_m[Sm-1].clone(),bm.crossVectors(xm[Sm-1],xm[Sm]),bm.length()>Number.EPSILON&&(bm.normalize(),Em=Math.acos(dp.clamp(xm[Sm-1].dot(xm[Sm]),-1,1)),vm[Sm].applyMatrix4(Mm.makeRotationAxis(bm,Em))),_m[Sm].crossVectors(xm[Sm],vm[Sm]);if(!0===hm)for(Em=Math.acos(dp.clamp(vm[0].dot(vm[fm]),-1,1)),Em/=fm,0<xm[0].dot(bm.crossVectors(vm[0],vm[fm]))&&(Em=-Em),Sm=1;Sm<=fm;Sm++)vm[Sm].applyMatrix4(Mm.makeRotationAxis(xm[Sm],Em*Sm)),_m[Sm].crossVectors(xm[Sm],vm[Sm]);return{tangents:xm,normals:vm,binormals:_m}},clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.arcLengthDivisions=fm.arcLengthDivisions,this},toJSON:function(){var fm={metadata:{version:4.5,type:'Curve',generator:'Curve.toJSON'},arcLengthDivisions:this.arcLengthDivisions,type:this.type};return fm},fromJSON:function(fm){return this.arcLengthDivisions=fm.arcLengthDivisions,this}}),No.prototype=Object.create(zo.prototype),No.prototype.constructor=No,No.prototype.isEllipseCurve=!0,No.prototype.getPoint=function(fm,hm){for(var ym=hm||new S,xm=2*Math.PI,vm=this.aEndAngle-this.aStartAngle,_m=Math.abs(vm)<Number.EPSILON;0>vm;)vm+=xm;for(;vm>xm;)vm-=xm;vm<Number.EPSILON&&(_m?vm=0:vm=xm),!0!==this.aClockwise||_m||(vm==xm?vm=-xm:vm-=xm);var bm=this.aStartAngle+fm*vm,Mm=this.aX+this.xRadius*Math.cos(bm),Sm=this.aY+this.yRadius*Math.sin(bm);if(0!==this.aRotation){var Tm=Math.cos(this.aRotation),Em=Math.sin(this.aRotation),wm=Mm-this.aX,Lm=Sm-this.aY;Mm=wm*Tm-Lm*Em+this.aX,Sm=wm*Em+Lm*Tm+this.aY}return ym.set(Mm,Sm)},No.prototype.copy=function(fm){return zo.prototype.copy.call(this,fm),this.aX=fm.aX,this.aY=fm.aY,this.xRadius=fm.xRadius,this.yRadius=fm.yRadius,this.aStartAngle=fm.aStartAngle,this.aEndAngle=fm.aEndAngle,this.aClockwise=fm.aClockwise,this.aRotation=fm.aRotation,this},No.prototype.toJSON=function(){var fm=zo.prototype.toJSON.call(this);return fm.aX=this.aX,fm.aY=this.aY,fm.xRadius=this.xRadius,fm.yRadius=this.yRadius,fm.aStartAngle=this.aStartAngle,fm.aEndAngle=this.aEndAngle,fm.aClockwise=this.aClockwise,fm.aRotation=this.aRotation,fm},No.prototype.fromJSON=function(fm){return zo.prototype.fromJSON.call(this,fm),this.aX=fm.aX,this.aY=fm.aY,this.xRadius=fm.xRadius,this.yRadius=fm.yRadius,this.aStartAngle=fm.aStartAngle,this.aEndAngle=fm.aEndAngle,this.aClockwise=fm.aClockwise,this.aRotation=fm.aRotation,this},Bo.prototype=Object.create(No.prototype),Bo.prototype.constructor=Bo,Bo.prototype.isArcCurve=!0;var mu=new A,gu=new Uo,fu=new Uo,hu=new Uo;Go.prototype=Object.create(zo.prototype),Go.prototype.constructor=Go,Go.prototype.isCatmullRomCurve3=!0,Go.prototype.getPoint=function(fm,hm){var ym=hm||new A,xm=this.points,vm=xm.length,_m=(vm-(this.closed?0:1))*fm,bm=Math.floor(_m),Mm=_m-bm;this.closed?bm+=0<bm?0:(Math.floor(Math.abs(bm)/vm)+1)*vm:0==Mm&&bm===vm-1&&(bm=vm-2,Mm=1);var Sm,Tm,Em,wm;if(this.closed||0<bm?Sm=xm[(bm-1)%vm]:(mu.subVectors(xm[0],xm[1]).add(xm[0]),Sm=mu),Tm=xm[bm%vm],Em=xm[(bm+1)%vm],this.closed||bm+2<vm?wm=xm[(bm+2)%vm]:(mu.subVectors(xm[vm-1],xm[vm-2]).add(xm[vm-1]),wm=mu),'centripetal'===this.curveType||'chordal'===this.curveType){var Lm='chordal'===this.curveType?0.5:0.25,Am=Math.pow(Sm.distanceToSquared(Tm),Lm),Pm=Math.pow(Tm.distanceToSquared(Em),Lm),Cm=Math.pow(Em.distanceToSquared(wm),Lm);1e-4>Pm&&(Pm=1),1e-4>Am&&(Am=Pm),1e-4>Cm&&(Cm=Pm),gu.initNonuniformCatmullRom(Sm.x,Tm.x,Em.x,wm.x,Am,Pm,Cm),fu.initNonuniformCatmullRom(Sm.y,Tm.y,Em.y,wm.y,Am,Pm,Cm),hu.initNonuniformCatmullRom(Sm.z,Tm.z,Em.z,wm.z,Am,Pm,Cm)}else'catmullrom'===this.curveType&&(gu.initCatmullRom(Sm.x,Tm.x,Em.x,wm.x,this.tension),fu.initCatmullRom(Sm.y,Tm.y,Em.y,wm.y,this.tension),hu.initCatmullRom(Sm.z,Tm.z,Em.z,wm.z,this.tension));return ym.set(gu.calc(Mm),fu.calc(Mm),hu.calc(Mm)),ym},Go.prototype.copy=function(fm){zo.prototype.copy.call(this,fm),this.points=[];for(var hm=0,ym=fm.points.length,xm;hm<ym;hm++)xm=fm.points[hm],this.points.push(xm.clone());return this.closed=fm.closed,this.curveType=fm.curveType,this.tension=fm.tension,this},Go.prototype.toJSON=function(){var fm=zo.prototype.toJSON.call(this);fm.points=[];for(var hm=0,ym=this.points.length,xm;hm<ym;hm++)xm=this.points[hm],fm.points.push(xm.toArray());return fm.closed=this.closed,fm.curveType=this.curveType,fm.tension=this.tension,fm},Go.prototype.fromJSON=function(fm){zo.prototype.fromJSON.call(this,fm),this.points=[];for(var hm=0,ym=fm.points.length,xm;hm<ym;hm++)xm=fm.points[hm],this.points.push(new A().fromArray(xm));return this.closed=fm.closed,this.curveType=fm.curveType,this.tension=fm.tension,this},Zo.prototype=Object.create(zo.prototype),Zo.prototype.constructor=Zo,Zo.prototype.isCubicBezierCurve=!0,Zo.prototype.getPoint=function(fm,hm){var ym=hm||new S,xm=this.v0,vm=this.v1,_m=this.v2,bm=this.v3;return ym.set(Yo(fm,xm.x,vm.x,_m.x,bm.x),Yo(fm,xm.y,vm.y,_m.y,bm.y)),ym},Zo.prototype.copy=function(fm){return zo.prototype.copy.call(this,fm),this.v0.copy(fm.v0),this.v1.copy(fm.v1),this.v2.copy(fm.v2),this.v3.copy(fm.v3),this},Zo.prototype.toJSON=function(){var fm=zo.prototype.toJSON.call(this);return fm.v0=this.v0.toArray(),fm.v1=this.v1.toArray(),fm.v2=this.v2.toArray(),fm.v3=this.v3.toArray(),fm},Zo.prototype.fromJSON=function(fm){return zo.prototype.fromJSON.call(this,fm),this.v0.fromArray(fm.v0),this.v1.fromArray(fm.v1),this.v2.fromArray(fm.v2),this.v3.fromArray(fm.v3),this},Jo.prototype=Object.create(zo.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isCubicBezierCurve3=!0,Jo.prototype.getPoint=function(fm,hm){var ym=hm||new A,xm=this.v0,vm=this.v1,_m=this.v2,bm=this.v3;return ym.set(Yo(fm,xm.x,vm.x,_m.x,bm.x),Yo(fm,xm.y,vm.y,_m.y,bm.y),Yo(fm,xm.z,vm.z,_m.z,bm.z)),ym},Jo.prototype.copy=function(fm){return zo.prototype.copy.call(this,fm),this.v0.copy(fm.v0),this.v1.copy(fm.v1),this.v2.copy(fm.v2),this.v3.copy(fm.v3),this},Jo.prototype.toJSON=function(){var fm=zo.prototype.toJSON.call(this);return fm.v0=this.v0.toArray(),fm.v1=this.v1.toArray(),fm.v2=this.v2.toArray(),fm.v3=this.v3.toArray(),fm},Jo.prototype.fromJSON=function(fm){return zo.prototype.fromJSON.call(this,fm),this.v0.fromArray(fm.v0),this.v1.fromArray(fm.v1),this.v2.fromArray(fm.v2),this.v3.fromArray(fm.v3),this},Qo.prototype=Object.create(zo.prototype),Qo.prototype.constructor=Qo,Qo.prototype.isLineCurve=!0,Qo.prototype.getPoint=function(fm,hm){var ym=hm||new S;return 1===fm?ym.copy(this.v2):(ym.copy(this.v2).sub(this.v1),ym.multiplyScalar(fm).add(this.v1)),ym},Qo.prototype.getPointAt=function(fm,hm){return this.getPoint(fm,hm)},Qo.prototype.getTangent=function(){var fm=this.v2.clone().sub(this.v1);return fm.normalize()},Qo.prototype.copy=function(fm){return zo.prototype.copy.call(this,fm),this.v1.copy(fm.v1),this.v2.copy(fm.v2),this},Qo.prototype.toJSON=function(){var fm=zo.prototype.toJSON.call(this);return fm.v1=this.v1.toArray(),fm.v2=this.v2.toArray(),fm},Qo.prototype.fromJSON=function(fm){return zo.prototype.fromJSON.call(this,fm),this.v1.fromArray(fm.v1),this.v2.fromArray(fm.v2),this},Ko.prototype=Object.create(zo.prototype),Ko.prototype.constructor=Ko,Ko.prototype.isLineCurve3=!0,Ko.prototype.getPoint=function(fm,hm){var ym=hm||new A;return 1===fm?ym.copy(this.v2):(ym.copy(this.v2).sub(this.v1),ym.multiplyScalar(fm).add(this.v1)),ym},Ko.prototype.getPointAt=function(fm,hm){return this.getPoint(fm,hm)},Ko.prototype.copy=function(fm){return zo.prototype.copy.call(this,fm),this.v1.copy(fm.v1),this.v2.copy(fm.v2),this},Ko.prototype.toJSON=function(){var fm=zo.prototype.toJSON.call(this);return fm.v1=this.v1.toArray(),fm.v2=this.v2.toArray(),fm},Ko.prototype.fromJSON=function(fm){return zo.prototype.fromJSON.call(this,fm),this.v1.fromArray(fm.v1),this.v2.fromArray(fm.v2),this},$o.prototype=Object.create(zo.prototype),$o.prototype.constructor=$o,$o.prototype.isQuadraticBezierCurve=!0,$o.prototype.getPoint=function(fm,hm){var ym=hm||new S,xm=this.v0,vm=this.v1,_m=this.v2;return ym.set(ko(fm,xm.x,vm.x,_m.x),ko(fm,xm.y,vm.y,_m.y)),ym},$o.prototype.copy=function(fm){return zo.prototype.copy.call(this,fm),this.v0.copy(fm.v0),this.v1.copy(fm.v1),this.v2.copy(fm.v2),this},$o.prototype.toJSON=function(){var fm=zo.prototype.toJSON.call(this);return fm.v0=this.v0.toArray(),fm.v1=this.v1.toArray(),fm.v2=this.v2.toArray(),fm},$o.prototype.fromJSON=function(fm){return zo.prototype.fromJSON.call(this,fm),this.v0.fromArray(fm.v0),this.v1.fromArray(fm.v1),this.v2.fromArray(fm.v2),this},ei.prototype=Object.create(zo.prototype),ei.prototype.constructor=ei,ei.prototype.isQuadraticBezierCurve3=!0,ei.prototype.getPoint=function(fm,hm){var ym=hm||new A,xm=this.v0,vm=this.v1,_m=this.v2;return ym.set(ko(fm,xm.x,vm.x,_m.x),ko(fm,xm.y,vm.y,_m.y),ko(fm,xm.z,vm.z,_m.z)),ym},ei.prototype.copy=function(fm){return zo.prototype.copy.call(this,fm),this.v0.copy(fm.v0),this.v1.copy(fm.v1),this.v2.copy(fm.v2),this},ei.prototype.toJSON=function(){var fm=zo.prototype.toJSON.call(this);return fm.v0=this.v0.toArray(),fm.v1=this.v1.toArray(),fm.v2=this.v2.toArray(),fm},ei.prototype.fromJSON=function(fm){return zo.prototype.fromJSON.call(this,fm),this.v0.fromArray(fm.v0),this.v1.fromArray(fm.v1),this.v2.fromArray(fm.v2),this},ti.prototype=Object.create(zo.prototype),ti.prototype.constructor=ti,ti.prototype.isSplineCurve=!0,ti.prototype.getPoint=function(fm,hm){var ym=hm||new S,xm=this.points,vm=(xm.length-1)*fm,_m=Math.floor(vm),bm=vm-_m,Mm=xm[0===_m?_m:_m-1],Sm=xm[_m],Tm=xm[_m>xm.length-2?xm.length-1:_m+1],Em=xm[_m>xm.length-3?xm.length-1:_m+2];return ym.set(Oo(bm,Mm.x,Sm.x,Tm.x,Em.x),Oo(bm,Mm.y,Sm.y,Tm.y,Em.y)),ym},ti.prototype.copy=function(fm){zo.prototype.copy.call(this,fm),this.points=[];for(var hm=0,ym=fm.points.length,xm;hm<ym;hm++)xm=fm.points[hm],this.points.push(xm.clone());return this},ti.prototype.toJSON=function(){var fm=zo.prototype.toJSON.call(this);fm.points=[];for(var hm=0,ym=this.points.length,xm;hm<ym;hm++)xm=this.points[hm],fm.points.push(xm.toArray());return fm},ti.prototype.fromJSON=function(fm){zo.prototype.fromJSON.call(this,fm),this.points=[];for(var hm=0,ym=fm.points.length,xm;hm<ym;hm++)xm=fm.points[hm],this.points.push(new S().fromArray(xm));return this};var yu=Object.freeze({ArcCurve:Bo,CatmullRomCurve3:Go,CubicBezierCurve:Zo,CubicBezierCurve3:Jo,EllipseCurve:No,LineCurve:Qo,LineCurve3:Ko,QuadraticBezierCurve:$o,QuadraticBezierCurve3:ei,SplineCurve:ti});ri.prototype=Object.assign(Object.create(zo.prototype),{constructor:ri,add:function(fm){this.curves.push(fm)},closePath:function(){var fm=this.curves[0].getPoint(0),hm=this.curves[this.curves.length-1].getPoint(1);fm.equals(hm)||this.curves.push(new Qo(hm,fm))},getPoint:function(fm){for(var hm=fm*this.getLength(),ym=this.getCurveLengths(),xm=0;xm<ym.length;){if(ym[xm]>=hm){var vm=ym[xm]-hm,_m=this.curves[xm],bm=_m.getLength(),Mm=0===bm?0:1-vm/bm;return _m.getPointAt(Mm)}xm++}return null},getLength:function(){var fm=this.getCurveLengths();return fm[fm.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var fm=[],hm=0,ym=0,xm=this.curves.length;ym<xm;ym++)hm+=this.curves[ym].getLength(),fm.push(hm);return this.cacheLengths=fm,fm},getSpacedPoints:function(fm){void 0===fm&&(fm=40);for(var hm=[],ym=0;ym<=fm;ym++)hm.push(this.getPoint(ym/fm));return this.autoClose&&hm.push(hm[0]),hm},getPoints:function(fm){fm=fm||12;for(var hm=[],xm=0,vm=this.curves,ym;xm<vm.length;xm++)for(var _m=vm[xm],bm=_m&&_m.isEllipseCurve?2*fm:_m&&(_m.isLineCurve||_m.isLineCurve3)?1:_m&&_m.isSplineCurve?fm*_m.points.length:fm,Mm=_m.getPoints(bm),Sm=0,Tm;Sm<Mm.length;Sm++)Tm=Mm[Sm],ym&&ym.equals(Tm)||(hm.push(Tm),ym=Tm);return this.autoClose&&1<hm.length&&!hm[hm.length-1].equals(hm[0])&&hm.push(hm[0]),hm},copy:function(fm){zo.prototype.copy.call(this,fm),this.curves=[];for(var hm=0,ym=fm.curves.length,xm;hm<ym;hm++)xm=fm.curves[hm],this.curves.push(xm.clone());return this.autoClose=fm.autoClose,this},toJSON:function(){var fm=zo.prototype.toJSON.call(this);fm.autoClose=this.autoClose,fm.curves=[];for(var hm=0,ym=this.curves.length,xm;hm<ym;hm++)xm=this.curves[hm],fm.curves.push(xm.toJSON());return fm},fromJSON:function(fm){zo.prototype.fromJSON.call(this,fm),this.autoClose=fm.autoClose,this.curves=[];for(var hm=0,ym=fm.curves.length,xm;hm<ym;hm++)xm=fm.curves[hm],this.curves.push(new yu[xm.type]().fromJSON(xm));return this}}),ai.prototype=Object.assign(Object.create(ri.prototype),{constructor:ai,setFromPoints:function(fm){this.moveTo(fm[0].x,fm[0].y);for(var hm=1,ym=fm.length;hm<ym;hm++)this.lineTo(fm[hm].x,fm[hm].y)},moveTo:function(fm,hm){this.currentPoint.set(fm,hm)},lineTo:function(fm,hm){var ym=new Qo(this.currentPoint.clone(),new S(fm,hm));this.curves.push(ym),this.currentPoint.set(fm,hm)},quadraticCurveTo:function(fm,hm,ym,xm){var vm=new $o(this.currentPoint.clone(),new S(fm,hm),new S(ym,xm));this.curves.push(vm),this.currentPoint.set(ym,xm)},bezierCurveTo:function(fm,hm,ym,xm,vm,_m){var bm=new Zo(this.currentPoint.clone(),new S(fm,hm),new S(ym,xm),new S(vm,_m));this.curves.push(bm),this.currentPoint.set(vm,_m)},splineThru:function(fm){var hm=[this.currentPoint.clone()].concat(fm),ym=new ti(hm);this.curves.push(ym),this.currentPoint.copy(fm[fm.length-1])},arc:function(fm,hm,ym,xm,vm,_m){var bm=this.currentPoint.x,Mm=this.currentPoint.y;this.absarc(fm+bm,hm+Mm,ym,xm,vm,_m)},absarc:function(fm,hm,ym,xm,vm,_m){this.absellipse(fm,hm,ym,ym,xm,vm,_m)},ellipse:function(fm,hm,ym,xm,vm,_m,bm,Mm){var Sm=this.currentPoint.x,Tm=this.currentPoint.y;this.absellipse(fm+Sm,hm+Tm,ym,xm,vm,_m,bm,Mm)},absellipse:function(fm,hm,ym,xm,vm,_m,bm,Mm){var Sm=new No(fm,hm,ym,xm,vm,_m,bm,Mm);if(0<this.curves.length){var Tm=Sm.getPoint(0);Tm.equals(this.currentPoint)||this.lineTo(Tm.x,Tm.y)}this.curves.push(Sm);var Em=Sm.getPoint(1);this.currentPoint.copy(Em)},copy:function(fm){return ri.prototype.copy.call(this,fm),this.currentPoint.copy(fm.currentPoint),this},toJSON:function(){var fm=ri.prototype.toJSON.call(this);return fm.currentPoint=this.currentPoint.toArray(),fm},fromJSON:function(fm){return ri.prototype.fromJSON.call(this,fm),this.currentPoint.fromArray(fm.currentPoint),this}}),oi.prototype=Object.assign(Object.create(ai.prototype),{constructor:oi,getPointsHoles:function(fm){for(var hm=[],ym=0,xm=this.holes.length;ym<xm;ym++)hm[ym]=this.holes[ym].getPoints(fm);return hm},extractPoints:function(fm){return{shape:this.getPoints(fm),holes:this.getPointsHoles(fm)}},copy:function(fm){ai.prototype.copy.call(this,fm),this.holes=[];for(var hm=0,ym=fm.holes.length,xm;hm<ym;hm++)xm=fm.holes[hm],this.holes.push(xm.clone());return this},toJSON:function(){var fm=ai.prototype.toJSON.call(this);fm.uuid=this.uuid,fm.holes=[];for(var hm=0,ym=this.holes.length,xm;hm<ym;hm++)xm=this.holes[hm],fm.holes.push(xm.toJSON());return fm},fromJSON:function(fm){ai.prototype.fromJSON.call(this,fm),this.uuid=fm.uuid,this.holes=[];for(var hm=0,ym=fm.holes.length,xm;hm<ym;hm++)xm=fm.holes[hm],this.holes.push(new ai().fromJSON(xm));return this}}),ii.prototype=Object.assign(Object.create(K.prototype),{constructor:ii,isLight:!0,copy:function(fm){return K.prototype.copy.call(this,fm),this.color.copy(fm.color),this.intensity=fm.intensity,this},toJSON:function(fm){var hm=K.prototype.toJSON.call(this,fm);return hm.object.color=this.color.getHex(),hm.object.intensity=this.intensity,void 0!==this.groundColor&&(hm.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(hm.object.distance=this.distance),void 0!==this.angle&&(hm.object.angle=this.angle),void 0!==this.decay&&(hm.object.decay=this.decay),void 0!==this.penumbra&&(hm.object.penumbra=this.penumbra),void 0!==this.shadow&&(hm.object.shadow=this.shadow.toJSON()),hm}}),ni.prototype=Object.assign(Object.create(ii.prototype),{constructor:ni,isHemisphereLight:!0,copy:function(fm){return ii.prototype.copy.call(this,fm),this.groundColor.copy(fm.groundColor),this}}),Object.assign(si.prototype,{copy:function(fm){return this.camera=fm.camera.clone(),this.bias=fm.bias,this.radius=fm.radius,this.mapSize.copy(fm.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var fm={};return 0!==this.bias&&(fm.bias=this.bias),1!==this.radius&&(fm.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(fm.mapSize=this.mapSize.toArray()),fm.camera=this.camera.toJSON(!1).object,delete fm.camera.matrix,fm}}),li.prototype=Object.assign(Object.create(si.prototype),{constructor:li,isSpotLightShadow:!0,update:function(fm){var hm=this.camera,ym=2*dp.RAD2DEG*fm.angle,xm=this.mapSize.width/this.mapSize.height,vm=fm.distance||hm.far;(ym!==hm.fov||xm!==hm.aspect||vm!==hm.far)&&(hm.fov=ym,hm.aspect=xm,hm.far=vm,hm.updateProjectionMatrix())}}),pi.prototype=Object.assign(Object.create(ii.prototype),{constructor:pi,isSpotLight:!0,copy:function(fm){return ii.prototype.copy.call(this,fm),this.distance=fm.distance,this.angle=fm.angle,this.penumbra=fm.penumbra,this.decay=fm.decay,this.target=fm.target.clone(),this.shadow=fm.shadow.clone(),this}}),di.prototype=Object.assign(Object.create(ii.prototype),{constructor:di,isPointLight:!0,copy:function(fm){return ii.prototype.copy.call(this,fm),this.distance=fm.distance,this.decay=fm.decay,this.shadow=fm.shadow.clone(),this}}),ci.prototype=Object.assign(Object.create(ir.prototype),{constructor:ci,isOrthographicCamera:!0,copy:function(fm,hm){return ir.prototype.copy.call(this,fm,hm),this.left=fm.left,this.right=fm.right,this.top=fm.top,this.bottom=fm.bottom,this.near=fm.near,this.far=fm.far,this.zoom=fm.zoom,this.view=null===fm.view?null:Object.assign({},fm.view),this},setViewOffset:function(fm,hm,ym,xm,vm,_m){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=fm,this.view.fullHeight=hm,this.view.offsetX=ym,this.view.offsetY=xm,this.view.width=vm,this.view.height=_m,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var fm=(this.right-this.left)/(2*this.zoom),hm=(this.top-this.bottom)/(2*this.zoom),ym=(this.right+this.left)/2,xm=(this.top+this.bottom)/2,vm=ym-fm,_m=ym+fm,bm=xm+hm,Mm=xm-hm;if(null!==this.view&&this.view.enabled){var Sm=this.zoom/(this.view.width/this.view.fullWidth),Tm=this.zoom/(this.view.height/this.view.fullHeight),Em=(this.right-this.left)/this.view.width,wm=(this.top-this.bottom)/this.view.height;vm+=Em*(this.view.offsetX/Sm),_m=vm+Em*(this.view.width/Sm),bm-=wm*(this.view.offsetY/Tm),Mm=bm-wm*(this.view.height/Tm)}this.projectionMatrix.makeOrthographic(vm,_m,bm,Mm,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(fm){var hm=K.prototype.toJSON.call(this,fm);return hm.object.zoom=this.zoom,hm.object.left=this.left,hm.object.right=this.right,hm.object.top=this.top,hm.object.bottom=this.bottom,hm.object.near=this.near,hm.object.far=this.far,null!==this.view&&(hm.object.view=Object.assign({},this.view)),hm}}),ui.prototype=Object.assign(Object.create(si.prototype),{constructor:ui}),mi.prototype=Object.assign(Object.create(ii.prototype),{constructor:mi,isDirectionalLight:!0,copy:function(fm){return ii.prototype.copy.call(this,fm),this.target=fm.target.clone(),this.shadow=fm.shadow.clone(),this}}),gi.prototype=Object.assign(Object.create(ii.prototype),{constructor:gi,isAmbientLight:!0}),hi.prototype=Object.assign(Object.create(ii.prototype),{constructor:hi,isRectAreaLight:!0,copy:function(fm){return ii.prototype.copy.call(this,fm),this.width=fm.width,this.height=fm.height,this},toJSON:function(fm){var hm=ii.prototype.toJSON.call(this,fm);return hm.object.width=this.width,hm.object.height=this.height,hm}}),Object.assign(yi.prototype,{load:function(fm,hm,ym,xm){var vm=this,_m=new Lo(vm.manager);_m.setPath(vm.path),_m.load(fm,function(bm){hm(vm.parse(JSON.parse(bm)))},ym,xm)},parse:function(fm){function hm(Mm){return void 0===ym[Mm]&&console.warn('THREE.MaterialLoader: Undefined texture',Mm),ym[Mm]}var ym=this.textures,xm=new iu[fm.type];if(void 0!==fm.uuid&&(xm.uuid=fm.uuid),void 0!==fm.name&&(xm.name=fm.name),void 0!==fm.color&&xm.color.setHex(fm.color),void 0!==fm.roughness&&(xm.roughness=fm.roughness),void 0!==fm.metalness&&(xm.metalness=fm.metalness),void 0!==fm.emissive&&xm.emissive.setHex(fm.emissive),void 0!==fm.specular&&xm.specular.setHex(fm.specular),void 0!==fm.shininess&&(xm.shininess=fm.shininess),void 0!==fm.clearCoat&&(xm.clearCoat=fm.clearCoat),void 0!==fm.clearCoatRoughness&&(xm.clearCoatRoughness=fm.clearCoatRoughness),void 0!==fm.vertexColors&&(xm.vertexColors=fm.vertexColors),void 0!==fm.fog&&(xm.fog=fm.fog),void 0!==fm.flatShading&&(xm.flatShading=fm.flatShading),void 0!==fm.blending&&(xm.blending=fm.blending),void 0!==fm.combine&&(xm.combine=fm.combine),void 0!==fm.side&&(xm.side=fm.side),void 0!==fm.opacity&&(xm.opacity=fm.opacity),void 0!==fm.transparent&&(xm.transparent=fm.transparent),void 0!==fm.alphaTest&&(xm.alphaTest=fm.alphaTest),void 0!==fm.depthTest&&(xm.depthTest=fm.depthTest),void 0!==fm.depthWrite&&(xm.depthWrite=fm.depthWrite),void 0!==fm.colorWrite&&(xm.colorWrite=fm.colorWrite),void 0!==fm.wireframe&&(xm.wireframe=fm.wireframe),void 0!==fm.wireframeLinewidth&&(xm.wireframeLinewidth=fm.wireframeLinewidth),void 0!==fm.wireframeLinecap&&(xm.wireframeLinecap=fm.wireframeLinecap),void 0!==fm.wireframeLinejoin&&(xm.wireframeLinejoin=fm.wireframeLinejoin),void 0!==fm.rotation&&(xm.rotation=fm.rotation),1!==fm.linewidth&&(xm.linewidth=fm.linewidth),void 0!==fm.dashSize&&(xm.dashSize=fm.dashSize),void 0!==fm.gapSize&&(xm.gapSize=fm.gapSize),void 0!==fm.scale&&(xm.scale=fm.scale),void 0!==fm.polygonOffset&&(xm.polygonOffset=fm.polygonOffset),void 0!==fm.polygonOffsetFactor&&(xm.polygonOffsetFactor=fm.polygonOffsetFactor),void 0!==fm.polygonOffsetUnits&&(xm.polygonOffsetUnits=fm.polygonOffsetUnits),void 0!==fm.skinning&&(xm.skinning=fm.skinning),void 0!==fm.morphTargets&&(xm.morphTargets=fm.morphTargets),void 0!==fm.dithering&&(xm.dithering=fm.dithering),void 0!==fm.visible&&(xm.visible=fm.visible),void 0!==fm.userData&&(xm.userData=fm.userData),void 0!==fm.uniforms)for(var vm in fm.uniforms){var _m=fm.uniforms[vm];switch(xm.uniforms[vm]={},_m.type){case't':xm.uniforms[vm].value=hm(_m.value);break;case'c':xm.uniforms[vm].value=new W().setHex(_m.value);break;case'v2':xm.uniforms[vm].value=new S().fromArray(_m.value);break;case'v3':xm.uniforms[vm].value=new A().fromArray(_m.value);break;case'v4':xm.uniforms[vm].value=new I().fromArray(_m.value);break;case'm4':xm.uniforms[vm].value=new E().fromArray(_m.value);break;default:xm.uniforms[vm].value=_m.value;}}if(void 0!==fm.defines&&(xm.defines=fm.defines),void 0!==fm.vertexShader&&(xm.vertexShader=fm.vertexShader),void 0!==fm.fragmentShader&&(xm.fragmentShader=fm.fragmentShader),void 0!==fm.shading&&(xm.flatShading=1===fm.shading),void 0!==fm.size&&(xm.size=fm.size),void 0!==fm.sizeAttenuation&&(xm.sizeAttenuation=fm.sizeAttenuation),void 0!==fm.map&&(xm.map=hm(fm.map)),void 0!==fm.alphaMap&&(xm.alphaMap=hm(fm.alphaMap),xm.transparent=!0),void 0!==fm.bumpMap&&(xm.bumpMap=hm(fm.bumpMap)),void 0!==fm.bumpScale&&(xm.bumpScale=fm.bumpScale),void 0!==fm.normalMap&&(xm.normalMap=hm(fm.normalMap)),void 0!==fm.normalMapType&&(xm.normalMapType=fm.normalMapType),void 0!==fm.normalScale){var bm=fm.normalScale;!1===Array.isArray(bm)&&(bm=[bm,bm]),xm.normalScale=new S().fromArray(bm)}return void 0!==fm.displacementMap&&(xm.displacementMap=hm(fm.displacementMap)),void 0!==fm.displacementScale&&(xm.displacementScale=fm.displacementScale),void 0!==fm.displacementBias&&(xm.displacementBias=fm.displacementBias),void 0!==fm.roughnessMap&&(xm.roughnessMap=hm(fm.roughnessMap)),void 0!==fm.metalnessMap&&(xm.metalnessMap=hm(fm.metalnessMap)),void 0!==fm.emissiveMap&&(xm.emissiveMap=hm(fm.emissiveMap)),void 0!==fm.emissiveIntensity&&(xm.emissiveIntensity=fm.emissiveIntensity),void 0!==fm.specularMap&&(xm.specularMap=hm(fm.specularMap)),void 0!==fm.envMap&&(xm.envMap=hm(fm.envMap)),void 0!==fm.envMapIntensity&&(xm.envMapIntensity=fm.envMapIntensity),void 0!==fm.reflectivity&&(xm.reflectivity=fm.reflectivity),void 0!==fm.lightMap&&(xm.lightMap=hm(fm.lightMap)),void 0!==fm.lightMapIntensity&&(xm.lightMapIntensity=fm.lightMapIntensity),void 0!==fm.aoMap&&(xm.aoMap=hm(fm.aoMap)),void 0!==fm.aoMapIntensity&&(xm.aoMapIntensity=fm.aoMapIntensity),void 0!==fm.gradientMap&&(xm.gradientMap=hm(fm.gradientMap)),xm},setPath:function(fm){return this.path=fm,this},setTextures:function(fm){return this.textures=fm,this}});var xu={decodeText:function(fm){if('undefined'!=typeof TextDecoder)return new TextDecoder().decode(fm);for(var hm='',ym=0,xm=fm.length;ym<xm;ym++)hm+=String.fromCharCode(fm[ym]);return decodeURIComponent(escape(hm))},extractUrlBase:function(fm){var hm=fm.lastIndexOf('/');return-1===hm?'./':fm.substr(0,hm+1)}};Object.assign(xi.prototype,{load:function(fm,hm,ym,xm){var vm=this,_m=new Lo(vm.manager);_m.setPath(vm.path),_m.load(fm,function(bm){hm(vm.parse(JSON.parse(bm)))},ym,xm)},parse:function(fm){var hm=new xe,ym=fm.data.index;if(ym!==void 0){var xm=new vu[ym.type](ym.array);hm.setIndex(new re(xm,1))}var vm=fm.data.attributes;for(var _m in vm){var bm=vm[_m],xm=new vu[bm.type](bm.array);hm.addAttribute(_m,new re(xm,bm.itemSize,bm.normalized))}var Mm=fm.data.groups||fm.data.drawcalls||fm.data.offsets;if(Mm!==void 0)for(var Sm=0,Tm=Mm.length,Em;Sm!==Tm;++Sm)Em=Mm[Sm],hm.addGroup(Em.start,Em.count,Em.materialIndex);var wm=fm.data.boundingSphere;if(wm!==void 0){var Lm=new A;wm.center!==void 0&&Lm.fromArray(wm.center),hm.boundingSphere=new F(Lm,wm.radius)}return hm},setPath:function(fm){return this.path=fm,this}});var vu={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:'undefined'==typeof Uint8ClampedArray?Uint8Array:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};vi.Handlers={handlers:[],add:function(fm,hm){this.handlers.push(fm,hm)},get:function(fm){for(var hm=this.handlers,ym=0,xm=hm.length;ym<xm;ym+=2){var vm=hm[ym],_m=hm[ym+1];if(vm.test(fm))return _m}return null}},Object.assign(vi.prototype,{crossOrigin:'anonymous',onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(fm,hm,ym){for(var xm=[],vm=0;vm<fm.length;++vm)xm[vm]=this.createMaterial(fm[vm],hm,ym);return xm},createMaterial:function(){var fm={NoBlending:Bn,NormalBlending:Un,AdditiveBlending:Gn,SubtractiveBlending:On,MultiplyBlending:Fn,CustomBlending:Hn},hm=new W,ym=new Do,xm=new yi;return function(_m,bm,Mm){function Sm(Am,Pm,Cm,Rm,Im){var Dm=bm+Am,zm=vi.Handlers.get(Dm),Nm;null===zm?(ym.setCrossOrigin(Mm),Nm=ym.load(Dm)):Nm=zm.load(Dm),void 0!==Pm&&(Nm.repeat.fromArray(Pm),1!==Pm[0]&&(Nm.wrapS=Cs),1!==Pm[1]&&(Nm.wrapT=Cs)),void 0!==Cm&&Nm.offset.fromArray(Cm),void 0!==Rm&&('repeat'===Rm[0]&&(Nm.wrapS=Cs),'mirror'===Rm[0]&&(Nm.wrapS=Is),'repeat'===Rm[1]&&(Nm.wrapT=Cs),'mirror'===Rm[1]&&(Nm.wrapT=Is)),void 0!==Im&&(Nm.anisotropy=Im);var Bm=dp.generateUUID();return Tm[Bm]=Nm,Bm}var Tm={},Em={uuid:dp.generateUUID(),type:'MeshLambertMaterial'};for(var wm in _m){var Lm=_m[wm];switch(wm){case'DbgColor':case'DbgIndex':case'opticalDensity':case'illumination':break;case'DbgName':Em.name=Lm;break;case'blending':Em.blending=fm[Lm];break;case'colorAmbient':case'mapAmbient':console.warn('THREE.Loader.createMaterial:',wm,'is no longer supported.');break;case'colorDiffuse':Em.color=hm.fromArray(Lm).getHex();break;case'colorSpecular':Em.specular=hm.fromArray(Lm).getHex();break;case'colorEmissive':Em.emissive=hm.fromArray(Lm).getHex();break;case'specularCoef':Em.shininess=Lm;break;case'shading':'basic'===Lm.toLowerCase()&&(Em.type='MeshBasicMaterial'),'phong'===Lm.toLowerCase()&&(Em.type='MeshPhongMaterial'),'standard'===Lm.toLowerCase()&&(Em.type='MeshStandardMaterial');break;case'mapDiffuse':Em.map=Sm(Lm,_m.mapDiffuseRepeat,_m.mapDiffuseOffset,_m.mapDiffuseWrap,_m.mapDiffuseAnisotropy);break;case'mapDiffuseRepeat':case'mapDiffuseOffset':case'mapDiffuseWrap':case'mapDiffuseAnisotropy':break;case'mapEmissive':Em.emissiveMap=Sm(Lm,_m.mapEmissiveRepeat,_m.mapEmissiveOffset,_m.mapEmissiveWrap,_m.mapEmissiveAnisotropy);break;case'mapEmissiveRepeat':case'mapEmissiveOffset':case'mapEmissiveWrap':case'mapEmissiveAnisotropy':break;case'mapLight':Em.lightMap=Sm(Lm,_m.mapLightRepeat,_m.mapLightOffset,_m.mapLightWrap,_m.mapLightAnisotropy);break;case'mapLightRepeat':case'mapLightOffset':case'mapLightWrap':case'mapLightAnisotropy':break;case'mapAO':Em.aoMap=Sm(Lm,_m.mapAORepeat,_m.mapAOOffset,_m.mapAOWrap,_m.mapAOAnisotropy);break;case'mapAORepeat':case'mapAOOffset':case'mapAOWrap':case'mapAOAnisotropy':break;case'mapBump':Em.bumpMap=Sm(Lm,_m.mapBumpRepeat,_m.mapBumpOffset,_m.mapBumpWrap,_m.mapBumpAnisotropy);break;case'mapBumpScale':Em.bumpScale=Lm;break;case'mapBumpRepeat':case'mapBumpOffset':case'mapBumpWrap':case'mapBumpAnisotropy':break;case'mapNormal':Em.normalMap=Sm(Lm,_m.mapNormalRepeat,_m.mapNormalOffset,_m.mapNormalWrap,_m.mapNormalAnisotropy);break;case'mapNormalFactor':Em.normalScale=Lm;break;case'mapNormalRepeat':case'mapNormalOffset':case'mapNormalWrap':case'mapNormalAnisotropy':break;case'mapSpecular':Em.specularMap=Sm(Lm,_m.mapSpecularRepeat,_m.mapSpecularOffset,_m.mapSpecularWrap,_m.mapSpecularAnisotropy);break;case'mapSpecularRepeat':case'mapSpecularOffset':case'mapSpecularWrap':case'mapSpecularAnisotropy':break;case'mapMetalness':Em.metalnessMap=Sm(Lm,_m.mapMetalnessRepeat,_m.mapMetalnessOffset,_m.mapMetalnessWrap,_m.mapMetalnessAnisotropy);break;case'mapMetalnessRepeat':case'mapMetalnessOffset':case'mapMetalnessWrap':case'mapMetalnessAnisotropy':break;case'mapRoughness':Em.roughnessMap=Sm(Lm,_m.mapRoughnessRepeat,_m.mapRoughnessOffset,_m.mapRoughnessWrap,_m.mapRoughnessAnisotropy);break;case'mapRoughnessRepeat':case'mapRoughnessOffset':case'mapRoughnessWrap':case'mapRoughnessAnisotropy':break;case'mapAlpha':Em.alphaMap=Sm(Lm,_m.mapAlphaRepeat,_m.mapAlphaOffset,_m.mapAlphaWrap,_m.mapAlphaAnisotropy);break;case'mapAlphaRepeat':case'mapAlphaOffset':case'mapAlphaWrap':case'mapAlphaAnisotropy':break;case'flipSided':Em.side=Cn;break;case'doubleSided':Em.side=Rn;break;case'transparency':console.warn('THREE.Loader.createMaterial: transparency has been renamed to opacity'),Em.opacity=Lm;break;case'depthTest':case'depthWrite':case'colorWrite':case'opacity':case'reflectivity':case'transparent':case'visible':case'wireframe':Em[wm]=Lm;break;case'vertexColors':!0===Lm&&(Em.vertexColors=Nn),'face'===Lm&&(Em.vertexColors=zn);break;default:console.error('THREE.Loader.createMaterial: Unsupported',wm,Lm);}}return'MeshBasicMaterial'===Em.type&&delete Em.emissive,'MeshPhongMaterial'!==Em.type&&delete Em.specular,1>Em.opacity&&(Em.transparent=!0),xm.setTextures(Tm),xm.parse(Em)}}()}),Object.assign(_i.prototype,{crossOrigin:'anonymous',load:function(fm,hm,ym,xm){var vm=this,_m=this.path===void 0?xu.extractUrlBase(fm):this.path,bm=new Lo(this.manager);bm.setPath(this.path),bm.setWithCredentials(this.withCredentials),bm.load(fm,function(Mm){var Sm=JSON.parse(Mm),Tm=Sm.metadata;if(Tm!==void 0){var Em=Tm.type;if(Em!==void 0&&'object'===Em.toLowerCase())return void console.error('THREE.JSONLoader: '+fm+' should be loaded with THREE.ObjectLoader instead.')}var wm=vm.parse(Sm,_m);hm(wm.geometry,wm.materials)},ym,xm)},setPath:function(fm){return this.path=fm,this},setResourcePath:function(fm){return this.resourcePath=fm,this},setCrossOrigin:function(fm){return this.crossOrigin=fm,this},parse:function(){function fm(vm,_m){function bm(rg,ag){return rg&1<<ag}var Jm=vm.faces,Qm=vm.vertices,Km=vm.normals,$m=vm.colors,eg=vm.scale,tg=0,Mm,Sm,Tm,Em,wm,Lm,Am,Pm,Cm,Rm,Im,Dm,zm,Nm,Bm,Um,Gm,Om,Fm,Hm,Vm,km,Wm,jm,Xm,Ym,Zm;if(vm.uvs!==void 0){for(Mm=0;Mm<vm.uvs.length;Mm++)vm.uvs[Mm].length&&tg++;for(Mm=0;Mm<tg;Mm++)_m.faceVertexUvs[Mm]=[]}for(Em=0,wm=Qm.length;Em<wm;)Om=new A,Om.x=Qm[Em++]*eg,Om.y=Qm[Em++]*eg,Om.z=Qm[Em++]*eg,_m.vertices.push(Om);for(Em=0,wm=Jm.length;Em<wm;)if(Rm=Jm[Em++],Im=bm(Rm,0),Dm=bm(Rm,1),zm=bm(Rm,3),Nm=bm(Rm,4),Bm=bm(Rm,5),Um=bm(Rm,6),Gm=bm(Rm,7),Im){if(Hm=new Z,Hm.a=Jm[Em],Hm.b=Jm[Em+1],Hm.c=Jm[Em+3],Vm=new Z,Vm.a=Jm[Em+1],Vm.b=Jm[Em+2],Vm.c=Jm[Em+3],Em+=4,Dm&&(Cm=Jm[Em++],Hm.materialIndex=Cm,Vm.materialIndex=Cm),Tm=_m.faces.length,zm)for(Mm=0;Mm<tg;Mm++)for(jm=vm.uvs[Mm],_m.faceVertexUvs[Mm][Tm]=[],_m.faceVertexUvs[Mm][Tm+1]=[],Sm=0;4>Sm;Sm++)Pm=Jm[Em++],Ym=jm[2*Pm],Zm=jm[2*Pm+1],Xm=new S(Ym,Zm),2!==Sm&&_m.faceVertexUvs[Mm][Tm].push(Xm),0!==Sm&&_m.faceVertexUvs[Mm][Tm+1].push(Xm);if(Nm&&(Am=3*Jm[Em++],Hm.normal.set(Km[Am++],Km[Am++],Km[Am]),Vm.normal.copy(Hm.normal)),Bm)for(Mm=0;4>Mm;Mm++)Am=3*Jm[Em++],Wm=new A(Km[Am++],Km[Am++],Km[Am]),2!==Mm&&Hm.vertexNormals.push(Wm),0!==Mm&&Vm.vertexNormals.push(Wm);if(Um&&(Lm=Jm[Em++],km=$m[Lm],Hm.color.setHex(km),Vm.color.setHex(km)),Gm)for(Mm=0;4>Mm;Mm++)Lm=Jm[Em++],km=$m[Lm],2!==Mm&&Hm.vertexColors.push(new W(km)),0!==Mm&&Vm.vertexColors.push(new W(km));_m.faces.push(Hm),_m.faces.push(Vm)}else{if(Fm=new Z,Fm.a=Jm[Em++],Fm.b=Jm[Em++],Fm.c=Jm[Em++],Dm&&(Cm=Jm[Em++],Fm.materialIndex=Cm),Tm=_m.faces.length,zm)for(Mm=0;Mm<tg;Mm++)for(jm=vm.uvs[Mm],_m.faceVertexUvs[Mm][Tm]=[],Sm=0;3>Sm;Sm++)Pm=Jm[Em++],Ym=jm[2*Pm],Zm=jm[2*Pm+1],Xm=new S(Ym,Zm),_m.faceVertexUvs[Mm][Tm].push(Xm);if(Nm&&(Am=3*Jm[Em++],Fm.normal.set(Km[Am++],Km[Am++],Km[Am])),Bm)for(Mm=0;3>Mm;Mm++)Am=3*Jm[Em++],Wm=new A(Km[Am++],Km[Am++],Km[Am]),Fm.vertexNormals.push(Wm);if(Um&&(Lm=Jm[Em++],Fm.color.setHex($m[Lm])),Gm)for(Mm=0;3>Mm;Mm++)Lm=Jm[Em++],Fm.vertexColors.push(new W($m[Lm]));_m.faces.push(Fm)}}function hm(vm,_m){var bm=vm.influencesPerVertex===void 0?2:vm.influencesPerVertex;if(vm.skinWeights)for(var Mm=0,Sm=vm.skinWeights.length;Mm<Sm;Mm+=bm){var Tm=vm.skinWeights[Mm],Em=1<bm?vm.skinWeights[Mm+1]:0,wm=2<bm?vm.skinWeights[Mm+2]:0,Lm=3<bm?vm.skinWeights[Mm+3]:0;_m.skinWeights.push(new I(Tm,Em,wm,Lm))}if(vm.skinIndices)for(var Mm=0,Sm=vm.skinIndices.length;Mm<Sm;Mm+=bm){var Am=vm.skinIndices[Mm],Pm=1<bm?vm.skinIndices[Mm+1]:0,Cm=2<bm?vm.skinIndices[Mm+2]:0,Rm=3<bm?vm.skinIndices[Mm+3]:0;_m.skinIndices.push(new I(Am,Pm,Cm,Rm))}_m.bones=vm.bones,_m.bones&&0<_m.bones.length&&(_m.skinWeights.length!==_m.skinIndices.length||_m.skinIndices.length!==_m.vertices.length)&&console.warn('When skinning, number of vertices ('+_m.vertices.length+'), skinIndices ('+_m.skinIndices.length+'), and skinWeights ('+_m.skinWeights.length+') should match.')}function ym(vm,_m){var bm=vm.scale;if(vm.morphTargets!==void 0)for(var Mm=0,Sm=vm.morphTargets.length;Mm<Sm;Mm++){_m.morphTargets[Mm]={},_m.morphTargets[Mm].name=vm.morphTargets[Mm].name,_m.morphTargets[Mm].vertices=[];for(var Tm=_m.morphTargets[Mm].vertices,Em=vm.morphTargets[Mm].vertices,wm=0,Lm=Em.length,Am;wm<Lm;wm+=3)Am=new A,Am.x=Em[wm]*bm,Am.y=Em[wm+1]*bm,Am.z=Em[wm+2]*bm,Tm.push(Am)}if(void 0!==vm.morphColors&&0<vm.morphColors.length){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var Pm=_m.faces,Cm=vm.morphColors[0].colors,Mm=0,Sm=Pm.length;Mm<Sm;Mm++)Pm[Mm].color.fromArray(Cm,3*Mm)}}function xm(vm,_m){var bm=[],Mm=[];vm.animation!==void 0&&Mm.push(vm.animation),vm.animations!==void 0&&(vm.animations.length?Mm=Mm.concat(vm.animations):Mm.push(vm.animations));for(var Sm=0,Tm;Sm<Mm.length;Sm++)Tm=So.parseAnimation(Mm[Sm],_m.bones),Tm&&bm.push(Tm);if(_m.morphTargets){var Em=So.CreateClipsFromMorphTargetSequences(_m.morphTargets,10);bm=bm.concat(Em)}0<bm.length&&(_m.animations=bm)}return function(_m,bm){void 0!==_m.data&&(_m=_m.data),_m.scale=void 0===_m.scale?1:1/_m.scale;var Mm=new ee;if(fm(_m,Mm),hm(_m,Mm),ym(_m,Mm),xm(_m,Mm),Mm.computeFaceNormals(),Mm.computeBoundingSphere(),void 0===_m.materials||0===_m.materials.length)return{geometry:Mm};var Sm=vi.prototype.initMaterials(_m.materials,this.resourcePath||bm,this.crossOrigin);return{geometry:Mm,materials:Sm}}}()}),Object.assign(bi.prototype,{crossOrigin:'anonymous',load:function(fm,hm,ym,xm){var vm=this,_m=this.path===void 0?xu.extractUrlBase(fm):this.path;this.resourcePath=this.resourcePath||_m;var bm=new Lo(vm.manager);bm.setPath(this.path),bm.load(fm,function(Mm){var Sm=null;try{Sm=JSON.parse(Mm)}catch(Em){return void 0!==xm&&xm(Em),void console.error('THREE:ObjectLoader: Can\'t parse '+fm+'.',Em.message)}var Tm=Sm.metadata;return void 0===Tm||void 0===Tm.type||'geometry'===Tm.type.toLowerCase()?void console.error('THREE.ObjectLoader: Can\'t load '+fm+'. Use THREE.JSONLoader instead.'):void vm.parse(Sm,hm)},ym,xm)},setPath:function(fm){return this.path=fm,this},setResourcePath:function(fm){return this.resourcePath=fm,this},setCrossOrigin:function(fm){return this.crossOrigin=fm,this},parse:function(fm,hm){var ym=this.parseShape(fm.shapes),xm=this.parseGeometries(fm.geometries,ym),vm=this.parseImages(fm.images,function(){void 0!==hm&&hm(Mm)}),_m=this.parseTextures(fm.textures,vm),bm=this.parseMaterials(fm.materials,_m),Mm=this.parseObject(fm.object,xm,bm);return fm.animations&&(Mm.animations=this.parseAnimations(fm.animations)),(void 0===fm.images||0===fm.images.length)&&void 0!==hm&&hm(Mm),Mm},parseShape:function(fm){var hm={};if(fm!==void 0)for(var ym=0,xm=fm.length,vm;ym<xm;ym++)vm=new oi().fromJSON(fm[ym]),hm[vm.uuid]=vm;return hm},parseGeometries:function(fm,hm){var ym={};if(fm!==void 0)for(var xm=new _i,vm=new xi,_m=0,bm=fm.length;_m<bm;_m++){var Sm=fm[_m],Mm;switch(Sm.type){case'PlaneGeometry':case'PlaneBufferGeometry':Mm=new ou[Sm.type](Sm.width,Sm.height,Sm.widthSegments,Sm.heightSegments);break;case'BoxGeometry':case'BoxBufferGeometry':case'CubeGeometry':Mm=new ou[Sm.type](Sm.width,Sm.height,Sm.depth,Sm.widthSegments,Sm.heightSegments,Sm.depthSegments);break;case'CircleGeometry':case'CircleBufferGeometry':Mm=new ou[Sm.type](Sm.radius,Sm.segments,Sm.thetaStart,Sm.thetaLength);break;case'CylinderGeometry':case'CylinderBufferGeometry':Mm=new ou[Sm.type](Sm.radiusTop,Sm.radiusBottom,Sm.height,Sm.radialSegments,Sm.heightSegments,Sm.openEnded,Sm.thetaStart,Sm.thetaLength);break;case'ConeGeometry':case'ConeBufferGeometry':Mm=new ou[Sm.type](Sm.radius,Sm.height,Sm.radialSegments,Sm.heightSegments,Sm.openEnded,Sm.thetaStart,Sm.thetaLength);break;case'SphereGeometry':case'SphereBufferGeometry':Mm=new ou[Sm.type](Sm.radius,Sm.widthSegments,Sm.heightSegments,Sm.phiStart,Sm.phiLength,Sm.thetaStart,Sm.thetaLength);break;case'DodecahedronGeometry':case'DodecahedronBufferGeometry':case'IcosahedronGeometry':case'IcosahedronBufferGeometry':case'OctahedronGeometry':case'OctahedronBufferGeometry':case'TetrahedronGeometry':case'TetrahedronBufferGeometry':Mm=new ou[Sm.type](Sm.radius,Sm.detail);break;case'RingGeometry':case'RingBufferGeometry':Mm=new ou[Sm.type](Sm.innerRadius,Sm.outerRadius,Sm.thetaSegments,Sm.phiSegments,Sm.thetaStart,Sm.thetaLength);break;case'TorusGeometry':case'TorusBufferGeometry':Mm=new ou[Sm.type](Sm.radius,Sm.tube,Sm.radialSegments,Sm.tubularSegments,Sm.arc);break;case'TorusKnotGeometry':case'TorusKnotBufferGeometry':Mm=new ou[Sm.type](Sm.radius,Sm.tube,Sm.tubularSegments,Sm.radialSegments,Sm.p,Sm.q);break;case'LatheGeometry':case'LatheBufferGeometry':Mm=new ou[Sm.type](Sm.points,Sm.segments,Sm.phiStart,Sm.phiLength);break;case'PolyhedronGeometry':case'PolyhedronBufferGeometry':Mm=new ou[Sm.type](Sm.vertices,Sm.indices,Sm.radius,Sm.details);break;case'ShapeGeometry':case'ShapeBufferGeometry':for(var Tm=[],Em=0,wm=Sm.shapes.length,Lm;Em<wm;Em++)Lm=hm[Sm.shapes[Em]],Tm.push(Lm);Mm=new ou[Sm.type](Tm,Sm.curveSegments);break;case'ExtrudeGeometry':case'ExtrudeBufferGeometry':for(var Tm=[],Em=0,wm=Sm.shapes.length,Lm;Em<wm;Em++)Lm=hm[Sm.shapes[Em]],Tm.push(Lm);var Am=Sm.options.extrudePath;void 0!==Am&&(Sm.options.extrudePath=new yu[Am.type]().fromJSON(Am)),Mm=new ou[Sm.type](Tm,Sm.options);break;case'BufferGeometry':Mm=vm.parse(Sm);break;case'Geometry':Mm=xm.parse(Sm,this.resourcePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+Sm.type+'"');continue;}Mm.uuid=Sm.uuid,void 0!==Sm.name&&(Mm.name=Sm.name),!0===Mm.isBufferGeometry&&void 0!==Sm.userData&&(Mm.userData=Sm.userData),ym[Sm.uuid]=Mm}return ym},parseMaterials:function(fm,hm){var ym={},xm={};if(fm!==void 0){var vm=new yi;vm.setTextures(hm);for(var _m=0,bm=fm.length,Mm;_m<bm;_m++)if(Mm=fm[_m],'MultiMaterial'===Mm.type){for(var Sm=[],Tm=0,Em;Tm<Mm.materials.length;Tm++)Em=Mm.materials[Tm],void 0===ym[Em.uuid]&&(ym[Em.uuid]=vm.parse(Em)),Sm.push(ym[Em.uuid]);xm[Mm.uuid]=Sm}else xm[Mm.uuid]=vm.parse(Mm),ym[Mm.uuid]=xm[Mm.uuid]}return xm},parseAnimations:function(fm){for(var hm=[],ym=0;ym<fm.length;ym++){var xm=fm[ym],vm=So.parse(xm);xm.uuid!==void 0&&(vm.uuid=xm.uuid),hm.push(vm)}return hm},parseImages:function(fm,hm){function ym(Cm){return xm.manager.itemStart(Cm),bm.load(Cm,function(){xm.manager.itemEnd(Cm)},void 0,function(){xm.manager.itemError(Cm),xm.manager.itemEnd(Cm)})}var xm=this,vm={};if(fm!==void 0&&0<fm.length){var _m=new wo(hm),bm=new Ro(_m);bm.setCrossOrigin(this.crossOrigin);for(var Mm=0,Sm=fm.length;Mm<Sm;Mm++){var Tm=fm[Mm],Em=Tm.url;if(Array.isArray(Em)){vm[Tm.uuid]=[];for(var wm=0,Lm=Em.length;wm<Lm;wm++){var Am=Em[wm],Pm=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(Am)?Am:xm.resourcePath+Am;vm[Tm.uuid].push(ym(Pm))}}else{var Pm=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(Tm.url)?Tm.url:xm.resourcePath+Tm.url;vm[Tm.uuid]=ym(Pm)}}}return vm},parseTextures:function(fm,hm){function ym(Sm,Tm){return'number'==typeof Sm?Sm:(console.warn('THREE.ObjectLoader.parseTexture: Constant should be in numeric form.',Sm),Tm[Sm])}var xm={};if(fm!==void 0)for(var vm=0,_m=fm.length,bm;vm<_m;vm++){bm=fm[vm],void 0===bm.image&&console.warn('THREE.ObjectLoader: No "image" specified for',bm.uuid),void 0===hm[bm.image]&&console.warn('THREE.ObjectLoader: Undefined image',bm.image);var Mm;Mm=Array.isArray(hm[bm.image])?new He(hm[bm.image]):new R(hm[bm.image]),Mm.needsUpdate=!0,Mm.uuid=bm.uuid,void 0!==bm.name&&(Mm.name=bm.name),void 0!==bm.mapping&&(Mm.mapping=ym(bm.mapping,_u)),void 0!==bm.offset&&Mm.offset.fromArray(bm.offset),void 0!==bm.repeat&&Mm.repeat.fromArray(bm.repeat),void 0!==bm.center&&Mm.center.fromArray(bm.center),void 0!==bm.rotation&&(Mm.rotation=bm.rotation),void 0!==bm.wrap&&(Mm.wrapS=ym(bm.wrap[0],bu),Mm.wrapT=ym(bm.wrap[1],bu)),void 0!==bm.format&&(Mm.format=bm.format),void 0!==bm.minFilter&&(Mm.minFilter=ym(bm.minFilter,Mu)),void 0!==bm.magFilter&&(Mm.magFilter=ym(bm.magFilter,Mu)),void 0!==bm.anisotropy&&(Mm.anisotropy=bm.anisotropy),void 0!==bm.flipY&&(Mm.flipY=bm.flipY),xm[bm.uuid]=Mm}return xm},parseObject:function(fm,hm,ym){function xm(Pm){return void 0===hm[Pm]&&console.warn('THREE.ObjectLoader: Undefined geometry',Pm),hm[Pm]}function vm(Pm){if(void 0!==Pm){if(Array.isArray(Pm)){for(var Cm=[],Rm=0,Im=Pm.length,Dm;Rm<Im;Rm++)Dm=Pm[Rm],void 0===ym[Dm]&&console.warn('THREE.ObjectLoader: Undefined material',Dm),Cm.push(ym[Dm]);return Cm}return void 0===ym[Pm]&&console.warn('THREE.ObjectLoader: Undefined material',Pm),ym[Pm]}}var _m;switch(fm.type){case'Scene':_m=new gr,void 0!==fm.background&&Number.isInteger(fm.background)&&(_m.background=new W(fm.background)),void 0!==fm.fog&&('Fog'===fm.fog.type?_m.fog=new mr(fm.fog.color,fm.fog.near,fm.fog.far):'FogExp2'===fm.fog.type&&(_m.fog=new ur(fm.fog.color,fm.fog.density)));break;case'PerspectiveCamera':_m=new nr(fm.fov,fm.aspect,fm.near,fm.far),void 0!==fm.focus&&(_m.focus=fm.focus),void 0!==fm.zoom&&(_m.zoom=fm.zoom),void 0!==fm.filmGauge&&(_m.filmGauge=fm.filmGauge),void 0!==fm.filmOffset&&(_m.filmOffset=fm.filmOffset),void 0!==fm.view&&(_m.view=Object.assign({},fm.view));break;case'OrthographicCamera':_m=new ci(fm.left,fm.right,fm.top,fm.bottom,fm.near,fm.far),void 0!==fm.zoom&&(_m.zoom=fm.zoom),void 0!==fm.view&&(_m.view=Object.assign({},fm.view));break;case'AmbientLight':_m=new gi(fm.color,fm.intensity);break;case'DirectionalLight':_m=new mi(fm.color,fm.intensity);break;case'PointLight':_m=new di(fm.color,fm.intensity,fm.distance,fm.decay);break;case'RectAreaLight':_m=new hi(fm.color,fm.intensity,fm.width,fm.height);break;case'SpotLight':_m=new pi(fm.color,fm.intensity,fm.distance,fm.angle,fm.penumbra,fm.decay);break;case'HemisphereLight':_m=new ni(fm.color,fm.groundColor,fm.intensity);break;case'SkinnedMesh':console.warn('THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.');case'Mesh':var bm=xm(fm.geometry),Mm=vm(fm.material);_m=bm.bones&&0<bm.bones.length?new Sr(bm,Mm):new Pe(bm,Mm);break;case'LOD':_m=new _r;break;case'Line':_m=new Er(xm(fm.geometry),vm(fm.material),fm.mode);break;case'LineLoop':_m=new Lr(xm(fm.geometry),vm(fm.material));break;case'LineSegments':_m=new wr(xm(fm.geometry),vm(fm.material));break;case'PointCloud':case'Points':_m=new Pr(xm(fm.geometry),vm(fm.material));break;case'Sprite':_m=new xr(vm(fm.material));break;case'Group':_m=new or;break;default:_m=new K;}if(_m.uuid=fm.uuid,void 0!==fm.name&&(_m.name=fm.name),void 0===fm.matrix?(void 0!==fm.position&&_m.position.fromArray(fm.position),void 0!==fm.rotation&&_m.rotation.fromArray(fm.rotation),void 0!==fm.quaternion&&_m.quaternion.fromArray(fm.quaternion),void 0!==fm.scale&&_m.scale.fromArray(fm.scale)):(_m.matrix.fromArray(fm.matrix),void 0!==fm.matrixAutoUpdate&&(_m.matrixAutoUpdate=fm.matrixAutoUpdate),_m.matrixAutoUpdate&&_m.matrix.decompose(_m.position,_m.quaternion,_m.scale)),void 0!==fm.castShadow&&(_m.castShadow=fm.castShadow),void 0!==fm.receiveShadow&&(_m.receiveShadow=fm.receiveShadow),fm.shadow&&(void 0!==fm.shadow.bias&&(_m.shadow.bias=fm.shadow.bias),void 0!==fm.shadow.radius&&(_m.shadow.radius=fm.shadow.radius),void 0!==fm.shadow.mapSize&&_m.shadow.mapSize.fromArray(fm.shadow.mapSize),void 0!==fm.shadow.camera&&(_m.shadow.camera=this.parseObject(fm.shadow.camera))),void 0!==fm.visible&&(_m.visible=fm.visible),void 0!==fm.frustumCulled&&(_m.frustumCulled=fm.frustumCulled),void 0!==fm.renderOrder&&(_m.renderOrder=fm.renderOrder),void 0!==fm.userData&&(_m.userData=fm.userData),void 0!==fm.layers&&(_m.layers.mask=fm.layers),void 0!==fm.children)for(var Sm=fm.children,Tm=0;Tm<Sm.length;Tm++)_m.add(this.parseObject(Sm[Tm],hm,ym));if('LOD'===fm.type)for(var Em=fm.levels,wm=0;wm<Em.length;wm++){var Lm=Em[wm],Am=_m.getObjectByProperty('uuid',Lm.object);void 0!==Am&&_m.addLevel(Am,Lm.distance)}return _m}});var _u={UVMapping:Ms,CubeReflectionMapping:Ss,CubeRefractionMapping:Ts,EquirectangularReflectionMapping:Es,EquirectangularRefractionMapping:ws,SphericalReflectionMapping:Ls,CubeUVReflectionMapping:As,CubeUVRefractionMapping:Ps},bu={RepeatWrapping:Cs,ClampToEdgeWrapping:Rs,MirroredRepeatWrapping:Is},Mu={NearestFilter:Ds,NearestMipMapNearestFilter:zs,NearestMipMapLinearFilter:Ns,LinearFilter:Bs,LinearMipMapNearestFilter:Us,LinearMipMapLinearFilter:Gs};Object.assign(Mi.prototype,{moveTo:function(fm,hm){this.currentPath=new ai,this.subPaths.push(this.currentPath),this.currentPath.moveTo(fm,hm)},lineTo:function(fm,hm){this.currentPath.lineTo(fm,hm)},quadraticCurveTo:function(fm,hm,ym,xm){this.currentPath.quadraticCurveTo(fm,hm,ym,xm)},bezierCurveTo:function(fm,hm,ym,xm,vm,_m){this.currentPath.bezierCurveTo(fm,hm,ym,xm,vm,_m)},splineThru:function(fm){this.currentPath.splineThru(fm)},toShapes:function(fm,hm){function ym(Xm){for(var Ym=[],Zm=0,Jm=Xm.length;Zm<Jm;Zm++){var Qm=Xm[Zm],Km=new oi;Km.curves=Qm.curves,Ym.push(Km)}return Ym}function xm(Xm,Ym){for(var Zm=Ym.length,Jm=!1,Qm=Zm-1,Km=0;Km<Zm;Qm=Km++){var $m=Ym[Qm],eg=Ym[Km],tg=eg.x-$m.x,rg=eg.y-$m.y;if(Math.abs(rg)>Number.EPSILON){if(0>rg&&($m=Ym[Km],tg=-tg,eg=Ym[Qm],rg=-rg),Xm.y<$m.y||Xm.y>eg.y)continue;if(Xm.y!==$m.y){var ag=rg*(Xm.x-$m.x)-tg*(Xm.y-$m.y);if(0==ag)return!0;if(0>ag)continue;Jm=!Jm}else if(Xm.x===$m.x)return!0}else{if(Xm.y!==$m.y)continue;if(eg.x<=Xm.x&&Xm.x<=$m.x||$m.x<=Xm.x&&Xm.x<=eg.x)return!0}}return Jm}var vm=ru.isClockWise,_m=this.subPaths;if(0===_m.length)return[];if(!0===hm)return ym(_m);var Tm=[],bm,Mm,Sm;if(1===_m.length)return Mm=_m[0],Sm=new oi,Sm.curves=Mm.curves,Tm.push(Sm),Tm;var Em=!vm(_m[0].getPoints());Em=fm?!Em:Em;var wm=[],Lm=[],Am=[],Pm=0,Cm;Lm[Pm]=void 0,Am[Pm]=[];for(var Rm=0,Im=_m.length;Rm<Im;Rm++)Mm=_m[Rm],Cm=Mm.getPoints(),bm=vm(Cm),bm=fm?!bm:bm,bm?(!Em&&Lm[Pm]&&Pm++,Lm[Pm]={s:new oi,p:Cm},Lm[Pm].s.curves=Mm.curves,Em&&Pm++,Am[Pm]=[]):Am[Pm].push({h:Mm,p:Cm[0]});if(!Lm[0])return ym(_m);if(1<Lm.length){for(var Dm=!1,zm=[],Nm=0,Bm=Lm.length;Nm<Bm;Nm++)wm[Nm]=[];for(var Nm=0,Bm=Lm.length,Um;Nm<Bm;Nm++){Um=Am[Nm];for(var Gm=0;Gm<Um.length;Gm++){for(var Om=Um[Gm],Fm=!0,Hm=0;Hm<Lm.length;Hm++)xm(Om.p,Lm[Hm].p)&&(Nm!==Hm&&zm.push({froms:Nm,tos:Hm,hole:Gm}),Fm?(Fm=!1,wm[Hm].push(Om)):Dm=!0);Fm&&wm[Nm].push(Om)}}0<zm.length&&!Dm&&(Am=wm)}for(var Rm=0,km=Lm.length,Vm;Rm<km;Rm++){Sm=Lm[Rm].s,Tm.push(Sm),Vm=Am[Rm];for(var Wm=0,jm=Vm.length;Wm<jm;Wm++)Sm.holes.push(Vm[Wm].h)}return Tm}}),Object.assign(Si.prototype,{isFont:!0,generateShapes:function(fm,hm){hm===void 0&&(hm=100);for(var ym=[],xm=Ti(fm,hm,this.data),vm=0,_m=xm.length;vm<_m;vm++)Array.prototype.push.apply(ym,xm[vm].toShapes());return ym}}),Object.assign(function(fm){this.manager=fm===void 0?du:fm}.prototype,{load:function(fm,hm,ym,xm){var vm=this,_m=new Lo(this.manager);_m.setPath(this.path),_m.load(fm,function(bm){var Mm;try{Mm=JSON.parse(bm)}catch(Tm){console.warn('THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead.'),Mm=JSON.parse(bm.substring(65,bm.length-2))}var Sm=vm.parse(Mm);hm&&hm(Sm)},ym,xm)},parse:function(fm){return new Si(fm)},setPath:function(fm){return this.path=fm,this}});var Su,Tu={getContext:function(){return void 0==Su&&(Su=new(window.AudioContext||window.webkitAudioContext)),Su},setContext:function(fm){Su=fm}};Object.assign(Li.prototype,{load:function(fm,hm,ym,xm){var vm=new Lo(this.manager);vm.setResponseType('arraybuffer'),vm.setPath(this.path),vm.load(fm,function(_m){var bm=_m.slice(0),Mm=Tu.getContext();Mm.decodeAudioData(bm,function(Sm){hm(Sm)})},ym,xm)},setPath:function(fm){return this.path=fm,this}}),Object.assign(function(){this.type='StereoCamera',this.aspect=1,this.eyeSep=0.064,this.cameraL=new nr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new nr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}.prototype,{update:function(){var fm,hm,ym,xm,vm,_m,bm,Mm,Sm=new E,Tm=new E;return function(wm){var Lm=fm!==this||hm!==wm.focus||ym!==wm.fov||xm!==wm.aspect*this.aspect||vm!==wm.near||_m!==wm.far||bm!==wm.zoom||Mm!==this.eyeSep;if(Lm){fm=this,hm=wm.focus,ym=wm.fov,xm=wm.aspect*this.aspect,vm=wm.near,_m=wm.far,bm=wm.zoom;var Am=wm.projectionMatrix.clone();Mm=this.eyeSep/2;var Pm=Mm*vm/hm,Cm=vm*Math.tan(0.5*(dp.DEG2RAD*ym))/bm,Rm,Im;Tm.elements[12]=-Mm,Sm.elements[12]=Mm,Rm=-Cm*xm+Pm,Im=Cm*xm+Pm,Am.elements[0]=2*vm/(Im-Rm),Am.elements[8]=(Im+Rm)/(Im-Rm),this.cameraL.projectionMatrix.copy(Am),Rm=-Cm*xm-Pm,Im=Cm*xm-Pm,Am.elements[0]=2*vm/(Im-Rm),Am.elements[8]=(Im+Rm)/(Im-Rm),this.cameraR.projectionMatrix.copy(Am)}this.cameraL.matrixWorld.copy(wm.matrixWorld).multiply(Tm),this.cameraR.matrixWorld.copy(wm.matrixWorld).multiply(Sm)}}()}),Pi.prototype=Object.create(K.prototype),Pi.prototype.constructor=Pi,Object.assign(Ci.prototype,{start:function(){this.startTime=('undefined'==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var fm=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var hm=('undefined'==typeof performance?Date:performance).now();fm=(hm-this.oldTime)/1e3,this.oldTime=hm,this.elapsedTime+=fm}return fm}}),Ri.prototype=Object.assign(Object.create(K.prototype),{constructor:Ri,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(fm){return null===this.filter?this.gain.disconnect(this.context.destination):(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)),this.filter=fm,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(fm){return this.gain.gain.setTargetAtTime(fm,this.context.currentTime,0.01),this},updateMatrixWorld:function(){var fm=new A,hm=new L,ym=new A,xm=new A,vm=new Ci;return function(bm){K.prototype.updateMatrixWorld.call(this,bm);var Mm=this.context.listener,Sm=this.up;if(this.timeDelta=vm.getDelta(),this.matrixWorld.decompose(fm,hm,ym),xm.set(0,0,-1).applyQuaternion(hm),Mm.positionX){var Tm=this.context.currentTime+this.timeDelta;Mm.positionX.linearRampToValueAtTime(fm.x,Tm),Mm.positionY.linearRampToValueAtTime(fm.y,Tm),Mm.positionZ.linearRampToValueAtTime(fm.z,Tm),Mm.forwardX.linearRampToValueAtTime(xm.x,Tm),Mm.forwardY.linearRampToValueAtTime(xm.y,Tm),Mm.forwardZ.linearRampToValueAtTime(xm.z,Tm),Mm.upX.linearRampToValueAtTime(Sm.x,Tm),Mm.upY.linearRampToValueAtTime(Sm.y,Tm),Mm.upZ.linearRampToValueAtTime(Sm.z,Tm)}else Mm.setPosition(fm.x,fm.y,fm.z),Mm.setOrientation(xm.x,xm.y,xm.z,Sm.x,Sm.y,Sm.z)}}()}),Ii.prototype=Object.assign(Object.create(K.prototype),{constructor:Ii,getOutput:function(){return this.gain},setNodeSource:function(fm){return this.hasPlaybackControl=!1,this.sourceType='audioNode',this.source=fm,this.connect(),this},setMediaElementSource:function(fm){return this.hasPlaybackControl=!1,this.sourceType='mediaNode',this.source=this.context.createMediaElementSource(fm),this.connect(),this},setBuffer:function(fm){return this.buffer=fm,this.sourceType='buffer',this.autoplay&&this.play(),this},play:function(){if(!0===this.isPlaying)return void console.warn('THREE.Audio: Audio is already playing.');if(!1===this.hasPlaybackControl)return void console.warn('THREE.Audio: this Audio has no playback control.');var fm=this.context.createBufferSource();return fm.buffer=this.buffer,fm.loop=this.loop,fm.onended=this.onEnded.bind(this),fm.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,fm.start(this.startTime,this.offset),this.isPlaying=!0,this.source=fm,this.connect()},pause:function(){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this)},stop:function(){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this)},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var fm=1,hm=this.filters.length;fm<hm;fm++)this.filters[fm-1].connect(this.filters[fm]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var fm=1,hm=this.filters.length;fm<hm;fm++)this.filters[fm-1].disconnect(this.filters[fm]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(fm){return fm||(fm=[]),!0===this.isPlaying?(this.disconnect(),this.filters=fm,this.connect()):this.filters=fm,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(fm){return this.setFilters(fm?[fm]:[])},setPlaybackRate:function(fm){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(this.playbackRate=fm,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this)},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn('THREE.Audio: this Audio has no playback control.'),!1):this.loop},setLoop:function(fm){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(this.loop=fm,!0===this.isPlaying&&(this.source.loop=this.loop),this)},getVolume:function(){return this.gain.gain.value},setVolume:function(fm){return this.gain.gain.setTargetAtTime(fm,this.context.currentTime,0.01),this}}),Di.prototype=Object.assign(Object.create(Ii.prototype),{constructor:Di,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(fm){return this.panner.refDistance=fm,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(fm){return this.panner.rolloffFactor=fm,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(fm){return this.panner.distanceModel=fm,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(fm){return this.panner.maxDistance=fm,this},setDirectionalCone:function(fm,hm,ym){return this.panner.coneInnerAngle=fm,this.panner.coneOuterAngle=hm,this.panner.coneOuterGain=ym,this},updateMatrixWorld:function(){var fm=new A,hm=new L,ym=new A,xm=new A;return function(_m){K.prototype.updateMatrixWorld.call(this,_m);var bm=this.panner;if(this.matrixWorld.decompose(fm,hm,ym),xm.set(0,0,1).applyQuaternion(hm),bm.positionX){var Mm=this.context.currentTime+this.listener.timeDelta;bm.positionX.linearRampToValueAtTime(fm.x,Mm),bm.positionY.linearRampToValueAtTime(fm.y,Mm),bm.positionZ.linearRampToValueAtTime(fm.z,Mm),bm.orientationX.linearRampToValueAtTime(xm.x,Mm),bm.orientationY.linearRampToValueAtTime(xm.y,Mm),bm.orientationZ.linearRampToValueAtTime(xm.z,Mm)}else bm.setPosition(fm.x,fm.y,fm.z),bm.setOrientation(xm.x,xm.y,xm.z)}}()}),Object.assign(zi.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var fm=0,hm=this.getFrequencyData(),ym=0;ym<hm.length;ym++)fm+=hm[ym];return fm/hm.length}}),Object.assign(Ni.prototype,{accumulate:function(fm,hm){var ym=this.buffer,xm=this.valueSize,vm=fm*xm+xm,_m=this.cumulativeWeight;if(0===_m){for(var bm=0;bm!==xm;++bm)ym[vm+bm]=ym[bm];_m=hm}else{_m+=hm;var Mm=hm/_m;this._mixBufferRegion(ym,vm,0,Mm,xm)}this.cumulativeWeight=_m},apply:function(fm){var hm=this.valueSize,ym=this.buffer,xm=fm*hm+hm,vm=this.cumulativeWeight,_m=this.binding;if(this.cumulativeWeight=0,1>vm){this._mixBufferRegion(ym,xm,3*hm,1-vm,hm)}for(var Mm=hm;Mm!==hm+hm;++Mm)if(ym[Mm]!==ym[Mm+hm]){_m.setValue(ym,xm);break}},saveOriginalState:function(){var fm=this.binding,hm=this.buffer,ym=this.valueSize,xm=3*ym;fm.getValue(hm,xm);for(var vm=ym;vm!==xm;++vm)hm[vm]=hm[xm+vm%ym];this.cumulativeWeight=0},restoreOriginalState:function(){var fm=3*this.valueSize;this.binding.setValue(this.buffer,fm)},_select:function(fm,hm,ym,xm,vm){if(0.5<=xm)for(var _m=0;_m!==vm;++_m)fm[hm+_m]=fm[ym+_m]},_slerp:function(fm,hm,ym,xm){L.slerpFlat(fm,hm,fm,hm,fm,ym,xm)},_lerp:function(fm,hm,ym,xm,vm){for(var bm=0,Mm;bm!==vm;++bm)Mm=hm+bm,fm[Mm]=fm[Mm]*(1-xm)+fm[ym+bm]*xm}});var Eu='\\[\\]\\.:\\/';Object.assign(Bi.prototype,{getValue:function(fm,hm){this.bind();var ym=this._targetGroup.nCachedObjects_,xm=this._bindings[ym];xm!==void 0&&xm.getValue(fm,hm)},setValue:function(fm,hm){for(var ym=this._bindings,xm=this._targetGroup.nCachedObjects_,vm=ym.length;xm!==vm;++xm)ym[xm].setValue(fm,hm)},bind:function(){for(var fm=this._bindings,hm=this._targetGroup.nCachedObjects_,ym=fm.length;hm!==ym;++hm)fm[hm].bind()},unbind:function(){for(var fm=this._bindings,hm=this._targetGroup.nCachedObjects_,ym=fm.length;hm!==ym;++hm)fm[hm].unbind()}}),Object.assign(Ui,{Composite:Bi,create:function(fm,hm,ym){return fm&&fm.isAnimationObjectGroup?new Ui.Composite(fm,hm,ym):new Ui(fm,hm,ym)},sanitizeNodeName:function(){var fm=/[\[\]\.:\/]/g;return function(ym){return ym.replace(/\s/g,'_').replace(fm,'')}}(),parseTrackName:function(){var fm='[^'+Eu+']',hm='[^'+Eu.replace('\\.','')+']',ym=/((?:WC+[\/:])*)/.source.replace('WC',fm),xm=/(WCOD+)?/.source.replace('WCOD',hm),vm=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace('WC',fm),_m=/\.(WC+)(?:\[(.+)\])?/.source.replace('WC',fm),bm=new RegExp('^'+ym+xm+vm+_m+'$'),Mm=['material','materials','bones'];return function(Tm){var Em=bm.exec(Tm);if(!Em)throw new Error('PropertyBinding: Cannot parse trackName: '+Tm);var wm={nodeName:Em[2],objectName:Em[3],objectIndex:Em[4],propertyName:Em[5],propertyIndex:Em[6]},Lm=wm.nodeName&&wm.nodeName.lastIndexOf('.');if(Lm!==void 0&&-1!==Lm){var Am=wm.nodeName.substring(Lm+1);-1!==Mm.indexOf(Am)&&(wm.nodeName=wm.nodeName.substring(0,Lm),wm.objectName=Am)}if(null===wm.propertyName||0===wm.propertyName.length)throw new Error('PropertyBinding: can not parse propertyName from trackName: '+Tm);return wm}}(),findNode:function(fm,hm){if(!hm||''===hm||'root'===hm||'.'===hm||-1===hm||hm===fm.name||hm===fm.uuid)return fm;if(fm.skeleton){var ym=fm.skeleton.getBoneByName(hm);if(void 0!==ym)return ym}if(fm.children){var xm=function(_m){for(var bm=0,Mm;bm<_m.length;bm++){if(Mm=_m[bm],Mm.name===hm||Mm.uuid===hm)return Mm;var Sm=xm(Mm.children);if(Sm)return Sm}return null},vm=xm(fm.children);if(vm)return vm}return null}}),Object.assign(Ui.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(hm,ym){hm[ym]=this.node[this.propertyName]},function(hm,ym){for(var xm=this.resolvedProperty,vm=0,_m=xm.length;vm!==_m;++vm)hm[ym++]=xm[vm]},function(hm,ym){hm[ym]=this.resolvedProperty[this.propertyIndex]},function(hm,ym){this.resolvedProperty.toArray(hm,ym)}],SetterByBindingTypeAndVersioning:[[function(hm,ym){this.targetObject[this.propertyName]=hm[ym]},function(hm,ym){this.targetObject[this.propertyName]=hm[ym],this.targetObject.needsUpdate=!0},function(hm,ym){this.targetObject[this.propertyName]=hm[ym],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(hm,ym){for(var xm=this.resolvedProperty,vm=0,_m=xm.length;vm!==_m;++vm)xm[vm]=hm[ym++]},function(hm,ym){for(var xm=this.resolvedProperty,vm=0,_m=xm.length;vm!==_m;++vm)xm[vm]=hm[ym++];this.targetObject.needsUpdate=!0},function(hm,ym){for(var xm=this.resolvedProperty,vm=0,_m=xm.length;vm!==_m;++vm)xm[vm]=hm[ym++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(hm,ym){this.resolvedProperty[this.propertyIndex]=hm[ym]},function(hm,ym){this.resolvedProperty[this.propertyIndex]=hm[ym],this.targetObject.needsUpdate=!0},function(hm,ym){this.resolvedProperty[this.propertyIndex]=hm[ym],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(hm,ym){this.resolvedProperty.fromArray(hm,ym)},function(hm,ym){this.resolvedProperty.fromArray(hm,ym),this.targetObject.needsUpdate=!0},function(hm,ym){this.resolvedProperty.fromArray(hm,ym),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(hm,ym){this.bind(),this.getValue(hm,ym)},setValue:function(hm,ym){this.bind(),this.setValue(hm,ym)},bind:function(){var fm=this.node,hm=this.parsedPath,ym=hm.objectName,xm=hm.propertyName,vm=hm.propertyIndex;if(fm||(fm=Ui.findNode(this.rootNode,hm.nodeName)||this.rootNode,this.node=fm),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!fm)return void console.error('THREE.PropertyBinding: Trying to update node for track: '+this.path+' but it wasn\'t found.');if(ym){var _m=hm.objectIndex;switch(ym){case'materials':if(!fm.material)return void console.error('THREE.PropertyBinding: Can not bind to material as node does not have a material.',this);if(!fm.material.materials)return void console.error('THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.',this);fm=fm.material.materials;break;case'bones':if(!fm.skeleton)return void console.error('THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.',this);fm=fm.skeleton.bones;for(var bm=0;bm<fm.length;bm++)if(fm[bm].name===_m){_m=bm;break}break;default:if(void 0===fm[ym])return void console.error('THREE.PropertyBinding: Can not bind to objectName of node undefined.',this);fm=fm[ym];}if(void 0!==_m){if(void 0===fm[_m])return void console.error('THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.',this,fm);fm=fm[_m]}}var Mm=fm[xm];if(void 0===Mm){var Sm=hm.nodeName;return void console.error('THREE.PropertyBinding: Trying to update property for track: '+Sm+'.'+xm+' but it wasn\'t found.',fm)}var Tm=this.Versioning.None;this.targetObject=fm,void 0===fm.needsUpdate?void 0!==fm.matrixWorldNeedsUpdate&&(Tm=this.Versioning.MatrixWorldNeedsUpdate):Tm=this.Versioning.NeedsUpdate;var Em=this.BindingType.Direct;if(void 0!==vm){if('morphTargetInfluences'===xm){if(!fm.geometry)return void console.error('THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.',this);if(fm.geometry.isBufferGeometry){if(!fm.geometry.morphAttributes)return void console.error('THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.',this);for(var bm=0;bm<this.node.geometry.morphAttributes.position.length;bm++)if(fm.geometry.morphAttributes.position[bm].name===vm){vm=bm;break}}else{if(!fm.geometry.morphTargets)return void console.error('THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.',this);for(var bm=0;bm<this.node.geometry.morphTargets.length;bm++)if(fm.geometry.morphTargets[bm].name===vm){vm=bm;break}}}Em=this.BindingType.ArrayElement,this.resolvedProperty=Mm,this.propertyIndex=vm}else void 0!==Mm.fromArray&&void 0!==Mm.toArray?(Em=this.BindingType.HasFromToArray,this.resolvedProperty=Mm):Array.isArray(Mm)?(Em=this.BindingType.EntireArray,this.resolvedProperty=Mm):this.propertyName=xm;this.getValue=this.GetterByBindingType[Em],this.setValue=this.SetterByBindingTypeAndVersioning[Em][Tm]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Ui.prototype,{_getValue_unbound:Ui.prototype.getValue,_setValue_unbound:Ui.prototype.setValue}),Object.assign(function(){this.uuid=dp.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var fm={};this._indicesByUUID=fm;for(var hm=0,ym=arguments.length;hm!==ym;++hm)fm[arguments[hm].uuid]=hm;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var xm=this;this.stats={objects:{get total(){return xm._objects.length},get inUse(){return this.total-xm.nCachedObjects_}},get bindingsPerObject(){return xm._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var fm=this._objects,hm=fm.length,ym=this.nCachedObjects_,xm=this._indicesByUUID,vm=this._paths,_m=this._parsedPaths,bm=this._bindings,Mm=bm.length,Sm=void 0,Tm=0,Em=arguments.length;Tm!==Em;++Tm){var wm=arguments[Tm],Lm=wm.uuid,Am=xm[Lm];if(Am===void 0){Am=hm++,xm[Lm]=Am,fm.push(wm);for(var Pm=0,Cm=Mm;Pm!==Cm;++Pm)bm[Pm].push(new Ui(wm,vm[Pm],_m[Pm]))}else if(Am<ym){Sm=fm[Am];var Rm=--ym,Im=fm[Rm];xm[Im.uuid]=Am,fm[Am]=Im,xm[Lm]=Rm,fm[Rm]=wm;for(var Pm=0,Cm=Mm;Pm!==Cm;++Pm){var Dm=bm[Pm],zm=Dm[Rm],Nm=Dm[Am];Dm[Am]=zm,Nm===void 0&&(Nm=new Ui(wm,vm[Pm],_m[Pm])),Dm[Rm]=Nm}}else fm[Am]!==Sm&&console.error('THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.')}this.nCachedObjects_=ym},remove:function(){for(var fm=this._objects,hm=this.nCachedObjects_,ym=this._indicesByUUID,xm=this._bindings,vm=xm.length,_m=0,bm=arguments.length;_m!==bm;++_m){var Mm=arguments[_m],Sm=Mm.uuid,Tm=ym[Sm];if(Tm!==void 0&&Tm>=hm){var Em=hm++,wm=fm[Em];ym[wm.uuid]=Tm,fm[Tm]=wm,ym[Sm]=Em,fm[Em]=Mm;for(var Lm=0;Lm!==vm;++Lm){var Pm=xm[Lm],Cm=Pm[Em],Rm=Pm[Tm];Pm[Tm]=Cm,Pm[Em]=Rm}}}this.nCachedObjects_=hm},uncache:function(){for(var fm=this._objects,hm=fm.length,ym=this.nCachedObjects_,xm=this._indicesByUUID,vm=this._bindings,_m=vm.length,bm=0,Mm=arguments.length;bm!==Mm;++bm){var Sm=arguments[bm],Tm=Sm.uuid,Em=xm[Tm];if(void 0!==Em)if(delete xm[Tm],Em<ym){var wm=--ym,Lm=fm[wm],Am=--hm,Pm=fm[Am];xm[Lm.uuid]=Em,fm[Em]=Lm,xm[Pm.uuid]=wm,fm[wm]=Pm,fm.pop();for(var Cm=0,Rm=_m;Cm!==Rm;++Cm){var Im=vm[Cm],Dm=Im[wm],zm=Im[Am];Im[Em]=Dm,Im[wm]=zm,Im.pop()}}else{var Am=--hm,Pm=fm[Am];xm[Pm.uuid]=Em,fm[Em]=Pm,fm.pop();for(var Cm=0,Rm=_m,Im;Cm!==Rm;++Cm)Im=vm[Cm],Im[Em]=Im[Am],Im.pop()}}this.nCachedObjects_=ym},subscribe_:function(fm,hm){var ym=this._bindingsIndicesByPath,xm=ym[fm],vm=this._bindings;if(xm!==void 0)return vm[xm];var _m=this._paths,bm=this._parsedPaths,Mm=this._objects,Sm=Mm.length,Tm=this.nCachedObjects_,Em=Array(Sm);xm=vm.length,ym[fm]=xm,_m.push(fm),bm.push(hm),vm.push(Em);for(var wm=Tm,Lm=Mm.length,Am;wm!==Lm;++wm)Am=Mm[wm],Em[wm]=new Ui(Am,fm,hm);return Em},unsubscribe_:function(fm){var hm=this._bindingsIndicesByPath,ym=hm[fm];if(ym!==void 0){var xm=this._paths,vm=this._parsedPaths,_m=this._bindings,bm=_m.length-1,Mm=_m[bm],Sm=fm[bm];hm[Sm]=ym,_m[ym]=Mm,_m.pop(),vm[ym]=vm[bm],vm.pop(),xm[ym]=xm[bm],xm.pop()}}}),Object.assign(Oi.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(fm){return this._startTime=fm,this},setLoop:function(fm,hm){return this.loop=fm,this.repetitions=hm,this},setEffectiveWeight:function(fm){return this.weight=fm,this._effectiveWeight=this.enabled?fm:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(fm){return this._scheduleFading(fm,0,1)},fadeOut:function(fm){return this._scheduleFading(fm,1,0)},crossFadeFrom:function(fm,hm,ym){if(fm.fadeOut(hm),this.fadeIn(hm),ym){var xm=this._clip.duration,vm=fm._clip.duration;fm.warp(1,vm/xm,hm),this.warp(xm/vm,1,hm)}return this},crossFadeTo:function(fm,hm,ym){return fm.crossFadeFrom(this,hm,ym)},stopFading:function(){var fm=this._weightInterpolant;return null!==fm&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(fm)),this},setEffectiveTimeScale:function(fm){return this.timeScale=fm,this._effectiveTimeScale=this.paused?0:fm,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(fm){return this.timeScale=this._clip.duration/fm,this.stopWarping()},syncWith:function(fm){return this.time=fm.time,this.timeScale=fm.timeScale,this.stopWarping()},halt:function(fm){return this.warp(this._effectiveTimeScale,0,fm)},warp:function(fm,hm,ym){var xm=this._mixer,vm=xm.time,_m=this._timeScaleInterpolant,bm=this.timeScale;null===_m&&(_m=xm._lendControlInterpolant(),this._timeScaleInterpolant=_m);var Mm=_m.parameterPositions,Sm=_m.sampleValues;return Mm[0]=vm,Mm[1]=vm+ym,Sm[0]=fm/bm,Sm[1]=hm/bm,this},stopWarping:function(){var fm=this._timeScaleInterpolant;return null!==fm&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(fm)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(fm,hm,ym,xm){if(!this.enabled)return void this._updateWeight(fm);var vm=this._startTime;if(null!==vm){var _m=(fm-vm)*ym;if(0>_m||0===ym)return;this._startTime=null,hm=ym*_m}hm*=this._updateTimeScale(fm);var bm=this._updateTime(hm),Mm=this._updateWeight(fm);if(0<Mm)for(var Sm=this._interpolants,Tm=this._propertyBindings,Em=0,wm=Sm.length;Em!==wm;++Em)Sm[Em].evaluate(bm),Tm[Em].accumulate(xm,Mm)},_updateWeight:function(fm){var hm=0;if(this.enabled){hm=this.weight;var ym=this._weightInterpolant;if(null!==ym){var xm=ym.evaluate(fm)[0];hm*=xm,fm>ym.parameterPositions[1]&&(this.stopFading(),0===xm&&(this.enabled=!1))}}return this._effectiveWeight=hm,hm},_updateTimeScale:function(fm){var hm=0;if(!this.paused){hm=this.timeScale;var ym=this._timeScaleInterpolant;if(null!==ym){var xm=ym.evaluate(fm)[0];hm*=xm,fm>ym.parameterPositions[1]&&(this.stopWarping(),0==hm?this.paused=!0:this.timeScale=hm)}}return this._effectiveTimeScale=hm,hm},_updateTime:function(fm){var hm=this.time+fm,ym=this._clip.duration,xm=this.loop,vm=this._loopCount,_m=xm===2202;if(0===fm)return-1===vm?hm:_m&&1==(1&vm)?ym-hm:hm;if(xm===2200){-1===vm&&(this._loopCount=0,this._setEndings(!0,!0,!1));handle_stop:{if(hm>=ym)hm=ym;else if(0>hm)hm=0;else break handle_stop;this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:'finished',action:this,direction:0>fm?-1:1})}}else{if(-1===vm&&(0<=fm?(vm=0,this._setEndings(!0,0===this.repetitions,_m)):this._setEndings(0===this.repetitions,!0,_m)),hm>=ym||0>hm){var bm=Math.floor(hm/ym);hm-=ym*bm,vm+=Math.abs(bm);var Mm=this.repetitions-vm;if(0>=Mm)this.clampWhenFinished?this.paused=!0:this.enabled=!1,hm=0<fm?ym:0,this._mixer.dispatchEvent({type:'finished',action:this,direction:0<fm?1:-1});else{if(1==Mm){var Sm=0>fm;this._setEndings(Sm,!Sm,_m)}else this._setEndings(!1,!1,_m);this._loopCount=vm,this._mixer.dispatchEvent({type:'loop',action:this,loopDelta:bm})}}if(_m&&1==(1&vm))return this.time=hm,ym-hm}return this.time=hm,hm},_setEndings:function(fm,hm,ym){var xm=this._interpolantSettings;ym?(xm.endingStart=Xl,xm.endingEnd=Xl):(xm.endingStart=fm?this.zeroSlopeAtStart?Xl:ql:Yl,xm.endingEnd=hm?this.zeroSlopeAtEnd?Xl:ql:Yl)},_scheduleFading:function(fm,hm,ym){var xm=this._mixer,vm=xm.time,_m=this._weightInterpolant;null===_m&&(_m=xm._lendControlInterpolant(),this._weightInterpolant=_m);var bm=_m.parameterPositions,Mm=_m.sampleValues;return bm[0]=vm,Mm[0]=hm,bm[1]=vm+fm,Mm[1]=ym,this}}),Fi.prototype=Object.assign(Object.create(M.prototype),{constructor:Fi,_bindAction:function(fm,hm){var ym=fm._localRoot||this._root,xm=fm._clip.tracks,vm=xm.length,_m=fm._propertyBindings,bm=fm._interpolants,Mm=ym.uuid,Sm=this._bindingsByRootAndName,Tm=Sm[Mm];Tm===void 0&&(Tm={},Sm[Mm]=Tm);for(var Em=0;Em!==vm;++Em){var wm=xm[Em],Lm=wm.name,Am=Tm[Lm];if(void 0!==Am)_m[Em]=Am;else{if(Am=_m[Em],void 0!==Am){null===Am._cacheIndex&&(++Am.referenceCount,this._addInactiveBinding(Am,Mm,Lm));continue}var Pm=hm&&hm._propertyBindings[Em].binding.parsedPath;Am=new Ni(Ui.create(ym,Lm,Pm),wm.ValueTypeName,wm.getValueSize()),++Am.referenceCount,this._addInactiveBinding(Am,Mm,Lm),_m[Em]=Am}bm[Em].resultBuffer=Am.buffer}},_activateAction:function(fm){if(!this._isActiveAction(fm)){if(null===fm._cacheIndex){var hm=(fm._localRoot||this._root).uuid,ym=fm._clip.uuid,xm=this._actionsByClip[ym];this._bindAction(fm,xm&&xm.knownActions[0]),this._addInactiveAction(fm,ym,hm)}for(var vm=fm._propertyBindings,_m=0,bm=vm.length,Mm;_m!==bm;++_m)Mm=vm[_m],0==Mm.useCount++&&(this._lendBinding(Mm),Mm.saveOriginalState());this._lendAction(fm)}},_deactivateAction:function(fm){if(this._isActiveAction(fm)){for(var hm=fm._propertyBindings,ym=0,xm=hm.length,vm;ym!==xm;++ym)vm=hm[ym],0==--vm.useCount&&(vm.restoreOriginalState(),this._takeBackBinding(vm));this._takeBackAction(fm)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var fm=this;this.stats={actions:{get total(){return fm._actions.length},get inUse(){return fm._nActiveActions}},bindings:{get total(){return fm._bindings.length},get inUse(){return fm._nActiveBindings}},controlInterpolants:{get total(){return fm._controlInterpolants.length},get inUse(){return fm._nActiveControlInterpolants}}}},_isActiveAction:function(fm){var hm=fm._cacheIndex;return null!==hm&&hm<this._nActiveActions},_addInactiveAction:function(fm,hm,ym){var xm=this._actions,vm=this._actionsByClip,_m=vm[hm];if(_m===void 0)_m={knownActions:[fm],actionByRoot:{}},fm._byClipCacheIndex=0,vm[hm]=_m;else{var bm=_m.knownActions;fm._byClipCacheIndex=bm.length,bm.push(fm)}fm._cacheIndex=xm.length,xm.push(fm),_m.actionByRoot[ym]=fm},_removeInactiveAction:function(fm){var hm=this._actions,ym=hm[hm.length-1],xm=fm._cacheIndex;ym._cacheIndex=xm,hm[xm]=ym,hm.pop(),fm._cacheIndex=null;var vm=fm._clip.uuid,_m=this._actionsByClip,bm=_m[vm],Mm=bm.knownActions,Sm=Mm[Mm.length-1],Tm=fm._byClipCacheIndex;Sm._byClipCacheIndex=Tm,Mm[Tm]=Sm,Mm.pop(),fm._byClipCacheIndex=null;var Em=bm.actionByRoot,wm=(fm._localRoot||this._root).uuid;delete Em[wm],0===Mm.length&&delete _m[vm],this._removeInactiveBindingsForAction(fm)},_removeInactiveBindingsForAction:function(fm){for(var hm=fm._propertyBindings,ym=0,xm=hm.length,vm;ym!==xm;++ym)vm=hm[ym],0==--vm.referenceCount&&this._removeInactiveBinding(vm)},_lendAction:function(fm){var hm=this._actions,ym=fm._cacheIndex,xm=this._nActiveActions++,vm=hm[xm];fm._cacheIndex=xm,hm[xm]=fm,vm._cacheIndex=ym,hm[ym]=vm},_takeBackAction:function(fm){var hm=this._actions,ym=fm._cacheIndex,xm=--this._nActiveActions,vm=hm[xm];fm._cacheIndex=xm,hm[xm]=fm,vm._cacheIndex=ym,hm[ym]=vm},_addInactiveBinding:function(fm,hm,ym){var xm=this._bindingsByRootAndName,vm=xm[hm],_m=this._bindings;vm===void 0&&(vm={},xm[hm]=vm),vm[ym]=fm,fm._cacheIndex=_m.length,_m.push(fm)},_removeInactiveBinding:function(fm){var hm=this._bindings,ym=fm.binding,xm=ym.rootNode.uuid,vm=ym.path,_m=this._bindingsByRootAndName,bm=_m[xm],Mm=hm[hm.length-1],Sm=fm._cacheIndex;Mm._cacheIndex=Sm,hm[Sm]=Mm,hm.pop(),delete bm[vm];remove_empty_map:{for(var Tm in bm)break remove_empty_map;delete _m[xm]}},_lendBinding:function(fm){var hm=this._bindings,ym=fm._cacheIndex,xm=this._nActiveBindings++,vm=hm[xm];fm._cacheIndex=xm,hm[xm]=fm,vm._cacheIndex=ym,hm[ym]=vm},_takeBackBinding:function(fm){var hm=this._bindings,ym=fm._cacheIndex,xm=--this._nActiveBindings,vm=hm[xm];fm._cacheIndex=xm,hm[xm]=fm,vm._cacheIndex=ym,hm[ym]=vm},_lendControlInterpolant:function(){var fm=this._controlInterpolants,hm=this._nActiveControlInterpolants++,ym=fm[hm];return void 0===ym&&(ym=new uo(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),ym.__cacheIndex=hm,fm[hm]=ym),ym},_takeBackControlInterpolant:function(fm){var hm=this._controlInterpolants,ym=fm.__cacheIndex,xm=--this._nActiveControlInterpolants,vm=hm[xm];fm.__cacheIndex=xm,hm[xm]=fm,vm.__cacheIndex=ym,hm[ym]=vm},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(fm,hm){var ym=hm||this._root,xm=ym.uuid,vm='string'==typeof fm?So.findByName(ym,fm):fm,_m=null===vm?fm:vm.uuid,bm=this._actionsByClip[_m],Mm=null;if(void 0!==bm){var Sm=bm.actionByRoot[xm];if(void 0!==Sm)return Sm;Mm=bm.knownActions[0],null===vm&&(vm=Mm._clip)}if(null===vm)return null;var Tm=new Oi(this,vm,hm);return this._bindAction(Tm,Mm),this._addInactiveAction(Tm,_m,xm),Tm},existingAction:function(fm,hm){var ym=hm||this._root,xm=ym.uuid,vm='string'==typeof fm?So.findByName(ym,fm):fm,_m=vm?vm.uuid:fm,bm=this._actionsByClip[_m];return void 0===bm?null:bm.actionByRoot[xm]||null},stopAllAction:function(){var fm=this._actions,hm=this._nActiveActions,ym=this._bindings,xm=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var vm=0;vm!==hm;++vm)fm[vm].reset();for(var vm=0;vm!==xm;++vm)ym[vm].useCount=0;return this},update:function(fm){fm*=this.timeScale;for(var hm=this._actions,ym=this._nActiveActions,xm=this.time+=fm,vm=Math.sign(fm),_m=this._accuIndex^=1,bm=0,Mm;bm!==ym;++bm)Mm=hm[bm],Mm._update(xm,fm,vm,_m);for(var Sm=this._bindings,Tm=this._nActiveBindings,bm=0;bm!==Tm;++bm)Sm[bm].apply(_m);return this},getRoot:function(){return this._root},uncacheClip:function(fm){var hm=this._actions,ym=fm.uuid,xm=this._actionsByClip,vm=xm[ym];if(vm!==void 0){for(var _m=vm.knownActions,bm=0,Mm=_m.length,Sm;bm!==Mm;++bm){Sm=_m[bm],this._deactivateAction(Sm);var Tm=Sm._cacheIndex,Em=hm[hm.length-1];Sm._cacheIndex=null,Sm._byClipCacheIndex=null,Em._cacheIndex=Tm,hm[Tm]=Em,hm.pop(),this._removeInactiveBindingsForAction(Sm)}delete xm[ym]}},uncacheRoot:function(fm){var hm=fm.uuid,ym=this._actionsByClip;for(var xm in ym){var vm=ym[xm].actionByRoot,_m=vm[hm];_m!==void 0&&(this._deactivateAction(_m),this._removeInactiveAction(_m))}var bm=this._bindingsByRootAndName,Mm=bm[hm];if(Mm!==void 0)for(var Sm in Mm){var Tm=Mm[Sm];Tm.restoreOriginalState(),this._removeInactiveBinding(Tm)}},uncacheAction:function(fm,hm){var ym=this.existingAction(fm,hm);null!==ym&&(this._deactivateAction(ym),this._removeInactiveAction(ym))}}),Hi.prototype.clone=function(){return new Hi(this.value.clone===void 0?this.value:this.value.clone())},Vi.prototype=Object.assign(Object.create(xe.prototype),{constructor:Vi,isInstancedBufferGeometry:!0,copy:function(fm){return xe.prototype.copy.call(this,fm),this.maxInstancedCount=fm.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)}}),ki.prototype=Object.assign(Object.create(fr.prototype),{constructor:ki,isInstancedInterleavedBuffer:!0,copy:function(fm){return fr.prototype.copy.call(this,fm),this.meshPerAttribute=fm.meshPerAttribute,this}}),Wi.prototype=Object.assign(Object.create(re.prototype),{constructor:Wi,isInstancedBufferAttribute:!0,copy:function(fm){return re.prototype.copy.call(this,fm),this.meshPerAttribute=fm.meshPerAttribute,this}}),Object.assign(function(fm,hm,ym,xm){this.ray=new we(fm,hm),this.near=ym||0,this.far=xm||Infinity,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn('THREE.Raycaster: params.PointCloud has been renamed to params.Points.'),this.Points}}})}.prototype,{linePrecision:1,set:function(fm,hm){this.ray.set(fm,hm)},setFromCamera:function(fm,hm){hm&&hm.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(hm.matrixWorld),this.ray.direction.set(fm.x,fm.y,0.5).unproject(hm).sub(this.ray.origin).normalize()):hm&&hm.isOrthographicCamera?(this.ray.origin.set(fm.x,fm.y,(hm.near+hm.far)/(hm.near-hm.far)).unproject(hm),this.ray.direction.set(0,0,-1).transformDirection(hm.matrixWorld)):console.error('THREE.Raycaster: Unsupported camera type.')},intersectObject:function(fm,hm,ym){var xm=ym||[];return Xi(fm,this,xm,hm),xm.sort(qi),xm},intersectObjects:function(fm,hm,ym){var xm=ym||[];if(!1===Array.isArray(fm))return console.warn('THREE.Raycaster.intersectObjects: objects is not an Array.'),xm;for(var vm=0,_m=fm.length;vm<_m;vm++)Xi(fm[vm],this,xm,hm);return xm.sort(qi),xm}}),Object.assign(function(fm,hm,ym){return this.radius=void 0===fm?1:fm,this.phi=void 0===hm?0:hm,this.theta=void 0===ym?0:ym,this}.prototype,{set:function(fm,hm,ym){return this.radius=fm,this.phi=hm,this.theta=ym,this},clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.radius=fm.radius,this.phi=fm.phi,this.theta=fm.theta,this},makeSafe:function(){var fm=1e-6;return this.phi=Math.max(fm,Math.min(Math.PI-fm,this.phi)),this},setFromVector3:function(fm){return this.setFromCartesianCoords(fm.x,fm.y,fm.z)},setFromCartesianCoords:function(fm,hm,ym){return this.radius=Math.sqrt(fm*fm+hm*hm+ym*ym),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(fm,ym),this.phi=Math.acos(dp.clamp(hm/this.radius,-1,1))),this}}),Object.assign(function(fm,hm,ym){return this.radius=void 0===fm?1:fm,this.theta=void 0===hm?0:hm,this.y=void 0===ym?0:ym,this}.prototype,{set:function(fm,hm,ym){return this.radius=fm,this.theta=hm,this.y=ym,this},clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.radius=fm.radius,this.theta=fm.theta,this.y=fm.y,this},setFromVector3:function(fm){return this.setFromCartesianCoords(fm.x,fm.y,fm.z)},setFromCartesianCoords:function(fm,hm,ym){return this.radius=Math.sqrt(fm*fm+ym*ym),this.theta=Math.atan2(fm,ym),this.y=hm,this}}),Object.assign(Ji.prototype,{set:function(fm,hm){return this.min.copy(fm),this.max.copy(hm),this},setFromPoints:function(fm){this.makeEmpty();for(var hm=0,ym=fm.length;hm<ym;hm++)this.expandByPoint(fm[hm]);return this},setFromCenterAndSize:function(){var fm=new S;return function(ym,xm){var vm=fm.copy(xm).multiplyScalar(0.5);return this.min.copy(ym).sub(vm),this.max.copy(ym).add(vm),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.min.copy(fm.min),this.max.copy(fm.max),this},makeEmpty:function(){return this.min.x=this.min.y=+Infinity,this.max.x=this.max.y=-Infinity,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(fm){return void 0===fm&&(console.warn('THREE.Box2: .getCenter() target is now required'),fm=new S),this.isEmpty()?fm.set(0,0):fm.addVectors(this.min,this.max).multiplyScalar(0.5)},getSize:function(fm){return void 0===fm&&(console.warn('THREE.Box2: .getSize() target is now required'),fm=new S),this.isEmpty()?fm.set(0,0):fm.subVectors(this.max,this.min)},expandByPoint:function(fm){return this.min.min(fm),this.max.max(fm),this},expandByVector:function(fm){return this.min.sub(fm),this.max.add(fm),this},expandByScalar:function(fm){return this.min.addScalar(-fm),this.max.addScalar(fm),this},containsPoint:function(fm){return fm.x<this.min.x||fm.x>this.max.x||fm.y<this.min.y||fm.y>this.max.y?!1:!0},containsBox:function(fm){return this.min.x<=fm.min.x&&fm.max.x<=this.max.x&&this.min.y<=fm.min.y&&fm.max.y<=this.max.y},getParameter:function(fm,hm){return void 0===hm&&(console.warn('THREE.Box2: .getParameter() target is now required'),hm=new S),hm.set((fm.x-this.min.x)/(this.max.x-this.min.x),(fm.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(fm){return fm.max.x<this.min.x||fm.min.x>this.max.x||fm.max.y<this.min.y||fm.min.y>this.max.y?!1:!0},clampPoint:function(fm,hm){return void 0===hm&&(console.warn('THREE.Box2: .clampPoint() target is now required'),hm=new S),hm.copy(fm).clamp(this.min,this.max)},distanceToPoint:function(){var fm=new S;return function(ym){var xm=fm.copy(ym).clamp(this.min,this.max);return xm.sub(ym).length()}}(),intersect:function(fm){return this.min.max(fm.min),this.max.min(fm.max),this},union:function(fm){return this.min.min(fm.min),this.max.max(fm.max),this},translate:function(fm){return this.min.add(fm),this.max.add(fm),this},equals:function(fm){return fm.min.equals(this.min)&&fm.max.equals(this.max)}}),Object.assign(Qi.prototype,{set:function(fm,hm){return this.start.copy(fm),this.end.copy(hm),this},clone:function(){return new this.constructor().copy(this)},copy:function(fm){return this.start.copy(fm.start),this.end.copy(fm.end),this},getCenter:function(fm){return void 0===fm&&(console.warn('THREE.Line3: .getCenter() target is now required'),fm=new A),fm.addVectors(this.start,this.end).multiplyScalar(0.5)},delta:function(fm){return void 0===fm&&(console.warn('THREE.Line3: .delta() target is now required'),fm=new A),fm.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(fm,hm){return void 0===hm&&(console.warn('THREE.Line3: .at() target is now required'),hm=new A),this.delta(hm).multiplyScalar(fm).add(this.start)},closestPointToPointParameter:function(){var fm=new A,hm=new A;return function(xm,vm){fm.subVectors(xm,this.start),hm.subVectors(this.end,this.start);var _m=hm.dot(hm),bm=hm.dot(fm),Mm=bm/_m;return vm&&(Mm=dp.clamp(Mm,0,1)),Mm}}(),closestPointToPoint:function(fm,hm,ym){var xm=this.closestPointToPointParameter(fm,hm);return void 0===ym&&(console.warn('THREE.Line3: .closestPointToPoint() target is now required'),ym=new A),this.delta(ym).multiplyScalar(xm).add(this.start)},applyMatrix4:function(fm){return this.start.applyMatrix4(fm),this.end.applyMatrix4(fm),this},equals:function(fm){return fm.start.equals(this.start)&&fm.end.equals(this.end)}}),Ki.prototype=Object.create(K.prototype),Ki.prototype.constructor=Ki,Ki.prototype.isImmediateRenderObject=!0,$i.prototype=Object.create(wr.prototype),$i.prototype.constructor=$i,$i.prototype.update=function(){var fm=new A,hm=new A,ym=new C;return function(){var vm=['a','b','c'];this.object.updateMatrixWorld(!0),ym.getNormalMatrix(this.object.matrixWorld);var _m=this.object.matrixWorld,bm=this.geometry.attributes.position,Mm=this.object.geometry;if(Mm&&Mm.isGeometry)for(var Sm=Mm.vertices,Tm=Mm.faces,Em=0,wm=0,Lm=Tm.length,Am;wm<Lm;wm++){Am=Tm[wm];for(var Pm=0,Cm=Am.vertexNormals.length;Pm<Cm;Pm++){var Rm=Sm[Am[vm[Pm]]],Im=Am.vertexNormals[Pm];fm.copy(Rm).applyMatrix4(_m),hm.copy(Im).applyMatrix3(ym).normalize().multiplyScalar(this.size).add(fm),bm.setXYZ(Em,fm.x,fm.y,fm.z),++Em,bm.setXYZ(Em,hm.x,hm.y,hm.z),++Em}}else if(Mm&&Mm.isBufferGeometry)for(var Dm=Mm.attributes.position,zm=Mm.attributes.normal,Em=0,Pm=0,Cm=Dm.count;Pm<Cm;Pm++)fm.set(Dm.getX(Pm),Dm.getY(Pm),Dm.getZ(Pm)).applyMatrix4(_m),hm.set(zm.getX(Pm),zm.getY(Pm),zm.getZ(Pm)),hm.applyMatrix3(ym).normalize().multiplyScalar(this.size).add(fm),bm.setXYZ(Em,fm.x,fm.y,fm.z),++Em,bm.setXYZ(Em,hm.x,hm.y,hm.z),++Em;bm.needsUpdate=!0}}(),en.prototype=Object.create(K.prototype),en.prototype.constructor=en,en.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},en.prototype.update=function(){var fm=new A,hm=new A;return function(){this.light.updateMatrixWorld();var xm=this.light.distance?this.light.distance:1e3,vm=xm*Math.tan(this.light.angle);this.cone.scale.set(vm,vm,xm),fm.setFromMatrixPosition(this.light.matrixWorld),hm.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(hm.sub(fm)),this.color===void 0?this.cone.material.color.copy(this.light.color):this.cone.material.color.set(this.color)}}(),rn.prototype=Object.create(wr.prototype),rn.prototype.constructor=rn,rn.prototype.updateMatrixWorld=function(){var fm=new A,hm=new E,ym=new E;return function(vm){var _m=this.bones,bm=this.geometry,Mm=bm.getAttribute('position');ym.getInverse(this.root.matrixWorld);for(var Sm=0,Tm=0,Em;Sm<_m.length;Sm++)Em=_m[Sm],Em.parent&&Em.parent.isBone&&(hm.multiplyMatrices(ym,Em.matrixWorld),fm.setFromMatrixPosition(hm),Mm.setXYZ(Tm,fm.x,fm.y,fm.z),hm.multiplyMatrices(ym,Em.parent.matrixWorld),fm.setFromMatrixPosition(hm),Mm.setXYZ(Tm+1,fm.x,fm.y,fm.z),Tm+=2);bm.getAttribute('position').needsUpdate=!0,K.prototype.updateMatrixWorld.call(this,vm)}}(),on.prototype=Object.create(Pe.prototype),on.prototype.constructor=on,on.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},on.prototype.update=function(){this.color===void 0?this.material.color.copy(this.light.color):this.material.color.set(this.color)},nn.prototype=Object.create(K.prototype),nn.prototype.constructor=nn,nn.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},nn.prototype.update=function(){var fm=0.5*this.light.width,hm=0.5*this.light.height,ym=this.line.geometry.attributes.position,xm=ym.array;xm[0]=fm,xm[1]=-hm,xm[2]=0,xm[3]=fm,xm[4]=hm,xm[5]=0,xm[6]=-fm,xm[7]=hm,xm[8]=0,xm[9]=-fm,xm[10]=-hm,xm[11]=0,xm[12]=fm,xm[13]=-hm,xm[14]=0,ym.needsUpdate=!0,this.color===void 0?this.line.material.color.copy(this.light.color):this.line.material.color.set(this.color)},sn.prototype=Object.create(K.prototype),sn.prototype.constructor=sn,sn.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},sn.prototype.update=function(){var fm=new A,hm=new W,ym=new W;return function(){var vm=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var _m=vm.geometry.getAttribute('color');hm.copy(this.light.color),ym.copy(this.light.groundColor);for(var bm=0,Mm=_m.count,Sm;bm<Mm;bm++)Sm=bm<Mm/2?hm:ym,_m.setXYZ(bm,Sm.r,Sm.g,Sm.b);_m.needsUpdate=!0}vm.lookAt(fm.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),ln.prototype=Object.create(wr.prototype),ln.prototype.constructor=ln,pn.prototype=Object.create(wr.prototype),pn.prototype.constructor=pn,dn.prototype=Object.create(wr.prototype),dn.prototype.constructor=dn,dn.prototype.update=function(){var fm=new A,hm=new A,ym=new C;return function(){this.object.updateMatrixWorld(!0),ym.getNormalMatrix(this.object.matrixWorld);for(var vm=this.object.matrixWorld,_m=this.geometry.attributes.position,bm=this.object.geometry,Mm=bm.vertices,Sm=bm.faces,Tm=0,Em=0,wm=Sm.length;Em<wm;Em++){var Lm=Sm[Em],Am=Lm.normal;fm.copy(Mm[Lm.a]).add(Mm[Lm.b]).add(Mm[Lm.c]).divideScalar(3).applyMatrix4(vm),hm.copy(Am).applyMatrix3(ym).normalize().multiplyScalar(this.size).add(fm),_m.setXYZ(Tm,fm.x,fm.y,fm.z),++Tm,_m.setXYZ(Tm,hm.x,hm.y,hm.z),++Tm}_m.needsUpdate=!0}}(),cn.prototype=Object.create(K.prototype),cn.prototype.constructor=cn,cn.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},cn.prototype.update=function(){var fm=new A,hm=new A,ym=new A;return function(){fm.setFromMatrixPosition(this.light.matrixWorld),hm.setFromMatrixPosition(this.light.target.matrixWorld),ym.subVectors(hm,fm),this.lightPlane.lookAt(hm),this.color===void 0?(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)):(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)),this.targetLine.lookAt(hm),this.targetLine.scale.z=ym.length()}}(),un.prototype=Object.create(wr.prototype),un.prototype.constructor=un,un.prototype.update=function(){function fm(_m,bm,Mm,Sm){xm.set(bm,Mm,Sm).unproject(vm);var Tm=ym[_m];if(Tm!==void 0)for(var Em=hm.getAttribute('position'),wm=0,Lm=Tm.length;wm<Lm;wm++)Em.setXYZ(Tm[wm],xm.x,xm.y,xm.z)}var hm,ym,xm=new A,vm=new ir;return function(){hm=this.geometry,ym=this.pointMap;var bm=1,Mm=1;vm.projectionMatrix.copy(this.camera.projectionMatrix),fm('c',0,0,-1),fm('t',0,0,1),fm('n1',-bm,-Mm,-1),fm('n2',bm,-Mm,-1),fm('n3',-bm,Mm,-1),fm('n4',bm,Mm,-1),fm('f1',-bm,-Mm,1),fm('f2',bm,-Mm,1),fm('f3',-bm,Mm,1),fm('f4',bm,Mm,1),fm('u1',0.7*bm,1.1*Mm,-1),fm('u2',0.7*-bm,1.1*Mm,-1),fm('u3',0,2*Mm,-1),fm('cf1',-bm,0,1),fm('cf2',bm,0,1),fm('cf3',0,-Mm,1),fm('cf4',0,Mm,1),fm('cn1',-bm,0,-1),fm('cn2',bm,0,-1),fm('cn3',0,-Mm,-1),fm('cn4',0,Mm,-1),hm.getAttribute('position').needsUpdate=!0}}(),mn.prototype=Object.create(wr.prototype),mn.prototype.constructor=mn,mn.prototype.update=function(){var fm=new O;return function(ym){if(void 0!==ym&&console.warn('THREE.BoxHelper: .update() has no longer arguments.'),void 0!==this.object&&fm.setFromObject(this.object),!fm.isEmpty()){var xm=fm.min,vm=fm.max,_m=this.geometry.attributes.position,bm=_m.array;bm[0]=vm.x,bm[1]=vm.y,bm[2]=vm.z,bm[3]=xm.x,bm[4]=vm.y,bm[5]=vm.z,bm[6]=xm.x,bm[7]=xm.y,bm[8]=vm.z,bm[9]=vm.x,bm[10]=xm.y,bm[11]=vm.z,bm[12]=vm.x,bm[13]=vm.y,bm[14]=xm.z,bm[15]=xm.x,bm[16]=vm.y,bm[17]=xm.z,bm[18]=xm.x,bm[19]=xm.y,bm[20]=xm.z,bm[21]=vm.x,bm[22]=xm.y,bm[23]=xm.z,_m.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),mn.prototype.setFromObject=function(fm){return this.object=fm,this.update(),this},mn.prototype.copy=function(fm){return wr.prototype.copy.call(this,fm),this.object=fm.object,this},mn.prototype.clone=function(){return new this.constructor().copy(this)},gn.prototype=Object.create(wr.prototype),gn.prototype.constructor=gn,gn.prototype.updateMatrixWorld=function(fm){var hm=this.box;hm.isEmpty()||(hm.getCenter(this.position),hm.getSize(this.scale),this.scale.multiplyScalar(0.5),K.prototype.updateMatrixWorld.call(this,fm))},fn.prototype=Object.create(Er.prototype),fn.prototype.constructor=fn,fn.prototype.updateMatrixWorld=function(fm){var hm=-this.plane.constant;1e-8>Math.abs(hm)&&(hm=1e-8),this.scale.set(0.5*this.size,0.5*this.size,hm),this.children[0].material.side=0>hm?Cn:Pn,this.lookAt(this.plane.normal),K.prototype.updateMatrixWorld.call(this,fm)};var wu,Lu;hn.prototype=Object.create(K.prototype),hn.prototype.constructor=hn,hn.prototype.setDirection=function(){var fm=new A,hm;return function(xm){0.99999<xm.y?this.quaternion.set(0,0,0,1):-0.99999>xm.y?this.quaternion.set(1,0,0,0):(fm.set(xm.z,0,-xm.x).normalize(),hm=Math.acos(xm.y),this.quaternion.setFromAxisAngle(fm,hm))}}(),hn.prototype.setLength=function(fm,hm,ym){hm===void 0&&(hm=0.2*fm),ym===void 0&&(ym=0.2*hm),this.line.scale.set(1,Math.max(0,fm-hm),1),this.line.updateMatrix(),this.cone.scale.set(ym,hm,ym),this.cone.position.y=fm,this.cone.updateMatrix()},hn.prototype.setColor=function(fm){this.line.material.color.copy(fm),this.cone.material.color.copy(fm)},hn.prototype.copy=function(fm){return K.prototype.copy.call(this,fm,!1),this.line.copy(fm.line),this.cone.copy(fm.cone),this},hn.prototype.clone=function(){return new this.constructor().copy(this)},yn.prototype=Object.create(wr.prototype),yn.prototype.constructor=yn,zo.create=function(fm,hm){return console.log('THREE.Curve.create() has been deprecated'),fm.prototype=Object.create(zo.prototype),fm.prototype.constructor=fm,fm.prototype.getPoint=hm,fm},Object.assign(ri.prototype,{createPointsGeometry:function(fm){console.warn('THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.');var hm=this.getPoints(fm);return this.createGeometry(hm)},createSpacedPointsGeometry:function(fm){console.warn('THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.');var hm=this.getSpacedPoints(fm);return this.createGeometry(hm)},createGeometry:function(fm){console.warn('THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.');for(var hm=new ee,ym=0,xm=fm.length,vm;ym<xm;ym++)vm=fm[ym],hm.vertices.push(new A(vm.x,vm.y,vm.z||0));return hm}}),Object.assign(ai.prototype,{fromPoints:function(fm){console.warn('THREE.Path: .fromPoints() has been renamed to .setFromPoints().'),this.setFromPoints(fm)}}),xn.prototype=Object.create(Go.prototype),Object.assign(xn.prototype,{initFromArray:function(){console.error('THREE.Spline: .initFromArray() has been removed.')},getControlPointsArray:function(){console.error('THREE.Spline: .getControlPointsArray() has been removed.')},reparametrizeByArcLength:function(){console.error('THREE.Spline: .reparametrizeByArcLength() has been removed.')}}),ln.prototype.setColors=function(){console.error('THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.')},rn.prototype.update=function(){console.error('THREE.SkeletonHelper: update() no longer needs to be called.')},Object.assign(vi.prototype,{extractUrlBase:function(fm){return console.warn('THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.'),xu.extractUrlBase(fm)}}),Object.assign(_i.prototype,{setTexturePath:function(fm){return console.warn('THREE.JSONLoader: .setTexturePath() has been renamed to .setResourcePath().'),this.setResourcePath(fm)}}),Object.assign(bi.prototype,{setTexturePath:function(fm){return console.warn('THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath().'),this.setResourcePath(fm)}}),Object.assign(Ji.prototype,{center:function(fm){return console.warn('THREE.Box2: .center() has been renamed to .getCenter().'),this.getCenter(fm)},empty:function(){return console.warn('THREE.Box2: .empty() has been renamed to .isEmpty().'),this.isEmpty()},isIntersectionBox:function(fm){return console.warn('THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().'),this.intersectsBox(fm)},size:function(fm){return console.warn('THREE.Box2: .size() has been renamed to .getSize().'),this.getSize(fm)}}),Object.assign(O.prototype,{center:function(fm){return console.warn('THREE.Box3: .center() has been renamed to .getCenter().'),this.getCenter(fm)},empty:function(){return console.warn('THREE.Box3: .empty() has been renamed to .isEmpty().'),this.isEmpty()},isIntersectionBox:function(fm){return console.warn('THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().'),this.intersectsBox(fm)},isIntersectionSphere:function(fm){return console.warn('THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().'),this.intersectsSphere(fm)},size:function(fm){return console.warn('THREE.Box3: .size() has been renamed to .getSize().'),this.getSize(fm)}}),Qi.prototype.center=function(fm){return console.warn('THREE.Line3: .center() has been renamed to .getCenter().'),this.getCenter(fm)},Object.assign(dp,{random16:function(){return console.warn('THREE.Math: .random16() has been deprecated. Use Math.random() instead.'),Math.random()},nearestPowerOfTwo:function(fm){return console.warn('THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo().'),dp.floorPowerOfTwo(fm)},nextPowerOfTwo:function(fm){return console.warn('THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo().'),dp.ceilPowerOfTwo(fm)}}),Object.assign(C.prototype,{flattenToArrayOffset:function(fm,hm){return console.warn('THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.'),this.toArray(fm,hm)},multiplyVector3:function(fm){return console.warn('THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.'),fm.applyMatrix3(this)},multiplyVector3Array:function(){console.error('THREE.Matrix3: .multiplyVector3Array() has been removed.')},applyToBuffer:function(fm){return console.warn('THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.'),this.applyToBufferAttribute(fm)},applyToVector3Array:function(){console.error('THREE.Matrix3: .applyToVector3Array() has been removed.')}}),Object.assign(E.prototype,{extractPosition:function(fm){return console.warn('THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().'),this.copyPosition(fm)},flattenToArrayOffset:function(fm,hm){return console.warn('THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.'),this.toArray(fm,hm)},getPosition:function(){var fm;return function(){return void 0==fm&&(fm=new A),console.warn('THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.'),fm.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(fm){return console.warn('THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().'),this.makeRotationFromQuaternion(fm)},multiplyToArray:function(){console.warn('THREE.Matrix4: .multiplyToArray() has been removed.')},multiplyVector3:function(fm){return console.warn('THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.'),fm.applyMatrix4(this)},multiplyVector4:function(fm){return console.warn('THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.'),fm.applyMatrix4(this)},multiplyVector3Array:function(){console.error('THREE.Matrix4: .multiplyVector3Array() has been removed.')},rotateAxis:function(fm){console.warn('THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.'),fm.transformDirection(this)},crossVector:function(fm){return console.warn('THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.'),fm.applyMatrix4(this)},translate:function(){console.error('THREE.Matrix4: .translate() has been removed.')},rotateX:function(){console.error('THREE.Matrix4: .rotateX() has been removed.')},rotateY:function(){console.error('THREE.Matrix4: .rotateY() has been removed.')},rotateZ:function(){console.error('THREE.Matrix4: .rotateZ() has been removed.')},rotateByAxis:function(){console.error('THREE.Matrix4: .rotateByAxis() has been removed.')},applyToBuffer:function(fm){return console.warn('THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.'),this.applyToBufferAttribute(fm)},applyToVector3Array:function(){console.error('THREE.Matrix4: .applyToVector3Array() has been removed.')},makeFrustum:function(fm,hm,ym,xm,vm,_m){return console.warn('THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.'),this.makePerspective(fm,hm,xm,ym,vm,_m)}}),H.prototype.isIntersectionLine=function(fm){return console.warn('THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().'),this.intersectsLine(fm)},L.prototype.multiplyVector3=function(fm){return console.warn('THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.'),fm.applyQuaternion(this)},Object.assign(we.prototype,{isIntersectionBox:function(fm){return console.warn('THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().'),this.intersectsBox(fm)},isIntersectionPlane:function(fm){return console.warn('THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().'),this.intersectsPlane(fm)},isIntersectionSphere:function(fm){return console.warn('THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().'),this.intersectsSphere(fm)}}),Object.assign(Le.prototype,{area:function(){return console.warn('THREE.Triangle: .area() has been renamed to .getArea().'),this.getArea()},barycoordFromPoint:function(fm,hm){return console.warn('THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().'),this.getBarycoord(fm,hm)},midpoint:function(fm){return console.warn('THREE.Triangle: .midpoint() has been renamed to .getMidpoint().'),this.getMidpoint(fm)},normal:function(fm){return console.warn('THREE.Triangle: .normal() has been renamed to .getNormal().'),this.getNormal(fm)},plane:function(fm){return console.warn('THREE.Triangle: .plane() has been renamed to .getPlane().'),this.getPlane(fm)}}),Object.assign(Le,{barycoordFromPoint:function(fm,hm,ym,xm,vm){return console.warn('THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().'),Le.getBarycoord(fm,hm,ym,xm,vm)},normal:function(fm,hm,ym,xm){return console.warn('THREE.Triangle: .normal() has been renamed to .getNormal().'),Le.getNormal(fm,hm,ym,xm)}}),Object.assign(oi.prototype,{extractAllPoints:function(fm){return console.warn('THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.'),this.extractPoints(fm)},extrude:function(fm){return console.warn('THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.'),new Ca(this,fm)},makeGeometry:function(fm){return console.warn('THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.'),new Ha(this,fm)}}),Object.assign(S.prototype,{fromAttribute:function(fm,hm,ym){return console.warn('THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().'),this.fromBufferAttribute(fm,hm,ym)},distanceToManhattan:function(fm){return console.warn('THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().'),this.manhattanDistanceTo(fm)},lengthManhattan:function(){return console.warn('THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().'),this.manhattanLength()}}),Object.assign(A.prototype,{setEulerFromRotationMatrix:function(){console.error('THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.')},setEulerFromQuaternion:function(){console.error('THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.')},getPositionFromMatrix:function(fm){return console.warn('THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().'),this.setFromMatrixPosition(fm)},getScaleFromMatrix:function(fm){return console.warn('THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().'),this.setFromMatrixScale(fm)},getColumnFromMatrix:function(fm,hm){return console.warn('THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().'),this.setFromMatrixColumn(hm,fm)},applyProjection:function(fm){return console.warn('THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.'),this.applyMatrix4(fm)},fromAttribute:function(fm,hm,ym){return console.warn('THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().'),this.fromBufferAttribute(fm,hm,ym)},distanceToManhattan:function(fm){return console.warn('THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().'),this.manhattanDistanceTo(fm)},lengthManhattan:function(){return console.warn('THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().'),this.manhattanLength()}}),Object.assign(I.prototype,{fromAttribute:function(fm,hm,ym){return console.warn('THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().'),this.fromBufferAttribute(fm,hm,ym)},lengthManhattan:function(){return console.warn('THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().'),this.manhattanLength()}}),Object.assign(ee.prototype,{computeTangents:function(){console.error('THREE.Geometry: .computeTangents() has been removed.')},computeLineDistances:function(){console.error('THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.')}}),Object.assign(K.prototype,{getChildByName:function(fm){return console.warn('THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().'),this.getObjectByName(fm)},renderDepth:function(){console.warn('THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.')},translate:function(fm,hm){return console.warn('THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.'),this.translateOnAxis(hm,fm)},getWorldRotation:function(){console.error('THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.')}}),Object.defineProperties(K.prototype,{eulerOrder:{get:function(){return console.warn('THREE.Object3D: .eulerOrder is now .rotation.order.'),this.rotation.order},set:function(fm){console.warn('THREE.Object3D: .eulerOrder is now .rotation.order.'),this.rotation.order=fm}},useQuaternion:{get:function(){console.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.')},set:function(){console.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.')}}}),Object.defineProperties(_r.prototype,{objects:{get:function(){return console.warn('THREE.LOD: .objects has been renamed to .levels.'),this.levels}}}),Object.defineProperty(br.prototype,'useVertexTexture',{get:function(){console.warn('THREE.Skeleton: useVertexTexture has been removed.')},set:function(){console.warn('THREE.Skeleton: useVertexTexture has been removed.')}}),Object.defineProperty(zo.prototype,'__arcLengthDivisions',{get:function(){return console.warn('THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.'),this.arcLengthDivisions},set:function(fm){console.warn('THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.'),this.arcLengthDivisions=fm}}),nr.prototype.setLens=function(fm,hm){console.warn('THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.'),hm!==void 0&&(this.filmGauge=hm),this.setFocalLength(fm)},Object.defineProperties(ii.prototype,{onlyShadow:{set:function(){console.warn('THREE.Light: .onlyShadow has been removed.')}},shadowCameraFov:{set:function(fm){console.warn('THREE.Light: .shadowCameraFov is now .shadow.camera.fov.'),this.shadow.camera.fov=fm}},shadowCameraLeft:{set:function(fm){console.warn('THREE.Light: .shadowCameraLeft is now .shadow.camera.left.'),this.shadow.camera.left=fm}},shadowCameraRight:{set:function(fm){console.warn('THREE.Light: .shadowCameraRight is now .shadow.camera.right.'),this.shadow.camera.right=fm}},shadowCameraTop:{set:function(fm){console.warn('THREE.Light: .shadowCameraTop is now .shadow.camera.top.'),this.shadow.camera.top=fm}},shadowCameraBottom:{set:function(fm){console.warn('THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.'),this.shadow.camera.bottom=fm}},shadowCameraNear:{set:function(fm){console.warn('THREE.Light: .shadowCameraNear is now .shadow.camera.near.'),this.shadow.camera.near=fm}},shadowCameraFar:{set:function(fm){console.warn('THREE.Light: .shadowCameraFar is now .shadow.camera.far.'),this.shadow.camera.far=fm}},shadowCameraVisible:{set:function(){console.warn('THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.')}},shadowBias:{set:function(fm){console.warn('THREE.Light: .shadowBias is now .shadow.bias.'),this.shadow.bias=fm}},shadowDarkness:{set:function(){console.warn('THREE.Light: .shadowDarkness has been removed.')}},shadowMapWidth:{set:function(fm){console.warn('THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.'),this.shadow.mapSize.width=fm}},shadowMapHeight:{set:function(fm){console.warn('THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.'),this.shadow.mapSize.height=fm}}}),Object.defineProperties(re.prototype,{length:{get:function(){return console.warn('THREE.BufferAttribute: .length has been deprecated. Use .count instead.'),this.array.length}},copyIndicesArray:function(){console.error('THREE.BufferAttribute: .copyIndicesArray() has been removed.')}}),Object.assign(xe.prototype,{addIndex:function(fm){console.warn('THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().'),this.setIndex(fm)},addDrawCall:function(fm,hm,ym){ym!==void 0&&console.warn('THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.'),console.warn('THREE.BufferGeometry: .addDrawCall() is now .addGroup().'),this.addGroup(fm,hm)},clearDrawCalls:function(){console.warn('THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().'),this.clearGroups()},computeTangents:function(){console.warn('THREE.BufferGeometry: .computeTangents() has been removed.')},computeOffsets:function(){console.warn('THREE.BufferGeometry: .computeOffsets() has been removed.')}}),Object.defineProperties(xe.prototype,{drawcalls:{get:function(){return console.error('THREE.BufferGeometry: .drawcalls has been renamed to .groups.'),this.groups}},offsets:{get:function(){return console.warn('THREE.BufferGeometry: .offsets has been renamed to .groups.'),this.groups}}}),Object.assign(Ra.prototype,{getArrays:function(){console.error('THREE.ExtrudeBufferGeometry: .getArrays() has been removed.')},addShapeList:function(){console.error('THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.')},addShape:function(){console.error('THREE.ExtrudeBufferGeometry: .addShape() has been removed.')}}),Object.defineProperties(Hi.prototype,{dynamic:{set:function(){console.warn('THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.')}},onUpdate:{value:function(){return console.warn('THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.'),this}}}),Object.defineProperties(Te.prototype,{wrapAround:{get:function(){console.warn('THREE.Material: .wrapAround has been removed.')},set:function(){console.warn('THREE.Material: .wrapAround has been removed.')}},overdraw:{get:function(){console.warn('THREE.Material: .overdraw has been removed.')},set:function(){console.warn('THREE.Material: .overdraw has been removed.')}},wrapRGB:{get:function(){return console.warn('THREE.Material: .wrapRGB has been removed.'),new W}},shading:{get:function(){console.error('THREE.'+this.type+': .shading has been removed. Use the boolean .flatShading instead.')},set:function(fm){console.warn('THREE.'+this.type+': .shading has been removed. Use the boolean .flatShading instead.'),this.flatShading=fm===In}}}),Object.defineProperties(ao.prototype,{metal:{get:function(){return console.warn('THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.'),!1},set:function(){console.warn('THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead')}}}),Object.defineProperties(Ee.prototype,{derivatives:{get:function(){return console.warn('THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.'),this.extensions.derivatives},set:function(fm){console.warn('THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.'),this.extensions.derivatives=fm}}}),Object.assign(cr.prototype,{clearTarget:function(fm,hm,ym,xm){console.warn('THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead.'),this.setRenderTarget(fm),this.clear(hm,ym,xm)},animate:function(fm){console.warn('THREE.WebGLRenderer: .animate() is now .setAnimationLoop().'),this.setAnimationLoop(fm)},getCurrentRenderTarget:function(){return console.warn('THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().'),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn('THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().'),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn('THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.'),this.capabilities.precision},resetGLState:function(){return console.warn('THREE.WebGLRenderer: .resetGLState() is now .state.reset().'),this.state.reset()},supportsFloatTextures:function(){return console.warn('THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( \'OES_texture_float\' ).'),this.extensions.get('OES_texture_float')},supportsHalfFloatTextures:function(){return console.warn('THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( \'OES_texture_half_float\' ).'),this.extensions.get('OES_texture_half_float')},supportsStandardDerivatives:function(){return console.warn('THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( \'OES_standard_derivatives\' ).'),this.extensions.get('OES_standard_derivatives')},supportsCompressedTextureS3TC:function(){return console.warn('THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( \'WEBGL_compressed_texture_s3tc\' ).'),this.extensions.get('WEBGL_compressed_texture_s3tc')},supportsCompressedTexturePVRTC:function(){return console.warn('THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( \'WEBGL_compressed_texture_pvrtc\' ).'),this.extensions.get('WEBGL_compressed_texture_pvrtc')},supportsBlendMinMax:function(){return console.warn('THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( \'EXT_blend_minmax\' ).'),this.extensions.get('EXT_blend_minmax')},supportsVertexTextures:function(){return console.warn('THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.'),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn('THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( \'ANGLE_instanced_arrays\' ).'),this.extensions.get('ANGLE_instanced_arrays')},enableScissorTest:function(fm){console.warn('THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().'),this.setScissorTest(fm)},initMaterial:function(){console.warn('THREE.WebGLRenderer: .initMaterial() has been removed.')},addPrePlugin:function(){console.warn('THREE.WebGLRenderer: .addPrePlugin() has been removed.')},addPostPlugin:function(){console.warn('THREE.WebGLRenderer: .addPostPlugin() has been removed.')},updateShadowMap:function(){console.warn('THREE.WebGLRenderer: .updateShadowMap() has been removed.')},setFaceCulling:function(){console.warn('THREE.WebGLRenderer: .setFaceCulling() has been removed.')}}),Object.defineProperties(cr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(fm){console.warn('THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.'),this.shadowMap.enabled=fm}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(fm){console.warn('THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.'),this.shadowMap.type=fm}},shadowMapCullFace:{get:function(){return console.warn('THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.'),void 0},set:function(){console.warn('THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.')}}}),Object.defineProperties(er.prototype,{cullFace:{get:function(){return console.warn('THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.'),void 0},set:function(){console.warn('THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.')}},renderReverseSided:{get:function(){return console.warn('THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.'),void 0},set:function(){console.warn('THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.')}},renderSingleSided:{get:function(){return console.warn('THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.'),void 0},set:function(){console.warn('THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.')}}}),Object.defineProperties(D.prototype,{wrapS:{get:function(){return console.warn('THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.'),this.texture.wrapS},set:function(fm){console.warn('THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.'),this.texture.wrapS=fm}},wrapT:{get:function(){return console.warn('THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.'),this.texture.wrapT},set:function(fm){console.warn('THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.'),this.texture.wrapT=fm}},magFilter:{get:function(){return console.warn('THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.'),this.texture.magFilter},set:function(fm){console.warn('THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.'),this.texture.magFilter=fm}},minFilter:{get:function(){return console.warn('THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.'),this.texture.minFilter},set:function(fm){console.warn('THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.'),this.texture.minFilter=fm}},anisotropy:{get:function(){return console.warn('THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.'),this.texture.anisotropy},set:function(fm){console.warn('THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.'),this.texture.anisotropy=fm}},offset:{get:function(){return console.warn('THREE.WebGLRenderTarget: .offset is now .texture.offset.'),this.texture.offset},set:function(fm){console.warn('THREE.WebGLRenderTarget: .offset is now .texture.offset.'),this.texture.offset=fm}},repeat:{get:function(){return console.warn('THREE.WebGLRenderTarget: .repeat is now .texture.repeat.'),this.texture.repeat},set:function(fm){console.warn('THREE.WebGLRenderTarget: .repeat is now .texture.repeat.'),this.texture.repeat=fm}},format:{get:function(){return console.warn('THREE.WebGLRenderTarget: .format is now .texture.format.'),this.texture.format},set:function(fm){console.warn('THREE.WebGLRenderTarget: .format is now .texture.format.'),this.texture.format=fm}},type:{get:function(){return console.warn('THREE.WebGLRenderTarget: .type is now .texture.type.'),this.texture.type},set:function(fm){console.warn('THREE.WebGLRenderTarget: .type is now .texture.type.'),this.texture.type=fm}},generateMipmaps:{get:function(){return console.warn('THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.'),this.texture.generateMipmaps},set:function(fm){console.warn('THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.'),this.texture.generateMipmaps=fm}}}),Object.defineProperties(pr.prototype,{standing:{set:function(){console.warn('THREE.WebVRManager: .standing has been removed.')}},userHeight:{set:function(){console.warn('THREE.WebVRManager: .userHeight has been removed.')}}}),Ii.prototype.load=function(fm){console.warn('THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.');var hm=this,ym=new Li;return ym.load(fm,function(xm){hm.setBuffer(xm)}),this},zi.prototype.getData=function(){return console.warn('THREE.AudioAnalyser: .getData() is now .getFrequencyData().'),this.getFrequencyData()},Pi.prototype.updateCubeMap=function(fm,hm){return console.warn('THREE.CubeCamera: .updateCubeMap() is now .update().'),this.update(fm,hm)},cp.crossOrigin=void 0,cp.loadTexture=function(fm,hm,ym,xm){console.warn('THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.');var vm=new Do;vm.setCrossOrigin(this.crossOrigin);var _m=vm.load(fm,ym,void 0,xm);return hm&&(_m.mapping=hm),_m},cp.loadTextureCube=function(fm,hm,ym,xm){console.warn('THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.');var vm=new Io;vm.setCrossOrigin(this.crossOrigin);var _m=vm.load(fm,ym,void 0,xm);return hm&&(_m.mapping=hm),_m},cp.loadCompressedTexture=function(){console.error('THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.')},cp.loadCompressedTextureCube=function(){console.error('THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.')};const Au=Math.PI/6,Pu=1,Cu=0,Ru=0.01;class Iu{constructor(fm,hm,ym,xm){this.camera=new nr(45,fm/hm,0.25,200),this.camera.position.x=ym[0],this.camera.position.y=ym[1],this.camera.position.z=ym[2],this.camera.rotation.x=xm*Math.PI/180,this.isRotating=!1,this.rotationDirection=Pu}getCamera(){return this.camera}rotate(){if(this.isRotating||0!=this.camera.rotation.z){if(!this.isRotating){if(this.rotationDirection==Pu){if(0>this.camera.rotation.z&&(this.camera.rotation.z+=Ru,0<=this.camera.rotation.z))return this.camera.rotation.z=0,void(this.rotationDirection=Cu);this.camera.rotation.z+=Ru,this.camera.rotation.z>=Au&&(this.camera.rotation.z=Au,this.rotationDirection=Cu)}else{if(0<this.camera.rotation.z&&(this.camera.rotation.z-=Ru,0>=this.camera.rotation.z))return this.camera.rotation.z=0,void(this.rotationDirection=Pu);this.camera.rotation.z-=Ru,this.camera.rotation.z<=-Au&&(this.camera.rotation.z=-Au,this.rotationDirection=Pu)}return}this.rotationDirection==Pu?(this.camera.rotation.z+=Ru,this.camera.rotation.z>=Au&&(this.camera.rotation.z=Au,this.rotationDirection=Cu)):(this.camera.rotation.z-=Ru,this.camera.rotation.z<=-Au&&(this.camera.rotation.z=-Au,this.rotationDirection=Pu))}}setRotation(){this.isRotating=!0}unsetRotation(){this.isRotating=!1}}const Du=30;var zu;const Nu=200;class Bu{constructor(fm,hm,ym,xm){zu=2.5*fm;let vm=new Se(hm,ym),_m=new eo({color:xm});this.ground=new Pe(vm,_m),'/desktop/credits.php'==document.location.pathname&&(this.ground.receiveShadow=!0);let bm=new _e(Du,zu,Nu),Mm=new eo({color:5658198});this.rightSide=new Pe(bm,Mm),this.leftSide=new Pe(bm,Mm),'/desktop/credits.php'==document.location.pathname&&(this.rightSide.receiveShadow=!0,this.leftSide.receiveShadow=!0),this.rightSide.position.x=4*fm+Du/2,this.rightSide.position.y=zu/2,this.rightSide.position.z=-Nu/2+3,this.leftSide.position.x=-(4*fm+Du/2),this.leftSide.position.y=zu/2,this.leftSide.position.z=-Nu/2+3,this.ground.rotation.x=-90*Math.PI/180,this.changeColor(16777215*Math.random())}getGround(){return this.ground}changeColor(fm){this.getGround().material.color.setHex(fm),this.leftSide.material.color.setHex(fm),this.rightSide.material.color.setHex(fm)}}const Uu=3,Gu=10,Ou=-150,qu=2.5,Xu=16639,Yu=16776960,Zu=16639,Ju=16776960,Qu=65280,Ku=16777215;class $u{constructor(fm){if(this.length=Gu,this.obstacle=null,this.stopped=!1,this.time=0,this.positionZ=0,1==fm){var hm=new _e(Uu,Uu,Gu),ym=new Do,xm=ym.load('../images/mickey.jpg'),vm=[new eo({color:Xu}),new eo({color:Xu}),new eo({color:Xu}),new eo({color:Xu}),new Ae({map:xm}),new eo({color:Xu})];this.obstacle=new Pe(hm,vm),this.obstacle.position.y=Uu/2,this.obstacle.position.z=Ou,this.positionZ=Ou,this.obstacle.position.x=-qu}if(2==fm){var hm=new _e(Uu,Uu,Gu),ym=new Do,xm=ym.load('../images/donald.jpg'),vm=[new eo({color:Yu}),new eo({color:Yu}),new eo({color:Yu}),new eo({color:Yu}),new Ae({map:xm}),new eo({color:Yu})];this.obstacle=new Pe(hm,vm),this.obstacle.position.y=Uu/2,this.obstacle.position.z=Ou,this.positionZ=Ou,this.obstacle.position.x=qu}if(3==fm){var hm=new _e(Uu,Uu,Gu),ym=new Do,xm=ym.load('../images/marco.png'),vm=[new eo({color:Zu}),new eo({color:Zu}),new eo({color:Zu}),new eo({color:Zu}),new Ae({map:xm}),new eo({color:Zu})];this.obstacle=new Pe(hm,vm),this.obstacle.position.y=Uu/2,this.obstacle.position.z=Ou,this.positionZ=Ou,this.obstacle.position.x=qu}if(4==fm){var hm=new _e(Uu,Uu,Gu),ym=new Do,xm=ym.load('../images/christian.png'),vm=[new eo({color:Ju}),new eo({color:Ju}),new eo({color:Ju}),new eo({color:Ju}),new Ae({map:xm}),new eo({color:Ju})];this.obstacle=new Pe(hm,vm),this.obstacle.position.y=Uu/2,this.obstacle.position.z=Ou,this.positionZ=Ou,this.obstacle.position.x=-qu}if(5==fm){var hm=new _e(1.5*Uu,Uu,Gu),ym=new Do,xm=ym.load('../images/william.png'),vm=[new eo({color:Qu}),new eo({color:Qu}),new eo({color:Qu}),new eo({color:Qu}),new Ae({map:xm}),new eo({color:Qu})];this.obstacle=new Pe(hm,vm),this.obstacle.position.y=Uu/2,this.obstacle.position.z=Ou,this.positionZ=Ou,this.obstacle.position.x=0}if(6==fm){var hm=new _e(1.5*Uu,Uu,Gu),ym=new Do,xm=ym.load('../images/thanks.png'),vm=[new eo({color:Ku}),new eo({color:Ku}),new eo({color:Ku}),new eo({color:Ku}),new Ae({map:xm}),new eo({color:Ku})];this.obstacle=new Pe(hm,vm),this.obstacle.position.y=Uu/2,this.obstacle.position.z=Ou,this.positionZ=Ou,this.obstacle.position.x=0}'/desktop/credits.php'==document.location.pathname&&(this.obstacle.receiveShadow=!0,this.obstacle.castShadow=!0)}addStep(fm){this.obstacle.position.z+=fm,this.positionZ+=fm}setPositionZ(fm){this.obstacle.position.z=fm,this.positionZ=fm}}const tm=[0,5,8],om=0.9,im=1,nm=140,sm=-6;class cm{constructor(fm,hm){this.notFinished=!0,this.scene=new gr,this.camera=new Iu(fm,hm,tm,-20),this.ground=new Bu(1.5,500,500,0),this.scene.fog=new mr(16777215,50,140),this.firstObstacle,this.secondObstacle,this.thirdObstacle,this.thanksObstacle,this.firstText,this.living_obstacles=0,this.VELOCITY_STEP=0.5,this.hemisphereLight=new ni(16777215,0,om),this.sun=new mi(16777215,om),this.scenetime=0,this.clock=new Ci,this.walkingThings=[],this.generateSituation(),this.addObjectsToScene()}generateSituation(){if(0==this.scenetime){this.firstObstacle=new $u(1),this.scene.add(this.firstObstacle.obstacle);this.walkingThings.push(this.firstObstacle);this.firstText=new $u(3),this.scene.add(this.firstText.obstacle),this.walkingThings.push(this.firstText)}250==this.scenetime&&(this.secondObstacle=new $u(2),this.scene.add(this.secondObstacle.obstacle),this.walkingThings.push(this.secondObstacle),this.secondText=new $u(4),this.scene.add(this.secondText.obstacle),this.walkingThings.push(this.secondText)),500==this.scenetime&&(this.thirdText=new $u(5),this.scene.add(this.thirdText.obstacle),this.walkingThings.push(this.thirdText)),750==this.scenetime&&(this.thanksObstacle=new $u(6),this.scene.add(this.thanksObstacle.obstacle),this.walkingThings.push(this.thanksObstacle)),1150==this.scenetime&&(this.notFinished=!1,'/desktop/credits.php'==document.location.pathname?document.onkeydown=this.handleKeyDown.bind(this):this.enableSwipes())}handleKeyDown(fm){32==fm.keyCode?window.location.replace('game.php'):'swipeup'==fm&&window.location.replace('game_mobile.php')}enableSwipes(){let fm=new Hammer(document.getElementById('fullspace'));fm.get('swipe').set({direction:Hammer.DIRECTION_ALL}),fm.on('swipeleft swiperight swipeup',hm=>this.handleKeyDown(hm.type))}addObjectsToScene(){this.scene.add(this.ground.ground),this.scene.add(this.ground.rightSide),this.scene.add(this.ground.leftSide),this.addLight()}addLight(){this.sun.position.set(12,6,7),'/desktop/credits.php'==document.location.pathname&&(this.sun.castShadow=!0,this.sun.shadow.mapSize.width=256,this.sun.shadow.mapSize.height=256,this.sun.shadow.camera.near=0.5,this.sun.shadow.camera.far=50),this.scene.add(this.sun),this.scene.add(this.hemisphereLight)}getScene(){return this.scene}getNextMovement(){for(let fm=0;fm<this.walkingThings.length;fm++)this.walk(this.walkingThings[fm]);for(let fm=0;fm<this.walkingThings.length;fm++)this.walkingThings[fm].stopped&&(this.walkingThings[fm].time+=1);this.scenetime+=1,this.generateSituation()}walk(fm){if(!fm.stopped&&fm.positionZ<sm)fm.addStep(im);else if(!fm.stopped&&fm.positionZ>=sm)fm.setPositionZ(sm),fm.stopped=!0;else if(fm.stopped&&fm.time<nm);else fm.stopped&&fm.time>nm&&(fm.addStep(im),fm.positionZ>10&&this.walkingThings.splice(this.walkingThings.indexOf(fm),1))}}class um{constructor(){this.clock=new Ci,this.sceneWidth=window.innerWidth,this.sceneHeight=window.innerHeight,this.renderer='/desktop/credits.php'==document.location.pathname?new cr({antialias:!0}):new cr,this.myscene=new cm(this.sceneWidth,this.sceneHeight),window.addEventListener('resize',this.onWindowResize.bind(this),!1),this.inizializeCanvas()}inizializeCanvas(){this.renderer.setClearColor(16775930,1),this.renderer.setPixelRatio(window.devicePixelRatio),'/desktop/credits.php'==document.location.pathname&&(this.renderer.shadowMap.enabled=!0),this.renderer.setSize(this.sceneWidth,this.sceneHeight),document.body.appendChild(this.renderer.domElement)}renderize(){this.renderer.render(this.myscene.getScene(),this.myscene.camera.getCamera())}goGame(){window.requestAnimationFrame(this.goGame.bind(this)),this.myscene.notFinished?this.myscene.getNextMovement():document.getElementById('bottomText').style.visibility='visible',this.renderize()}onWindowResize(){this.sceneHeight=window.innerHeight,this.sceneWidth=window.innerWidth,this.renderer.setSize(this.sceneWidth,this.sceneHeight),this.myscene.camera.getCamera().aspect=this.sceneWidth/this.sceneHeight,this.myscene.camera.getCamera().updateProjectionMatrix()}}var mm=sessionStorage.getItem('isSoundActive');null==mm&&(mm='true',sessionStorage.setItem('isSoundActive','true'));var gm;$(document).ready(function(){_n();var fm=new um;document.getElementById('bottomText').style.visibility='hidden',fm.goGame()})})();